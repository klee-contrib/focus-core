{"version":3,"file":"dist\\app.js","sources":["lib/config.coffee","lib/core/http_response_parser.js","lib/helpers/backbone_notification.js","lib/helpers/custom_exception.coffee","lib/helpers/error_helper.js","lib/helpers/form_helper.js","lib/helpers/formatter_helper.coffee","lib/helpers/header_helper.js","lib/helpers/language_helper.coffee","lib/helpers/message_helper.js","lib/helpers/metadata_builder.coffee","lib/helpers/model_validation_promise.js","lib/helpers/odata_helper.js","lib/helpers/post_rendering_builder.js","lib/helpers/post_rendering_helper.js","lib/helpers/promisify_helper.js","lib/helpers/reference_helper.js","lib/helpers/router.js","lib/helpers/session_helper.js","lib/helpers/site_description_builder.js","lib/helpers/site_description_helper.js","lib/helpers/url_helper.js","lib/helpers/user_helper.js","lib/helpers/util_helper.js","lib/helpers/validators.js","lib/helpers/view_helper.coffee","lib/infos.js","lib/main.js","lib/models/collection.coffee","lib/models/header-item.js","lib/models/header-items.js","lib/models/model.coffee","lib/models/notification.js","lib/models/notifications.js","lib/models/paginatedCollection.js","lib/templates/helpers/common/template_helper.coffee","lib/templates/helpers/debug.coffee","lib/templates/helpers/pick.coffee","lib/templates/helpers/translate.coffee","lib/templates/templateHelper.js","lib/templates/templates.js","lib/views/collection-pagination-view.js","lib/views/composite-view.js","lib/views/consult-edit-view.js","lib/views/core-view.js","lib/views/header-items-view.js","lib/views/header-view.js","lib/views/list-view.js","lib/views/modal-view.js","lib/views/notifications-view.js","lib/views/search-results-view.js","lib/views/search-view.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,C;ECAA;AAAA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/LA;AAAA,CCAA;AAAA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1GA;AAAA,C;ACCA;iSAAA;CAAA,CAAC,SAAC,EAAD;AACC;AAAA;AAAA,EAGA,KAAK,MAAM,EAHX;AAAA,EAIA,cAAc,kBAAiB,WAAjB,IAAiC,kBAAmB,WAJlE;AAMA;;;KANA;AAAA,EAUM;AAEQ,6BAAE,IAAF,EAAS,OAAT,EAAkB,OAAlB;AACV,MADW,IAAC,YACZ;AAAA,MADkB,IAAC,kBACnB;AAAA,MAD2B,IAAC,kBAC5B;AAAA,UAAC,IAAD,GADU;IAAA,CAAZ;CAAA,8BAGA,MAAK;aACH,OAAO,CAAC,KAAR,CAAc,MAAd,EAAsB,IAAC,KAAvB,EAA6B,SAA7B,EAAwC,IAAC,QAAzC,EAAkD,SAAlD,EAA6D,IAAC,QAA9D,EADG;IAAA,CAHL;CAAA,8BAMA,SAAO;AACL,aAAO;AAAA,QAAC,QAAQ,IAAC,KAAV;AAAA,QAAgB,WAAW,IAAC,QAA5B;AAAA,QAAsC,WAAW,IAAC,QAAlD;OAAP,CADK;IAAA,CANP;4BAAA;OAZF;AAAA,EAqBM;AACJ;CAAY,qCAAC,OAAD,EAAU,OAAV;AACV,+DAAM,yBAAN,EAAiC,OAAjC,EAA0C,OAA1C,EADU;IAAA,CAAZ;oCAAA;MADoC,gBArBtC;AAAA,EAyBM;AACJ;CAAY,mCAAC,OAAD;AACV,6DAAM,cAAN,EAAsB,OAAtB,EADU;IAAA,CAAZ;kCAAA;MADkC,gBAzBpC;AAAA,EA6BM;AACJ;CAAY,sCAAC,OAAD,EAAU,OAAV;AACV,gEAAM,0BAAN,EAAkC,OAAlC,EAA2C,OAA3C,EADU;IAAA,CAAZ;qCAAA;MADqC,gBA7BvC;AAAA,EAgCM;AACJ;CAAY,iCAAC,OAAD,EAAU,OAAV;AACV,2DAAM,qBAAN,EAA6B,OAA7B,EAAsC,OAAtC,EADU;IAAA,CAAZ;gCAAA;MADgC,gBAhClC;AAAA,EAmCA,MAAM;AAAA,IACJ,iBAAiB,eADb;AAAA,IAEJ,yBAAyB,uBAFrB;AAAA,IAGJ,uBAAuB,qBAHnB;AAAA,IAIJ,0BAA0B,wBAJtB;AAAA,IAKJ,qBAAqB,mBALjB;GAnCN;AA0CA,MAAG,WAAH;AACE,MAAE,CAAC,OAAH,GAAa,EAAE,CAAC,OAAH,IAAc,EAA3B;WACA,EAAE,CAAC,OAAO,CAAC,UAAX,GAAwB,IAF1B;GAAA;WAIE,MAAM,CAAC,OAAP,GAAiB,IAJnB;GA3CD;AAAA,CAAD,EAgDK,kBAAiB,WAAjB,IAAiC,kBAAmB,WAAvD,GAAwE,MAAM,CAAC,GAA/E,GAAwF,MAAM,CAAC,OAhDjG;;ECDA;AAAA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvXA;AAAA,CCAA;AAAA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AAC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AC,OAAH,GAAa,EAAE,CAAC,OAAH,IAAc,EAA3B;AAAA,IACA,EAAE,CAAC,OAAO,CAAC,eAAX,GAA6B,eAD7B;WAEA,EAAE,CAAC,OAAO,CAAC,eAAX,GAAiC,sBAHnC;GAAA;WAKE,MAAM,CAAC,OAAP,GAAiB;AAAA,MAAC,iBAAiB,eAAlB;AAAA,MAAmC,iBAAqB,qBAAxD;MALnB;GArJD;AAAA,CAAD,EA2JK,kBAAiB,WAAjB,IAAiC,kBAAmB,WAAvD,GAAwE,MAAM,CAAC,GAA/E,GAAwF,MAAM,CAAC,OA3JjG,CADA;;ECAA;AAAA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtIA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxNA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AAzCA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AA7FA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7PA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7EA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/DA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1HA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArPA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnEA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzFA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlPA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AArKA;AAAA,C;ACGA;CAAA,gBAAgB,GAAG,CAAC,OAAO,CAAC,eAA5B;CAAA,kBACA,GAAqB,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,UAA5B,EADrB;CAAA,UAGU,CAAC,cAAX,CAA0B,MAA1B,EAAkC,SAAC,GAAD,EAAM,OAAN;AAChC,SAAO,OAAO,CAAC,IAAK,KAApB,CADgC;AAAA,CAAlC,CAHA;CAAA,UAOU,CAAC,cAAX,CAA0B,GAA1B,EAA+B,SAAC,QAAD,EAAW,OAAX;AAC7B;AAAA,QAAM,OAAO,CAAC,IAAR,IAAgB,EAAtB;AAAA,EACA,SAAU,GAAG,CAAC,MAAJ,IAAc,EADxB;AAAA,EAEA,SAAS,GAAG,CAAC,MAAJ,IAAc,EAFvB;AAAA,EAGA,YAAY,GAAG,CAAC,GAHhB;AAIA,MAA+B,GAAG,CAAC,YAAJ,KAAoB,IAAnD;AAAA,IAAC,WAAW,IAAK,UAAjB;GAJA;AAAA,EAMA,SAAY,kBAAH,GAAoB,GAAG,CAAC,MAAM,CAAC,KAAX,CAAiB,GAAjB,CAApB,GAA+C,MANxD;AAAA,EAOA,OAAO,CAAC,GAAR,CAAY,GAAG,CAAC,MAAhB,EAAwB,CAAC,CAAC,IAAI,CAAC,KAAP,CAAa,IAAb,EAAgB,MAAhB,CAAxB,CAPA;AAAA,EAQA,SAAY,cAAH,GAAgB,CAAC,CAAC,IAAI,CAAC,KAAP,CAAa,IAAb,EAAgB,MAAhB,CAAhB,GAA6C,MARtD;AAAA,EASA,SAAS,IAAI,CAAC,CAAL,CAAO,KAAG,MAAH,GAAY,QAAZ,GAAuB,MAA9B,EAAwC,MAAxC,CATT;AAUA,MAAG,uBAAe,YAAY,MAAM,CAAC,MAArC;AAAiD,aAAS,KAAE,CAAC,MAAM,CAAC,KAAP,CAAa,CAAb,EAAe,UAAf,CAAD,CAAF,GAA8B,KAAvC,CAAjD;GAVA;SAWI,cAAU,CAAC,UAAX,CAAsB,MAAtB,EAZyB;AAAA,CAA/B,CAPA;CAAA,UAsBU,CAAC,cAAX,CAA0B,OAA1B,EAAmC,SAAC,aAAD;AACjC,SAAO,CAAC,GAAR,CAAY,iBAAZ;AAAA,EACA,OAAO,CAAC,GAAR,CAAY,sBAAZ,CADA;AAAA,EAEA,OAAO,CAAC,GAAR,CAAY,IAAZ,CAFA;AAGA,MAAG,aAAH;AACE,WAAO,CAAC,GAAR,CAAY,OAAZ;AAAA,IACA,OAAO,CAAC,GAAR,CAAY,sBAAZ,CADA;WAEA,OAAO,CAAC,GAAR,CAAY,aAAZ,EAHF;GAJiC;AAAA,CAAnC,CAtBA;CA+BA;AAAA,gHA/BA;CAAA,UAgCU,CAAC,cAAX,CAA0B,aAA1B,EAAyC,SAAC,QAAD,EAAW,OAAX;AACvC;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,MAAM,OAAO,CAAC,IAAR,IAAgB,EADtB;AAAA,EAEA,YAAY,IAAI,CAAC,SAAL,IAAkB,GAAG,CAAC,SAAtB,IAAmC,MAF/C;AAAA,EAGA,YAAY,CAAC,CAAC,MAAF,CAAS,IAAT,EAAe;AAAA,IAAC,WAAW,SAAZ;GAAf,CAHZ;AAAA,EAIA,WAAW,aAAa,CAAC,uBAAd,CAAsC,SAAtC,EAAgD,QAAhD,CAJX;AAAA,EAKA,SAAU,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,UAA5B,EAAyC,SAAQ,CAAC,MAAT,CAAzC,IAA6D,EALvE;AAAA,EAMA,kBAAkB,GAAG,CAAC,eAAJ,IAAuB,MANzC;AAAA,EAOA,WAAW,GAAG,CAAC,QAAJ,IAAgB,MAAM,CAAC,IAAvB,IAA+B,MAP1C;AAQA,MAA2B,aAAY,SAAvC;AAAA,IAAC,WAAW,UAAZ;GARA;AAAA,EASA,mBAAmB,GAAG,CAAC,gBAAJ,IAAwB,EAT3C;AAAA,EAUA,eAAe,GAAG,CAAC,YAAJ,IAAoB,EAVnC;AAAA,EAWA,iBAAoB,GAAG,CAAC,SAAP,GAAsB,CAAtB,GAAgC,GAAG,CAAC,SAAP,GAAsB,GAAG,CAAC,SAA1B,GAAyC,CAXvF;AAAA,EAYA,YAAa,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAZxE;AAAA,EAaA,MAAS,eAAH,GAAiB,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,IAAvB,CAA4B,IAA5B,EAAkC,GAAG,CAAC,GAAtC,CAAjB,GAAiE,EAbvE;AAAA,EAcA,SAAY,kBAAH,GAAoB,GAAG,CAAC,MAAxB,GAAoC,KAd7C;AAAA,EAeA,SAAY,kBAAH,GAAoB,GAAG,CAAC,MAAxB,GAAoC,KAf7C;AAAA,EAgBA,SAAY,kBAAH,GAAqB,SAAM,GAAG,CAAC,MAAV,GAAiB,GAAtC,GAA8C,EAhBvD;AAAA,EAiBA,SAAY,kBAAH,GAAoB,GAAG,CAAC,MAAxB,GAAoC,EAjB7C;AAAA,EAmBA,WAAW;WAAA;AACT,UAAG,MAAH;AAAe,eAAQ,cAAW,MAAX,GAAkB,gBAA1B,CAAf;OAAA;AAA8D,eAAO,EAAP,CAA9D;OADS;IAAA;EAAA,QAnBX;AAAA,EAqBA,YAAY;WAAA;AACV,UAAG,MAAH;AAAe,eAAO,MAAP,CAAf;OAAA;AAAkC,eAAO,EAAP,CAAlC;OADU;IAAA;EAAA,QArBZ;AAAA,EAwBA,YAAY;WAAA;AAEV;AAAA,UAAG,UAAU,GAAG,CAAC,YAAjB;eACE,YAAY,GADd;OAAA;AAGE,yBAAiB,KAAK,cAAtB;eACA,YAAY,GAAG,CAAC,SAAJ,IAAiB,CAAC,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAA5D,EAJ/B;OAFU;IAAA;EAAA,QAxBZ;AAAA,EAiCA,iBAAgB;WAAA;AACd;AAAA,oBAAc,GAAG,CAAC,cAAJ,IAAsB,QAAQ,CAAC,KAA/B,IAAwC,CAAuC,0BAAtC,QAAG,KAAK,aAAR,GAAqB,GAArB,GAAwB,QAAxB,SAAD,CAAxC,IAAsG,EAApH;AACA,UAAG,uBAAH;AACE,sBAAe,CAAI,CAAC,uBAAD,KAAuB,2BAA0B,QAApD,GAAkE,kBAAkB,GAApF,GAA6F,EAA9F,CAAD,GAAsG,QAApH,CADF;OADA;AAGO,UAAG,gBAAe,EAAlB;eAA2B,GAA3B;OAAA;eAAmC,IAAI,CAAC,CAAL,CAAO,WAAP,EAAnC;OAJO;IAAA;EAAA,QAjChB;AAAA,EAuCA,QAAQ;WAAA;AACN,UAAG,qBAAH;AACE,eAAO,EAAP,CADF;OAAA,MAEK,IAAG,MAAH;AACH,eAAO,KAAE,CAAC,gBAAD,CAAT,CADG;OAAA;AAGH,eAAQ,iCAA8B,SAA9B,GAAwC,SAAxC,GAAiD,QAAjD,GAA0D,IAA1D,GAA6D,CAAC,gBAAD,CAA7D,GAA+E,UAAvF,CAHG;OAHC;IAAA;EAAA,QAvCR;AAAA,EA+CA,gBAAiB;WAAA;AACf;AAAA,sBAAmB,sBAAH,GAAwB,QAAQ,CAAC,KAAjC,GAA4C,EAA5D;AAEA,UAAG,uBAAH;AACE,oBAAY,KAAK,UAAjB;AACA,YAAG,mBAAH;AACE,gBAAM,KAAK,UAAX;AAAA,UACA,QAAQ,CAAC,CAAC,SAAF,CAAY,KAAM,IAAG,CAAC,OAAJ,CAAlB,EAAgC;AAAA,YAAC,MAAK,KAAM,UAAZ;WAAhC,CADR;AAEA,cAAO,aAAP;AACG,oBAAQ,CAAC,CAAC,SAAF,CAAY,KAAM,IAAG,CAAC,OAAJ,CAAlB,EAAgC;AAAA,cAAC,IAAG,KAAM,UAAV;aAAhC,CAAR,CADH;WAFA;AAIA,cAAG,aAAH;AACE,wBAAe,GAAG,CAAC,aAAP,GAA0B,KAAM,IAAG,CAAC,aAAJ,CAAhC,GAAwD,KAAK,CAAC,KAA1E,CADF;WAAA;AAGE,wBAAY,MAAZ,CAHF;WALF;SADA;AAUA,YAAG,MAAH;AACE,iBAAO,KAAE,CAAC,CAAC,CAAC,MAAF,CAAS,SAAT,CAAD,CAAT,CADF;SAVA;AAYA,YAAG,6BAAsB,+BAAzB;AAEE,sBAAa,QAAQ,CAAC,MAAM,CAAC,KAAhB,CAAsB,SAAtB,EAAiC,QAAQ,CAAC,MAAM,CAAC,OAAjD,CAAb,CAFF;SAZA;AAeA,YAAG,uBAAH;AACE,sBAAY,YAAY,GAAZ,GAAkB,IAAI,CAAC,CAAL,CAAO,QAAQ,CAAC,MAAhB,CAA9B,CADF;SAfA;AAiBA,YAAG,aAAY,UAAf;AACG,sBAAe,KAAK,UAAR,GAAuB,IAAI,CAAC,CAAL,CAAO,oBAAP,CAAvB,GAAyD,IAAI,CAAC,CAAL,CAAO,qBAAP,CAArE,CADH;SAjBA;AAmBA,YAAG,aAAY,MAAZ,IAAuB,KAAK,UAAL,KAAoB,EAA9C;AACE,iBAAQ,UAAO,MAAP,GAAc,UAAd,GAAwB,aAAxB,GAAsC,IAAtC,GAA0C,SAA1C,GAAoD,QAA5D,CADF;SAAA;AAEK,iBAAQ,UAAO,MAAP,GAAc,UAAd,GAAwB,aAAxB,GAAsC,IAAtC,GAAyC,CAAC,UAAD,CAAzC,GAAsD,CAAC,CAAC,CAAC,MAAF,CAAS,SAAT,CAAD,CAAtD,GAA4E,CAAC,WAAD,CAA5E,GAAyF,QAAjG,CAFL;SApBF;OAFA;AAyBA,aAAO,EAAP,CA1Be;IAAA;EAAA,QA/CjB;AA0EA,MAAG,MAAH;AAAe,WAAW,cAAU,CAAC,UAAX,CAAsB,KAAE,CAAC,OAAD,CAAF,GAAW,GAAX,GAAa,CAAC,eAAD,CAAnC,CAAX,CAAf;GA1EA;AAAA,EA2EA,OAAQ,4BAAyB,GAAzB,GAA6B,KAA7B,GACG,CAAC,OAAD,CADH,GACY,eADZ,GAEe,CAAC,WAAD,CAFf,GAE4B,GAF5B,GAE+B,YAF/B,GAE4C,IAF5C,GAEgD,gBAFhD,GAEiE,qCAFjE,GAGsC,CAAC,eAAD,CAHtC,GAGuD,uBA9E/D;AAiFA,SAAW,cAAU,CAAC,UAAX,CAAsB,IAAtB,CAAX,CAlFuC;AAAA,CAAzC,CAhCA;CAAA,UAoHU,CAAC,cAAX,CAA0B,qBAA1B,EAAiD;SAAA,SAAC,QAAD,EAAW,OAAX;AAC/C;AAAA,UAAM,OAAO,CAAC,IAAR,IAAgB,EAAtB;AAAA,IACA,QAAM,GAAG,CAAC,KADV;AAEA,QAAG,CAAC,CAAC,QAAF,CAAW,QAAX,EAAqB,KAArB,CAAH;AACE,aAAO,GAAG,CAAC,QAAD,CAAV,CADF;KAFA;AAIA,WAAO,EAAP,CAL+C;EAAA;AAAA,QAAjD,CApHA;CAAA,UA2HU,CAAC,cAAX,CAA0B,WAA1B,EAAuC,SAAC,QAAD,EAAW,OAAX;AACrC;AAAA,YAAU,WAAW,EAArB;AAAA,EAEA,OAAO,MAFP;AAAA,EAGA,kBAAkB,MAHlB;AAAA,EAIA,WAAW,MAJX;AAAA,EAMA,MAAM,OAAO,CAAC,IAAR,IAAgB,EANtB;AAAA,EAOA,YAAY,IAAI,CAAC,SAAL,IAAkB,GAAG,CAAC,SAAtB,IAAmC,MAP/C;AAAA,EAQA,YAAY,CAAC,CAAC,MAAF,CAAS,IAAT,EAAe;AAAA,IAAC,WAAW,SAAZ;GAAf,CARZ;AAAA,EASA,WAAW,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,uBAA5B,CAAoD,SAApD,EAA8D,QAA9D,CATX;AAAA,EAWA,SAAS,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,UAA5B,EAAyC,SAAQ,CAAC,MAAT,CAAzC,IAA6D,EAXtE;AAAA,EAaA,cAAiB,uBAAH,GAAyB,GAAG,CAAC,WAA7B,GAA8C,KAb5D;AAAA,EAcA,SAAY,GAAG,CAAC,MAAP,GAAmB,GAAG,CAAC,MAAvB,GAAmC,KAd5C;AAAA,EAeA,aAAa,SAAC,OAAD;AACX;AAAA,cAAU,EAAV;AACA,QAAG,GAAG,CAAC,UAAP;AACE,mBAAa,GAAG,CAAC,UAAU,CAAC,KAAf,CAAqB,GAArB,CAAb;AAAA,MACA,UAAU,CAAC,OAAX,CAAmB,SAAC,SAAD;AACjB,YAAG,OAAQ,WAAX;iBACE,UAAU,UAAU,CAAC,UAAO,SAAP,GAAiB,IAAjB,GAAqB,OAAQ,WAA7B,GAAwC,GAAzC,EADtB;SADiB;MAAA,CAAnB,CADA,CADF;KADA;AAOA,WAAO,OAAP,CARW;EAAA,CAfb;AAAA,EAwBA,oBAAoB,KAxBpB;AAAA,EAyBA,aAAa;WAAA;AACX,0BAAoB,KAApB;AACA,UAAG,sBAAH;AACE,4BAAoB,GAAG,CAAC,UAAxB,CADF;OAAA,MAEK,IAAG,yBAAH;AACH,4BAAoB,QAAQ,CAAC,QAA7B,CADG;OAHL;AAKO,UAAG,iBAAH;eAA0B,2CAA1B;OAAA;eAA0E,GAA1E;OANI;IAAA;EAAA,QAzBb;AAAA,EAgCA,SAAS;WAAA;AACP;AAAA,iBAAW,KAAX;AAEA,UAAG,kBAAH;AACE,mBAAW,GAAG,CAAC,MAAf,CADF;OAAA,MAEK,IAAG,uBAAH;AACH,mBAAW,QAAQ,CAAC,MAApB,CADG;OAJL;AAOO,UAAG,QAAH;eAAkB,qCAAkC,QAAlC,GAA2C,UAA7D;OAAA;eAA2E,GAA3E;OARA;IAAA;EAAA,QAhCT;AAAA,EA0CA,kBAAkB,GAAG,CAAC,eAAJ,IAAuB,MA1CzC;AAAA,EA2CA,WAAW,GAAG,CAAC,QAAJ,IAAgB,MAAM,CAAC,IAAvB,IAA+B,MA3C1C;AA4CA,MAA2B,aAAY,SAAvC;AAAA,IAAC,WAAW,UAAZ;GA5CA;AAAA,EA6CA,WAAW,GAAG,CAAC,QAAJ,IAAgB,KA7C3B;AAAA,EA8CA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,EA9C5C;AAAA,EA+CA,WAAW,GAAG,CAAC,QAAJ,IAAgB,KA/C3B;AAAA,EAgDA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,EAhD5C;AAAA,EAiDA,kBAAiB,IAAK,IAAG,CAAC,eAAJ,CAAL,IAA6B,GAAG,CAAC,eAAjC,IAAoD,EAjDrE;AAAA,EAkDA,UAAa,IAAG,CAAC,YAAJ,GAAmB,IAAnB,CAAH,GAAiC,UAAO,IAAC,IAAR,GAAY,GAA7C,GAAqD,EAlD/D;AAAA,EAoDA,mBAAmB,GAAG,CAAC,gBAAJ,IAAwB,EApD3C;AAAA,EAqDA,eAAe,GAAG,CAAC,YAAJ,IAAoB,EArDnC;AAAA,EAsDA,iBAAoB,GAAG,CAAC,SAAP,GAAsB,CAAtB,GAAgC,GAAG,CAAC,SAAP,GAAsB,GAAG,CAAC,SAA1B,GAAyC,CAtDvF;AAAA,EAuDA,YAAa,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAvDxE;AAAA,EAwDA,MAAS,eAAH,GAAiB,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,IAAvB,CAA4B,IAA5B,EAAkC,GAAG,CAAC,GAAtC,CAAjB,GAAiE,EAxDvE;AAAA,EA0DA,YAAY;WAAA;AAEV;AAAA,UAAG,UAAU,GAAG,CAAC,YAAjB;eACE,YAAY,GADd;OAAA;AAGE,yBAAiB,KAAK,cAAtB;eACA,YAAY,GAAG,CAAC,SAAJ,IAAiB,CAAC,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAA5D,EAJ/B;OAFU;IAAA;EAAA,QA1DZ;AAAA,EAmEA,eAAe,QAAQ,kBAAR,IAAsB,CAAC,GAAG,CAAC,UAAJ,IAAkB,QAAQ,CAAC,QAA5B,CAAD,KAA2C,IAAhE,IAAwE,yCAnEvF;AAAA,EAqEA,gBAAiB;WAAA;AACf;AAAA,UAAG,uBAAH;AACE,oBAAY,KAAK,UAAjB;AACA,YAAG,6BAAqB,+BAAxB;AAEE,sBAAa,QAAQ,CAAC,MAAM,CAAC,KAAhB,CAAsB,SAAtB,EAAiC,QAAQ,CAAC,MAAM,CAAC,OAAjD,CAAb,CAFF;SADA;AAIA,YAAG,aAAY,UAAf;AACE,cAAG,SAAH;AAAkB,mBAAO,SAAP,CAAlB;WADF;SAJA;AAMA,YAAG,aAAY,MAAZ,IAAuB,cAAe,EAAzC;AACE,iBAAO,YAAY,SAAZ,GAAwB,GAA/B,CADF;SANA;AAQA,YAAG,aAAY,QAAf;AACE,iBAAO,YAAY,QAAQ,SAAR,CAAkB,CAAC,KAAnB,EAAZ,GAAyC,GAAhD,CADF;SAAA;AAEK,iBAAQ,YAAQ,CAAC,CAAC,CAAC,MAAF,CAAS,SAAT,CAAD,CAAR,GAA6B,GAArC,CAFL;SATF;OAAA;aAYA,GAbe;IAAA;EAAA,QArEjB;AAAA,EAoFA,iBAAgB;WAAA;AACd;AAAA,oBAAc,GAAG,CAAC,cAAJ,IAAsB,QAAQ,CAAC,KAA/B,IAAwC,CAAuC,0BAAtC,QAAG,KAAK,aAAR,GAAqB,GAArB,GAAwB,QAAxB,SAAD,CAAxC,IAAsG,EAApH;AACA,UAAG,uBAAH;AACE,sBAAe,CAAI,CAAC,uBAAD,KAAuB,2BAA0B,QAApD,GAAkE,kBAAkB,GAApF,GAA6F,EAA9F,CAAD,GAAsG,QAApH,CADF;OADA;AAIO,UAAG,gBAAe,EAAlB;eAA2B,GAA3B;OAAA;eAAmC,IAAI,CAAC,CAAL,CAAO,WAAP,EAAnC;OALO;IAAA;EAAA,QApFhB;AAAA,EA4FA,OAAO;WAAA;AAEL,UAAG,gBAAH;eAAmB,qDAAkD,GAAG,CAAC,IAAtD,GAA2D,wBAA9E;OAAA;eAA0G,GAA1G;OAFK;IAAA;EAAA,QA5FP;AAAA,EAgGA,QAAQ;WAAA;AACN,UAAG,qBAAH;AACE,eAAO,EAAP,CADF;OAAA;AAGE,eAAQ,iCAA8B,SAA9B,GAAwC,SAAxC,GAAiD,QAAjD,GAA0D,IAA1D,GAA6D,CAAC,gBAAD,CAA7D,GAA+E,UAAvF,CAHF;OADM;IAAA;EAAA,QAhGR;AAAA,EAuGA,cAAiB,CAAE,yBAAD,IAAsB,GAAG,CAAC,SAA3B,KAAyC,GAAG,CAAC,WAAhD,GAAkE,kBAAc,CAAC,gBAAD,CAAd,GAAgC,GAAlG,GAA0G,EAvGxH;AAAA,EA0GA,YAAY;WAAA;AACV,UAAG,0BAAH;AACE,eAAQ,qBAAkB,QAAQ,CAAC,SAA3B,GAAqC,GAA7C,CADF;OAAA;AAGE,eAAO,EAAP,CAHF;OADU;IAAA;EAAA,QA1GZ;AAAA,EAiHA,QAAQ,EAjHR;AAkHA,MAAuB,yBAAa,+BAApC;AAAA,YAAQ,WAAR;GAlHA;AAAA,EAmHA,aAAgB,yBAAa,+BAAhB,GAAwC,IAAI,CAAC,CAAL,CAAO,IAAC,OAAO,UAAf,CAAxC,GAAuE,EAnHpF;AAAA,EAoHA,YAAY;WAAA;AACV;AAAA,oBAAc,KAAK,cAAnB;AAAA,MACA,cAAc,cADd;AAEA,aAAQ,YAAS,WAAT,GAAqB,UAArB,GAA+B,WAA/B,GAA2C,UAA3C,GAAqD,WAArD,GAAiE,iBAAjE,GAAkF,WAAlF,GAA8F,iBAA9F,GAA+G,WAA/G,GAA2H,iBAA3H,GAA4I,WAApJ,CAHU;IAAA;EAAA,QApHZ;AAAA,EAyHA,SAAS;WAAA;AACP,UAAG,UAAS,WAAZ;eAA8B,kBAAe,KAAf,GAAqB,GAArB,GAAuB,CAAC,WAAD,CAAvB,GAAoC,iDAApC,GAAqF,UAArF,GAAiG,WAA/H;OAAA;eAA8I,GAA9I;OADO;IAAA;EAAA,QAzHT;AAgIA,MAAG,WAAH;AACI,WAAQ,iBAAc,QAAd,GAAuB,IAAvB,GAA0B,CAAC,WAAW,IAAX,CAAD,CAA1B,GAAyC,GAAzC,GAA2C,CAAC,WAAD,CAA3C,GAAwD,WAAhE;AAAA,IACA,QAAS,gBAAa,QAAb,GAAsB,UAAtB,GAAgC,QAAhC,GAAyC,IAAzC,GAA6C,eAA7C,GAA6D,GAA7D,GAAgE,OAAhE,GAAwE,GAAxE,GAA2E,WAA3E,GAAuF,GAAvF,GAAyF,CAAC,eAAD,CAAzF,GAA0G,GAA1G,GAA6G,QAA7G,GAAsH,GAAtH,GAAyH,QAAzH,GAAkI,IAD3I,CADJ;GAAA;AAII,WACN,4BAAyB,KAAzB,GAA+B,GAA/B,GAAkC,GAAlC,GAAsC,KAAtC,GACG,CAAC,OAAD,CADH,GACY,eADZ,GAEe,CAAC,WAAD,CAFf,GAE4B,GAF5B,GAE+B,YAF/B,GAE4C,IAF5C,GAEgD,gBAFhD,GAEiE,gBAFjE,GAGmB,CAAI,YAAH,GAAqB,aAArB,GAAwC,EAAzC,CAHnB,GAG+D,KAH/D,GAIM,CAAC,MAAD,CAJN,GAIc,cAJd,GAKiB,QALjB,GAK0B,IAL1B,GAK6B,CAAC,WAAD,CAL7B,GAK0C,GAL1C,GAK4C,CAAC,WAAW,IAAX,CAAD,CAL5C,GAK2D,UANrD;AAOA,QAAG,aAAY,UAAf;AAAgC,cAAO,eAAP,CAAhC;KAPA;AAAA,IAQA,QAAS,0BAAuB,QAAvB,GAAgC,UAAhC,GAA0C,QAA1C,GAAmD,IAAnD,GAAuD,eAAvD,GAAuE,GAAvE,GAA0E,WAA1E,GAAsF,GAAtF,GAAwF,CAAC,eAAD,CAAxF,GAAyG,GAAzG,GAA4G,QAA5G,GAAqH,GAArH,GAAwH,QAAxH,GAAiI,KAAjI,GACI,CAAC,QAAD,CATb;AAUA,QAAG,aAAW,UAAd;AAA+B,cAAQ,mBAAe,CAAC,YAAD,CAAvB,CAA/B;KAAA;AAA2E,cAAM,gBAAN,CAA3E;KAVA;AAAA,IAYA,QAAO,kCAEI,CAAC,QAAD,CAFJ,GAEc,SAdrB,CAJJ;GAhIA;SAqJI,cAAU,CAAC,UAAX,CAAsB,IAAtB,EAtJiC;AAAA,CAAvC,CA3HA;CAAA,UAoRU,CAAC,cAAX,CAA0B,WAA1B,EAAuC,SAAC,QAAD,EAAW,OAAX;AACrC;AAAA,YAAU,WAAW,EAArB;AAAA,EAEA,OAAO,MAFP;AAAA,EAGA,kBAAkB,MAHlB;AAAA,EAIA,WAAW,MAJX;AAAA,EAMA,MAAM,OAAO,CAAC,IAAR,IAAgB,EANtB;AAAA,EAOA,WAAW,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,uBAA5B,CAAoD,IAApD,EAAyD,QAAzD,CAPX;AAAA,EASA,SAAS,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,UAA5B,EAAyC,SAAQ,CAAC,MAAT,CAAzC,IAA6D,EATtE;AAAA,EAWA,iBAAiB,EAXjB;AAAA,EAYA,oBAAoB,KAZpB;AAAA,EAaA,aAAa;WAAA;AACX,0BAAoB,KAApB;AACA,UAAG,sBAAH;AACE,4BAAoB,GAAG,CAAC,UAAxB,CADF;OAAA,MAEK,IAAG,yBAAH;AACH,4BAAoB,QAAQ,CAAC,QAA7B,CADG;OAHL;AAKO,UAAG,iBAAH;eAA0B,GAA1B;OAAA;eAAkC,oBAAoB,IAAI,CAAC,CAAL,CAAO,mBAAP,CAApB,EAAiD,MAAjD,EAAyD,iBAAgB,EAAzE,EAAlC;OANI;IAAA;EAAA,QAbb;AAAA,EAqBA,kBAAkB,GAAG,CAAC,eAAJ,IAAuB,MArBzC;AAAA,EAsBA,WAAW,GAAG,CAAC,QAAJ,IAAgB,MAAM,CAAC,IAAvB,IAA+B,MAtB1C;AAwBA,UAAO,QAAP;AAAA,SACO,SADP;AACsB,uBAAiB,CAAC,IAAD,EAAO,KAAP,CAAjB,CADtB;AACO;AADP;AAEO,aAAO,UAAU,QAAV,GAAqB,oCAA5B,CAFP;AAAA,GAxBA;AAAA,EA2BA,eAAkB,GAAG,CAAC,YAAJ,KAAoB,MAAvB,GAAsC,GAAG,CAAC,YAA1C,GAA4D,EA3B3E;AAAA,EA4BA,WAAW,GAAG,CAAC,QAAJ,IAAgB,KA5B3B;AAAA,EA6BA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,EA7B5C;AAAA,EA8BA,WAAW,GAAG,CAAC,QAAJ,IAAgB,KA9B3B;AAAA,EA+BA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,EA/B5C;AAAA,EAgCA,kBAAiB,GAAG,CAAC,eAAJ,IAAuB,EAhCxC;AAAA,EAkCA,mBAAmB,GAAG,CAAC,gBAAJ,IAAwB,EAlC3C;AAAA,EAmCA,eAAe,GAAG,CAAC,YAAJ,IAAoB,EAnCnC;AAAA,EAoCA,iBAAoB,GAAG,CAAC,SAAP,GAAsB,CAAtB,GAAgC,GAAG,CAAC,SAAP,GAAsB,GAAG,CAAC,SAA1B,GAAyC,CApCvF;AAAA,EAqCA,YAAa,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cArCxE;AAAA,EAsCA,MAAS,eAAH,GAAiB,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,IAAvB,CAA4B,IAA5B,EAAkC,GAAG,CAAC,GAAtC,CAAjB,GAAiE,EAtCvE;AAAA,EAuCA,iBAAiB,GAAG,CAAC,SAAJ,IAAiB,CAvClC;AAAA,EAwCA,YAAa,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAxCxE;AAAA,EA0CA,YAAY;WAAA;AACR;AAAA,uBAAiB,KAAK,cAAtB;aACA,YAAY,GAAG,CAAC,SAAJ,IAAiB,CAAC,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAA5D,EAFrB;IAAA;EAAA,QA1CZ;AAAA,EA8CA,QAAQ;WAAA;AACN,UAAG,qBAAH;AACE,eAAO,EAAP,CADF;OAAA;AAGE,eAAQ,iCAA8B,SAA9B,GAAwC,SAAxC,GAAiD,QAAjD,GAA0D,IAA1D,GAA6D,CAAC,gBAAD,CAA7D,GAA+E,UAAvF,CAHF;OADM;IAAA;EAAA,QA9CR;AAAA,EAoDA,iBAAgB;WAAA;AACd;AAAA,oBAAc,GAAG,CAAC,cAAJ,IAAwB,QAAQ,CAAC,KAAjC,IAA0C,CAAuC,0BAAtC,QAAG,KAAK,aAAR,GAAqB,GAArB,GAAwB,QAAxB,SAAD,CAA1C,IAAwG,EAAtH;AACA,UAAG,uBAAH;AACE,sBAAe,CAAI,CAAC,uBAAD,KAAuB,2BAA0B,QAApD,GAAkE,kBAAkB,GAApF,GAA6F,EAA9F,CAAD,GAAsG,QAApH,CADF;OADA;AAIO,UAAG,gBAAe,EAAlB;eAA2B,GAA3B;OAAA;eAAmC,IAAI,CAAC,CAAL,CAAO,WAAP,EAAnC;OALO;IAAA;EAAA,QApDhB;AAAA,EA6DA,cAAiB,CAAE,yBAAD,IAAsB,GAAG,CAAC,SAA3B,KAAyC,GAAG,CAAC,WAAhD,GAAkE,kBAAc,CAAC,gBAAD,CAAd,GAAgC,GAAlG,GAA0G,EA7DxH;AAAA,EAiEA,UAAU;WAAA,SAAC,KAAD,EAAQ,SAAR;AACR;AAAA,kBAAa,KAAK,UAAL,KAAkB,KAAlB,IAA2B,CAAC,CAAK,uBAAL,KAA0B,SAA3B,CAA3B,IAAoE,KAAjF;AACO,UAAG,SAAH;eAAkB,oBAAlB;OAAA;eAA2C,GAA3C;OAFC;IAAA;EAAA,QAjEV;AAAA,EAsEA,sBAAsB;WAAA,SAAC,KAAD,EAAQ,KAAR,EAAe,SAAf;AACpB,aACJ,iBAAc,SAAd,GAAwB,2EAAxB,GAGwB,CAAC,WAAW,KAAZ,CAHxB,GAG0C,UAH1C,GAGoD,QAHpD,GAG6D,eAH7D,GAG4E,QAH5E,GAGqF,sBAHrF,GAG2G,KAH3G,GAGiH,IAHjH,GAGoH,CAAC,QAAQ,KAAR,EAAc,SAAd,CAAD,CAHpH,GAG8I,GAH9I,GAGiJ,eAHjJ,GAGiK,GAHjK,GAGoK,WAHpK,GAGgL,GAHhL,GAGmL,QAHnL,GAG4L,GAH5L,GAG+L,QAH/L,GAGwM,yBAHxM,GAKsB,CAAC,WAAW,KAAZ,CALtB,GAKwC,0BALxC,GAMa,KANb,GAMmB,yBAPf,CADoB;IAAA;EAAA,QAtEtB;AAAA,EAqFA,QAAQ,EArFR;AAsFA,MAAuB,yBAAa,+BAApC;AAAA,YAAQ,WAAR;GAtFA;AAAA,EAuFA,aAAgB,yBAAa,+BAAhB,GAAwC,IAAI,CAAC,CAAL,CAAO,IAAC,OAAO,UAAf,CAAxC,GAAuE,EAvFpF;AAAA,EAwFA,YAAY;WAAA;AACV;AAAA,oBAAc,KAAK,cAAnB;AAAA,MACA,cAAc,cADd;AAEA,aAAQ,YAAS,WAAT,GAAqB,UAArB,GAA+B,WAA/B,GAA2C,UAA3C,GAAqD,WAArD,GAAiE,iBAAjE,GAAkF,WAAlF,GAA8F,iBAA9F,GAA+G,WAA/G,GAA2H,iBAA3H,GAA4I,WAApJ,CAHU;IAAA;EAAA,QAxFZ;AAAA,EA6FA,SAAS,YA7FT;AA8FA;+BAAA;AAAA,cAAU,oBAAoB,IAAI,CAAC,CAAL,CAAO,mBAAiB,KAAxB,CAApB,EAAoD,KAApD,EAA2D,UAAS,YAApE,CAAV;AAAA,GA9FA;AAAA,EAgGA,SAAS;WAAA;AACP,UAAG,UAAS,WAAZ;eAA8B,kBAAe,KAAf,GAAqB,GAArB,GAAuB,CAAC,WAAD,CAAvB,GAAoC,iDAApC,GAAqF,UAArF,GAAiG,WAA/H;OAAA;eAA8I,GAA9I;OADO;IAAA;EAAA,QAhGT;AAAA,EAkGA,OACF,4BAAyB,KAAzB,GAA+B,GAA/B,GAAkC,GAAlC,GAAsC,KAAtC,GACG,CAAC,OAAD,CADH,GACY,eADZ,GAEe,CAAC,WAAD,CAFf,GAE4B,GAF5B,GAE+B,YAF/B,GAE4C,IAF5C,GAEgD,gBAFhD,GAEiE,IAFjE,GAGM,MAHN,GAGa,UAHb,GAKG,CAAC,QAAD,CALH,GAKa,SAxGX;SA2GI,cAAU,CAAC,UAAX,CAAsB,IAAtB,EA5GiC;AAAA,CAAvC,CApRA;CAAA,UAmYU,CAAC,cAAX,CAA0B,kBAA1B,EAA8C,SAAC,QAAD,EAAW,OAAX;AAC5C;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,MAAM,OAAO,CAAC,IAAR,IAAgB,EADtB;AAAA,EAEA,WAAc,oBAAH,GAAsB,GAAG,CAAC,QAA1B,GAAwC,EAFnD;AAAA,EAGA,UAAa,mBAAH,GAAsB,gBAAa,GAAG,CAAC,OAAjB,GAAyB,GAA/C,GAAuD,EAHjE;AAAA,EAIA,mBAAsB,4BAAH,GAA+B,6BAA0B,GAAG,CAAC,gBAA9B,GAA+C,GAA9E,GAAsF,EAJzG;AAAA,EAKA,sBAAyB,+BAAH,GAAkC,gCAA6B,GAAG,CAAC,mBAAjC,GAAqD,GAAvF,GAA+F,EALrH;AAAA,EAMA,aAAgB,sBAAH,GAAwB,IAAK,IAAG,CAAC,UAAJ,CAA7B,GAAkD,IAN/D;AAAA,EAOA,cAAiB,kBAAH,GAAqB,kBAAe,UAApC,GAAsD,EAPpE;AAAA,EAQA,OAAO,IAAK,IAAG,CAAC,OAAJ,CAAL,IAAqB,EAR5B;AAAA,EASA,WAAW,IAAK,UAAL,IAAkB,GAAG,CAAC,QAAtB,IAAkC,MAT7C;AAUA,MAAG,GAAG,CAAC,UAAP;AACE,WAAM;MAAC;AAAA,QAAC,IAAI,MAAL;AAAA,QAAgB,OAAO,EAAvB;OAAD;KAA4B,CAAC,MAA7B,CAAoC,IAApC,CAAN,CADF;GAVA;AAAA,EAYA,WAAW,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,uBAA5B,CAAoD,IAApD,EAAyD,QAAzD,CAZX;AAAA,EAaA,SAAS,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,UAA5B,EAAyC,SAAQ,CAAC,MAAT,CAAzC,IAA6D,EAbtE;AAAA,EAeA,aAAa;WAAA;AACX;AAAA,0BAAoB,KAApB;AACA,UAAG,sBAAH;AACE,4BAAoB,GAAG,CAAC,UAAxB,CADF;OAAA,MAEK,IAAG,yBAAH;AACH,4BAAoB,QAAQ,CAAC,QAA7B,CADG;OAHL;AAKO,UAAG,iBAAH;eAA0B,2CAA1B;OAAA;eAA0E,GAA1E;OANI;IAAA;EAAA,QAfb;AAAA,EAsBA,kBAAkB,GAAG,CAAC,eAAJ,IAAuB,MAtBzC;AAAA,EAuBA,WAAW,GAAG,CAAC,QAAJ,IAAgB,KAvB3B;AAAA,EAwBA,WAAW,GAAG,CAAC,QAAJ,IAAgB,KAxB3B;AAAA,EAyBA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,EAzB5C;AAAA,EA0BA,iBAAoB,GAAG,CAAC,SAAP,GAAsB,CAAtB,GAAgC,GAAG,CAAC,SAAP,GAAsB,GAAG,CAAC,SAA1B,GAAyC,CA1BvF;AAAA,EA2BA,YAAa,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cA3BxE;AAAA,EA4BA,MAAS,eAAH,GAAiB,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,IAAvB,CAA4B,IAA5B,EAAkC,GAAG,CAAC,GAAtC,CAAjB,GAAiE,EA5BvE;AAAA,EA8BA,YAAY;WAAA;AAEV;AAAA,UAAG,GAAG,CAAC,YAAP;eACE,YAAY,GADd;OAAA;AAGE,yBAAiB,KAAK,cAAtB;eACA,YAAY,GAAG,CAAC,SAAJ,IAAiB,CAAC,YAAS,cAAT,GAAwB,UAAxB,GAAkC,cAAlC,GAAiD,UAAjD,GAA2D,cAA5D,EAJ/B;OAFU;IAAA;EAAA,QA9BZ;AAAA,EAuCA,iBAAgB;WAAA;AACd;AAAA,oBAAc,GAAG,CAAC,cAAJ,IAAsB,QAAQ,CAAC,KAA/B,IAAwC,CAAuC,0BAAtC,QAAG,KAAK,aAAR,GAAqB,GAArB,GAAwB,QAAxB,SAAD,CAAxC,IAAsG,EAApH;AACA,UAAG,uBAAH;AACE,sBAAe,CAAI,CAAC,uBAAD,KAAuB,2BAA0B,QAApD,GAAkE,kBAAkB,GAApF,GAA6F,EAA9F,CAAD,GAAsG,QAApH,CADF;OADA;AAIO,UAAG,gBAAe,EAAlB;eAA2B,GAA3B;OAAA;eAAmC,IAAI,CAAC,CAAL,CAAO,WAAP,EAAnC;OALO;IAAA;EAAA,QAvChB;AAAA,EA6CA,OAAO;WAAA;AAEL,UAAG,gBAAH;eAAmB,qDAAkD,GAAG,CAAC,IAAtD,GAA2D,uBAA9E;OAAA;eAAyG,GAAzG;OAFK;IAAA;EAAA,QA7CP;AAAA,EAiDA,eAAe,QAAQ,kBAAR,IAAqB,CAAC,GAAG,CAAC,UAAJ,IAAkB,QAAQ,CAAC,QAA5B,MAAyC,IAjD7E;AAAA,EAmDA,QAAQ;WAAA;AACN,UAAO,qBAAP;AACE,YAAG,QAAH;iBACG,uDAAoD,QAApD,GAA6D,KAA7D,GAAiE,CAAC,gBAAD,CAAjE,GAAmF,kBADtF;SAAA;iBAGG,iCAA8B,SAA9B,GAAwC,SAAxC,GAAiD,QAAjD,GAA0D,KAA1D,GAA8D,CAAC,gBAAD,CAA9D,GAAgF,YAHnF;SADF;OAAA;eAKK,GALL;OADM;IAAA;EAAA,QAnDR;AAAA,EA2DA,QAAQ,EA3DR;AA4DA,MAAuB,yBAAa,+BAApC;AAAA,YAAQ,WAAR;GA5DA;AAAA,EA6DA,aAAgB,yBAAa,+BAAhB,GAAwC,IAAI,CAAC,CAAL,CAAO,IAAC,OAAO,UAAf,CAAxC,GAAuE,EA7DpF;AAAA,EA+DA,SAAS;WAAA;AACP,UAAG,UAAS,WAAZ;eAA8B,kBAAe,KAAf,GAAqB,iDAArB,GAAsE,UAAtE,GAAkF,WAAhH;OAAA;eAA+H,GAA/H;OADO;IAAA;EAAA,QA/DT;AAAA,EAiEA,YAAY,IAjEZ;AAAA,EAmEA,YAAY,SAAC,GAAD;AACV;AAAA,SAAK,GAAG,CAAC,EAAJ,IAAU,GAAG,CAAC,IAAnB;AAAA,IACA,OAAU,GAAG,CAAC,aAAP,GAA0B,GAAI,IAAG,CAAC,aAAJ,CAA9B,GAAsD,GAAG,CAAC,KADjE;AAAA,IAEA,aAAgB,sBAAc,YAAd,IAAsB,CAAC,CAAC,EAAE,CAAC,OAAF,CAAU,QAAV,CAAD,IAAyB,EAAE,CAAC,QAAH,OAAiB,QAAQ,CAAC,QAAT,EAA3C,KAAmE,CAAC,CAAC,CAAC,OAAF,CAAU,QAAV,KAAwB,QAAQ,CAAC,OAAT,CAAiB,EAAE,CAAC,QAAH,EAAjB,IAAkC,EAA3D,CAApE,CAAzB,GAAkK,UAAlK,GAAkL,EAF/L;AAAA,IAGA,QAAQ,qBAAkB,EAAlB,GAAqB,KAArB,GAA0B,UAA1B,GAAqC,GAArC,GAAwC,IAAxC,GAA6C,WAHrD;AAIA,WAAO,MAAP,CALU;EAAA,CAnEZ;AAAA,EAyEA,WAAc,GAAG,CAAC,UAAP,GAAuB,mCAAvB,GAAgE,EAzE3E;AAAA,EA2EA,cAAc;AAEZ;AAAA,0BAAsB,sBAAc,CAAE,iBAAkB,EAApB,CAApC;AACA,QAAG,CAAC,GAAG,CAAC,OAAJ,KAAe,IAAhB,KAAyB,CAAC,CAAC,GAAG,CAAC,UAAJ,KAAkB,IAAnB,KAA4B,CAAC,wBAAuB,IAAxB,CAA7B,CAAzB,IAAyF,CAAC,IAAO,CAAC,UAAT,CAA5F;AACE,aAAO,EAAP,CADF;KADA;AAGA,WAAO,mBAAP,CALY;EAAA,CA3Ed;AAAA,EAoFA,OAAQ,4BAAyB,KAAzB,GAA+B,GAA/B,GAAkC,GAAlC,GAAsC,KAAtC,GACG,CAAC,OAAD,CADH,GACY,wBADZ,GAEwB,CAAC,WAAD,CAFxB,GAEqC,gCAFrC,GAIO,CAAC,MAAD,CAJP,GAIe,eAJf,GAKoB,QALpB,GAK6B,eAL7B,GAK4C,QAL5C,GAKqD,IALrD,GAKyD,QALzD,GAKkE,GALlE,GAKqE,QALrE,GAK8E,GAL9E,GAKiF,OALjF,GAKyF,GALzF,GAK4F,gBAL5F,GAK6G,GAL7G,GAKgH,mBALhH,GAKoI,GALpI,GAKuI,WALvI,GAKmJ,gCALnJ,GAKmL,QALnL,GAK4L,IAL5L,GAK+L,CAAC,aAAD,CAzFvM;AA2FA;mBAAA;AAAA,cAAU,GAAV;AAAA,GA3FA;AAAA,EA4FA,QAAc,cAAU,CAAC,YAAD,CAAV,GAAwB,UAAxB,GAED,CAAC,QAAD,CAFC,GAES,gBA9FvB;SAiGI,cAAU,CAAC,UAAX,CAAsB,IAAtB,EAlGwC;AAAA,CAA9C,CAnYA;CAAA,UAweU,CAAC,cAAX,CAA0B,YAA1B,EAAuC,SAAC,KAAD,EAAQ,OAAR;AACrC;AAAA,iBAAe,EAAf;AACA,MAAG,KAAH;AACE,UAAM,OAAO,CAAC,IAAR,IAAgB,EAAtB;AAAA,IACA,SAAS,GAAG,CAAC,MAAJ,IAAc,QAAQ,WAAR,CAAoB,CAAC,UAD5C;AAAA,IAEA,eAAe,OAAO,KAAP,CAAa,CAAC,MAAd,CAAqB,MAArB,CAFf,CADF;GADA;SAKI,cAAU,CAAC,UAAX,CAAsB,YAAtB,EANiC;AAAA,CAAvC,CAxeA;CAAA,EAifA,GAAK;SACH,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,MAAL,EAAL,IAAsB,OAAvB,IAAkC,CAAnC,CAAqC,CAAC,QAAtC,CAA+C,EAA/C,CAAkD,CAAC,SAAnD,CAA6D,CAA7D,EADG;AAAA,CAjfL;CAAA,IAqfA,GAAO;SACL,OAAO,IAAP,GAAc,GAAd,GAAoB,IAApB,GAA2B,GAA3B,GAAiC,IAAjC,GAAwC,GAAxC,GAA8C,IAA9C,GAAqD,GAArD,GAA2D,IAA3D,GAAkE,IAAlE,GAAyE,KADpE;AAAA,CArfP;CAAA,UAyfU,CAAC,cAAX,CAA0B,QAA1B,EAAmC,SAAC,QAAD,EAAW,OAAX;AAEjC;AAAA,QAAM,OAAO,CAAC,IAAR,IAAgB,EAAtB;AACA,MAAG,GAAG,CAAC,IAAJ,KAAe,MAAf,IAA6B,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,OAAvB,CAA+B,GAAG,CAAC,IAAnC,CAAjC;AACE,WAAO,EAAP,CADF;GADA;AAAA,EAGA,YAAa,GAAG,CAAC,SAHjB;AAAA,EAIA,WAAW,GAAG,CAAC,OAAD,CAAH,IAAa,EAJxB;AAAA,EAKA,QAAQ,GAAG,CAAC,EAAJ,IAAU,MALlB;AAAA,EAMA,iBAAiB,GAAG,CAAC,cAAJ,IAAsB,EANvC;AAAA,EAOA,OAAO,GAAG,CAAC,IAAJ,IAAY,QAPnB;AAAA,EAQA,SAAY,kBAAH,GAAqB,iBAAc,MAAnC,GAAiD,EAR1D;AAAA,EASA,UAAU;AACR,QAAG,aAAa,SAAQ,QAAxB;AACE,aAAQ,qCAAiC,CAAC,GAAG,CAAC,WAAJ,IAAmB,IAAI,CAAC,CAAL,CAAO,gBAAP,CAApB,CAAjC,GAA8E,GAAtF,CADF;KAAA;AAEA,WAAO,EAAP,CAHQ;EAAA,CATV;AAAA,EAaA,OAAO;AACJ,QAAG,gBAAH;aAAmB,2BAAwB,GAAG,CAAC,IAA5B,GAAiC,SAApD;KAAA;aAAiE,GAAjE;KADI;EAAA,CAbP;AAAA,EAeA,SAAU,mBAAgB,IAAhB,GAAqB,IAArB,GAAyB,MAAzB,GAAgC,IAAhC,GAAoC,cAApC,GAAmD,cAAnD,GAAiE,QAAjE,GAA0E,QAA1E,GAAkF,KAAlF,GAAwF,IAAxF,GAA2F,CAAC,SAAD,CAA3F,GAAsG,GAAtG,GAAwG,CAAC,MAAD,CAAxG,GAAgH,GAAhH,GAAkH,CAAI,aAAc,EAAjB,GAAyB,IAAI,CAAC,CAAL,CAAO,QAAP,CAAzB,GAA+C,EAAhD,CAAlH,GAAqK,WAf/K;SAgBI,cAAU,CAAC,UAAX,CAAsB,MAAtB,EAlB6B;AAAA,CAAnC,CAzfA;CAAA,UAghBU,CAAC,cAAX,CAA0B,UAA1B,EAAsC,SAAC,QAAD,EAAW,OAAX;AACpC;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,UAAU,OAAO,CAAC,IAAR,IAAgB,EAD1B;AAEA,MAAiB,uBAAjB;AAAA,WAAO,EAAP;GAFA;AAGA,MAAa,6BAAiB,IAAC,WAAU,CAAC,MAAZ,KAAsB,CAApD;AAAA,WAAO,EAAP;GAHA;AAAA,EAIA,cAAc,IAAI,CAAC,WAJnB;AAAA,EAKA,YAAY,IAAI,CAAC,SAAL,IAAkB,CAL9B;AAAA,EAMA,UAAU,IAAI,CAAC,UAAL,IAAmB,CAN7B;AAAA,EAQA,UAAU,CARV;AAAA,EASA,iBAAiB,IAAI,CAAC,GAAL,CAAS,SAAT,EAAoB,cAAc,OAAlC,CATjB;AAAA,EAUA,gBAAgB,IAAI,CAAC,GAAL,CAAS,OAAT,EAAkB,cAAc,OAAhC,CAVhB;AAAA,EAWA,cAAc,gBAAgB,cAX9B;AAYA,MAAG,cAAc,UAAU,CAA3B;AACE,QAAG,UAAU,aAAV,GAA0B,OAA7B;AACE,uBAAiB,UAAU,CAAV,GAAc,WAA/B,CADF;KAAA;AAGE,wBAAkB,UAAU,CAAV,GAAc,WAAhC,CAHF;KADF;GAZA;AAAA,EAkBA,iBAAiB,IAAI,CAAC,GAAL,CAAS,cAAT,EAAyB,CAAzB,CAlBjB;AAAA,EAoBA,UAAU,IAAI,CAAC,OAAL,IAAgB,EApB1B;AAAA,EAqBA,eAAe,IAAI,CAAC,YArBpB;AAAA,EAsBA,oBAAoB;AAClB;AAAA,gBAAe,gBAAe,SAAlB,GAAiC,UAAjC,GAAiD,EAA7D;AACA,WAAQ,gBAAa,SAAb,GAAuB,uCAAvB,GAA8D,SAA9D,GAAwE,oBAAhF,CAFkB;EAAA,CAtBpB;AAAA,EAyBA,qBAAoB;AAClB;AAAA,WAAO,EAAP;AACA,SAAoI,uJAApI;AAAA,MAAC,QAAQ,gBAAY,CAAI,MAAK,WAAR,GAAyB,QAAzB,GAAuC,EAAxC,CAAZ,GAAuD,uCAAvD,GAA8F,CAA9F,GAAgG,IAAhG,GAAoG,CAApG,GAAsG,WAA/G;AAAA,KADA;AAEA,WAAO,IAAP,CAHkB;EAAA,CAzBpB;AAAA,EA6BA,qBAAqB;AACnB;AAAA,gBAAe,gBAAe,OAAlB,GAA+B,UAA/B,GAA+C,EAA3D;AACA,WAAQ,gBAAa,SAAb,GAAuB,wCAAvB,GAA+D,OAA/D,GAAuE,oBAA/E,CAFmB;EAAA,CA7BrB;AAAA,EAgCA,qBAAqB;AACnB,QAAa,gBAAgB,OAA7B;AAAA,aAAO,EAAP;KAAA;AACA,WAAO,KAAE,CAAC,mBAAD,CAAF,GAAwB,CAAC,oBAAD,CAAxB,GAA+C,CAAC,oBAAD,CAAtD,CAFmB;EAAA,CAhCrB;AAAA,EAmCA,qBAAqB;AACnB;AAAA,iBAAa,IAAI,CAAC,CAAL,CAAO,mBAAP,CAAb;AAAA,IACA,kBAAkB;AAChB;AAAA,aAAO,EAAP;AACA,WAAS,6BAAT;AACE,gBAAS,oBAAgB,CAAC,IAAE,CAAH,CAAhB,GAAqB,IAArB,GAAwB,CAAI,IAAE,CAAF,KAAO,OAAV,GAAuB,UAAvB,SAAD,CAAxB,GAA2D,GAA3D,GAA6D,CAAC,IAAE,CAAH,CAA7D,GAAkE,GAAlE,GAAqE,UAArE,GAAgF,WAAzF,CADF;AAAA,OADA;AAGA,aAAO,IAAP,CAJgB;IAAA,CADlB;AAOA,WAAQ,8CACG,CAAC,iBAAD,CADH,GACsB,YAD9B,CARmB;EAAA,CAnCrB;AAAA,EA8CA,gBAAgB;AACd;AAAA,mBAAe,IAAI,CAAC,CAAL,CAAO,eAAP,CAAf;AACO,QAAG,OAAO,CAAC,gBAAX;aAAkC,8BAA2B,YAA3B,GAAwC,uBAAxC,GAA+D,YAA/D,GAA4E,gBAA9G;KAAA;aAAkI,GAAlI;KAFO;EAAA,CA9ChB;AAAA,EAkDA,OAAQ,mDAC0B,CAAC,oBAAD,CAD1B,GACgD,iDADhD,GAIG,CAAC,eAAD,CAJH,GAIoB,4CAJpB,GAOG,CAAC,oBAAD,CAPH,GAOyB,SAzDjC;AA2DA,SAAW,cAAU,CAAC,UAAX,CAAsB,IAAtB,CAAX,CA5DoC;AAAA,CAAtC,CAhhBA;CAAA,UA+kBU,CAAC,cAAX,CAA0B,mBAA1B,EAA+C,SAAC,OAAD;AAC7C;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,UAAU,OAAO,CAAC,IAAR,IAAgB,EAD1B;AAAA,EAEA,eAAe,IAAI,CAAC,YAAL,IAAqB,CAFpC;AAAA,EAGA,eAAe,IAAI,CAAC,CAAL,CAAO,OAAO,CAAC,WAAR,IAAuB,eAA9B,CAHf;AAAA,EAIA,eAAe;AACb,QAAG,+BAAsB,eAAe,CAAxC;AACE,aACN,4GAC0E,CAAC,IAAI,CAAC,CAAL,CAAO,eAAP,CAAD,CAD1E,GACmG,qBADnG,GAEa,OAAO,CAAC,SAFrB,GAE+B,yEAF/B,GAEuG,CAAC,IAAI,CAAC,CAAL,CAAO,eAAP,CAAD,CAFvG,GAEgI,aAH1H,CADF;KAAA;AAOA,WAAO,EAAP,CARa;EAAA,CAJf;AAAA,EAaA,gBAAgB;AACd,WAAQ,yBAAsB,YAAtB,GAAmC,UAAnC,GAA6C,YAArD,CADc;EAAA,CAbhB;AAAA,EAeA,OAAQ,uDAEO,CAAC,eAAD,CAFP,GAEwB,UAFxB,GAIG,CAAC,cAAD,CAJH,GAImB,SAnB3B;AAqBA,SAAW,cAAU,CAAC,UAAX,CAAsB,IAAtB,CAAX,CAtB6C;AAAA,CAA/C,CA/kBA;CAAA,UAymBU,CAAC,cAAX,CAA0B,YAA1B,EAAwC,SAAC,QAAD,EAAW,OAAX;AACtC;AAAA,YAAU,OAAO,CAAC,IAAR,IAAgB,EAA1B;AAAA,EACA,YAAY,IAAI,CAAC,SADjB;AAAA,EAEA,QAAQ,IAAI,CAAC,KAAL,IAAc,KAFtB;AAAA,EAGA,iBAAiB,OAAO,CAAC,cAAR,IAA0B,MAH3C;AAAA,EAIA,uBAAsB;AACpB;AAAA,WAAO,YAAP;AACA,QAAG,aAAY,SAAf;AACE,cAAO,MAAM,KAAb,CADF;KADA;AAGA,WAAQ,eAAY,IAAZ,GAAiB,eAAjB,GAAgC,QAAhC,GAAyC,QAAjD,CAJoB;EAAA,CAJtB;AASA,MAAG,IAAI,CAAC,MAAR;AACE,WAAW,cAAU,CAAC,UAAX,CAAuB,8BAA0B,CAAC,IAAI,CAAC,CAAL,CAAO,cAAP,CAAD,CAA1B,GAAkD,SAAzE,CAAX,CADF;GATA;SAWI,cAAU,CAAC,UAAX,CAAuB,gDAA6C,QAA7C,GAAsD,gBAAtD,GAAqE,CAAC,IAAI,CAAC,CAAL,CAAO,cAAP,CAAD,CAArE,GAA6F,GAA7F,GAA+F,CAAI,IAAI,CAAC,MAAR,GAAoB,EAApB,GAA4B,sBAA7B,CAA/F,GAAmJ,MAA1K,EAZkC;AAAA,CAAxC,CAzmBA;CAAA,UAunBU,CAAC,cAAX,CAA0B,YAA1B,EAAwC,SAAC,QAAD,EAAW,OAAX;AACtC;AAAA,MAAG,QAAO,IAAK,UAAL,KAAkB,SAAnB,CAAT;AACE,QAAG,IAAK,UAAR;AAAuB,aAAO,aAAP,CAAvB;KAAA;AAAiD,aAAO,mBAAP,CAAjD;KADF;GAAA;AAEK,YAAO,IAAK,UAAZ;AAAA,WACE,CADF;AACS,eAAO,WAAP,CADT;AACE;AADF,WAEE,CAFF;AAES,eAAO,mBAAP,CAFT;AAEE;AAFF,WAGE,CAHF;AAGS,eAAO,eAAP,CAHT;AAGE;AAHF,WAIE,CAJF;AAIS,eAAO,aAAP,CAJT;AAIE;AAJF;AAKE,eAAO,EAAP,CALF;AAAA,KAFL;GAAA;AAQA,SAAW,cAAU,CAAC,UAAX,CAAuB,eAAY,IAAZ,GAAiB,OAAxC,CAAX,CATsC;AAAA,CAAxC,CAvnBA;CAAA,UAmoBU,CAAC,cAAX,CAA0B,UAA1B,EAAsC,SAAC,QAAD,EAAW,OAAX;AAEpC;AAAA,gBAAc,SAAC,QAAD;AACZ;AAAA,WAAO,EAAP;AAAA,IACA,MAAM,CADN;AAAA,IAEA,QAAQ,CAAC,OAAT,CAAiB,SAAC,GAAD;AACf,UAAG,EAAK,CAAC,OAAF,CAAU,GAAV,CAAP;eACE,OAAM,GAAG,CAAC,MADZ;OADe;IAAA,CAAjB,CAFA;AAAA,IAMA,QAAQ,CAAC,OAAT,CAAiB,SAAC,GAAD;AACf,UAAG,EAAK,CAAC,OAAF,CAAU,GAAV,CAAP;eACE,QAAS,2CAAwC,GAAG,CAAC,IAA5C,GAAiD,kBAAjD,GAAkE,CAAC,IAAI,CAAC,KAAL,CAAW,GAAG,CAAC,KAAJ,GAAU,GAAV,GAAc,GAAzB,CAAD,CAAlE,GAAiG,MAAjG,GACL,GAAG,CAAC,KADC,GACK,UAFhB;OADe;IAAA,CAAjB,CANA;AAaA,WAAO,IAAP,CAdY;EAAA,CAAd;AAeA,SAAW,cAAU,CAAC,UAAX,CAAuB,2BAAuB,CAAC,YAAY,IAAE,UAAd,CAAD,CAAvB,GAAiD,QAAxE,CAAX,CAjBoC;AAAA,CAAtC,CAnoBA;CAupBA;AAAA;;;;GAvpBA;CAAA,UA4pBU,CAAC,cAAX,CAA0B,YAA1B,EAAwC,SAAC,QAAD,EAAW,OAAX;AACtC;AAAA,MAAG,CAAC,CAAC,QAAF,CAAW,QAAX,CAAH;AACE,YAAQ,QAAQ,CAAC,KAAT,CAAe,GAAf,CAAR;AACA,QAAG,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC,UAAvB,CAAkC,KAAlC,CAAH;AACE,aAAO,OAAO,CAAC,EAAR,CAAW,IAAX,CAAP,CADF;KAFF;GADsC;AAAA,CAAxC,CA5pBA;CAmqBA;AAAA;;;;GAnqBA;CAAA,UAwqBU,CAAC,cAAX,CAA0B,SAA1B,EAAqC,SAAC,QAAD,EAAW,OAAX;AACnC,MAAG,CAAC,CAAC,QAAF,CAAW,QAAX,KAAyB,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC,OAAvB,CAA+B,QAA/B,CAA5B;AACE,WAAO,OAAO,CAAC,EAAR,CAAW,IAAX,CAAP,CADF;GADmC;AAAA,CAArC,CAxqBA;CA6qBA;AAAA;;GA7qBA;CAAA,UAgrBU,CAAC,cAAX,CAA0B,KAA1B,EAAiC,SAAC,QAAD;AAC/B,SAAQ,YAAS,QAAT,GAAkB,UAAlB,GAA4B,QAA5B,GAAqC,UAArC,GAA+C,QAA/C,GAAwD,UAAxD,GAAkE,QAA1E,CAD+B;AAAA,CAAjC,CAhrBA;CAsrBA;AAAA;;;;;;GAtrBA;CAAA,UA8rBU,CAAC,cAAX,CAA0B,MAA1B,EAAkC,SAAC,OAAD,EAAU,OAAV;AAChC;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,MAAM,OAAO,CAAC,IAAR,IAAgB,EADtB;AAAA,EAEA,MAAM,EAFN;AAAA,EAGA,mBAAmB,MAHnB;AAIA,MAAG,sBAAH;AACE,uBAAmB,CAAC,CAAC,IAAF,CAAO,IAAP,EAAa,GAAG,CAAC,UAAU,CAAC,KAAf,CAAqB,GAArB,CAAb,CAAnB,CADF;GAJA;AAAA,EAOA,UAAU,WAAW,EAPrB;AAQA,MAAG,CAAC,CAAC,OAAF,CAAU,OAAV,CAAH;AACI;AAAA;sBAAA;AACE,YAAM,CAAC,CAAC,MAAF,CAAS,IAAT,EAAe,gBAAf,CAAN;AAAA,MACA,MAAM,MAAM,OAAO,CAAC,EAAR,CAAW,GAAX,CADZ,CADF;AAAA,KADJ;GAAA,MAIK,IAAG,CAAC,CAAC,QAAF,CAAW,OAAX,CAAH;AACH;AACI,YAAM;AAAA,QAAC,KAAK,IAAN;AAAA,QAAY,OAAO,CAAC,CAAC,MAAF,CAAS,OAAQ,MAAjB,EAAwB,gBAAxB,CAAnB;OAAN;AAAA,MACA,MAAM,MAAM,OAAO,CAAC,EAAR,CAAW,GAAX,CADZ,CADJ;AAAA,KADG;GAZL;AAgBA,SAAO,GAAP,CAjBgC;AAAA,CAAlC,CA9rBA;CAAA,UAitBU,CAAC,cAAX,CAA0B,YAA1B,EAAwC,SAAC,QAAD,EAAW,OAAX;AACtC;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,MAAM,OAAO,CAAC,IAAR,IAAgB,EADtB;AAAA,EAEA,YAAe,qBAAH,GAAuB,GAAG,CAAC,SAA3B,GAA0C,IAFtD;AAAA,EAGA,aAAgB,SAAH,GAAkB,aAAlB,GAAqC,WAHlD;AAAA,EAIA,YAAY,IAAI,CAAC,SAAL,IAAkB,QAAlB,IAA8B,GAAG,CAAC,SAAlC,IAA+C,MAJ3D;AAAA,EAKA,YAAY,CAAC,CAAC,MAAF,CAAS,IAAT,EAAe;AAAA,IAAC,WAAW,SAAZ;GAAf,CALZ;AAAA,EAMA,YAAY,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,YAA5B,CAAyC,SAAzC,KAAuD,EANnE;AAAA,EAOA,OAAO,EAPP;AAQA;AAEE,WAAQ,OAAO,UAAU,CAAC,OAAQ,YAAW,CAAC,IAA/B,CAAoC,SAApC,EAA+C,IAA/C,EAAqD;AAAA,MAAC,MAAM;AAAA,QAAC,KAAK,EAAN;OAAP;KAArD,CAAf,CAFF;AAAA,GARA;AAWA,SAAW,cAAU,CAAC,UAAX,CAAsB,IAAtB,CAAX,CAZsC;AAAA,CAAxC,CAjtBA;CAkuBA;AAAA;;;;;;;;;;GAluBA;CA4uBA;AAAA;;;GA5uBA;CAAA,UAgvBU,CAAC,cAAX,CAA0B,MAA1B,EAAkC,SAAC,OAAD;AAC9B,SAAQ,0DAAsD,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAAtD,GAAqE,SAA7E,CAD8B;AAAA,CAAlC,CAhvBA;CAkvBA;AAAA;;;GAlvBA;CAAA,UAsvBU,CAAC,cAAX,CAA0B,SAA1B,EAAqC,SAAC,OAAD;AACjC,SAAQ,0DAAsD,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAAtD,GAAqE,SAA7E,CADiC;AAAA,CAArC,CAtvBA;CAwvBA;AAAA;;;GAxvBA;CAAA,UA4vBU,CAAC,cAAX,CAA0B,aAA1B,EAAyC,SAAC,OAAD;AACrC,SAAQ,qDAAiD,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAAjD,GAAgE,cAAxE,CADqC;AAAA,CAAzC,CA5vBA;CA8vBA;AAAA;;;;GA9vBA;CAAA,UAmwBU,CAAC,cAAX,CAA0B,OAA1B,EAAmC,SAAC,KAAD,EAAQ,OAAR;AAC/B;AAAA,QAAM,CAAC,WAAW,EAAZ,CAAe,CAAC,IAAhB,IAAwB,EAA9B;AACA,MAAG,CAAC,CAAC,QAAF,CAAW,KAAX,CAAH;AACE,cAAU,KAAV;AAAA,IACA,QAAQ,MADR,CADF;GADA;AAAA,EAIA,aAAa;AACJ,QAAG,GAAG,CAAC,IAAP;aAAiB,UAAU,CAAC,OAAO,CAAC,WAAW,CAAC,IAA/B,CAAoC,IAApC,EAAuC;AAAA,QAAC,MAAM;AAAA,UAAC,MAAM,QAAP;SAAP;OAAvC,EAAjB;KAAA;aAAuF,GAAvF;KADI;EAAA,CAJb;AAAA,EAMA,aAAa;AACJ,QAAG,GAAG,CAAC,IAAP;aAAiB,UAAU,CAAC,OAAO,CAAC,WAAW,CAAC,IAA/B,CAAoC,IAApC,EAAuC,MAAvC,EAAkD;AAAA,QAAC,MAAM;AAAA,UAAC,MAAM,MAAP;SAAP;OAAlD,EAAjB;KAAA;aAAgG,GAAhG;KADI;EAAA,CANb;AAAA,EAQA,eAAe;AACN,QAAG,GAAG,CAAC,IAAP;aAAiB,UAAU,CAAC,OAAO,CAAC,aAAa,CAAC,IAAjC,CAAsC,IAAtC,EAAyC;AAAA,QAAC,MAAM;AAAA,UAAC,MAAM,MAAP;SAAP;OAAzC,EAAjB;KAAA;aAAuF,GAAvF;KADM;EAAA,CARf;AAAA,EAUA,QAAgB,aAAP,GAAmB,EAAnB,GAA2B,IAAI,CAAC,CAAL,CAAO,KAAP,CAVpC;AAAA,EAWA,OAAQ,kEAC2B,KAD3B,GACiC,GADjC,GACmC,CAAC,YAAD,CADnC,GACiD,GADjD,GACmD,CAAC,YAAD,CADnD,GACiE,GADjE,GACmE,CAAC,cAAD,CADnE,GACmF,iCADnF,GAEuB,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAFvB,GAEsC,eAb9C;AAeA,SAAO,IAAP,CAhB+B;AAAA,CAAnC,CAnwBA;CAoxBA;AAAA;;;GApxBA;CAAA,UAwxBU,CAAC,cAAX,CAA0B,MAA1B,EAAkC,SAAC,KAAD,EAAQ,OAAR;AAChC;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,MAAM,OAAO,CAAC,IAAR,IAAgB,EADtB;AAEA,MAAyC,EAAK,CAAC,QAAF,CAAW,KAAX,CAA7C;AAAA,WAAO,CAAC,KAAR,CAAc,uBAAd;GAFA;AAAA,EAGA,OACF,SAAK,CAAC,IAAI,CAAC,CAAL,CAAO,KAAP,CAAD,CAAL,GAAoB,mCAApB,GAEG,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAFH,GAEkB,SANhB;AASA,SAAO,IAAP,CAVgC;AAAA,CAAlC,CAxxBA;CAoyBA;AAAA;;;GApyBA;CAAA,UAwyBU,CAAC,cAAX,CAA0B,UAA1B,EAAsC,SAAC,KAAD,EAAQ,OAAR;AACpC;AAAA,YAAU,WAAW,EAArB;AACA,MAAG,CAAC,CAAC,QAAF,CAAW,KAAX,CAAH;AACI,cAAU,KAAV;AAAA,IACA,QAAQ,MADR,CADJ;GADA;AAAA,EAIE,QAAgB,aAAP,GAAmB,EAAnB,GAA2B,IAAI,CAAC,CAAL,CAAO,KAAP,CAJtC;AAAA,EAKA,OACF,gCACQ,KADR,GACc,QADd,GAEG,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAFH,GAEkB,SARhB;AAWA,SAAO,IAAP,CAZoC;AAAA,CAAtC,CAxyBA;CAAA,UAwzBU,CAAC,cAAX,CAA0B,QAA1B,EAAoC,SAAC,OAAD;AAClC;AAAA,YAAU,WAAW,EAArB;AAAA,EACA,MAAM,OAAO,CAAC,IAAR,IAAgB,EADtB;AAAA,EAEA,UAAa,mBAAH,GAAqB,GAAG,CAAC,OAAzB,GAAsC,IAFhD;AAAA,EAGA,cAAiB,GAAG,CAAC,WAAP,GAAwB,IAAI,CAAC,CAAL,CAAO,GAAG,CAAC,WAAX,CAAxB,GAAqD,MAHnE;AAAA,EAIA,cAAiB,OAAH,GAAgB,OAAhB,GAA6B,IAJ3C;AAAA,EAKA,iBAAoB,OAAH,GAAgB,IAAhB,GAA0B,IAL3C;AAAA,EAMA,UAAa,mBAAH,GAAqB,GAAG,CAAC,QAAzB,GAAuC,IANjD;AAAA,EAOA,WAAc,OAAH,GAAgB,QAAQ,CAAC,QAAQ,CAAC,KAAlC,GAA6C,QAAQ,CAAC,QAAQ,CAAC,IAP1E;AAQA,MAAG,oBAAH;AAAsB,eAAU,KAAG,QAAH,GAAY,eAAtB,CAAtB;GARA;AASA,MAAG,OAAH;AACE,eAAW,WAAW,iBAAtB,CADF;GATA;AAAA,EAYA,qBAAqB;WAAA;AACnB;AAAA,0BAAuB,6BAAH,GAA+B,GAAG,CAAC,iBAAnC,GAA0D,IAA9E;AACO,UAAG,iBAAH;eAA0B,KAAE,CAAC,UAAU,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAArC,CAA0C,KAA1C,EAAgD;AAAA,UAAC,MAAK;AAAA,YAAC,aAAa,EAAd;AAAA,YAAkB,WAAW,KAAI,CAAC,SAAlC;AAAA,YAA6C,aAAa,WAA1D;WAAN;SAAhD,CAAD,CAAF,GAAkI,UAA5J;OAAA;eAA0K,GAA1K;OAFY;IAAA;EAAA,QAZrB;AAAA,EAgBA,WAAW;WAAA;AACT;AAAA,mBAAgB,sBAAH,GAAwB,GAAG,CAAC,UAA5B,GAA4C,IAAzD;AACA,UAAG,UAAH;eACE,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,IAA5B,CAAiC,KAAjC,EAAuC;AAAA,UAAC,MAAK;AAAA,YAAC,kBAAiB,KAAlB;WAAN;SAAvC,EADF;OAAA;eAEK,GAFL;OAFS;IAAA;EAAA,QAhBX;AAAA,EAsBA,OAAQ,MAAE,CAAC,oBAAD,CAAF,GAAwB,IAAxB,GACO,WADP,GACmB,UADnB,GAC6B,QAD7B,GACsC,KADtC,GAEO,CAAC,OAAO,CAAC,EAAR,CAAW,IAAX,CAAD,CAFP,GAEsB,KAFtB,GAGQ,WAHR,GAGoB,IAHpB,GAIG,CAAC,UAAD,CAJH,GAIe,0CA1BvB;AA6BA,SAAW,cAAU,CAAC,UAAX,CAAsB,IAAtB,CAAX,CA9BkC;AAAA,CAApC,CAxzBA;;ECHA;AAAA;AACA;AADA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA,C;ACAA;iSAAA;CAAA,CAAC,SAAC,EAAD;AACC;AAAA;AAAA,EAEA,KAAK,MAAM,EAFX;AAAA,EAGA,cAAc,kBAAiB,WAAjB,IAAiC,kBAAmB,WAHlE;AAAA,EAKM;AAEJ;;;KAAA;CAAA,qCAAW,MAAX;CAAA,yBAGA,WAAU,SAAC,KAAD;AACR,UAAG,KAAK,CAAC,KAAN,EAAH;eACE,IAAC,QAAO,CAAC,OAAQ,MAAK,CAAC,GAAN,CAAjB,GAA8B,KAAK,CAAC,UAAN,GADhC;OAAA;eAEK,IAAC,YAAD,CAAa,KAAb,EAFL;OADQ;IAAA,CAHV;CAAA,yBAOA,cAAa,SAAC,KAAD;AACX,UAAwC,uCAAxC;AAAA,QAAC,WAAQ,QAAO,CAAC,OAAQ,MAAK,CAAC,GAAN,CAAzB;OAAA;aACA,IAAC,QAAO,CAAC,OAAQ,MAAK,CAAC,GAAN,CAAjB,GAA8B,KAAK,CAAC,UAAN,GAFnB;IAAA,CAPb;CAAA,yBAUA,cAAY,SAAC,KAAD;AACV,UAAG,uCAAH;AACE,mBAAQ,QAAO,CAAC,OAAQ,MAAK,CAAC,GAAN,CAAxB,CADF;OAAA;AAEA,UAAG,uCAAH;AACE,YAAC,QAAO,CAAC,OAAQ,MAAK,CAAC,GAAN,CAAjB,GAA8B,KAAK,CAAC,UAAN,EAA9B;eACA,WAAQ,QAAO,CAAC,OAAQ,MAAK,CAAC,GAAN,EAF1B;OAHU;IAAA,CAVZ;CAAA,yBAgBA,cAAY,SAAC,MAAD;AAEV,UAAC,QAAD,GAAW;AAAA,QAET,SAAS,EAFA;AAAA,QAIT,SAAS,EAJA;AAAA,QAMT,SAAS,EANA;OAAX;aASA,MAAM,CAAC,OAAP,CAAe,IAAC,SAAhB,EAA0B,IAA1B,EAXU;IAAA,CAhBZ;CAAA,yBA6BA,aAAY,SAAC,OAAD;AACV,gBAAU,WAAW,EAArB;AAAA,MAEA,IAAC,QAAD,GAAW;AAAA,QAET,SAAS,EAFA;AAAA,QAIT,SAAS,EAJA;AAAA,QAMT,SAAS,EANA;OAFX;AAAA,MAWA,IAAC,GAAD,CAAI,KAAJ,EAAU;eAAA,SAAC,KAAD;iBAAU,KAAC,SAAD,CAAU,KAAV,EAAV;QAAA;MAAA,QAAV,CAXA;AAAA,MAYA,IAAC,GAAD,CAAI,QAAJ,EAAc;eAAA,SAAC,KAAD;iBAAU,KAAC,YAAD,CAAa,KAAb,EAAV;QAAA;MAAA,QAAd,CAZA;AAAA,MAaA,IAAC,GAAD,CAAI,QAAJ,EAAc;eAAA,SAAC,KAAD;iBAAU,KAAC,SAAD,CAAU,KAAV,EAAV;QAAA;MAAA,QAAd,CAbA;aAcA,IAAC,GAAD,CAAI,OAAJ,EAAa;eAAA,SAAC,MAAD;iBAAW,KAAC,YAAD,CAAa,MAAb,EAAX;QAAA;MAAA,QAAb,EAfU;IAAA,CA7BZ;CAAA,yBAgDA,SAAQ;AACN;AAAA,kBAAY,sCAAZ;AAAA,MACA,SAAS,CAAC,SAAV,GAAuB,IAAC,UAAD,IAAc,IAAI,CAAC,GAAL,CAAS,WAAT,CADrC;AAEA,aAAO,SAAP,CAHM;IAAA,CAhDR;CAAA,yBAsDA,aAAW,SAAC,cAAD;AACT;AAAA,uBAAiB,kBAAkB,MAAnC;AAAA,MACA,UAAU,KAAG,cAAH,GAAkB,SAD5B;AAAA,MAEA,UAAU,KAAG,cAAH,GAAkB,SAF5B;AAAA,MAGA,UAAU,KAAG,cAAH,GAAkB,SAH5B;AAAA,MAIA,SAAS,EAJT;AAAA,MAKA,MAAO,SAAP,GAAkB,IAAC,QAAO,CAAC,OAL3B;AAAA,MAMA,MAAO,SAAP,GAAkB,IAAC,QAAO,CAAC,OAN3B;AAAA,MAOA,MAAO,SAAP,GAAkB,IAAC,QAAO,CAAC,OAP3B;AAQA,aAAO,MAAP,CATS;IAAA,CAtDX;CAAA,yBAiEA,eAAc;aACZ,IAAC,yBAAD,GAA4B,IAAC,OAAD,GADhB;IAAA,CAjEd;CAAA,yBAoEA,kBAAiB,SAAC,OAAD;AACf,gBAAU,WAAW,EAArB;AAAA,MACA,OAAO,CAAC,MAAR,GAAiB,OAAO,CAAC,QAAR,IAAoB,KADrC;aAEA,IAAC,MAAD,CAAO,IAAC,yBAAR,EAAkC,OAAlC,EAHe;IAAA,CApEjB;CAAA,yBAyEA,cAAa;AACX,aAAO,EAAK,CAAC,OAAF,CAAU,IAAC,yBAAX,EAAqC,IAAC,OAAD,EAArC,CAAX,CADW;IAAA,CAzEb;CA2EA;AAAA;;OA3EA;CAAA,yBA8EA,YAAU,SAAC,MAAD,EAAS,OAAT;AACR,UAAG,CAAC,CAAC,OAAF,CAAU,MAAV,CAAH;eACE,IAAC,mBAAD,CAAoB,MAApB,EAA4B,OAA5B,EADF;OAAA,MAEK,IAAG,CAAC,CAAC,QAAF,CAAW,MAAX,CAAH;eACH,IAAC,oBAAD,CAAqB,MAArB,EAA6B,OAA7B,EADG;OAHG;IAAA,CA9EV;CAAA,yBAoFA,qBAAmB,SAAC,MAAD,EAAS,OAAT;AACjB;AAAA;WAAA;2BAAA;AACE,YAA4C,qBAAJ,IAAqB,YAAY,CAAC,KAAb,KAAwB,QAArF;AAAA,iBAAO,CAAC,IAAR,CAAa,eAAb,EAA8B,KAA9B;SAAA;AACA,YAA4C,sBAAJ,IAAsB,YAAY,CAAC,MAAb,KAAyB,QAAvF;AAAA,iBAAO,CAAC,IAAR,CAAa,eAAb,EAA8B,KAA9B;SADA;AAAA,sBAKA,IAAC,GAAD,CAAI,KAAK,CAAC,KAAV,CAAgB,CAAC,GAAjB,CAAqB;AAAA,UACjB,QAAQ,KAAK,CAAC,MADG;SAArB,EAEG,OAFH,EALA,CADF;AAAA;sBADiB;IAAA,CApFnB;CAAA,yBA8FA,sBAAoB,SAAC,MAAD,EAAS,OAAT;AAClB;AAAA;WAAA;AACE,YAAsC,EAAK,CAAC,QAAF,CAAW,GAAX,CAA1C;AAAA,iBAAO,CAAC,IAAR,CAAa,eAAb,EAA8B,GAA9B;SAAA;AAAA,sBACA,IAAC,IAAD,CAAK,GAAL,CAAS,CAAC,GAAV,CAAc;AAAA,UACV,QAAQ,MAAO,KADL;SAAd,EAEG,OAFH,EADA,CADF;AAAA;sBADkB;IAAA,CA9FpB;CAAA,yBAqGA,cAAa,SAAC,OAAD;aACX,IAAC,QAAD,CAAS,SAAC,GAAD;eAAQ,GAAG,CAAC,WAAJ,CAAgB,OAAhB,EAAR;MAAA,CAAT,EADW;IAAA,CArGb;CAAA,yBAuGA,mBAAiB,SAAC,QAAD;AACf;AAAA,gBAAU,EAAV;AAAA,MACA,CAAC,CAAC,IAAF,CAAO,QAAQ,CAAC,OAAhB,EAAyB,SAAC,GAAD;eAAO,OAAO,CAAC,IAAR,CAAa,GAAb,EAAP;MAAA,CAAzB,CADA;AAAA,MAEA,CAAC,CAAC,IAAF,CAAO,QAAQ,CAAC,OAAhB,EAAyB,SAAC,GAAD;eAAO,OAAO,CAAC,IAAR,CAAa,GAAb,EAAP;MAAA,CAAzB,CAFA;AAGA,aAAO,OAAP,CAJe;IAAA,CAvGjB;uBAAA;MAFuB,QAAQ,CAAC,WALlC;AAoHA,MAAG,WAAH;AACE,MAAE,CAAC,MAAH,GAAY,EAAE,CAAC,MAAH,IAAa,EAAzB;WACA,EAAE,CAAC,MAAM,CAAC,UAAV,GAAuB,WAFzB;GAAA;WAIE,MAAM,CAAC,OAAP,GAAiB,WAJnB;GArHD;AAAA,CAAD,EA0HK,kBAAiB,WAAjB,IAAiC,kBAAmB,WAAvD,GAAwE,MAAM,CAAC,GAA/E,GAAwF,MAAM,CAAC,OA1HjG;;ECAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvCA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzEA;AAAA,C;ACAA;iSAAA;CAAA,CAAC,SAAC,EAAD;AACC;AAAA;AAAA,EAEA,KAAK,MAAM,EAFX;AAAA,EAGA,cAAc,kBAAiB,WAAjB,IAAiC,kBAAmB,WAHlE;AAAA,EAKM;AACJ;;;KAAA;CAAA,mCAAc,MAAd;CAAA,oBAEA,aAAY,SAAC,OAAD;AACV,gBAAU,WAAW,EAArB;AAAA,MACA,sCAAM,OAAN,CADA;AAEA,UAAkC,yBAAlC;AAAA,YAAC,UAAD,GAAa,OAAO,CAAC,SAArB;OAFA;AAGA,UAAI,IAAI,CAAC,GAAL,CAAS,IAAT,KAAmB,IAAI,CAAC,GAAL,CAAS,IAAT,MAAkB,KAAzC;AACE,YAAI,CAAC,KAAL,CAAW,IAAX,EAAiB;AAAA,UAAC,QAAQ,IAAT;SAAjB;AAAA,QACA,IAAI,CAAC,GAAL,CAAS,YAAT,EAAuB,IAAvB,EAA6B;AAAA,UAAC,QAAQ,IAAT;SAA7B,CADA,CADF;OAAA;AAIE,YAAI,CAAC,GAAL,CAAS,YAAT,EAAuB,KAAvB,EAA8B;AAAA,UAAC,QAAQ,IAAT;SAA9B,EAJF;OAHA;AAAA,MAQA,IAAC,aAAD,EARA;AASA,UAAG,IAAC,MAAD,MAAa,2BAAhB;eACE,IAAI,CAAC,GAAL,CAAS,IAAC,aAAV,EAAwB;AAAA,UAAE,QAAQ,IAAV;SAAxB,EADF;OAVU;IAAA,CAFZ;CAAA,oBAeA,cAAY,SAAC,OAAD;AACV;AAAA,gBAAU,WAAW,EAArB;AAAA,MACA,SAAS,OAAO,CAAC,MAAR,IAAkB,KAD3B;aAEA,IAAC,MAAD,CAAO,QAAP,EAAiB;AAAA,QAAC,QAAQ,MAAT;OAAjB,EAHU;IAAA,CAfZ;CAAA,oBAoBA,YAAU,SAAC,MAAD;AACR,UAA4B,cAA5B;eAAA,IAAC,IAAD,CAAK;AAAA,UAAC,UAAU,MAAX;SAAL;OADQ;IAAA,CApBV;CAAA,oBAuBA,YAAW,MAvBX;CAAA,oBAwBA,SAAQ;AACN;AAAA,kBAAY,iCAAZ;AAAA,MACA,SAAS,CAAC,GAAV,GAAgB,IAAC,IADjB;AAAA,MAEA,SAAS,CAAC,SAAV,GAAuB,IAAC,UAFxB;AAAA,MAGA,SAAS,CAAC,SAAV,GAAuB,IAAC,UAAD,IAAc,IAAC,IAAD,CAAK,WAAL,CAHrC;AAIA,aAAO,SAAP,CALM;IAAA,CAxBR;CAAA,oBAgCA,aAAY;aACV,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAhC,CAAqC,IAArC,EADU;IAAA,CAhCZ;CAAA,oBAmCA,iBAAgB;AACd,aAAO,uBAAP,CADc;IAAA,CAnChB;CAAA,oBAsCA,eAAc;aACZ,IAAC,oBAAD,GAAuB,IAAC,WAAD,GADX;IAAA,CAtCd;CAAA,oBAyCA,kBAAiB,SAAC,OAAD;AACf,gBAAU,WAAW,EAArB;AAAA,MACA,OAAO,CAAC,MAAR,GAAiB,OAAO,CAAC,QAAR,IAAoB,KADrC;AAAA,MAEA,IAAC,MAAD,CAAO;AAAA,QAAC,QAAQ,IAAT;OAAP,CAFA;aAGA,IAAC,IAAD,CAAK,IAAC,oBAAN,EAA2B,OAA3B,EAJe;IAAA,CAzCjB;CAAA,oBA8CA,cAAa;AACX,aAAO,EAAK,CAAC,OAAF,CAAU,IAAC,oBAAX,EAAgC,IAAC,WAAD,EAAhC,CAAX,CADW;IAAA,CA9Cb;kBAAA;MADkB,QAAQ,CAAC,MAL7B;AAsDA,MAAG,WAAH;AACE,MAAE,CAAC,MAAH,GAAY,EAAE,CAAC,MAAH,IAAa,EAAzB;WACA,EAAE,CAAC,MAAM,CAAC,KAAV,GAAkB,MAFpB;GAAA;WAIE,MAAM,CAAC,OAAP,GAAiB,MAJnB;GAvDD;AAAA,CAAD,EA4DK,kBAAiB,WAAjB,IAAiC,kBAAmB,WAAvD,GAAwE,MAAM,CAAC,GAA/E,GAAwF,MAAM,CAAC,OA5DjG;;ECAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3CA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhHA;AAAA,C;ACCA;AAAA,CACC,SAAC,EAAD;AAEC;AAAA,OAAK,MAAM,EAAX;AAAA,EACA,cAAc,kBAAiB,WAAjB,IAAiC,kBAAmB,WADlE;AAAA,EAIA,kBAAqB,WAAH,GAAoB,EAAE,CAAC,OAAO,CAAC,eAA/B,GAAoD,QAAQ,gCAAR,CAAyC,CAAC,eAJhH;AAAA,EAOA,qBAAqB,MAPrB;AAAA,EAUA,cAAc,IAVd;AAAA,EAWA,WAAW,EAXX;AAAA,EAYA,mBAAmB,CAZnB;AAAA,EAaA,mBAAoB,CAbpB;AAAA,EAgBA;AAAA,eAAW,SAAC,OAAD;AACT,2BAAqB,OAAO,CAAC,OAA7B;AAAA,MACA,cAAc,OAAO,CAAC,WAAR,IAAuB,WADrC;AAAA,MAEA,WAAW,OAAO,CAAC,QAAR,IAAoB,QAF/B;AAAA,MAGA,mBAAmB,OAAO,CAAC,SAH3B;aAIA,mBAAmB,OAAO,CAAC,SAAR,IAAqB,iBAL/B;IAAA,CAAX;GAAA,CAhBA;AAAA,EAwBA,KAAK;WACH,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,MAAL,EAAL,IAAsB,OAAvB,IAAkC,CAAnC,CAAqC,CAAC,QAAtC,CAA+C,EAA/C,CAAkD,CAAC,SAAnD,CAA6D,CAA7D,EADG;EAAA,CAxBL;AAAA,EA4BA,OAAO;WACL,OAAO,IAAP,GAAc,GAAd,GAAoB,IAApB,GAA2B,GAA3B,GAAiC,IAAjC,GAAwC,GAAxC,GAA8C,IAA9C,GAAqD,GAArD,GAA2D,IAA3D,GAAkE,IAAlE,GAAyE,KADpE;EAAA,CA5BP;AAAA,EAgCA,eAAe,EAhCf;AAAA,EAiCA,YAAY,CAAC,OAAb,GAAuB,SAAC,QAAD,EAAU,OAAV,EAAmB,OAAnB;AACrB;AAAA,cAAU,WAAW,EAArB;AAAA,IACA,SAAS,EADT;AAAA,IAEA,YAAY,CAAC,gBAAb,CAA8B,QAA9B,EAAuC,OAAvC,EAAgD,MAAhD,EAAwD,OAAxD,CAFA;AAAA,IAGA,YAAY,CAAC,aAAb,CAA2B,QAA3B,EAAoC,OAApC,EAA6C,MAA7C,EAAqD,OAArD,CAHA;WAIA,YAAY,CAAC,cAAb,CAA4B,QAA5B,EAAqC,OAArC,EAA8C,MAA9C,EAAsD,OAAtD,EALqB;EAAA,CAjCvB;AAAA,EA2CA,YAAY,CAAC,aAAb,GAA6B,SAAC,QAAD,EAAU,OAAV,EAAmB,MAAnB,EAA2B,OAA3B;AAC3B;AAAA,UAAM,OAAN;AAAA,IACA,WAAW,MAAM,CAAC,QADlB;AAAA,IAEA,MAAM,CAAC,OAAP,GAAiB,cAAc,CAAC,OAAf,CAAuB,GAAvB,EAA4B,QAA5B,CAFjB;AAGA,WAAO,MAAM,CAAC,OAAd,CAJ2B;EAAA,CA3C7B;AAAA,EAiDA,YAAY,CAAC,gBAAb,GAAgC,SAAC,QAAD,EAAU,OAAV,EAAmB,MAAnB,EAA2B,OAA3B;AAC9B,UAAM,CAAC,QAAP,GAAkB,eAAe,CAAC,uBAAhB,CAAwC,OAAxC,EAAgD,QAAhD,CAAlB;AACA,WAAO,MAAM,CAAC,QAAd,CAF8B;EAAA,CAjDhC;AAAA,EAsDA,YAAY,CAAC,aAAb,GAA6B,SAAC,QAAD,EAAU,OAAV,EAAmB,MAAnB,EAA2B,OAA3B;AAC3B,UAAM,CAAC,MAAP,GAAgB,kBAAmB,OAAM,CAAC,QAAQ,CAAC,MAAhB,CAAnB,IAA8C,EAA9D;AACA,WAAO,MAAM,CAAC,MAAd,CAF2B;EAAA,CAtD7B;AAAA,EAyDA,YAAY,CAAC,yBAAb,GAAyC,SAAC,QAAD,EAAU,OAAV,EAAmB,MAAnB,EAA2B,OAA3B;AACtC;AAAA,QAAG,yBAAH;AACC,kBAAY,OAAQ,UAApB;AAAA,MACA,WAAW,MAAM,CAAC,QADlB;AAEA,UAAG,uBAAH;AACE,oBAAa,QAAQ,CAAC,MAAT,CAAgB,SAAhB,CAAb,CADF;OAFA;AAIA,UAAG,aAAY,UAAf;AACE,YAAG,SAAH;AAAkB,iBAAO,SAAP,CAAlB;SADF;OAJA;AAMA,UAAG,aAAY,MAAZ,IAAuB,cAAe,EAAzC;AACE,eAAO,YAAY,SAAZ,GAAwB,GAA/B,CADF;OAAA;AAEK,eAAQ,YAAQ,CAAC,CAAC,CAAC,MAAF,CAAS,SAAT,CAAD,CAAR,GAA6B,GAArC,CAFL;OAPD;KADsC;EAAA,CAzDzC;AAoEE,SAAO,EAAP,CApEF;AAAA,EAsEA,YAAY,CAAC,kBAAb,GAAkC,SAAC,QAAD,EAAW,OAAX,EAAoB,MAApB,EAA4B,OAA5B;AAChC;AAAA,QAA8C,4CAA9C;AAAA,YAAU,UAAM,qBAAN,CAAV;KAAA;AAAA,IACA,WAAW,MAAM,CAAC,QADlB;AAAA,IAEA,kBAAkB,MAAM,CAAC,OAAO,CAAC,eAFjC;AAAA,IAGA,cAAc,QAAQ,CAAC,KAAT,IAAkB,CAA0C,4BAAzC,QAAG,OAAQ,aAAX,GAAwB,GAAxB,GAA2B,QAA3B,SAAD,CAAlB,IAAsF,EAHpG;AAIA,QAAG,uBAAH;AACE,oBAAe,CAAI,CAAC,uBAAD,KAAuB,2BAA0B,QAApD,GAAkE,kBAAkB,GAApF,GAA6F,EAA9F,CAAD,GAAsG,QAApH,CADF;KAJA;AAAA,IAMA,MAAM,CAAC,WAAP,GAAyB,gBAAe,EAAlB,GAA2B,EAA3B,GAAmC,IAAI,CAAC,CAAL,CAAO,WAAP,CANzD;AAOA,WAAO,MAAM,CAAC,WAAd,CARgC;EAAA,CAtElC;AAAA,EA+EA,cAAc,EA/Ed;AAAA,EAiFA,WAAW,CAAC,WAAZ,GAAyB,SAAC,QAAD,EAAW,OAAX,EAAoB,MAApB,EAA4B,OAA5B;AAEhB,QAAG,0BAAH;aAA6B,qDAAkD,MAAM,CAAC,MAAM,CAAC,IAAhE,GAAqE,wBAAlG;KAAA;aAA8H,GAA9H;KAFgB;EAAA,CAjFzB;AAAA,EAsFA,WAAW,CAAC,YAAZ,GAA0B,SAAC,QAAD,EAAW,OAAX,EAAoB,MAApB,EAA4B,OAA5B;AACxB;AAAA,UAAM,MAAM,CAAC,MAAb;AACA,QAAG,qBAAH;AACE,aAAO,EAAP,CADF;KAAA;AAGE,aAAQ,iCAA8B,GAAG,CAAC,SAAlC,GAA4C,SAA5C,GAAqD,QAArD,GAA8D,IAA9D,GAAkE,MAAM,CAAC,WAAzE,GAAqF,UAA7F,CAHF;KAFwB;EAAA,CAtF1B;AAAA,EA8FA,WAAW,CAAC,aAAZ,GAA2B,SAAC,QAAD,EAAW,OAAX,EAAoB,MAApB,EAA4B,OAA5B;AAEzB;AAAA,YAAQ,EAAR;AACA,QAAuB,yBAAa,+BAApC;AAAA,cAAQ,WAAR;KADA;AAAA,IAEA,aAAgB,yBAAa,+BAAhB,GAAwC,IAAC,OAAO,UAAhD,GAA+D,EAF5E;AAAA,IAGA,YAAY;aAAA;AACV;AAAA,sBAAc,WAAW,cAAzB;AAAA,QACA,cAAc,cADd;AAEA,eAAQ,YAAS,WAAT,GAAqB,UAArB,GAA+B,WAA/B,GAA2C,UAA3C,GAAqD,WAArD,GAAiE,iBAAjE,GAAkF,WAAlF,GAA8F,iBAA9F,GAA+G,WAA/G,GAA2H,iBAA3H,GAA4I,WAApJ,CAHU;MAAA;IAAA,QAHZ;AAAA,IAQA,SAAS;aAAA;AACP,YAAG,UAAS,WAAZ;iBAA8B,kBAAe,KAAf,GAAqB,GAArB,GAAuB,CAAC,WAAD,CAAvB,GAAoC,iDAApC,GAAqF,UAArF,GAAiG,WAA/H;SAAA;iBAA8I,GAA9I;SADO;MAAA;IAAA,QART;AAUA,WAAO,QAAP,CAZyB;EAAA,CA9F3B;AAAA,EA6GA,iBAAiB,EA7GjB;AAAA,EAgHA,cAAc,CAAC,OAAf,GAAyB,SAAC,GAAD,EAAM,QAAN;AACvB;AAAA,cAAU;AAAA,MACR,UAAU,cAAc,CAAC,QAAf,CAAwB,GAAxB,EAA6B,QAA7B,CADF;AAAA,MAER,QAAQ,cAAc,CAAC,MAAf,CAAsB,GAAtB,EAA2B,QAA3B,CAFA;AAAA,MAGR,UAAU,cAAc,CAAC,QAAf,CAAwB,GAAxB,EAA6B,QAA7B,CAHF;AAAA,MAIR,UAAU,cAAc,CAAC,QAAf,CAAwB,GAAxB,EAA6B,QAA7B,CAJF;AAAA,MAKR,UAAU,cAAc,CAAC,QAAf,CAAwB,GAAxB,EAA6B,QAA7B,CALF;AAAA,MAMR,WAAW,GAAG,CAAC,SANP;AAAA,MAOR,cAAc,cAAc,CAAC,YAAf,CAA4B,GAA5B,EAAiC,QAAjC,CAPN;AAAA,MAQR,iBAAiB,GAAG,CAAC,eAAJ,IAAuB,MARhC;AAAA,MASR,MAAM,GAAG,CAAC,IATF;KAAV;AAWA,WAAO,OAAP,CAZuB;EAAA,CAhHzB;AAAA,EA+HA,cAAc,CAAC,QAAf,GAA0B,SAAC,GAAD,EAAM,QAAN;AACxB;AAAA,eAAW,MAAX;AACA,QAAG,sBAAH;AACE,iBAAc,GAAG,CAAC,UAAP,GAAuB,GAAvB,GAAgC,MAA3C,CADF;KAAA,MAEK,IAAG,yBAAH;AACH,iBAAc,GAAG,CAAC,UAAP,GAAuB,GAAvB,GAAgC,MAA3C,CADG;KAHL;AAKA,WAAO,QAAP,CANwB;EAAA,CA/H1B;AAAA,EAwIA,cAAc,CAAC,MAAf,GAAwB,SAAC,GAAD,EAAM,QAAN;AACtB;AAAA,aAAS,MAAT;AACA,QAAG,kBAAH;AACE,eAAS,GAAG,CAAC,MAAb,CADF;KAAA,MAEK,IAAG,uBAAH;AACH,eAAS,QAAQ,CAAC,MAAlB,CADG;KAHL;AAKA,WAAO,MAAP,CANsB;EAAA,CAxIxB;AAAA,EAiJA,cAAc,CAAC,QAAf,GAA0B,SAAC,GAAD,EAAM,QAAN;AACxB;AAAA,eAAW,GAAG,CAAC,QAAJ,IAAgB,MAAM,CAAC,IAAvB,IAA+B,MAA1C;AACA,QAAG,aAAY,SAAf;AACE,iBAAW,UAAX,CADF;KAAA,MAEK,IAAG,aAAY,MAAf;AACH,UAAuB,YAAvB;AAAA,QAAC,WAAW,MAAZ;OADG;KAHL;AAKA,WAAO,QAAP,CANwB;EAAA,CAjJ1B;AAAA,EA0JA,cAAc,CAAC,QAAf,GAA0B,SAAC,GAAD,EAAM,QAAN;AACxB;AAAA,eAAW,GAAG,CAAC,QAAJ,IAAgB,KAA3B;WACA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,GAFpB;EAAA,CA1J1B;AAAA,EA+JA,cAAc,CAAC,QAAf,GAA0B,SAAC,GAAD,EAAM,QAAN;AACxB;AAAA,eAAW,GAAG,CAAC,QAAJ,IAAgB,KAA3B;WACA,WAAc,QAAH,GAAiB,UAAjB,GAAiC,GAFpB;EAAA,CA/J1B;AAAA,EAoKA,cAAc,CAAC,QAAf,GAA0B,SAAC,GAAD,EAAM,QAAN;AACxB;AAAA,WAAO,EAAP;AAAA,IAEA,IAAI,CAAC,KAAL,GAAgB,GAAG,CAAC,SAAP,GAAsB,CAAtB,GAAgC,GAAG,CAAC,SAAP,GAAsB,GAAG,CAAC,SAA1B,GAAyC,gBAFnF;AAIA,QAAG,GAAG,CAAC,YAAP;AACE,UAAI,CAAC,KAAL,GAAa,EAAb,CADF;KAAA;AAGE,UAAI,CAAC,KAAL,GAAc,WAAW,IAAI,CAAC,KAA9B,CAHF;KAJA;AAQA,WAAO,IAAP,CATwB;EAAA,CApK1B;AAAA,EA+KA,cAAc,CAAC,YAAf,GAA8B,SAAC,GAAD,EAAM,QAAN;AAC5B,WAAO,QAAQ,kBAAR,IAAsB,CAAC,GAAG,CAAC,UAAJ,IAAkB,QAAQ,CAAC,QAA5B,CAAD,KAA2C,IAAhE,IAAwE,yCAA/E;AAGA,WAAO,IAAP,CAJ4B;EAAA,CA/K9B;AAAA,EAsLA,MAAM;AAAA,IACJ,MAAM,IADF;AAAA,IAEJ,cAAc,OAFV;GAtLN;AA0LA,MAAG,WAAH;AACE,MAAE,CAAC,OAAH,GAAa,EAAE,CAAC,OAAH,IAAc,EAA3B;WACA,EAAE,CAAC,SAAS,CAAC,OAAb,GAAuB,IAFzB;GAAA;WAIE,MAAM,CAAC,OAAP,GAAiB,IAJnB;GA5LD;AAAA,CAAD,EAiMK,kBAAiB,WAAjB,IAAiC,kBAAmB,WAAvD,GAAwE,MAAM,CAAC,GAA/E,GAAwF,MAAM,CAAC,OAjMjG,CADA;;;ACAA,UAAU,CAAC,cAAX,CAA0B,OAA1B,EAAmC,SAAC,aAAD;AACjC,SAAO,CAAC,GAAR,CAAY,iBAAZ;AAAA,EACA,OAAO,CAAC,GAAR,CAAY,sBAAZ,CADA;AAAA,EAEA,OAAO,CAAC,GAAR,CAAY,IAAZ,CAFA;AAGA,MAAG,aAAH;AACE,WAAO,CAAC,GAAR,CAAY,OAAZ;AAAA,IACA,OAAO,CAAC,GAAR,CAAY,sBAAZ,CADA;WAEA,OAAO,CAAC,GAAR,CAAY,aAAZ,EAHF;GAJiC;AAAA,CAAnC;CAQA;AAAA;;;;;;GARA;;;ACCA,UAAU,CAAC,cAAX,CAA0B,MAA1B,EAAkC,SAAC,GAAD,EAAM,OAAN;AAChC,SAAO,OAAO,CAAC,IAAK,KAApB,CADgC;AAAA,CAAlC;;;ACAA,UAAU,CAAC,cAAX,CAA0B,GAA1B,EAA+B,SAAC,QAAD,EAAW,OAAX;AAC7B;AAAA,QAAM,OAAO,CAAC,IAAR,IAAgB,EAAtB;AAAA,EACA,YAAY,GAAG,CAAC,GADhB;AAAA,EAEA,SAAS,IAAI,CAAC,CAAL,CAAO,QAAP,CAFT;AAGA,MAAG,uBAAe,YAAY,MAAM,CAAC,MAArC;AAAiD,aAAS,KAAE,CAAC,MAAM,CAAC,KAAP,CAAa,CAAb,EAAe,UAAf,CAAD,CAAF,GAA8B,KAAvC,CAAjD;GAHA;SAII,cAAU,CAAC,UAAX,CAAsB,MAAtB,EALyB;AAAA,CAA/B;CAMA;AAAA;;;GANA;;ECFA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,CAzQA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7EA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtCA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjSA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjdA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1OA;AAAA,C,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9DA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3IA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CA1TA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApHA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5DA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/EA;AAAA,CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhQA;AAAA","sourcesContent":[" ","/*global _, window*/\r\n\r\n/**\r\n * @module core/http_response_parser\r\n * @description Global notifications mecanism around the whole application.\r\n * @see file helpers/backbone_notifications.js\r\n * @author pbesson\r\n */\r\n\r\n/*\r\n  Jquery ajax error and success [documentation](http://api.jquery.com/jquery.ajax/).\r\n  error\r\n    Type: Function( jqXHR jqXHR, String textStatus, String errorThrown )\r\n    A function to be called if the request fails. The function receives three arguments: The jqXHR (in jQuery 1.4.x, XMLHttpRequest) object, a string describing the type of error that occurred and an optional exception object, if one occurred. Possible values for the second argument (besides null) are \"timeout\", \"error\", \"abort\", and \"parsererror\". When an HTTP error occurs, errorThrown receives the textual portion of the HTTP status, such as \"Not Found\" or \"Internal Server Error.\" As of jQuery 1.5, the error setting can accept an array of functions. Each function will be called in turn. Note: This handler is not called for cross-domain script and cross-domain JSONP requests. This is an Ajax Event.\r\n  success: \r\n    Type: Function( PlainObject data, String textStatus, jqXHR jqXHR )\r\n    A function to be called if the request succeeds. The function gets passed three arguments: The data returned from the server, formatted according to the dataType parameter; a string describing the status; and the jqXHR (in jQuery 1.4.x, XMLHttpRequest) object. As of jQuery 1.5, the success setting can accept an array of functions. Each function will be called in turn. This is an Ajax Event.\r\n */\r\n\r\n\r\n(function(NS) {\r\n  \"use strict\";\r\n  NS = NS || {};\r\n\r\n  //Dependencies.\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n  var httpHelper = isInBrowser ? NS.Helpers.httpHelper : require(\"../helpers/http_helper\");\r\n  /**\r\n   * Default configuration.\r\n   * @type {Object}\r\n   */\r\n  var config = {\r\n    totalCountKey: \"odata.count\",\r\n    valuesKey: \"values\"\r\n  };\r\n\r\n  /**\r\n   * Configure the response parser.\r\n   * @param  {object} extendConf - the property you want to configure in the configuration.\r\n   * @return {[type]}            [description]\r\n   */\r\n  var configure = function configureHttpResponseParser(extendConf) {\r\n    if (!_.isObject(extendConf)) {\r\n      return;\r\n    }\r\n    _.extend(config, extendConf);\r\n  };\r\n\r\n  /**\r\n   * All the headers.\r\n   * @type {Object}\r\n   */\r\n  var HEADERS_KEYS = {\r\n    CONTENT_TYPE: \"Content-Type\",\r\n    TOTAL_COUNT: \"X-Total-Count\",\r\n    ACCESS_TOKEN: \"x-access-token\"\r\n  };\r\n  /**\r\n   * All the content types.\r\n   * @type {Object}\r\n   */\r\n  var CONTENT_TYPES = {\r\n    LIST: \"application/json+list\",\r\n    LIST_META: \"application/json+list+meta\",\r\n    ENTITY_DESC: \"applicatin/json+\",\r\n    ENTITY: \"application/json\"\r\n  };\r\n\r\n  /**\r\n   * Get the object name from the content type.\r\n   * @param  {string} contentType - The content type.\r\n   * @return {string} The name of the object.\r\n   */\r\n  var getObjectName = function getObjectNameFromContentType(contentType) {\r\n    var splitContent = contentType.split('+');\r\n    if (splitContent !== undefined && splitContent.length > 1) {\r\n      return splitContent[1].split(';')[0];\r\n\r\n    }\r\n    return undefined;\r\n  };\r\n  /**\r\n   * Parse an entity http response.\r\n   * @param  {jqXHR} response   - jQuery XmlHttpRequest.\r\n   * @param {object} contentType -  Object name in the contentType.\r\n   * @return {object}           - The parse response.\r\n   */\r\n  var entityParser = function entityParser(response, contentType) {\r\n    var entity = response.responseJSON;\r\n    //Set an object name if it is given as argument.\r\n    if (contentType) {\r\n      entity._objectName = getObjectName(contentType);\r\n    }\r\n    return entity;\r\n  };\r\n\r\n  /**\r\n   * Collection response parser.\r\n   * {jqXHR} response - jQuery XmlHttpRequest.\r\n   * @return {object}         - The parse response.\r\n   */\r\n  var collectionParser = function collectionParser(response, isMetaInHeader) {\r\n\r\n    var totalCount, values;\r\n    var jsonResponse = response.responseJSON;\r\n\r\n    if (isMetaInHeader) {\r\n      totalCount = +(response.getResponseHeader(HEADERS_KEYS.TOTAL_COUNT));\r\n      values = jsonResponse;\r\n      if (!_.isArray(values)) {\r\n        throw new ArgumentNullException(\"response.jsonResponse.\" + config.valuesKey + \" should be an array.\", response);\r\n      }\r\n    } else {\r\n\r\n      totalCount = jsonResponse[config.totalCountKey] || jsonResponse.length;\r\n      values = jsonResponse[config.valuesKey];\r\n      if (!_.isArray(values)) {\r\n        throw new ArgumentNullException(\"response.jsonResponse should be an array.\", response);\r\n      }\r\n    }\r\n\r\n    return {\r\n      totalCount: totalCount,\r\n      values: values\r\n    };\r\n\r\n  };\r\n\r\n  /**\r\n   * @param  {[type]} response [description]\r\n   * @return {[type]}          [description]\r\n   */\r\n  var parseAccessToken = function parseAccessToken(response) {\r\n    var accessToken = response.getResponseHeader(HEADERS_KEYS.ACCESS_TOKEN);\r\n    if (accessToken) {\r\n      httpHelper.setAccessToken(accessToken, true);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Polyfill for the string contains method.\r\n   * @param  {string} string  - The string to test.\r\n   * @param  {string} pattern - The pattern to identify.\r\n   * @return {boolean}         true or false.\r\n   */\r\n  var contains = function stringContains(string, pattern) {\r\n    if (!_.isString(string)) {\r\n      return false;\r\n    }\r\n    return string.indexOf(pattern) !== -1;\r\n  };\r\n\r\n  /**\r\n   * Parse HttpResponse.\r\n   * @param  {jqXHR} response - jQuery XmlHttpRequest.\r\n   * @return {object}         - The parse response.\r\n   */\r\n  var parseResponse = function parseResponse(response) {\r\n    var contentType = response.getResponseHeader(HEADERS_KEYS.CONTENT_TYPE);\r\n    parseAccessToken(response);\r\n    if (contains(contentType, CONTENT_TYPES.LIST_META)) {\r\n      return collectionParser(response, false);\r\n    } else if (contains(contentType, CONTENT_TYPES.LIST)) {\r\n      return collectionParser(response, true);\r\n    } else if (contains(contentType, CONTENT_TYPES.ENTITY_DESC)) {\r\n      return entityParser(response, contentType);\r\n    } else if (contains(contentType, CONTENT_TYPES.ENTITY)) {\r\n      return entityParser(response);\r\n    } else {\r\n      return response.responseJSON;\r\n    }\r\n  };\r\n  /**\r\n   * Container for the export.\r\n   * @type {Object}\r\n   */\r\n  var httpResponseParser = {\r\n    entity: entityParser,\r\n    collection: collectionParser,\r\n    parse: parseResponse,\r\n    configure: configure\r\n  };\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Core = NS.Core || {};\r\n    NS.Core.httpResponseParser = httpResponseParser;\r\n  } else {\r\n    module.exports = httpResponseParser;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global $,window*/\r\n\r\n/**\r\n * @module helpers/backbone_notifications\r\n * @description Global notifications mecanism around the whole application.\r\n * @see file helpers/backbone_notifications.js\r\n * @author  pbesson\r\n */\r\n\r\n(function(NS) {\r\n  \"use strict\";\r\n  NS = NS || {};\r\n\r\n  //Dependencies.\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var Notifications = isInBrowser ? NS.Models.Notifications : require('../models/notifications');\r\n  var NotificationsView = isInBrowser ? NS.Views.NotificationsView : require('../views/notifications-view');\r\n\r\n  /**\r\n   * Container specific to the application in order to manipulate the notification the way we want.\r\n   * @type {Object}\r\n   */\r\n  var backboneNotification = {\r\n\r\n    /**\r\n     * An instance of the notifications view in order to deal with the notifications.\r\n     * Which has a Notifications Model. This view is able to manipulate notifications and to render them.\r\n     * @type {NotificationsView}\r\n     */\r\n    notificationsView: new NotificationsView({\r\n      model: new Notifications()\r\n    }),\r\n\r\n    /**\r\n     * Add a notification in the stack. Is isRender is define and is true, the notifications are displayed.\r\n     * @param {object}  jsonNotification - A json object representing the notification. Types: warning, error, success.\r\n     * @param {Boolean} isRender         - Is isRender is define and is true, the notifications are displayed immediately.\r\n     * @example `Fmk.helpers.backboneNotifications.addNotification({type: \"error\", message: \"Message\"}, true);`\r\n     *\r\n     */\r\n    addNotification: function addNotification(jsonNotification, isRender) {\r\n      isRender = isRender || false;\r\n      this.notificationsView.model.add(jsonNotification);\r\n      if (isRender) {\r\n        this.renderNotifications();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Render all the notifications which are in the notifications collection and then clear this list.\r\n     * Once the notifications have been rendered, the messages stack is cleared\r\n     * @param  {string} selectorToRender - A css selector twhich define where the notifications are redered. Default us \"div#summary\"\r\n     * @param  {integer} timeout         - If a timeout is define, the notification is hidden after _timeout_ seconds.\r\n     * @param {boolean} isReset - Does the model needs to be reset.\r\n     * @return {undefined}\r\n     */\r\n    renderNotifications: function renderInApplication(selectorToRender, timeout, isReset) {\r\n      var selector = selectorToRender || \"div#summary\";\r\n      //We render all the messages.\r\n      $(selector).append(this.notificationsView.render().el);\r\n      //We empty the collection which contains all the notification messages.\r\n      if (isReset) {\r\n        this.notificationsView.model.reset();\r\n      }\r\n      $('button').button('reset');\r\n      var that = this;\r\n      //timeout = timeout || 5;\r\n      /*Notifications are displayed only timeout seconds.*/\r\n      if (timeout !== null && timeout !== undefined) {\r\n        setTimeout(function() {\r\n          that.clearNotifications(selector);\r\n        }, timeout * 1000);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Clear all the displayed notifications.\r\n     * @param  {string} selectorToRender The css selector describing where the notifications are rendered. Default is \"div#summary\".\r\n     * @return @return {undefined}\r\n     */\r\n    clearNotifications: function clearNotifications(selectorToRender) {\r\n      var selector = selectorToRender || \"div#summary\";\r\n      this.notificationsView.model.reset();\r\n      $(selector).html('');\r\n      $('button').button('reset');\r\n    },\r\n\r\n    /**\r\n     * Clear only the errors in the display of the screen.\r\n     * @param  {string} selectorToRender The css selector describing where the notifications are rendered. Default is \"div.notifications div.alert-danger\".\r\n     * @return {[type]}                  [description]\r\n     */\r\n    clearErrors: function clearErrors(selectorToRender) {\r\n      var selector = selectorToRender || \"div.notifications div.alert-danger\";\r\n      $(selector).html('');\r\n      $('button').button('reset');\r\n    }\r\n  };\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.backboneNotification = backboneNotification;\r\n  } else {\r\n    module.exports = backboneNotification;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","#global $, _\r\n((NS) ->\r\n  \"use strict\"\r\n\r\n  # Filename: helpers/error_helper.js */\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  # Exception class\r\n  ###\r\n   * Creates a new CustomException.\r\n   * @class Exception class.\r\n  ###\r\n  class CustomException\r\n    # @constructor\r\n    constructor:(@name, @message,@options) ->\r\n      @log()\r\n    #Log the content of the exception.\r\n    log: ->\r\n      console.error(\"name\", @name, \"message\", @message, \"options\", @options)\r\n    # JSONify the content of the exception.\r\n    toJSON:->\r\n      return {\"name\": @name, \"message\": @message,  \"options\": @options}\r\n  # Exception for a not implemented method.\r\n  class NotImplementedException extends CustomException\r\n    constructor:(message, options) ->\r\n      super(\"NotImplementedException\", message, options)\r\n  # Exception class for an argument null exeption.\r\n  class ArgumentNullException extends CustomException\r\n    constructor:(message) ->\r\n      super(\"ArgumentNull\", message)\r\n  # Exception for a invalid argument exeption\r\n  class ArgumentInvalidException extends CustomException\r\n    constructor:(message, options) ->\r\n      super(\"ArgumentInvalidException\", message, options)\r\n  class DependencyException extends CustomException\r\n    constructor:(message, options) ->\r\n      super(\"DependencyException\", message, options)\r\n  mod = {\r\n    CustomException: CustomException\r\n    NotImplementedException: NotImplementedException\r\n    ArgumentNullException: ArgumentNullException\r\n    ArgumentInvalidException: ArgumentInvalidException\r\n    DependencyException: DependencyException\r\n  }\r\n  if isInBrowser\r\n    NS.Helpers = NS.Helpers or {}\r\n    NS.Helpers.Exceptions = mod\r\n  else\r\n    module.exports = mod\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)","/*global _, window, i18n*/\r\n\r\n/**\r\n * @module helpers/error_helper\r\n * @description Error handling around the application.\r\n * @see file helpers/error_helper.js\r\n */\r\n\r\n(function(NS) {\r\n    \"use strict\";\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    NS = NS || {};\r\n    var BackboneNotification = isInBrowser ? NS.Helpers.backboneNotification : require('./backbone_notification');\r\n    var UtilHelper = isInBrowser ? NS.Helpers.utilHelper : require('./util_helper');\r\n    var metadataBuilder = isInBrowser ? NS.Helpers.metadataBuilder : require('./metadata_builder').metadataBuilder;\r\n\r\n    /**\r\n     * Define all the error types of the exceptions which are defined.\r\n     * @type {object}\r\n     */\r\n    var errorTypes = {\r\n        entity: \"entity\",\r\n        collection: \"collection\",\r\n        composite: \"composite\"\r\n    };\r\n\r\n    /**\r\n     * List of all the global messages to look after.\r\n     * @type {Array}\r\n     */\r\n    var globalMessages = [{\r\n        name: \"globalErrors\",\r\n        type: \"error\"\r\n    }, {\r\n        name: \"globalSuccess\",\r\n        type: \"success\"\r\n    }, {\r\n        name: \"globalWarnings\",\r\n        type: \"warning\"\r\n    }, {\r\n        name: \"globalInfos\",\r\n        type: \"error\"\r\n    }, {\r\n        name: \"globalErrorMessages\",\r\n        type: \"error\"\r\n    }, {\r\n        name: \"globalSuccessMessages\",\r\n        type: \"success\"\r\n    }, {\r\n        name: \"globalWarningMessages\",\r\n        type: \"warning\"\r\n    }, {\r\n        name: \"globalInfoMessages\",\r\n        type: \"error\"\r\n    }, {\r\n        name: \"errors\",\r\n        type: \"error\"\r\n    }];\r\n\r\n    function configure(options) {\r\n        options = options || {};\r\n        if (_.isArray(options.globalMessages)) {\r\n            globalMessages = options.globalMessages;\r\n        }\r\n        if (_.isObject(options.errorTypes)) {\r\n            errorTypes = options.errorTypes;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Treat the response json of an error.\r\n     * @param  {object} responseJSON The json response from the server.\r\n     * @param  {object} options The options containing the model. {model: Backbone.Model}\r\n     * @return {object} The constructed object from the error response.\r\n     */\r\n    function treatEntityExceptions(responseJSON, options) {\r\n        var errors = responseJSON.errors;\r\n        /*if (options.isDisplay || options.model) {\r\n            displayErrors(errors, options);\r\n        }*/\r\n        if (options.model) {\r\n            setModelErrors(options.model, errors);\r\n        }\r\n        return errors;\r\n    }\r\n\r\n    /**\r\n     * Treat the collection exceptions.\r\n     * @param  {object} responseJSON The JSON response from the server.\r\n     * @param  {object} options Options for error handling. {isDisplay: boolean, model: Backbone.Model}\r\n     * @return {object} The constructed object from the error response.\r\n     */\r\n    function treatCollectionExceptions(responseJSON, options) {\r\n        var errors = responseJSON.errors;\r\n        /* if (options.isDisplay || options.model) {\r\n            displayErrors(errors, options);\r\n        }*/\r\n        if (options.model) {\r\n            setCollectionErrors(options.model, errors);\r\n        }\r\n        return errors;\r\n\r\n    }\r\n\r\n    function treatGlobalMessagesPerType(messages, type) {\r\n        var messagesGlobal = [];\r\n        messages.forEach(function convertErrorsIntoNotification(element) {\r\n            var options = {};\r\n            if (_.isObject(element)) {\r\n                options = formatParameters(element.parameters);\r\n                element = element.message;\r\n            }\r\n            messagesGlobal.push({\r\n                type: type,\r\n                message: i18n.t(element, options),\r\n                creationDate: Date.now()\r\n            });\r\n\r\n        });\r\n        BackboneNotification.addNotification(messagesGlobal);\r\n    }\r\n\r\n    /**\r\n     * Treat the global errors.\r\n     * @param  {object} responseJSON - Treat the global errors.\r\n     * @param {object} options - Options for error handling.{isDisplay:[true/false], globalMessages: [{type: \"error\", name: \"propertyName\"}]}\r\n     * @return {}\r\n     */\r\n    function treatGlobalErrors(responseJSON, options) {\r\n        options = options || {};\r\n        var isDisplay = options.isDisplay || true;\r\n        var allMessagesTypes = options.globalMessages || globalMessages;\r\n        if (responseJSON !== undefined) {\r\n            var messages = responseJSON;\r\n            //Looping through all messages types.\r\n            allMessagesTypes.forEach(function treatAllTypes(globalMessageConf) {\r\n                //Treat all the gloabe\r\n                var msgs = messages[globalMessageConf.name];\r\n                if (msgs !== undefined) {\r\n                    treatGlobalMessagesPerType(msgs, globalMessageConf.type);\r\n                }\r\n            });\r\n            if (isDisplay) {\r\n                BackboneNotification.renderNotifications();\r\n            }\r\n\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * Treat with all the custom exception\r\n     * @param  {object} responseJSON - Response from the server.\r\n     * @param  {object} options      - Options for the exceptions teratement such as the {model: modelVar}.\r\n     * @return {object}              - The parsed error response.\r\n     */\r\n    function treatBadRequestExceptions(responseJSON, options) {\r\n\r\n        if (responseJSON.type !== undefined) {\r\n            switch (responseJSON.type) {\r\n                case errorTypes.entity:\r\n                    treatEntityExceptions(responseJSON, options);\r\n                    break;\r\n                case errorTypes.collection:\r\n                    treatCollectionExceptions(responseJSON, options);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // .\r\n    /**\r\n     * Transform errors send by API to application errors. Dispatch depending on the response http code.\r\n     * @param  {object} response - Object whic\r\n     * @param  {object} options  - Options for the exceptions teratement such as the model, {model: modelVar}.\r\n     * @return {object}          - The parsed error response.\r\n     */\r\n    function manageResponseErrors(response, options) {\r\n        options = options || {};\r\n        response = response || {};\r\n        var responseErrors = response.responseJSON;\r\n        if (responseErrors === undefined) {\r\n            if (response.responseText !== undefined) {\r\n                try {\r\n                    //The first try is to parse the response in JSON. Maybe the return mime type is not correct.\r\n                    responseErrors = JSON.parse(response.responseText);\r\n                } catch (e) {\r\n                    //Construt an error with the text.\r\n                    responseErrors = {\r\n                        statusCode: response.status,\r\n                        globalErrorMessages: [response.responseText]\r\n                    };\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n        responseErrors.statusCode = responseErrors.statusCode || response.status;\r\n        if (responseErrors.statusCode) {\r\n            treatGlobalErrors(responseErrors);\r\n            /*Deal with all the specific exceptions*/\r\n            switch (responseErrors.statusCode || response.status) {\r\n                case 400:\r\n                    treatBadRequestExceptions(responseErrors, options);\r\n                    break;\r\n                case 401:\r\n                    treatBadRequestExceptions(responseErrors, options);\r\n                    break;\r\n                case 422:\r\n                    treatBadRequestExceptions(responseErrors, options);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n\r\n\r\n        //Container for global errors.\r\n        var globalErrors = [];\r\n        var fieldErrors = {};\r\n\r\n        if (responseErrors !== undefined && responseErrors !== null) {\r\n            // Case of an HTTP Error with a status code: (as an example 404).*/\r\n            if (responseErrors.error !== undefined && responseErrors.error !== null) {\r\n                //The response json should have the following structure : {statusCode: 404, error: \"Not Found\"}\r\n                var message = responseErrors.statusCode ? responseErrors.statusCode + ' ' : '';\r\n                var parameters = responseErrors.parameters || {};\r\n                globalErrors.push({\r\n                    message: message + i18n.t(responseErrors.error),\r\n                    parameters: parameters\r\n                });\r\n            } else if (_.isObject(responseErrors)) {\r\n                if (responseErrors.globalErrors !== undefined && responseErrors.globalErrors !== null) {\r\n                    responseErrors.globalErrors.forEach(function(error) {\r\n                        globalErrors.push(error.message);\r\n                    });\r\n                }\r\n                if (responseErrors.fieldErrors !== undefined && responseErrors.fieldErrors !== null) {\r\n                    responseErrors.fieldErrors = _.object(_.map(responseErrors.fieldErrors, function(value, key) {\r\n                        return [key, i18n.t(value)];\r\n                    }));\r\n                    fieldErrors = responseErrors.fieldErrors;\r\n                }\r\n            } else if (responseErrors.exceptionType !== undefined) {\r\n                //If the error is not catch by the errorHelper, in dev, display the type and the message if exists.\r\n                globalErrors.push(i18n.t('error.' + responseErrors.exceptionType));\r\n                if (responseErrors.exceptionMessage !== undefined) {\r\n                    globalErrors.push(responseErrors.statusCode + \" \" + responseErrors.exceptionMessage);\r\n                }\r\n            } else {\r\n                //In the case the error is completly unanticipated.\r\n                console.log(i18n.t('error.unanticipated'), responseErrors);\r\n                globalErrors.push(i18n.t('error.unanticipated'));\r\n            }\r\n        }\r\n        //If there is no errors, do nothing.\r\n        if ((_.isEmpty(fieldErrors) && _.isEmpty(globalErrors))) {\r\n            return null;\r\n        } else {\r\n\r\n            var errors = {\r\n                fieldErrors: fieldErrors,\r\n                globalErrors: globalErrors\r\n            };\r\n            //If the display options is passed in argument, we display the options.\r\n            if (options.isDisplay || options.model) {\r\n                displayErrors(errors);\r\n            }\r\n            if (options.model) {\r\n                UtilHelper.isBackboneCollection(options.model) ? setCollectionErrors(options.model, errors) : setModelErrors(options.model, errors);\r\n            }\r\n            return errors;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Display errors which are defined into the errors.global.\r\n     * @param  {array} errors   - An array containing the globam errors.\r\n     * @param  {object} options - An object which contains the method options such as isDisplay to tell if the errors has to be immediatly displayed.\r\n     * @return {undefined}\r\n     */\r\n    function displayErrors(errors, options) {\r\n        options = options || {};\r\n        var isDisplay = options.isDisplay || true;\r\n        if (errors !== undefined && errors.globalErrors !== undefined) {\r\n            var errorsGlobal = [];\r\n            errors.globalErrors.forEach(function convertErrorsIntoNotification(element) {\r\n                var options = {};\r\n                if (_.isObject(element)) {\r\n                    options = formatParameters(element.parameters);\r\n                    element = element.message;\r\n                }\r\n                errorsGlobal.push({\r\n                    type: \"error\",\r\n                    message: i18n.t(element, options),\r\n                    creationDate: Date.now()\r\n                });\r\n\r\n            });\r\n            BackboneNotification.addNotification(errorsGlobal, isDisplay);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the *model* errors in the fieldErrors.\r\n     * @param {Model} model    - A backbone model.\r\n     * @param {object} errors  - An object which represents the errros. There should be the follwing structure : `{fieldErrors: {property: \"Error Message.\"}}`.\r\n     * @param {object} options - Options defined when setting the errors to the model.\r\n     */\r\n    function setModelErrors(model, errors, options) {\r\n        if (errors !== undefined && errors.fieldErrors !== undefined) {\r\n            model.set({\r\n                'errors': errors.fieldErrors\r\n            }, options);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the *model* errors in the fieldErrors.\r\n     * @param {Model} model    - A backbone model.\r\n     * @param {object} errors  - An object which represents the errros. There should be the follwing structure : `{fieldErrors: {property: \"Error Message.\"}}`.\r\n     * @param {object} options - Options defined when setting the errors to the model.\r\n     */\r\n    function setCollectionErrors(collection, errors, options) {\r\n        collection.setErrors(errors, options);\r\n    }\r\n\r\n    /**\r\n     * Template an error message with parameters.\r\n     * @param  {object} parameters - The parameters to format.\r\n     * @return {object}            - The formated parameters.\r\n     */\r\n    function formatParameters(parameters) {\r\n        var options = {},\r\n            formatter, value;\r\n        for (var prop in parameters) {\r\n            if (parameters.hasOwnProperty(prop)) {\r\n                if (parameters[prop].domain) {\r\n                    var domain = metadataBuilder.getDomains()[parameters[prop].domain];\r\n                    formatter = domain ? domain.format : undefined;\r\n                } else {\r\n                    formatter = undefined;\r\n                }\r\n                value = formatter && formatter.value ? formatter.value(parameters[prop].value) : parameters[prop].value;\r\n                options[prop] = value;\r\n            }\r\n        }\r\n        return options;\r\n    }\r\n\r\n    /**\r\n     * Exposed property of the module.\r\n     * @type {Object}\r\n     */\r\n    var errorHelper = {\r\n        manageResponseErrors: manageResponseErrors,\r\n        display: displayErrors,\r\n        setModelErrors: setModelErrors,\r\n        setCollectionErrors: setCollectionErrors,\r\n        configure: configure,\r\n        treatGlobalErrors: treatGlobalErrors\r\n    };\r\n\r\n    if (isInBrowser) {\r\n        NS.Helpers = NS.Helpers || {};\r\n        NS.Helpers.errorHelper = errorHelper;\r\n    } else {\r\n        module.exports = errorHelper;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global window, $, Backbone, _*/\r\n\r\n/**\r\n * @module helpers/form_helper\r\n * @description Helper for _form binding_, deals with models, collections, input, select, jQuery plugins.\r\n * @see file helpers/form_helper.js\r\n */\r\n\r\n(function(NS) {\r\n    \"use strict\";\r\n\r\n    //Dependencies\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    NS = NS || {};\r\n    var postRenderingHelper = isInBrowser ? NS.Helpers.postRenderingHelper : require(\"./post_rendering_helper\");\r\n\r\n    /**\r\n     * Helper to bond collections on list dom.\r\n     * @param  {object} jQuery selector         - A selector which should contains the list of element which dom list element.\r\n     * @param  {Backbone.Collection} collection - The collection where the reconstructed elements will be injected.\r\n     * @param  {object} options                 - {isSilent: boolean}\r\n     * @return {undefined}\r\n     */\r\n    var _formCollectionBinder = function forCollectionBinder(selector, collection, options) {\r\n        options = options || {};\r\n        options.isSilent = options.isSilent !== undefined ? options.isSilent : true;\r\n        if (selector !== undefined && selector !== null && collection instanceof Backbone.Collection) {\r\n            //collection.reset(null, {silent: true}); // The collection is cleared.\r\n            var index = 0;\r\n            //@todo: Check if there is a problem on collection save, the selector could have been change, do a clone.\r\n            Array.prototype.forEach.call(selector, function(modelLineSelector) {\r\n                //var model = new collection.model();\r\n                this.formModelBinder({\r\n                        inputs: $('input, textarea', modelLineSelector),\r\n                        options: $('select', modelLineSelector)\r\n                    },\r\n                    collection.at(index), //Model to populate.\r\n                    options\r\n                );\r\n                //collection.add(model,options);\r\n                index++;\r\n            }, this);\r\n        } else {\r\n            console.warn(\"The selector is not an object\", selector);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Model binder. Takes the data from the dom element and fill the model. Each dom element should have a _data-name_ property.\r\n     * @param  {object} data          - An object withe the structure {inputs: jQuerySelector, options: jQuerySelector} w<here jQuery Selector which contains the dom element of a model. inputs for inputs, options for selects.\r\n     * @param  {Backbone.Model} model - a Backbone.Model where the dom data will be injected to populate the fields.\r\n     * @param  {object} options       - The default options are: {isSilent: true}\r\n     * @return {undefined}\r\n     */\r\n    var _formModelBinder = function formModelBinder(data, model, options) {\r\n        options = options || {};\r\n        options.isSilent = options.isSilent !== undefined ? options.isSilent : true;\r\n        var modelContainer = {};\r\n        if (data.inputs !== null && data.inputs !== undefined) {\r\n            modelContainer = _.extend(modelContainer, this.formInputModelBinder(data.inputs, model, options));\r\n        }\r\n        if (data.options !== null && data.options !== undefined) {\r\n            modelContainer = _.extend(modelContainer, this.formOptionModelBinder(data.options, model, options));\r\n        }\r\n        model.set(modelContainer, {\r\n            silent: options.isSilent\r\n        });\r\n    };\r\n\r\n    // inputs must be a selector with option:selected inside and model a BackBone model.\r\n    /**\r\n     * Bind the model. If the model has a decorator (ie) a jQuery plugin, the data-decorator is use in order to\r\n     * @param  {object} inputs           - Selector containing all the inputs.\r\n     * @param  {Backbone.Model} model    - The model on which there is .\r\n     * @param  {object} options          - The default options are: {isSilent: true, isForceModelBinding: false}.\r\n     * @return {[type]}         [description]\r\n     */\r\n    var _formInputModelBinder = function formInputModelBinder(inputs, model, options) {\r\n        options = options || {};\r\n        options.isSilent = options.isSilent !== undefined ? options.isSilent : true;\r\n        //parameters checkings\r\n        if (typeof inputs === \"undefined\" || inputs === null) {\r\n            throw (\"inputs are not defined\");\r\n        }\r\n        if (typeof model === \"undefined\" || model === null) {\r\n            throw (\"the model is not defined\");\r\n        }\r\n        var modelContainer = {};\r\n        inputs.each(function() {\r\n            var input = this;\r\n            //console.log('input', input);\r\n            var currentvalue;\r\n            //we switch on all html5 values\r\n            //If a decorator is define, it should be use in order to get back the value.\r\n            var decorator = input.getAttribute('data-decorator');\r\n            if (decorator) {\r\n                currentvalue = postRenderingHelper.callParser({\r\n                    selector: $(input),\r\n                    helperName: decorator\r\n                });\r\n\r\n            } else if (input.tagName === \"TEXTAREA\") {\r\n                currentvalue = input.value;\r\n            } else { //See if an if on currentValue is nececessary.\r\n                switch (input.getAttribute('type')) {\r\n                    case \"checkbox\":\r\n                        currentvalue = input.multiple ? input.value : input.checked;\r\n                        break;\r\n                    case \"number\":\r\n                        var inputValue = input.value === \"\" ? undefined : input.value;\r\n                        currentvalue = (inputValue !== undefined && inputValue !== null) ? +inputValue : undefined;\r\n                        break;\r\n                    case \"radio\":\r\n                        if (input.checked) {\r\n                            currentvalue = _parseRadioValue(input.value);\r\n                        } else {\r\n                            currentvalue = modelContainer[this.getAttribute('data-name')];\r\n                        }\r\n                        break;\r\n                    default:\r\n                        currentvalue = input.value === \"\" ? undefined : input.value;\r\n                }\r\n\r\n            }\r\n\r\n\r\n            if (input.multiple) {\r\n                if (input.checked) {\r\n                    if (modelContainer[this.getAttribute('data-name')] === undefined) {\r\n                        modelContainer[this.getAttribute('data-name')] = [currentvalue];\r\n                    } else {\r\n                        modelContainer[this.getAttribute('data-name')].push(currentvalue);\r\n                    }\r\n                }\r\n            } else {\r\n                modelContainer[this.getAttribute('data-name')] = currentvalue;\r\n            }\r\n        });\r\n        if (options.isForceModelSet) {\r\n            model.set(modelContainer, {\r\n                silent: options.isSilent\r\n            });\r\n        }\r\n        return modelContainer;\r\n    };\r\n\r\n    var _parseRadioValue = function parseRadioValue(radioValue) {\r\n        switch (radioValue) {\r\n            case \"null\":\r\n                return undefined;\r\n            case \"true\":\r\n                return true;\r\n            case \"false\":\r\n                return false;\r\n            default:\r\n                return radioValue;\r\n        }\r\n    };\r\n\r\n    // formOptionModelBinder permet de convertir l'ensemble des options set d'un formulaire en model en fonction de leur attribut data-name.\r\n    // options must be a option:select and model a BackBone model.\r\n    var _formOptionModelBinder = function formOptionModelBinder(optionsSets, model, options) {\r\n        options = options || {};\r\n        options.isSilent = options.isSilent !== undefined ? options.isSilent : true;\r\n        //parameters checkings\r\n        if (typeof optionsSets === \"undefined\" || optionsSets === null) {\r\n            throw (\"options are not defined\");\r\n        }\r\n        if (typeof model === \"undefined\" || model === null) {\r\n            throw (\"the model is not defined\");\r\n        }\r\n\r\n        var selectedValue, modelContainer = {};\r\n        //For each option we take the value selected. We had this value to the model, only if the user doesn't choose the empty string.\r\n        optionsSets.each(function() {\r\n            var attributeName = this.getAttribute('data-name');\r\n            //A multiple option will be define with select2\r\n            var select = this;\r\n            var decorator = select.getAttribute('data-decorator');\r\n            if (decorator) {\r\n                selectedValue = postRenderingHelper.callParser({\r\n                    selector: $(select),\r\n                    helperName: decorator\r\n                });\r\n            } else {\r\n                if (this.hasAttribute('multiple')) {\r\n                    selectedValue = $(this).val() || []; // TODO : RGE si select2, il faut utiliser $(this).select2('val')\r\n                } else {\r\n                    selectedValue = this.value;\r\n                }\r\n\r\n            }\r\n            modelContainer[attributeName] = selectedValue === \"undefined\" ? undefined : selectedValue;\r\n        });\r\n        if (options.isForceModelSet) {\r\n            model.set(modelContainer, {\r\n                silent: options.isSilent\r\n            });\r\n        }\r\n        return modelContainer;\r\n\r\n    };\r\n\r\n    //#Generate a form from a model.\r\n    var _modelFormGenerator = function modelFormGenerator() {\r\n\r\n    };\r\n\r\n    var formHelper = {\r\n        formModelBinder: _formModelBinder,\r\n        formInputModelBinder: _formInputModelBinder,\r\n        formOptionModelBinder: _formOptionModelBinder,\r\n        modelFormGenerator: _modelFormGenerator,\r\n        formCollectionBinder: _formCollectionBinder\r\n    };\r\n\r\n    // Differentiate the export.\r\n    if (isInBrowser) {\r\n        NS.Helpers = NS.Helpers || {};\r\n        NS.Helpers.formHelper = formHelper;\r\n    } else {\r\n        module.exports = formHelper;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","\"use strict\"\r\n((NS) ->\r\n  # Filename: helpers/formatter_helper.coffee\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  \r\n  # Default confifuration of the formaters.\r\n  format =\r\n    currency: '0,0.00'\r\n    date: 'L'\r\n    dateTime: 'LLL'\r\n    \r\n  # Container for all the formaters.\r\n  formaters = {}\r\n  \r\n  #Update the configuration or the formater with the configuration given in option.\r\n  formaters.configure = (options) ->\r\n    _.extend(format, options)\r\n\r\n  #Format date\r\n  formaters.date = (prop, options) ->\r\n    options = options or {}\r\n    dateFormat = options.dateFormat or format.date\r\n    #Convert the isoString to a date without timezone.\r\n    if prop is undefined\r\n      return undefined\r\n    prop = prop.slice(0,10)\r\n    return moment(prop).format(dateFormat)\r\n  \r\n  #Format dateTime\r\n  formaters.dateTime = (prop, options) ->\r\n    options = options or {}\r\n    dateTimeFormat = options.dateTimeFormat or format.dateTime\r\n    return  moment(prop).format(dateTimeFormat)\r\n  \r\n  #Currency formatter\r\n  formaters.number = (prop, options) ->\r\n    options = options or {}\r\n    numeralFormat = options.numeralFormat or format.currency\r\n    return numeral(prop).format(numeralFormat);\r\n  \r\n  if isInBrowser\r\n    NS.Helpers = NS.Helpers or {}\r\n    NS.Helpers.formaters  = formaters\r\n  else\r\n    module.exports = formaters\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)","/*global window*/\r\n(function(NS) {\r\n    \"use strict\";\r\n\r\n    // Filename: helpers/metadata_builder.coffee\r\n    NS = NS || {};\r\n    //Dependency gestion depending on the fact that we are in the browser or in node.\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\r\n    var headerHelper = {\r\n        //Process all the data from the header.\r\n        process: function processHeader(headersElements) {\r\n            var headerData = [];\r\n            for (var i = 0, l = headersElements.length; i < l; i++) {\r\n                var active = i === 0 ? \"active\" : \"\";\r\n                var subHeaders = headersElements[i].subHeader;\r\n                var subHeaderData = [];\r\n                for (var j = 0; j < subHeaders.length; j++) {\r\n                    var sub2HeaderData = [];\r\n                    if (subHeaders[j].sub2Header !== undefined) {\r\n                        var sub2Headers = subHeaders[j].sub2Header;\r\n                        for (var k = 0; k < sub2Headers.length; k++) {\r\n                            var sub2HeaderName = sub2Headers[k].name;\r\n                            var sub2Header = {\r\n                                cssId: \"nav-\" + sub2HeaderName,\r\n                                active: \"\",\r\n                                name: sub2HeaderName,\r\n                                translationKey: \"header.subHeaders.sub2Headers.\" + sub2HeaderName,\r\n                                url: sub2Headers[k].url\r\n                            };\r\n                            sub2HeaderData.push(sub2Header);\r\n                        }\r\n                    }\r\n\r\n                    var subHeaderName = subHeaders[j].name;\r\n                    subHeaderData.push({\r\n                        cssId: \"nav-\" + subHeaderName,\r\n                        active: \"\",\r\n                        name: subHeaderName,\r\n                        translationKey: \"header.subHeaders.\" + subHeaderName,\r\n                        url: subHeaders[j].url,\r\n                        sub2Headers: sub2HeaderData\r\n                    });\r\n                }\r\n                var name = headersElements[i].name;\r\n                var jsonElement = {\r\n                    cssId: \"nav-\" + name,\r\n                    active: active,\r\n                    name: name,\r\n                    translationKey: \"header.\" + name,\r\n                    subHeaders: subHeaderData\r\n                };\r\n                if (headersElements[i].url !== undefined) {\r\n                    jsonElement.url = headersElements[i].url;\r\n                }\r\n                headerData.push(jsonElement);\r\n            }\r\n            return headerData;\r\n        }\r\n\r\n    };\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Helpers = NS.Helpers || {};\r\n        NS.Helpers.headerHelper = headerHelper;\r\n    } else {\r\n        module.exports = headerHelper;\r\n    }\r\n\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","#global $, _\r\n((NS) ->\r\n  # Filename: helpers/culture_helper.coffee\r\n  \"use strict\"\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  ArgumentNullException = if isInBrowser then NS.Helpers.Exceptions.ArgumentNullException else require(\"./custom_exception\").ArgumentNullException\r\n  ArgumentInvalidException= if isInBrowser then NS.Helpers.Exceptions.ArgumentInvalidException else require(\"./custom_exception\").ArgumentInvalidException\r\n  languagesOptions = {\r\n    'fr-FR':{},\r\n    'en-GB':{}\r\n  }\r\n  \r\n  #Define or extend a language in the application.\r\n  defineLanguage =(cultureCode, languageOptions, options) ->\r\n    options = options or {}\r\n    isExtend = options.isExtend or false\r\n    if not cultureCode?\r\n      throw new ArgumentNullException(\"cultureCode\", cultureCode)\r\n    if not _.isString(cultureCode)?\r\n      throw new ArgumentInvalidException(\"cultureCode should be a string.\", cultureCode)\r\n    if not languageOptions?\r\n      throw new ArgumentNullException(\"cultureCode\", languageOptions)\r\n    if not _.isObject(languageOptions)?\r\n      throw new ArgumentInvalidException(\"languageOptions should be an object.\", languageOptions)\r\n    if(not isExtend or not languageOptions[cultureCode]?)\r\n      languagesOptions[cultureCode] =  languageOptions\r\n    else\r\n      _.extend(languagesOptions[cultureCode], languageOptions)\r\n\r\n  #Define many languages in the application.\r\n  defineLanguages = (languages, options)->\r\n    if not _.isArray(languages)\r\n      throw new ArgumentInvalidException(\"Languages should be an array\", languages)\r\n    defineLanguage(language.culture, language.options) for language in languages\r\n  \r\n  # Get an array with all the application languages defined.\r\n  getCultures = ->\r\n    return _.keys(languagesOptions)\r\n  \r\n  # Get the language information.\r\n  getLanguage = (cultureCode)->\r\n    if languagesOptions[cultureCode]?\r\n      return languagesOptions[cultureCode]\r\n    return undefined\r\n\r\n  mod = {\r\n    \"getCultures\": getCultures,\r\n    \"defineLanguage\": defineLanguage,\r\n    \"defineLanguages\": defineLanguages,\r\n    \"getLanguage\":getLanguage\r\n  }\r\n  if isInBrowser\r\n    NS.Helpers = NS.Helpers or {}\r\n    NS.Helpers.languageHelper = mod\r\n  else\r\n    module.exports = mod\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)","/* global  _ , window, Promise,$, Backbone, i18n */\r\n/**\r\n * @module helpers/message_helper\r\n * @description Message helper to deal wit confirm, alert, ...\r\n * @see file helpers/message_helper.js\r\n */\r\n\r\n(function(NS) {\r\n    \"use strict\";\r\n    //Filename: \r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    //Dependencies.\r\n    var ModalView = isInBrowser ? NS.Views.ModalView : require('../views/modal-view');\r\n    var isInitialize = false;\r\n\r\n    var ConfirmView = ModalView.extend({\r\n        modalTitle: \" \",\r\n        customOptions: {isEdit: false},\r\n        templateConsult: function(data) {\r\n            return \"\" + data.message;\r\n        },\r\n        //configuration: _.extend({}, ModalView.prototype.configuration, {templateModal: });\r\n    });\r\n\r\n    //Create a Modal in the dom for containige the alert page.\r\n    var confirmView = new ConfirmView({\r\n        modelName: \"confirmModel\",\r\n        isButtonLabelRedefinition: false\r\n    });\r\n\r\n    //if (!$('div[data-modal-confirm]').length) {\r\n    //Register the modal in the DOM.\r\n    function initialize() {\r\n        $('div#modalConfirmContainer').append(confirmView.render().el);\r\n        isInitialize = true;\r\n    }\r\n\r\n    //Create an event manager.\r\n    var eventManager = _.extend({}, Backbone.Events);\r\n\r\n    /**\r\n     * Helper to replace the confirm of JavaScript.\r\n     * @param  {string} messageKey - internationalization key.\r\n     * @param  {[type]} options    [description]\r\n     * @return {[type]}            [description]\r\n     */\r\n    var confirm = function messageHelperConfirm(messageKey, options) {\r\n        options = options || {};\r\n        //Save the initial opts;\r\n        var initialOpts = confirmView.opts;\r\n        _.extend(confirmView.opts, options);\r\n        confirmView.modalTitle = messageKey;\r\n        confirmView.model.set({'message': messageKey},{silent: true});\r\n        confirmView.render();\r\n        return new Promise(function(resolve, reject) {\r\n            confirmView.showModal();\r\n            //Listen to once to the close event of the modal.\r\n            eventManager.listenToOnce(confirmView, \"modal:close\", function(data) {\r\n                eventManager.stopListening(confirmView, 'modal:cancel');\r\n                confirmView.opts = initialOpts;\r\n                resolve(messageKey);\r\n            });\r\n            //Listen to once the cancel event on the modal.\r\n            eventManager.listenToOnce(confirmView, \"modal:cancel\", function(data) {\r\n                eventManager.stopListening(confirmView, 'modal:close');\r\n                confirmView.opts = initialOpts;\r\n                reject(options.cancelMessageKey || {\r\n                    responseJSON: {\r\n                        \"error\": i18n.t(\"error.operationCancelled\")\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        \r\n    };\r\n\r\n    //Message helper.\r\n    var messageHelper = {\r\n        confirm: confirm,\r\n        initialize: initialize\r\n    };\r\n    if (isInBrowser) {\r\n        NS.Helpers = NS.Helpers || {};\r\n        NS.Helpers.messageHelper = messageHelper;\r\n    } else {\r\n        module.exports = messageHelper;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","\"use strict\"\r\n((NS) ->\r\n  # Filename: helpers/metadata_builder.coffee\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  # Exceptions\r\n  ArgumentNullException = if isInBrowser then NS.Helpers.Exceptions.ArgumentNullException else require(\"./custom_exception\").ArgumentNullException\r\n  proxyValidationContainer = {}\r\n  # Get the domains definition.\r\n  class MetadataBuilder\r\n    \r\n    #Initialize the dependencies from the project: the domains and the metadatas.\r\n    initialize: (options, cb) ->\r\n      throw new ArgumentNullException('The metadata builder needs options with domains and metadatas.') if not options?\r\n      throw new ArgumentNullException('The metadata builder needs domains in options.') if not options.domains?\r\n      throw new ArgumentNullException('The metadata builder needs metadatas in options.') if not options.metadatas?\r\n      @domains = options.domains\r\n      @metadatas = options.metadatas\r\n      @isLog = options.isLog #Define if there is warn or not for metadata properties.\r\n      cb(@domains, @metadatas) if cb?\r\n      \r\n    # Get the domains as they were initialized in the builder (if initialized).\r\n    getDomains: ->\r\n      return _.clone(@domains)\r\n      \r\n    # Get the validation attributes from the domain.\r\n    getDomainsValidationAttrs: (model) ->\r\n      #console.log('called')\r\n      return new ArgumentNullException('The model should exists and have a metadatas property.') if not model?\r\n      #Get the metadatas from the model.\r\n      metadatas = @getMetadatas(model)\r\n      #Container for the validation rules of the domain of each property.\r\n      valDomAttrs = {}\r\n      # Lopping through all attributes of th model in order to build their validators.\r\n      for attr of metadatas\r\n        # Construct the metadata object\r\n        md = metadatas[attr] or {}\r\n        if (md.isValidationOff? and md.isValidationOff is false) or (not md.isValidationOff?)\r\n          ###_.extend(metadata, md.metadata) if md.metadata?\r\n          (metadata.domain = md.domain) if md.domain?\r\n          (metadata.required = md.required) if md.required?\r\n          ###\r\n          #Container for the validators.\r\n          validators = []\r\n          #If the required filed is set, add a validator\r\n          validators.push({\"type\": \"required\",\"value\": true}) if md.required is true\r\n          # Extend the validators\r\n          (validators = _.union(validators, @domains[md.domain].validation)) if md.domain? and @domains[md.domain]?\r\n          # Set the validators inide the container associated with the field.\r\n          valDomAttrs[attr] = validators\r\n      return valDomAttrs\r\n    # Get all the metadatas from the model.\r\n    getMetadatas: (model) ->\r\n      throw new ArgumentNullException(\"In order to get metadatas , you must provide a model.\") if not model?\r\n      # Construct the metadatas obtained with the model name.\r\n      entityMetadatas = @constructEntityMetaDatas(model)\r\n      metadatas = _.clone(entityMetadatas)\r\n      # If the models has metadatas the metadatas given by its definitions will extend them.\r\n      metadatasAttrs = _.keys(metadatas)\r\n      if model.metadatas?\r\n        metadatasAttrs = _.union(metadatasAttrs, _.keys(model.metadatas))\r\n      for mdlMetadataAttr in metadatasAttrs\r\n        entityAttrMetadata = entityMetadatas[mdlMetadataAttr] # Get the introspected metadatas.\r\n        mdlMetadata = if model.metadatas? and model.metadatas[mdlMetadataAttr]? then model.metadatas[mdlMetadataAttr] else undefined\r\n        metadata = {} # Create a container for the metadatas.\r\n        _.extend(metadata,  entityAttrMetadata) # Inject validationinto metadata the entitydefinitions metadata attributes.\r\n        #console.log(\"metadata\",metadata,  metadata.domain, \"domains\", _.omit(@domains[metadata.domain]))\r\n        _.extend(metadata, _.omit(@domains[metadata.domain], 'validation')) #override the metadata with the metadata inside the domain style, validators,....\r\n        if mdlMetadata?\r\n          _.extend(metadata, mdlMetadata.metadata)  if mdlMetadata.metadata?\r\n          _.extend(metadata, _.omit(@domains[metadata.domain], 'validation')) #override the metadata with the metadata inside the domain style, validators,....\r\n          # Extend the \"overriden\" metadatas\r\n          # Property that can be overriden: required, label, domain, isValidationOff\r\n          overridenProperties = {}\r\n          #console.log 'mdlMetadatamdlMetadata', mdlMetadata\r\n          if mdlMetadata.domain?\r\n            _.extend(overridenProperties, {domain: mdlMetadata.domain}) # Change the domain.\r\n            _.extend(overridenProperties, _.omit(@domains[mdlMetadata.domain], 'validation')) # Change the metadatas of the domain.\r\n          _.extend(overridenProperties, {required: mdlMetadata.required}) if mdlMetadata.required?\r\n          _.extend(overridenProperties, {label: mdlMetadata.label}) if mdlMetadata.label?\r\n          _.extend(overridenProperties, {isValidationOff: mdlMetadata.isValidationOff}) if mdlMetadata.isValidationOff? #Turn off the model validations.\r\n          _.extend(overridenProperties, {style: mdlMetadata.style}) if mdlMetadata.style?\r\n          _.extend(overridenProperties, {decorator: mdlMetadata.decorator}) if mdlMetadata.decorator?\r\n          _.extend(overridenProperties, {symbol: mdlMetadata.symbol}) if mdlMetadata.symbol?\r\n          _.extend(overridenProperties, {decoratorOptions: mdlMetadata.decoratorOptions}) if mdlMetadata.decoratorOptions?\r\n          # If at least one property has been defined.\r\n          _.extend(metadata, overridenProperties) if not _.isEmpty(overridenProperties)\r\n        #Update the global metadatas<\r\n        #console.log \"metadata\", metadata\r\n        metadatas[mdlMetadataAttr] = metadata\r\n      return metadatas\r\n    \r\n    #Get the attributes for one property of a metadata.\r\n    getMetadataForAttribute: (model, attribute) ->\r\n      throw new ArgumentNullException(\"In order to get metadatas for an attribute of a model , you must provide a model.\") if not model?\r\n      throw new ArgumentNullException(\"In order to get metadatas for an attribute of a model , you must provide an attribute.\") if not attribute?\r\n      entityAttrMetadata = @constructEntityMetaDatas(model)[attribute]\r\n      mdlMetadata = if model.metadatas? and model.metadatas[attribute]? then model.metadatas[attribute] else undefined\r\n      metadata = {} # Create a container for the metadatas.\r\n      _.extend(metadata,  entityAttrMetadata) # Inject validationinto metadata the entitydefinitions metadata attributes.\r\n      #console.log(\"metadata\",metadata,  metadata.domain, \"domains\", _.omit(@domains[metadata.domain]))\r\n      _.extend(metadata, _.omit(@domains[metadata.domain], 'validation')) #override the metadata with the metadata inside the domain style, validators,....\r\n      if mdlMetadata?\r\n        _.extend(metadata, mdlMetadata.metadata)  if mdlMetadata.metadata?\r\n        _.extend(metadata, _.omit(@domains[metadata.domain], 'validation')) #override the metadata with the metadata inside the domain style, validators,....\r\n        # Extend the \"overriden\" metadatas\r\n        # Property that can be overriden: required, label, domain, isValidationOff\r\n        overridenProperties = {}\r\n        #console.log 'mdlMetadatamdlMetadata', mdlMetadata\r\n        if mdlMetadata.domain?\r\n          _.extend(overridenProperties, {domain: mdlMetadata.domain}) # Change the domain.\r\n          _.extend(overridenProperties, _.omit(@domains[mdlMetadata.domain], 'validation')) # Change the metadatas of the domain.\r\n        _.extend(overridenProperties, {required: mdlMetadata.required}) if mdlMetadata.required?\r\n        _.extend(overridenProperties, {label: mdlMetadata.label}) if mdlMetadata.label?\r\n        _.extend(overridenProperties, {isValidationOff: mdlMetadata.isValidationOff}) if mdlMetadata.isValidationOff? #Turn off the model validations.\r\n        _.extend(overridenProperties, {style: mdlMetadata.style}) if mdlMetadata.style?\r\n        _.extend(overridenProperties, {decorator: mdlMetadata.decorator}) if mdlMetadata.decorator?\r\n        _.extend(overridenProperties, {symbol: mdlMetadata.symbol}) if mdlMetadata.symbol?\r\n        _.extend(overridenProperties, {decoratorOptions: mdlMetadata.decoratorOptions}) if mdlMetadata.decoratorOptions?\r\n        # If at least one property has been defined.\r\n        _.extend(metadata, overridenProperties) if not _.isEmpty(overridenProperties)\r\n      return metadata\r\n    constructEntityMetaDatas: (model) ->\r\n      # TODO: pbn => Use a flatten function in order to flatten @metadatas and be ablt to access it without any problem.\r\n      if model.modelName?\r\n        mdName = model.modelName.split('.')\r\n        if mdName.length is 1\r\n          if @metadatas[model.modelName]?\r\n            return @metadatas[model.modelName]\r\n          else\r\n            if @isLog\r\n              console.warn(\"The metadatas does not have properties for model '#{model.modelName}'.\")\r\n            return {}\r\n        else\r\n          if @metadatas[mdName[0]]? and @metadatas[mdName[0]][mdName[1]]?\r\n            return @metadatas[mdName[0]][mdName[1]]\r\n          else\r\n            if @isLog\r\n              console.warn(\"The metadatas does not have properties for model '#{model.modelName}'.\")\r\n            return {}\r\n      else\r\n        throw new ArgumentNullException('The model should have a model name in order to build its metadatas')\r\n\r\n    proxyDomainValidationAttrs: (model) ->\r\n      return getDomainsValidationAttrs(model)\r\n      return proxyValidationContainer[model.modelName] if(model.modelName? and proxyValidationContainer[model.modelName]?)\r\n      if model.modelName?\r\n        return proxyValidationContainer[model.modelName] = getDomainsValidationAttrs(model)\r\n      else\r\n        return getDomainsValidationAttrs(model)\r\n  if isInBrowser\r\n    NS.Helpers = NS.Helpers or {}\r\n    NS.Helpers.MetadataBuilder = MetadataBuilder\r\n    NS.Helpers.metadataBuilder = new MetadataBuilder()\r\n  else\r\n    module.exports = {MetadataBuilder: MetadataBuilder, metadataBuilder: new MetadataBuilder()}\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)","/*global Promise, _, window, Backbone*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  NS = NS || {};\r\n  //Filename: helpers/model_validation_promise.js\r\n\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n  var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n  var metadataBuilder = isInBrowser ? NS.Helpers.metadataBuilder : require('./metadata_builder').metadataBuilder;\r\n  var validators = isInBrowser ? NS.Helpers.validators : require('./validators');\r\n  \r\n  //Validation function without promises.\r\n  //This can  is use in promise validation function and in the collection validation.\r\n  //In order to return only one promise well structured.\r\n  var validateNoPromise = function validateModelWithoutPromise(model) {\r\n    var errors = {};\r\n    //Looping through each attributes.\r\n    validateDomainAttributes(model, errors);\r\n    validateCustomAttributes(model, errors);\r\n    //Promisify the validations , if there is errors call the reject else call resolve with the model.\r\n    if (_.isEmpty(errors)) {\r\n      return {isValid: true, data: model};\r\n    } else {\r\n      return {isValid: false, data: errors};\r\n    }\r\n  };\r\n\r\n  var validate = function validateModel(model) {\r\n    var validationResult = validateNoPromise(model);\r\n    return new Promise(function promiseValidation(resolve, reject) {\r\n      //console.dir(\"Errors\", errors);\r\n      if (validationResult.isValid) {\r\n        //console.log('resolve');\r\n        resolve(validationResult.data);\r\n      } else {\r\n        //console.log('reject');\r\n        reject(validationResult.data);\r\n      }\r\n      return undefined;\r\n    });\r\n  };\r\n\r\n  //Validate the model customs attributes.\r\n  var validateCustomAttributes = function validateCustomAttributes(model, errors) {\r\n    if (!model) {\r\n      throw new ArgumentNullException('The model should exist');\r\n    }\r\n    //Validating only the model at\r\n    for (var attr in model.attributes) {\r\n      //console.log(\"Attr\", attr);\r\n      if (!model.isValid(attr)) {\r\n        var domainMessage = errors[attr] !== null && errors[attr] !== undefined ? errors[attr] : '';\r\n        errors[attr] = '' + domainMessage + '' + attr + \" not valid.\"; // Todo: translate the message.\r\n      }\r\n    }\r\n  };\r\n\r\n  //Get the validation \"standard\" attributes of a Backbone.model.\r\n  var getValidatedAttrs = function(model) {\r\n    return _.reduce(_.keys(_.result(model, 'validation') || {}), function(memo, key) {\r\n      memo[key] = void 0;\r\n      return memo;\r\n    }, {});\r\n  };\r\n\r\n  //Validate the validation domains attributes.\r\n  var validateDomainAttributes = function validateDomainAttributes(model, errors) {\r\n    var validatorsOfDomain = metadataBuilder.getDomainsValidationAttrs(model);\r\n    //console.log(\"validators %j\", validatorsOfDomain);\r\n    //Validate only the attributes of the model not all the validators int he metdadaga of the model.\r\n    for (var attr in model.attributes) {\r\n      //Validate the model only of there is the attribute on the model.\r\n      var valRes = validators.validate({\r\n        name: attr,\r\n        value: model.get(attr)\r\n      }, validatorsOfDomain[attr]);\r\n\r\n      //If there is no error dont set any errors. \r\n      if (valRes.errors !== undefined && valRes.errors.length > 0) {\r\n        errors[attr] = valRes.errors.join(',');\r\n      }\r\n    }\r\n  };\r\n  //Validate a Backbone.Collection, return a promises.\r\n  var validateAll = function validateCollection(collection) {\r\n    if (!collection instanceof Backbone.Collection) {\r\n      throw new ArgumentInvalidException(\"Only a backbone collection can be validateAll\", collection);\r\n    }\r\n    return new Promise(function(successCb, errorCb) {\r\n      //Container for all errors.\r\n      var errors = [];\r\n      var modelIndex = 0;\r\n      //Iterate over each collections.\r\n      collection.forEach(function(model) {\r\n        var validationResult = validateNoPromise(model);\r\n        if (!validationResult.isValid) {\r\n          errors.push({\r\n            index: modelIndex,\r\n            errors: validationResult.data\r\n          });\r\n        }\r\n        modelIndex++;\r\n      }, this);\r\n      if (errors.length > 0) {\r\n        //If the errors array is not empty, cb the promise errors.\r\n        errorCb(errors);\r\n      } else {\r\n        // Else call success callback with the collection.\r\n        successCb(collection);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Initialize the domains and the metadatas.\r\n  var initialize = function initializeModelValiationPromise(options) {\r\n    metadataBuilder.initialize(options);\r\n  };\r\n\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.modelValidationPromise = {\r\n      validate: validate,\r\n      initialize: initialize,\r\n      validateAll: validateAll\r\n    };\r\n  } else {\r\n    module.exports = {\r\n      validate: validate,\r\n      validateAll: validateAll,\r\n      initialize: initialize\r\n    };\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global _, $, window*/\r\n\"use strict\";\r\n(function(NS) {\r\n    NS = NS || {};\r\n    //Filename: helpers/odata_helper.js\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    var utilHelper = isInBrowser ? NS.Helpers.utilHelper : require('./utilHelper');\r\n    var urlHelper = isInBrowser ? NS.Helpers.urlHelper : require('./url_helper');\r\n\r\n    var odataOptions = {\r\n        filter: '$filter',\r\n        top: '$top',\r\n        skip: '$skip',\r\n        orderby: '$orderby',\r\n        format: '$format',\r\n        inlinecount: '$inlinecount',\r\n        exportColumnLabels: 'exportColumnLabels',\r\n        requestType: 'GET'\r\n    };\r\n    var configure = function configure(options) {\r\n        _.extend(odataOptions, options);\r\n    };\r\n\r\n    // type of the request for odata\r\n    var paginator_core = function paginator_core() {\r\n        return {\r\n            // the type of the request (GET by default)\r\n            type: odataOptions.requestType,\r\n\r\n            // the type of reply (json by default)\r\n            dataType: 'json'\r\n        };\r\n    };\r\n\r\n    function createOdataOptions(criteria, pagesInfo, options) {\r\n        //Compile the odata options.\r\n        var odataOpts = compileOdataOptions(criteria, pagesInfo, options);\r\n        return addOtherOptions(pagesInfo, odataOpts);\r\n    }\r\n\r\n    //Compile options which are not define by odata metadatas.\r\n    function addOtherOptions(pagesInfo, odataOptions) {\r\n        odataOptions = odataOptions || {};\r\n        //If necessary, add the export id to the criteria.\r\n        if (pagesInfo.exportId !== undefined) {\r\n            odataOptions.data = odataOptions.data + '&exportId=' + pagesInfo.exportId;\r\n        }\r\n        return odataOptions;\r\n    }\r\n\r\n    // convert JSON criteria to odata\r\n    //http://docs.oasis-open.org/odata/odata/v4.0/os/part2-url-conventions/odata-v4.0-os-part2-url-conventions.html#_Toc372793793\r\n    function criteriaToOdata(criteria) {\r\n        //console.log(\"Criteria OData\");\r\n        //Url to build\r\n        var result = \"\";\r\n        for (var property in criteria) {\r\n            //The treatement of the filter is done only.\r\n            if (property !== undefined && property !== null && criteria[property] !== undefined && criteria[property] !== null && criteria[property] !== \"\") {\r\n                var type = typeof criteria[property];\r\n                console.log(\"Type of the property\", type);\r\n                switch (type) {\r\n                    //Deal with the string parameter.\r\n                    case \"string\":\r\n                        result += property + \" eq \" + criteria[property] + \" and \";\r\n                        break;\r\n                        //Deal with array parameters\r\n                    case \"number\":\r\n                        result += property + \" eq \" + criteria[property] + \" and \";\r\n                        break;\r\n                    case \"boolean\":\r\n                        result += property + \" eq \" + criteria[property] + \" and \";\r\n                        break;\r\n                    case \"array\":\r\n                        //result += property + \" eq \" +\"[\"+ criteria[property].join(',')+\"]\" + \" and \";\r\n                        result += property + \" eq \" + \"['\" + criteria[property].join(\"','\") + \"']\" + \" and \";\r\n                        break;\r\n                        //Deal with the object.\r\n                    case \"object\":\r\n                        if (_.isArray(criteria[property])) {\r\n                            result += property + \" eq \" + \"['\" + criteria[property].join(\"','\") + \"']\" + \" and \";\r\n                            //result += property + \" eq \" + \"[\" + criteria[property].join(',') + \"]\" + \" and \"\r\n                        }\r\n                        //If there is an array.\r\n                        break;\r\n                    default:\r\n                        break;\r\n\r\n                }\r\n            }\r\n        }\r\n        return result.length > 0 ? result.slice(0, -5) : \"\"; //Todo: corriger la cration de critre. //result.substring(0, result.length - 1);\r\n    }\r\n\r\n    //generate orderBy parameters fo odata\r\n    function orderToOdata(sortFields) {\r\n        var orderBy = \"\";\r\n        sortFields.forEach(function(sortField) {\r\n            //TODO : cette condition n'est pas satisfaisante. Si ces champs ne sont pas dfinis ils ne devraient pas tre dans la liste.\r\n            if (sortField.field !== undefined && sortField.order !== undefined) {\r\n                orderBy += sortField.field + \" \" + sortField.order + \",\";\r\n            }\r\n        });\r\n        return orderBy.substring(0, orderBy.length - 1);\r\n    }\r\n\r\n    //generate parameter for odata server API\r\n    function generateServerApi(criteria, pagesInfo) {\r\n        var sortFields = [];\r\n        if (pagesInfo.sortField) {\r\n            sortFields.push(pagesInfo.sortField);\r\n        }\r\n\r\n        var val = {};\r\n        val[odataOptions.filter] = criteria; // criteriaToOdata(criteria);\r\n        val[odataOptions.top] = pagesInfo.perPage;\r\n        val[odataOptions.skip] = (pagesInfo.currentPage - 1) * pagesInfo.perPage;\r\n        val[odataOptions.orderby] = orderToOdata(sortFields);\r\n        val[odataOptions.format] = 'json';\r\n        val[odataOptions.inlinecount] = 'allpages';\r\n        var exportColumnLabels = [];\r\n        if(pagesInfo.exportColumnLabels){\r\n            for(var property in pagesInfo.exportColumnLabels){\r\n                if(pagesInfo.exportColumnLabels.hasOwnProperty(property)){\r\n                    exportColumnLabels.push({propertyName: property, propertyLabel: i18n.t(pagesInfo.exportColumnLabels[property])});\r\n                }\r\n            }\r\n        }\r\n        val[odataOptions.exportColumnLabels] = exportColumnLabels;\r\n        return val;\r\n    }\r\n\r\n    //generate options fo an odata request \r\n    function compileOdataOptions(criteria, pagesInfo, options) {\r\n        var self = pagesInfo;\r\n        options = options || {};\r\n\r\n        var server_api = generateServerApi(criteria, pagesInfo);\r\n        // Some values could be functions, let's make sure\r\n        // to change their scope too and run them\r\n        var queryAttributes = {};\r\n        _.each(server_api, function(value, key) {\r\n            if (_.isFunction(value)) {\r\n                value = _.bind(value, self);\r\n                value = value();\r\n            }\r\n            if (value !== undefined && value !== null && value.toString().length > 0) {\r\n                queryAttributes[key] = value;\r\n            }\r\n        });\r\n\r\n        var queryOptions = _.clone(paginator_core());\r\n        _.each(queryOptions, function(value, key) {\r\n            if (_.isFunction(value)) {\r\n                value = _.bind(value, self);\r\n                value = value();\r\n            }\r\n            queryOptions[key] = value;\r\n        });\r\n\r\n        // Create default values if no others are specified\r\n        queryOptions = _.defaults(queryOptions, {\r\n            timeout: 25000,\r\n            cache: false,\r\n            type: odataOptions.requestType,\r\n            dataType: 'json'\r\n        });\r\n\r\n        // Allows the passing in of {data: {foo: 'bar'}} at request time to overwrite server_api defaults\r\n        if (options.data) {\r\n            options.data = decodeURIComponent($.param(_.extend(queryAttributes, options.data)));\r\n        } else {\r\n            options.data = decodeURIComponent($.param(queryAttributes));\r\n        }\r\n\r\n        queryOptions = _.extend(queryOptions, {\r\n            data: decodeURIComponent($.param(queryAttributes)),\r\n            processData: false\r\n            //url: _.result(queryOptions, 'url')\r\n        }, options);\r\n\r\n        return queryOptions;\r\n    }\r\n\r\n    // parse odata response and return values in format : {totalRecords:totalRecords, values: values}\r\n    function parseOdataResponse(response) {\r\n        if (response === undefined || response === null) {\r\n            throw new Error('Odata error : parsing result');\r\n        }\r\n        // To be comaptible with C# ODataController\r\n        _.extend(response, utilHelper.flatten({\r\n            odata: response.odata\r\n        }));\r\n        delete response.odata;\r\n        if (response[\"odata.count\"] === undefined || response[\"odata.count\"] === null) {\r\n            throw new Error('Odata error : parsing result');\r\n        }\r\n        return {\r\n            totalRecords: response[\"odata.count\"],\r\n            values: response.value\r\n        };\r\n    }\r\n\r\n    var odataHelper = {\r\n        createOdataOptions: createOdataOptions,\r\n        parseOdataResponse: parseOdataResponse,\r\n        configure: configure\r\n    };\r\n\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Helpers = NS.Helpers || {};\r\n        NS.Helpers.odataHelper = odataHelper;\r\n    } else {\r\n        module.exports = odataHelper;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global window, $ */\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: post_rendering_builder.js\r\n  NS = NS || {};\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var metadataBuilder = isInBrowser ? NS.Helpers.metadataBuilder : require('./metadata_builder').metadataBuilder;\r\n  var postRenderingHelper = isInBrowser ? NS.Helpers.postRenderingHelper : require('./post_rendering_helper').metadataBuilder;\r\n  //Options must contain a model and a viewSelecrot property.\r\n  var postRenderingBuilder = function(options) {\r\n    //When there is no model inide the view, do nothing.\r\n    if (options === undefined || options === null || !options.model) {\r\n      return;\r\n    }\r\n    //Get all the metadatas of the model.\r\n    var metadatas = metadataBuilder.getMetadatas(options.model);\r\n    //Iterate through each attributes of the modoptions.modelel.\r\n    for (var attr in metadatas) {\r\n      var mdt = metadatas[attr];\r\n      /*Check for any of the metadata.*/\r\n      if (mdt !== undefined && mdt !== null) {\r\n        if (mdt.decorator) {\r\n          //Call a registered helper. See post_rendering_helper_file to see how to register a helper.\r\n          var nameAttribute = \"data-name='\" + attr + \"'\";\r\n\r\n          postRenderingHelper.callHelper({\r\n            helperName: mdt.decorator, //Get the post rendering helper to call from the metdata, this helper must have been register before.\r\n            selector: $(\"input[\" + nameAttribute + \"],select[\" + nameAttribute + \"],div[\" + nameAttribute + \"]\", options.viewSelector), //Create a selector on each attribute in the view with its .\r\n            decoratorOptions: mdt.decoratorOptions //Inject decorator options define on the model.\r\n          });\r\n        }\r\n      }\r\n    }\r\n  };\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.postRenderingBuilder = postRenderingBuilder;\r\n  } else {\r\n    module.exports = postRenderingBuilder;\r\n  }\r\n\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global window, _,  $*/\r\n\"use strict\";\r\n(function(NS) {\r\n  // Filename: post_rendering_helper.js\r\n  NS = NS || {};\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n  var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n  var DependencyException = isInBrowser ? NS.Helpers.Exceptions.DependencyException : require(\"./custom_exception\").DependencyException;\r\n  //Container for all the post renderings functions.\r\n  var postRenderingHelpers = {};\r\n  //Register a helper inside the application.\r\n  //Example call: `Fmk.postRenderingHelper.registerHelper({name: \"hlpName\", fn: fct})`\r\n  var registerHelper = function registerHelper(helper) {\r\n      if (helper === undefined || helper === null || _.isEmpty(helper)) {\r\n          throw new ArgumentNullException(\"registerHelper, helper argument cannot be null or undefined \");\r\n      }\r\n      if (helper.name === null || helper.name === undefined) {\r\n          throw new ArgumentNullException(\"registerHelper, helper.name cannot be null or undefined\");\r\n      }\r\n      if (typeof helper.name !== \"string\") {\r\n          throw new ArgumentInvalidException(\"registerHelper, helper.name must be a string.\", helper);\r\n      }\r\n      if (helper.fn === null || helper.fn === undefined) {\r\n          throw new ArgumentNullException(\"registerHelper, helper.fn cannot be null or undefined\");\r\n      }\r\n      if (typeof helper.fn !== \"string\") {\r\n          throw new ArgumentInvalidException(\"registerHelper, helper.fn must be a function name: a string.\", helper);\r\n      }\r\n      if (!$.fn[helper.fn]) {\r\n          throw new DependencyException(\"registerHelper, helper.fn: \"+ helper.fn +\" must be a registered JQuery plugin in $.fn\");\r\n      }\r\n      if (typeof helper.parseFunction !== \"string\") {\r\n          throw new ArgumentInvalidException(\"registerHelper, helper.fn must be a function name: a string.\", helper);\r\n      }\r\n      if (!$.fn[helper.parseFunction]) {\r\n          throw new DependencyException(\"registerHelper, helper.fn: \"+ helper.parseFunction +\" must be a registered JQuery plugin in $.fn\");\r\n      }\r\n      postRenderingHelpers[helper.name] = {fn: helper.fn, options: helper.options, parseArgument: helper.parseArgument, parseFunction: helper.parseFunction};\r\n  };\r\n  //Options must have a selector property and a helperName one.\r\n  var callHelper = function callHelper(config) {\r\n      \r\n    //If there is nothing selected.\r\n    if(config.selector === undefined || config.selector.size() === 0){\r\n      return;\r\n    }\r\n    if (typeof config.helperName !== \"string\") {\r\n        throw new ArgumentInvalidException(\"callHelper, config.helperName must be a string, check your in your domain file any the decorator property\", config);\r\n    }\r\n    //If the function  desn not exist on the selection.\r\n    if(config.selector[postRenderingHelpers[config.helperName].fn] === undefined){\r\n      return;\r\n    }\r\n    var postRenderingOptions = postRenderingHelpers[config.helperName].options;\r\n    if (config.decoratorOptions) {\r\n        //Extend the post rendering options defined in the helper definition with options define in the model (optionnaly)\r\n        // For each property: `Model.extend({metadatas:{propertyName: {decoratorOptions: {opt1: 1, opt2: 2}}}})`\r\n        _.extend(postRenderingOptions, config.decoratorOptions);\r\n    }\r\n    config.selector[postRenderingHelpers[config.helperName].fn](postRenderingOptions);\r\n    //config.selector[config.helperName](options);\r\n  };\r\n\r\n  //Call the parser plugin\r\n  var callParser = function callParser(config){\r\n    //If there is nothing selected.\r\n    if(config.selector === undefined || config.selector.size() === 0){\r\n      return;\r\n    }\r\n    if (typeof config.helperName !== \"string\") {\r\n        throw new ArgumentInvalidException(\"callHelper, config.helperName must be a string, check your in your domain file any the decorator property\", config);\r\n    }\r\n    //If the function  desn not exist on the selection.\r\n    if(config.selector[postRenderingHelpers[config.helperName].parseFunction] === undefined){\r\n      return;\r\n    }\r\n    var helper = postRenderingHelpers[config.helperName];\r\n    return config.selector[helper.parseFunction](helper.parseArgument);\r\n  };\r\n  var mdl = {\r\n    registerHelper: registerHelper,\r\n    callHelper: callHelper,\r\n    callParser:callParser\r\n  };\r\n    // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.postRenderingHelper = mdl;\r\n  } else {\r\n    module.exports = mdl;\r\n  }\r\n\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global Backbone, Promise, _, window */\r\n(function(NS) {\r\n\t\"use strict\";\r\n\t//Filename: promisify_helper.js\r\n\tNS = NS || {};\r\n\tvar isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\tvar odataHelper = isInBrowser ? NS.Helpers.odataHelper : require(\"./odata_helper\");\r\n\tvar httpResponseParser = isInBrowser ? NS.Core.httpResponseParser : require('../core/http_response_parser');\r\n\tvar ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n\tvar ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n\r\n\r\n\r\n\t// Backbone model with **promise** CRUD method instead of its own methods.\r\n\tvar PromiseModel = Backbone.Model.extend({\r\n\t\t/**\r\n\t\t * Set the data for a promise model.\r\n\t\t * @param  {object} json to set in the model.\r\n\t\t * @param  {object} options on the save function such as the url.\r\n\t\t * @return {undefined}\r\n\t\t */\r\n\t\tsetData: function setDataPromiseModel(json, options) {\r\n\t\t\toptions = options || {};\r\n\t\t\tif (_.isString(options.url)) {\r\n\t\t\t\tthis.urlRoot = options.url;\r\n\t\t\t}\r\n\t\t\tthis.clear({\r\n\t\t\t\tsilent: true\r\n\t\t\t});\r\n\t\t\tthis.set(json, {\r\n\t\t\t\tsilent: true\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * Save the data for a promise model.\r\n\t\t * @param  {object} json to save in the model.\r\n\t\t * @param  {object} options on the save function such as the url.\r\n\t\t * @return {objet} a promise of save.\r\n\t\t */\r\n\t\tsaveData: function setDataPromiseModel(json, options) {\r\n\t\t\tthis.setData(json, options);\r\n\t\t\treturn this.save();\r\n\t\t},\r\n\t\t/**\r\n\t\t * Fetch the model.\r\n\t\t * @param  {object} json to set to the model before loading.\r\n\t\t * @param  {object} options on the save function such as the url.\r\n\t\t * @return {objet} a promise of fetch.\r\n\t\t */\r\n\t\tfetchData: function fetchDataPromiseModel(json, options) {\r\n\t\t\tthis.setData(json, options);\r\n\t\t\treturn this.fetch();\r\n\t\t},\r\n\t\t//Ovverride the save method on the model in order to Return a promise.\r\n\t\tsave: function saveModel(options) {\r\n\t\t\tvar model = this;\r\n\t\t\tvar method = this.isNew() ? 'create' : 'update';\r\n\t\t\treturn new Promise(\r\n\t\t\t\tfunction(resolve, reject) {\r\n\t\t\t\t\tvar opts = _.extend({\r\n\t\t\t\t\t\tsuccess: function(data, textStatus, jqXHR) {\r\n\t\t\t\t\t\t\tresolve(httpResponseParser.parse(jqXHR));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: reject\r\n\t\t\t\t\t}, options);\r\n\t\t\t\t\tBackbone.sync(method, model, opts);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\t\t//Replacing the classic destroy model with a promise.\r\n\t\tdestroy: function promiseDestroyModel() {\r\n\t\t\tvar model = this;\r\n\t\t\treturn new Promise(\r\n\t\t\t\tfunction(resolve, reject) {\r\n\t\t\t\t\tBackbone.sync('delete', model, {\r\n\t\t\t\t\t\tsuccess: resolve,\r\n\t\t\t\t\t\terror: reject\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\t\t//Replacing the classic backbone fetch with a promise, resolve and reject are givent as options.success, and options.error of the ajax.\r\n\t\tfetch: function promiseFetchModel(options) {\r\n\t\t\toptions = options || {};\r\n\t\t\tvar model = this;\r\n\t\t\t//console.log('promiseFetchModel', model);\r\n\t\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t\t/*Don't use underscore but could have because bacckbone has a dependency on it.*/\r\n\t\t\t\toptions.success = function(data, textStatus, jqXHR) {\r\n\t\t\t\t\tresolve(httpResponseParser.parse(jqXHR));\r\n\t\t\t\t};\r\n\t\t\t\toptions.error = reject;\r\n\t\t\t\tBackbone.sync('read', model, options);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// Backbone collection with **promise** CRUD method instead of its own methods.\r\n\tvar PromiseCollection = Backbone.Collection.extend({\r\n\t\t/**\r\n\t\t * Fetch the collection datas, clean the share collection and parse.\r\n\t\t * @param  {object} this object should have the following structure: {criteria: {key: \"val\"}, pagesInfos: {}}.\r\n\t\t * @param  {object} options can contain a url.\r\n\t\t * @return {object} the promise of the fetch and the parse with the Odata.\r\n\t\t */\r\n\t\tfetchData: function fetchDataPromiseCollection(params, options) {\r\n\t\t\toptions = options || {};\r\n\t\t\tparams = params || {};\r\n\t\t\tif (!_.isObject(params)) {\r\n\t\t\t\tthrow new ArgumentNullException('fetchDataPromiseCollection: params should be an object, check your service');\r\n\t\t\t}\r\n\t\t\tif (!_.isObject(params.pagesInfos)) {\r\n\t\t\t\tthrow new ArgumentInvalidException('fetchDataPromiseCollection: params should have a pagesInfos property, check your service', params);\r\n\t\t\t}\r\n\t\t\t//Clean the shared collection.\r\n\t\t\tthis.reset(null, {\r\n\t\t\t\tsilent: true\r\n\t\t\t});\r\n\t\t\t//If the url wants to be changed it can be done.\r\n\t\t\tif (options.url) {\r\n\t\t\t\tthis.url = options.url;\r\n\t\t\t}\r\n\r\n\t\t\t//Automatically call the odataHelper to create the options.\r\n\t\t\treturn this.fetch(odataHelper.createOdataOptions(params.criteria, params.pagesInfos))\r\n\t\t\t\t.then(odataHelper.parseOdataResponse);\r\n\t\t},\r\n\t\t//Override the default collection fetch method, using and returning a promise.\r\n\t\t//Options is the options object which is sent to the jquery method.\r\n\t\tfetch: function promiseFetchCollection(options) {\r\n\t\t\toptions = options || {};\r\n\t\t\tvar collection = this;\r\n\t\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t\t/*Don't use underscore but could have because bacckbone has a dependency on it.*/\r\n\t\t\t\toptions.success = function(data, textStatus, jqXHR) {\r\n\t\t\t\t\tresolve(httpResponseParser.parse(jqXHR));\r\n\t\t\t\t};\r\n\t\t\t\toptions.error = reject;\r\n\t\t\t\tBackbone.sync('read', collection, options);\r\n\t\t\t});\r\n\t\t},\r\n\t\tsave: function saveCollection() {\r\n\t\t\tvar model = this;\r\n\t\t\tvar method = 'create';\r\n\t\t\treturn new Promise(\r\n\t\t\t\tfunction(resolve, reject) {\r\n\t\t\t\t\tBackbone.sync(method, model, {\r\n\t\t\t\t\t\tsuccess: function(data, textStatus, jqXHR) {\r\n\t\t\t\t\t\t\tresolve(httpResponseParser.parse(jqXHR));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: reject\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n\r\n\t//Convert an existing Backbone model to a _promise_ version of it.\r\n\tvar ConvertModel = function ConvertBackBoneModelToPromiseModel(model) {\r\n\t\tif (model.url === undefined || model.urlRoot === undefined) {\r\n\t\t\tthrow new Error(\"ConvertBackBoneModelToPromiseModel: The url of the model: \" + model.modelName + \" cannot be undefined.\");\r\n\t\t}\r\n\t\tvar fields = {};\r\n\t\tif (model.has('id')) {\r\n\t\t\t_.extend(fields, model.pick('id'));\r\n\t\t}\r\n\t\tvar promiseModel = new PromiseModel(fields);\r\n\t\tvar property = model.urlRoot !== undefined ? 'urlRoot' : 'url';\r\n\t\tpromiseModel[property] = model[property];\r\n\t\treturn promiseModel;\r\n\t};\r\n\r\n\t//Convert an existing Backbone collection to a _promise_ version of it.\r\n\tvar ConvertCollection = function ConvertBackboneCollectionToPromiseCollection(collection) {\r\n\t\tif (collection.url === undefined || collection.urlRoot === null) {\r\n\t\t\tthrow new Error(\"ConvertCollection: The  url of the collection \" + collection.modelName + \" cannot be undefined.\");\r\n\t\t}\r\n\t\tvar promiseCollection = new PromiseCollection();\r\n\t\tpromiseCollection.url = collection.url;\r\n\t\treturn promiseCollection;\r\n\t};\r\n\r\n\t// Convert an existing Backbone collection to a promise version of its changes \r\n\t// (when calling save, the { creates: [], deletes: [], updates: [] } object will be posted to collection.url)\r\n\tvar ConvertCollectionChanges = function ConvertBackboneCollectionToPromiseCollectionChanges(collection, changes) {\r\n\t\tif (collection.url === undefined || collection.urlRoot === null) {\r\n\t\t\tthrow new Error(\"ConvertCollection: The  url of the collection \" + collection.modelName + \" cannot be undefined.\");\r\n\t\t}\r\n\t\tvar promiseCollectionChanges = new PromiseModel(new Backbone.Model(changes));\r\n\t\tpromiseCollectionChanges.urlRoot = collection.url;\r\n\t\treturn promiseCollectionChanges;\r\n\t};\r\n\r\n\t/**\r\n\t * Generate a modle from  a json object and a url.\r\n\t * @param  {string} url  - The server api url.\r\n\t * @param  {object} json - JSON object representing the model properties.\r\n\t * @return {PromiseModel}      - A backbone model promisified with the good url.\r\n\t */\r\n\tvar generateModel = function generateModel(url, json) {\r\n\t\tif (json !== undefined && json !== null && !_.isObject(json)) {\r\n\t\t\tthrow new ArgumentInvalidException(json);\r\n\t\t}\r\n\t\tif (!_.isString(url)) {\r\n\t\t\tthrow new ArgumentInvalidException(url);\r\n\t\t}\r\n\t\tvar Model = PromiseModel.extend({\r\n\t\t\turlRoot: url\r\n\t\t});\r\n\t\treturn new Model(json);\r\n\t};\r\n\r\n\t/**\r\n\t * Generate a collection from an url , json and metadatas.\r\n\t * @param  {[type]} url       [description]\r\n\t * @param  {[type]} json      [description]\r\n\t * @param  {[type]} metadatas [description]\r\n\t * @return {[type]}           [description]\r\n\t */\r\n\tvar generateCollection = function generateCollection(url, json) {\r\n\t\tif (json !== undefined && !_.isArray(json)) {\r\n\t\t\tthrow new ArgumentInvalidException(json);\r\n\t\t}\r\n\t\tif (!_.isString(url)) {\r\n\t\t\tthrow new ArgumentInvalidException(url);\r\n\t\t}\r\n\t\tvar Collection = PromiseCollection.extend({\r\n\t\t\turl: url\r\n\t\t});\r\n\t\treturn new Collection(json);\r\n\t};\r\n\r\n\t//Todo: see if it is necessary to expose Model and collection promisified.\r\n\tvar promisifyHelper = {\r\n\t\tModel: PromiseModel,\r\n\t\tCollection: PromiseCollection,\r\n\t\tConvert: {\r\n\t\t\tModel: ConvertModel,\r\n\t\t\tCollection: ConvertCollection,\r\n\t\t\tCollectionChanges: ConvertCollectionChanges\r\n\t\t},\r\n\t\tmodel: generateModel,\r\n\t\tcollection: generateCollection\r\n\t};\r\n\r\n\t// Differenciating export for node or browser.\r\n\tif (isInBrowser) {\r\n\t\tNS.Helpers = NS.Helpers || {};\r\n\t\tNS.Helpers.promisifyHelper = promisifyHelper;\r\n\t} else {\r\n\t\tmodule.exports = promisifyHelper;\r\n\t}\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global Promise, $, _, window*/\r\n\"use strict\";\r\n(function(NS) {\r\n  NS = NS || {};\r\n  /* Filename: helpers/reference_helper.js  */\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var userHelper = isInBrowser ? NS.Helpers.utilHelper : require(\"./util_helper\");\r\n\r\n  //Container for the list and \r\n  var configuration = {};\r\n  \r\n  //Can be use to override a service, can be call with options = {\"referenceName\": serviceFunction} \r\n  //serviceFunction is obtain with a require. \r\n  function configureRefServices(options){\r\n    _.extend(configuration, options);\r\n  }\r\n\r\n  // This method perform an ajax request within a promise.\r\n  // Example call : refHelper.loadList({url: \"http://localhost:8080/api/list/1\"}).then(console.log,console.error);\r\n  var loadList = function loadList(listDesc){\r\n      return userHelper.promiseAjax({ url: listDesc.url, type: 'GET' });\r\n  };\r\n\r\n  // Load a reference with its list name.\r\n  // It calls the service which must have been registered.\r\n  function loadListByName(listName) {\r\n      return getService(listName);\r\n  }\r\n  \r\n    //Load a service by name.\r\n  function getService(listName, args) {\r\n      if (typeof configuration[listName] !== \"function\") {\r\n          throw new Error(\"You are trying to load the reference list: \"+ listName + \" which does not have a list configure.\" );\r\n      }\r\n      //Call the service, the service must return a promise.\r\n      return configuration[listName](args);\r\n  }\r\n\r\n    \r\n  //Load many lists by their names. `refHelper.loadMany(['list1', 'list2']).then(success, error)`\r\n  // Return an array of many promises for all the given lists.\r\n  // Be carefull, if there is a problem for one list, the error callback is called.\r\n  function loadMany(names) {\r\n      var promises = [];\r\n      //todo: add a _.isArray tests and throw an rxception.\r\n      if (names !== undefined) {\r\n          names.forEach(function (name) {\r\n              promises.push(loadListByName(name));\r\n          });\r\n      }\r\n    return promises;\r\n  }\r\n\r\n  function getAutoCompleteServiceQuery(listName) {\r\n      return function (query) {\r\n          getService(listName, query.term).then(function (results) {\r\n              query.callback(results);\r\n          });\r\n      };\r\n  }\r\n\r\n  var referenceHelper = {\r\n    loadListByName: loadListByName,\r\n    loadList: loadList,\r\n    loadMany: loadMany,\r\n    getAutoCompleteServiceQuery: getAutoCompleteServiceQuery,\r\n    configure: configureRefServices\r\n  };\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.referenceHelper = referenceHelper;\r\n  } else {\r\n    module.exports = referenceHelper;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global window, Promise, Backbone, i18n*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: helpers/router.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var userHelper = isInBrowser ? NS.Helpers.userHelper : require(\"./user_helper\");\r\n  var siteDescriptionBuilder = isInBrowser ? NS.Helpers.siteDescriptionBuilder : require(\"./site_description_builder\");\r\n  var backboneNotification = isInBrowser ? NS.Helpers.backboneNotification : require(\"./backbone_notification\");\r\n  var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n  var middleWares = [];\r\n  var middlewarePromise = function middlewarePromise(middleWareFunction) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (middleWareFunction(arguments)) {\r\n        resolve(arguments);\r\n      } else {\r\n        reject(arguments);\r\n      }\r\n    });\r\n  };\r\n\r\n  var registerMiddleWare = function registerMiddleWare(middleWareFunction) {\r\n    middleWares.push(middleWareFunction);\r\n  };\r\n  //Extend the backbone router.\r\n  var Router = Backbone.Router.extend({\r\n    route: function(route, name, callback) {\r\n      var router = this;\r\n      if (!callback){\r\n        callback = this[name];\r\n      }\r\n      if(callback === undefined || callback === null){\r\n        throw new ArgumentNullException(\"The route callback seems to be undefined, please check your router file for your route: \", name);\r\n      }\r\n      var f = function() {\r\n          //console.log('route before', route);\r\n        //Treat the home case.\r\n        if(route === \"\"){route = \"home\";}\r\n        var n = siteDescriptionBuilder.findRouteName(route);\r\n        var rt = siteDescriptionBuilder.getRoute(n);\r\n        //If the route does not exists, or the user does not have any right on the route display an error.\r\n        if((rt === undefined && route!== '') || !userHelper.hasOneRole(rt.roles)){\r\n          backboneNotification.addNotification({type: \"error\", message: i18n.t('application.noRights')}, true);\r\n          return Backbone.history.navigate('', true);\r\n        }else {\r\n          //Rendre all the notifications in the stack.\r\n          backboneNotification.renderNotifications();\r\n        }\r\n        //console.log('routeObject', siteDescriptionBuilder.getRoute(n));\r\n        callback.apply(router, arguments);\r\n      };\r\n      return Backbone.Router.prototype.route.call(this, route, name, f);\r\n    }\r\n  });\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.Router = Router;\r\n  } else {\r\n    module.exports = Router;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","//Session helper. Min browser: IE8, FF 3.5, Safari 4, Chrome 4, Opera 10.5. See [CanIUSE](http://caniuse.com/#feat=namevalue-storage)\r\n/* global window, Promise, Backbone, i18n*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: helpers/router.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n  \r\n  //Config of the storage.\r\n  var config = {\r\n    description: 'Session storage of the user.',\r\n    name: 'Session helper.',\r\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\r\n    // we can use without a prompt.\r\n    size: 4980736,\r\n    storeName: 'userSession',\r\n    version: 1.0\r\n  };\r\n\r\n  //Container for the storage.\r\n  var storage;\r\n  try {\r\n    // Initialize storage with session storage and create a variable to use it.\r\n    storage = window.sessionStorage;\r\n  } catch (e) {\r\n    throw new Error(\"Your browser does not seem to have session storage.\");\r\n  }\r\n\r\n  //Serialize the data to be save.\r\n  function _serialize(data) {\r\n    if (data !== null && data !== undefined) {\r\n      return JSON.stringify(data);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  //Deserialize the data.\r\n  function _deserialize(data) {\r\n    if (typeof data !== \"string\") {\r\n      throw new ArgumentInvalidException('The data to deserialize must be a string.', data);\r\n    }\r\n    return JSON.parse(data);\r\n  }\r\n\r\n  //Dave the data into the storage and return a promise.\r\n  // The Promise is fullfilled only if there is data to save.\r\n  function saveItem(key, data) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (data === null || data === undefined) {\r\n        reject(new ArgumentInvalidException('The data to save must be define.', data));\r\n      } else {\r\n        storage.setItem(key, _serialize(data));\r\n        resolve({\r\n          key: key,\r\n          data: data\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  //Get data with a promise.\r\n  // The Promise is fullfilled only if the item exists.\r\n  function getItem(key) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (typeof key !== \"string\") {\r\n        reject(new ArgumentInvalidException(\"The key must be a string\", key));\r\n      }\r\n      var stringData = storage.getItem(key);\r\n      if (stringData === null || stringData === undefined) {\r\n        resolve(null);\r\n      } else {\r\n        resolve(_deserialize(stringData));\r\n      }\r\n    });\r\n  }\r\n\r\n  //Remove an item from the session and return a promise.\r\n  // The Promise is fullfilled only if the item exists.\r\n  function removeItem(key) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (typeof key !== \"string\") {\r\n        reject(new ArgumentInvalidException(\"The key must be a string\", key));\r\n      }\r\n      var stringData = storage.getItem(key);\r\n      if (stringData === null || stringData === undefined) {\r\n        reject(null);\r\n      }else {\r\n        storage.removeItem(key);\r\n        resolve(key);\r\n      }\r\n    });\r\n  }\r\n\r\n  //Promise of clearing the storage.\r\n  //Promise is fullfilled only if it works.\r\n  function clear() {\r\n    return new Promise(function(resolve, reject) {\r\n      try {\r\n        storage.clear();\r\n        resolve();\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    });\r\n  }\r\n\r\n  var sessionHelper = {\r\n    clear: clear,\r\n    saveItem: saveItem,\r\n    getItem: getItem,\r\n    removeItem: removeItem\r\n  };\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.sessionHelper = sessionHelper;\r\n  } else {\r\n    module.exports = sessionHelper;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global window, _*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: helpers/routes_helper.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var userHelper = isInBrowser ? NS.Helpers.userHelper : require(\"./user_helper\");\r\n  var siteDescriptionHelper = isInBrowser ? NS.Helpers.siteDescriptionHelper : require(\"./site_description_helper\");\r\n  var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n  //Container for the site description and routes.\r\n  var siteDescription, routes = {}, siteStructure = {};\r\n\r\n  //Process the siteDescription if necessary.\r\n  var processSiteDescription = function(options){\r\n    options = options || {};\r\n    if(!siteDescriptionHelper.isProcessed() || options.isForceProcess){\r\n      siteDescription = siteDescriptionHelper.getSite();\r\n      regenerateRoutes();\r\n      return siteDescription;\r\n    }return false;\r\n  };\r\n\r\n  //Regenerate the application routes.\r\n  var regenerateRoutes = function regenerateRoutes() {\r\n    generateRoutes(siteDescription);\r\n  };\r\n\r\n  //Process the name of \r\n  var processName = function(pfx, eltDescName) {\r\n    if (pfx === undefined || pfx === null) {\r\n      pfx = \"\";\r\n    }\r\n    if (eltDescName === undefined || eltDescName === null) {\r\n      return pfx;\r\n    }\r\n    if (pfx === \"\") {\r\n      return eltDescName;\r\n    }\r\n    return pfx + '.' + eltDescName;\r\n  };\r\n\r\n  \r\n  var processElement = function(siteDescElt, prefix, options) {\r\n    options = options || {};\r\n    if (!siteDescElt) {\r\n      console.warn('The siteDescription does not exists', siteDescElt);\r\n      return;\r\n    }\r\n    var pfx = processName(prefix, siteDescElt.name);\r\n    //if(siteDescriptionHelper.checkParams(siteDescElt.requiredParams)){\r\n     processHeaders(siteDescElt, pfx);\r\n    //}\r\n    processPages(siteDescElt, pfx);\r\n    processRoute(siteDescElt, pfx, options);\r\n  };\r\n\r\n  //Process the deaders element of the site description element.\r\n  var processHeaders = function(siteDesc, prefix) {\r\n\r\n    if (!siteDesc.headers) {\r\n      return;\r\n    }\r\n    //console.log('headers', siteDesc.headers, 'prefix', prefix);\r\n    var headers = siteDesc.headers;\r\n    var isInSiteStructure = false;\r\n    if(siteDescriptionHelper.checkParams(siteDesc.requiredParams)){\r\n      isInSiteStructure = true;\r\n    }\r\n    for (var i in headers) {\r\n      processElement(headers[i], prefix, {isInSiteStructure: isInSiteStructure});\r\n    }\r\n  };\r\n\r\n  //Process the pages element of the site description.\r\n  var processPages = function(siteDesc, prefix) {\r\n    if (siteDesc.pages !== undefined && siteDesc.pages !== null) {\r\n      //console.log('pages', siteDesc.pages, 'prefix', prefix);\r\n\r\n      for (var i in siteDesc.pages) {\r\n        processElement(siteDesc.pages[i], prefix);\r\n      }\r\n    }\r\n  };\r\n\r\n \r\n  //Process the route part of the site description element.\r\n  var processRoute = function(siteDesc, prefix, options) {\r\n    options = options || {};\r\n    if (siteDesc.roles !== undefined && siteDesc.url !== undefined)\r\n    //console.log('route', siteDesc.url, 'prefix', prefix);\r\n\r\n      if (userHelper.hasOneRole(siteDesc.roles)) {\r\n        var route = {\r\n          roles: siteDesc.roles,\r\n          name: prefix,\r\n          route: siteDesc.url,\r\n          regex: routeToRegExp(siteDesc.url),\r\n          requiredParams: siteDesc.requiredParams\r\n        };\r\n        //Call the Backbone.history.handlers....\r\n        //console.log('*****************');\r\n        //console.log('ROute name: ',route.route);\r\n        //console.log('Route handler name : ',  findRouteName(route.route.substring(1)));\r\n        routes[findRouteName(route.route.substring(1))] = route;\r\n        if(options.isInSiteStructure){\r\n          siteStructure[prefix] = route;\r\n        }\r\n      }\r\n  };\r\n\r\n//Find a route with its name.\r\n// _routeToTest_ : Route to test.\r\n// *return* : The handler route name. \r\n var findRouteName = function(routeToTest) {\r\n    var handlers = Backbone.history.handlers;\r\n    //console.log('handlers', )\r\n    var h = _.find(handlers, function(handler){\r\n      return handler.route.test(routeToTest);\r\n    });\r\n    if(h !== undefined){\r\n      return  h.route.toString();\r\n    }\r\n    return _.any(handlers, function(handler) {\r\n      if (handler.route.test(routeToTest)) {\r\n        return  handler.route.toString();\r\n      }\r\n    });\r\n  };\r\n  \r\n\r\n    //Convert a route to regexp\r\n  var optionalParam = /\\((.*?)\\)/g;\r\n  var namedParam    = /(\\(\\?)?:\\w+/g;\r\n  var splatParam    = /\\*\\w+/g;\r\n  var escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\r\n  var routeToRegExp=  function routeToRegExp(route) {\r\n      route = route.replace(escapeRegExp, '\\\\$&')\r\n                   .replace(optionalParam, '(?:$1)?')\r\n                   .replace(namedParam, function(match, optional) {\r\n                     return optional ? match : '([^/?]+)';\r\n                   })\r\n                   .replace(splatParam, '([^?]*?)');\r\n      return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\r\n    };\r\n\r\n\r\n\r\n\r\n  //Generate the routes fromSiteDescription.\r\n  var generateRoutes = function generateRoutes(elementDesc, prefix) {\r\n    if (!elementDesc) {\r\n      console.warn('The siteDescription does not exists', elementDesc);\r\n      return;\r\n    }\r\n\r\n    return processElement(elementDesc, prefix);\r\n\r\n    var pfx = processName(prefix, elementDesc.name);\r\n\r\n    //process headers routes.\r\n    var headers = elementDesc.header;\r\n    for (var siteDescIdx in headers) {\r\n      var siteDesc = headers[siteDescIdx];\r\n      var prefixsiteDesc = processName(pfx, siteDesc.name);\r\n      //console.log('prefix', prefix, ' prefixsiteDesc', prefixsiteDesc);\r\n      if (siteDesc.header) {\r\n        generateRoutes(siteDesc, prefixsiteDesc);\r\n      } else {\r\n        addRouteForUser(siteDesc, prefixsiteDesc);\r\n      }\r\n    }\r\n    addRouteForUser(elementDesc, pfx);\r\n\r\n  };\r\n\r\n  //Add a route for a user.\r\n\r\n  var addRouteForUser = function addRouteForUser(element, prefix) {\r\n    //console.log('addRouteForUser', 'prefix', prefix);\r\n    if (!element) {\r\n      return;\r\n      //throw new ArgumentNullException(\"The element to add a route should not be undefined.\", element);\r\n    }\r\n    if (prefix === undefined || prefix === null || prefix === \"\") {\r\n      prefix = \"\";\r\n      //throw new ArgumentNullException(\"The prefix to add a route should not be undefined.\", prefix);\r\n    }\r\n    //Add the route only if the user has one of the required role.\r\n    if (element.roles !== undefined && element.url !== undefined)\r\n      if (userHelper.hasOneRole(element.roles)) {\r\n        var route = {\r\n          roles: element.roles,\r\n          name: prefix,\r\n          route: element.url\r\n        };\r\n        routes[element.url] = route;\r\n        siteStructure[prefix] = route;\r\n      }\r\n      //process the site not in the menus  \r\n    if (element.pages !== undefined && element.pages !== null) {\r\n      for (var rtIdx in element.pages) {\r\n        addRouteForUser(element.pages[rtIdx], prefix);\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n\r\n  //Get the siteDescription.\r\n  var getSiteDescription = function getSiteDescription() {\r\n    return _.clone(siteDescription);\r\n  };\r\n\r\n  //Get all the application routes from the siteDescription.\r\n  var getRoute = function getRoutes(routeName) {\r\n    return _.clone(routes[routeName]);\r\n  };\r\n\r\n  var getRoutes = function getRoutes() {\r\n    return _.clone(routes);\r\n  };\r\n\r\n  var getSiteStructure = function getSiteStructure() {\r\n    return _.clone(siteStructure);\r\n  };\r\n\r\n  var siteDescriptionBuilder = {\r\n    getRoute: getRoute,\r\n    getRoutes: getRoutes,\r\n    getSiteDescription: getSiteDescription,\r\n    regenerateRoutes: regenerateRoutes,\r\n    getSiteStructure: getSiteStructure,\r\n    processSiteDescription: processSiteDescription,\r\n    findRouteName: findRouteName,\r\n    routeToRegExp:routeToRegExp\r\n  };\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.siteDescriptionBuilder = siteDescriptionBuilder;\r\n  } else {\r\n    module.exports = siteDescriptionBuilder;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global window, _*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: helpers/routes_helper.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"./custom_exception\").ArgumentNullException;\r\n var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n  //Module page.\r\n  var siteDescriptionStructure,\r\n    siteDescriptionParams,\r\n    isProcess = false;\r\n  //Define the application site description.\r\n  //The siteDescription must be a function which return an object with the following structure: \r\n  // `{headers: [{name: \"NameOfTheModule\", url: \"#nameOftheModule/:param, roles:['CHIEF', 'MASTER']\", headers: [[{name: \"NameOfTheModule\", url: \"#nameOftheModule/:param, roles:['CHIEF', 'MASTER']\", headers: []}]]}]}`\r\n  var defineSite = function defineSite(siteDescription) {\r\n    if (typeof siteDescription !== \"object\") {\r\n      throw new ArgumentNullException('SiteDescription must be an object', siteDescription);\r\n    }\r\n    if (typeof siteDescription.params !== \"object\") {\r\n      throw new ArgumentNullException('SiteDescription.params must be an object', siteDescription);\r\n    }\r\n    if (typeof siteDescription.value !== \"function\") {\r\n      throw new ArgumentNullException('SiteDescription.value must be a function', siteDescription);\r\n    }\r\n    siteDescriptionParams = siteDescription.params || {};\r\n    siteDescriptionStructure = siteDescription.value;\r\n    return getSite();\r\n  };\r\n\r\n  //param must be a {name: 'paramName', value: 'paramValue'} object.\r\n  var defineParam = function defineParamSiteDescriptionHelper(param) {\r\n    if(param === undefined){\r\n      throw new ArgumentNullException('You cannot set an undefined param.', param);\r\n    }\r\n    //console.log(\"Debug\", param.name, siteDescriptionParams,siteDescriptionParams['codePays']);\r\n    if(siteDescriptionParams[param.name] === undefined){\r\n      throw new ArgumentNullException('The parameter you try to define has not been anticipated by the siteDescription', {param: param, siteParams: siteDescriptionParams});\r\n    }\r\n    if (siteDescriptionParams[param.name].value === param.value && _.isEqual(siteDescriptionParams[param.name].title, param.title)) {\r\n      console.info('No changes on param', param);\r\n      return false;\r\n    }\r\n    siteDescriptionParams[param.name] = {\r\n      value: param.value,\r\n      title: param.title,\r\n      isDefine: true\r\n    };\r\n    isProcess = false;\r\n    return true;\r\n  };\r\n\r\n  //Get the site process \r\n  var getSite = function getSite() {\r\n    isProcess = true;\r\n    return siteDescriptionStructure(siteDescriptionParams);\r\n  };\r\n\r\n  //Check if the params is define in the params list.\r\n  var checkParams = function checkParams(paramsArray) {\r\n    if(typeof paramsArray === \"undefined\"){\r\n      return true;\r\n    }\r\n    if (!_.isArray(paramsArray)) {\r\n      throw new ArgumentInvalidException(\"The paramsArray must be an array\");\r\n    }\r\n    if(_.intersection(_.keys(siteDescriptionParams), paramsArray).length !== paramsArray.length){\r\n      return false;\r\n    }\r\n    for (var prop in siteDescriptionParams) {\r\n      if ( _.contains(paramsArray, prop) && !siteDescriptionParams[prop].isDefine) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  var siteDescriptionHelper = {\r\n    defineSite: defineSite,\r\n    defineParam: defineParam,\r\n    getSite: getSite,\r\n    getParams: function(){return _.clone(siteDescriptionParams);},\r\n    checkParams: checkParams,\r\n    isProcessed: function isProcessed() {\r\n      return isProcess;\r\n    }\r\n  };\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.siteDescriptionHelper = siteDescriptionHelper;\r\n  } else {\r\n    module.exports = siteDescriptionHelper;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global $, _ , window*/\r\n\"use strict\";\r\n(function(NS) {\r\n  //Filename: helpers/url_helper.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\r\n  //*This helper has a dependency on underscore and jQuery.*/\r\n  var urlHelper = {};\r\n  // ### generateUrl\r\n  //  Generate an url with all the parameters\r\n  //  This function is use in order to build url from a tootname and a object you want to pass into the url as params.\r\n  //  ```javascript\r\n  //  var urlHelper = require('../lib/url_helper');\r\n  //  var url = urlHelper.generateUrl('rootName', {param1: \"nom\", param2: \"nom2\"}); \r\n  //  //url = '#rootName/?param1=nom&param2=nom2'\r\n  //  ```\r\n  urlHelper.generateUrl = function generateUrl(route, params) {\r\n    var url = '',\r\n      SEP = '/',\r\n      PARAM = '?',\r\n      ET = '&';\r\n    for (var i = 0, routeLength = route.length; i < routeLength; i++) {\r\n      url += (route[i] + SEP);\r\n    }\r\n    if (typeof params !== \"undefined\" && params !== null && !_.isEmpty(params)) {\r\n      url += PARAM;\r\n      for (var propt in params) {\r\n        url += (propt + '=' + params[propt] + ET);\r\n      }\r\n    }\r\n    return url.slice(0, -1); //Remove the last ET.\r\n  };\r\n\r\n  //Parse the parameters of the url.\r\n  urlHelper.parseParam = function parseParam(params) {\r\n    var result = {};\r\n    var paramsLength = params.length;\r\n    //If the string params are not in the chain wich starts with a ?\r\n    if (paramsLength === 0 || '?' !== params[0]) {\r\n      throw \"parseParam : the params is not well formated : \" + params;\r\n    }\r\n    var namedParams = params.slice(1).split('&');\r\n    //For each name param (param=value) we put it in an object, we get pack the parameter we have given in the url.\r\n    $.each(namedParams, function(index, value) {\r\n      if (value) {\r\n        /**/\r\n        var param = value.split('=');\r\n        if (param[1] === 'true') {\r\n          param[1] = true;\r\n        } else if (param[1] === 'false') {\r\n          param[1] = false;\r\n        }\r\n        result[param[0]] = param[1];\r\n      }\r\n    });\r\n    return result;\r\n  };\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.urlHelper = urlHelper;\r\n  } else {\r\n    module.exports = urlHelper;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global i18n, _, window*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: helpers/user_helper.js\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var t = i18n.t || function(s){return s;};\r\n  var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n  var sessionHelper = isInBrowser ? NS.Helpers.sessionHelper : require(\"./session_helper\");\r\n    //var siteDescriptionHelper = isInBrowser ? NS.Helpers.siteDescriptionHelper : require(\"./site_description_helper\");\r\n  //Setting the default user configuration.\r\n  var userConfiguration = {\r\n    cultureCode: \"en-US\", //Culture code.\r\n    name: t('default.name'), //User default name.\r\n    timeZone: \"us\",  //TimeZoneName\r\n    roles: [], //User role lists.,\r\n    routes: []\r\n  };\r\n\r\n  //State variable in order to know if it has been loaded once.\r\n  var isLoadedOnce = false;\r\n\r\n  //Call this method in order to get a clone of the user informations.\r\n  var getUserInformations = function getConfiguration() {\r\n    return _.clone(userConfiguration);\r\n  };\r\n\r\n  //Call this method in order to extend the default user configuration.\r\n  // Only the defined elements will be overriden.\r\n  //Example `configureUserInformations({cultureCode: \"fr-FR\", timeZone: \"uk\"})`\r\n  // Result `{{  cultureCode: \"fr-FR\",  name: default.name,  timeZone: \"uk\"}`\r\n  var configureUserInformations = function configureUserInformations(configurationElements) {\r\n    _.extend(userConfiguration, configurationElements);\r\n    //If the roles are redefine\r\n    if(configurationElements !== undefined && _.isArray(configurationElements.roles)){\r\n      console.info('The roles have change, the site description should be reload.');\r\n      //Attention si les roles sont redfinis il faut rafrachir le plan du site.\r\n      //siteDescriptionHelper.regenerateRoutes();\r\n    }\r\n    isLoadedOnce = true;\r\n    return getUserInformations();\r\n  };\r\n\r\n  // Load the users informations from a promise which is given in arguments.\r\n  var loadUserInformations = function loadUserInformations(promiseOfLoading) {\r\n      return promiseOfLoading.then(function successLoading(loadedConfiguration) {\r\n        configureUserInformations(loadedConfiguration);\r\n    });\r\n  };\r\n\r\n  //Test it the user has the given role in parameter.\r\n  var hasRole = function hasRole(role){\r\n    return _.contains(userConfiguration.roles, role);\r\n  };\r\n\r\n  //Test if the user has one of the role given in argument.\r\n  //_roles_ should be an array.\r\n  var hasOneRole = function hasOneRole(roles){\r\n    if(!_.isArray(roles)){\r\n      throw new ArgumentInvalidException(\"The roles should be an array\", roles);\r\n    }\r\n    return _.intersection(userConfiguration.roles, roles).length > 0;\r\n  };\r\n\r\n  //Change the culture informations.\r\n  var changeCultureInfos = function changeCultureInfos(cultureInfos) {\r\n      sessionHelper.getItem('cultureInformations').then(function (cultureInformations) {\r\n          if (cultureInformations === null || cultureInformations === undefined || cultureInformations.cultureCode !== cultureInfos.cultureCode) {\r\n              sessionHelper.saveItem('cultureInformations', _.extend(cultureInformations !== null && cultureInformations !== undefined ? cultureInformations : {}, cultureInfos)).then(function (success) {\r\n                  window.location.reload();\r\n              });\r\n          }\r\n      }).then(null, function (err) { console.error(err) });\r\n  };\r\n\r\n  var userHelper = {\r\n    loadUserInformations: loadUserInformations,\r\n    getUserInformations: getUserInformations,\r\n    configureUserInformations: configureUserInformations,\r\n    hasRole: hasRole,\r\n    hasOneRole: hasOneRole,\r\n    changeCultureInfos: changeCultureInfos\r\n  };\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Helpers = NS.Helpers || {};\r\n    NS.Helpers.userHelper = userHelper;\r\n  } else {\r\n    module.exports = userHelper;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global  _ , window, Promise */\r\n(function(NS) {\r\n    \"use strict\";\r\n    //Filename: helpers/util_helper.js\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"./custom_exception\").ArgumentInvalidException;\r\n    NS = NS || {};\r\n    var JSON = {};\r\n\r\n    // Unflatten a json object.\r\n    // from an object `{\"contact.nom\": \"Nom\", \"contact.prenom\": \"Prenom\"}`\r\n    // Gives a `{contact: {nom: \"nom\", prenom: \"prenom\"}}`\r\n    JSON.unflatten = function(data) {\r\n        if (Object(data) !== data || Array.isArray(data))\r\n            return data;\r\n        if (\"\" in data)\r\n            return data[\"\"];\r\n        var result = {},\r\n            cur, prop, idx, last, temp;\r\n        for (var p in data) {\r\n            cur = result;\r\n            prop = \"\";\r\n            last = 0;\r\n            do {\r\n                idx = p.indexOf(\".\", last);\r\n                temp = p.substring(last, idx !== -1 ? idx : undefined);\r\n                cur = cur[prop] || (cur[prop] = (!isNaN(parseInt(temp)) ? [] : {}));\r\n                prop = temp;\r\n                last = idx + 1;\r\n            } while (idx >= 0);\r\n            cur[prop] = data[p];\r\n        }\r\n        return result[\"\"];\r\n    };\r\n\r\n    //Flatten a json object.\r\n    // from an object`{contact: {nom: \"nom\", prenom: \"prenom\"}}` \r\n    // Gives a one level object:  `{\"contact.nom\": \"Nom\", \"contact.prenom\": \"Prenom\"}`\r\n    JSON.flatten = function(data) {\r\n        var result = {};\r\n\r\n        function recurse(cur, prop) {\r\n            if (Object(cur) !== cur) {\r\n                result[prop] = cur;\r\n            } else if (Array.isArray(cur)) {\r\n                for (var i = 0, l = cur.length; i < l; i++)\r\n                    recurse(cur[i], prop ? prop + \".\" + i : \"\" + i);\r\n                if (l === 0)\r\n                    result[prop] = [];\r\n            } else {\r\n                var isEmpty = true;\r\n                for (var p in cur) {\r\n                    isEmpty = false;\r\n                    recurse(cur[p], prop ? prop + \".\" + p : p);\r\n                }\r\n                if (isEmpty)\r\n                    result[prop] = {};\r\n            }\r\n        }\r\n        recurse(data, \"\");\r\n        return result;\r\n    };\r\n    //Deeply combine an arbitrary number of JS objects.\r\n    function combine() {\r\n        var res = {};\r\n        var args = _.map(arguments, function(item) {\r\n            return item && !_.isEmpty(item) ? JSON.flatten(item) : {};\r\n        });\r\n        args.unshift(res);\r\n        _.extend.apply(this, args);\r\n        return JSON.unflatten(res);\r\n    }\r\n    //Deeply combine two json.\r\n    function combineTwo(json1, json2) {\r\n        var res = {};\r\n        _.extend(\r\n            res,\r\n            JSON.flatten(json1),\r\n            JSON.flatten(json2)\r\n        );\r\n        return JSON.unflatten(res);\r\n    }\r\n    //Group datas by split char.\r\n    function groupBySplitChar(data, options) {\r\n        options = options || {};\r\n        if (!_.isObject(data)) {\r\n            throw new ArgumentInvalidException('Data must be an object', data);\r\n        }\r\n        var splitKey = options.splitKey || '.';\r\n        var resutContainer = {};\r\n        for (var prop in data) {\r\n            var l = prop.split(splitKey).length;\r\n            if (!_.isObject(resutContainer[l])) {\r\n                resutContainer[l] = {};\r\n            }\r\n            resutContainer[l][prop] = data[prop];\r\n        }\r\n        return resutContainer;\r\n    }\r\n    //Generate four random hex digits.\r\n    function splitLevel(source, options) {\r\n        options = options || {};\r\n        var splitChar = options.splitChar || '.';\r\n        var depth = options.depth || source.length;\r\n        //if(depth === 0){return source;}\r\n        return _.reduce(source.split(splitChar, depth), function(memo, val) {\r\n            return memo + val + splitChar;\r\n        }, '').slice(0, -1);\r\n    }\r\n\r\n    function S4() {\r\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n    }\r\n   \r\n    /**\r\n     * Generate a pseudo-GUID by concatenating random hexadecimal\r\n     * @return {string} A guid.\r\n     */\r\n    function guid() {\r\n        return (S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4());\r\n    }\r\n\r\n    //This method allows the user to load a data (objet or list) in a promise\r\n    // Exampl call: refHelper.loadLocalData([{id: 1, label: \"nom 1\"}, {id: 1, label: \"nom 2\"}])\r\n    var loadLocalData = function loadLocalData(data) {\r\n        return new Promise(function promiseLoadLocalList(resolve, reject) {\r\n            resolve(data);\r\n        });\r\n    };\r\n\r\n    //Generate fake datas.\r\n    var generateFake = {\r\n        //Generate an aleafied object\r\n        object: function generateFalseData(obj) {\r\n            var objAla = {};\r\n            for (var prop in obj) {\r\n                //todo: differenciate the treatement swithcing on type.\r\n                objAla[prop] = '' + obj[prop] + S4();\r\n            }\r\n            return objAla;\r\n        },\r\n        //Generate a fake collection from a single object, adding, nb is th array size.\r\n        collection: function geenerateFalseCollection(obj, nb) {\r\n            var res = [];\r\n            for (var i = 0; i < nb; i++) {\r\n                res.push(this.object(obj));\r\n            }\r\n            return res;\r\n        }\r\n\r\n    };\r\n    /**\r\n     * Sort an object by its keys.\r\n     * @param  {object} object - The object to sort.\r\n     * @return {object}        - The sorted object.\r\n     */\r\n    var sortObject = function sortObject(object) {\r\n        if(!_.isObject(object)){\r\n            throw new ArgumentInvalidException(\"object\");\r\n        }\r\n        var tmp = {};\r\n        var sortedKeys = _.sortBy(_.keys(object), function(d) {\r\n            return d;\r\n        });\r\n        for (var i = 0; i < sortedKeys.length; i++) {\r\n            tmp[sortedKeys[i]] = object[sortedKeys[i]];\r\n        }\r\n        return tmp;\r\n    };\r\n\r\n    //Method to call in order to know if a model is a model.\r\n    var isBackboneModel = function isBackboneModel(model) {\r\n        return model !== undefined && model !== null && typeof model.has === \"function\";\r\n    };\r\n\r\n    // Method to call in order to know if a model is a collection.\r\n    var isBackboneCollection = function isBackboneCollection(collection) {\r\n        return collection !== undefined && collection !== null && typeof collection.add === \"function\";\r\n    };\r\n\r\n    //Method to call in order to know of an object is a view.\r\n    var isBackboneView = function isBackboneView(view) {\r\n        return view !== undefined && view !== null && typeof view.render === \"function\";\r\n    };\r\n\r\n    // This method perform an ajax request within a promise.\r\n    // Example call : utilHelper.promiseAjax({url: \"http://localhost:8080/api/list/1\", type: \"GET\"}).then(console.log,console.error);\r\n    var promiseAjax = function promiseAjax(ajaxSettings) {\r\n        ajaxSettings = ajaxSettings || {};\r\n        return new Promise(function promiseLoadList(resolve, reject) {\r\n            //console.log(\"Errors\", errors);\r\n            $.ajax({\r\n                url: ajaxSettings.url,\r\n                type: ajaxSettings.type,\r\n                data: ajaxSettings.data,\r\n                dataType: \"json\",\r\n                crossDomain: true,\r\n                success: function(data) {\r\n                    //references[listDesc.name] = data; //In order to not reload the next time,  warning, as promises are asynchronous, when the promise is define, this could be false.\r\n                    resolve(data);\r\n                },\r\n                error: function(error) {\r\n                    reject(error);\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    // Returns a promise that is automatically rejected with an error message.\r\n    var promiseRejectWithMessage = function promiseRejectWithMessage(messageKey) {\r\n        return new Promise(function(resolve, reject) {\r\n            reject({\r\n                responseJSON: {\r\n                    \"error\": messageKey\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    //Util helper.\r\n    var utilHelper = {\r\n        flatten: JSON.flatten,\r\n        unflatten: JSON.unflatten,\r\n        combine: combine,\r\n        groupBySplitChar: groupBySplitChar,\r\n        splitLevel: splitLevel,\r\n        loadLocalData: loadLocalData,\r\n        guid: guid,\r\n        generateFake: generateFake,\r\n        isBackboneModel: isBackboneModel,\r\n        isBackboneCollection: isBackboneCollection,\r\n        isBackboneView: isBackboneView,\r\n        promiseAjax: promiseAjax,\r\n        promiseRejectWithMessage: promiseRejectWithMessage,\r\n        sortObject: sortObject\r\n    };\r\n    if (isInBrowser) {\r\n        NS.Helpers = NS.Helpers || {};\r\n        NS.Helpers.utilHelper = utilHelper;\r\n    } else {\r\n        module.exports = utilHelper;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global i18n, window, moment*/\r\n(function(NS) {\r\n\t\"use strict\";\r\n\t//Filename: helpers/validators.js\r\n\tNS = NS || {};\r\n\t//Dependency gestion depending on the fact that we are in the browser or in node.\r\n\tvar isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\tvar DependencyException = isInBrowser ? NS.Helpers.Exceptions.DependencyException : require(\"./custom_exception\").DependencyException;\r\n\t//All regex use in the application.\r\n\tvar regex = {\r\n\t\temail: /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\r\n\t\tnumber: /^-?\\d+(?:\\.d*)?(?:e[+\\-]?\\d+)?$/i\r\n\t};\r\n\r\n\t//Function to test an email.\r\n\tfunction emailValidation(emailToValidate, options) {\r\n\t\toptions = options || options;\r\n\t\treturn regex.email.test(emailToValidate);\r\n\t}\r\n\t//Function to validate a date.\r\n\tfunction dateValidation(dateToValidate, options) {\r\n\t\treturn moment(dateToValidate).isValid();\r\n\t}\r\n\r\n\t//Function to test the length of a string.\r\n\tfunction stringLength(stringToTest, options) {\r\n\t\tif ('string' !== typeof stringToTest) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\toptions = options || {};\r\n\t\t//console.log(options);\r\n\t\toptions.minLength = options.minLength || 0;\r\n\t\tvar isMinLength = options.minLength !== undefined ? stringToTest.length >= options.minLength : true;\r\n\t\tvar isMaxLength = options.maxLength !== undefined ? stringToTest.length <= options.maxLength : true;\r\n\t\treturn isMinLength && isMaxLength;\r\n\t}\r\n\t//Function to  validate that an input is a number.\r\n\tfunction numberValidation(numberToValidate, options) {\r\n\t\toptions = options || options;\r\n\t\tif (!numberToValidate) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (isNaN(numberToValidate)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnumberToValidate = +numberToValidate; //Cast it into a number.\r\n\t\tvar isMin = options.min !== undefined ? numberToValidate >= options.min : true;\r\n\t\tvar isMax = options.max !== undefined ? numberToValidate <= options.max : true;\r\n\t\treturn isMin && isMax;\r\n\t}\r\n\r\n\t//Validate a property, a property shoul be as follow: `{name: \"field_name\",value: \"field_value\", validators: [{...}] }`\r\n\tvar validate = function validate(property, validators) {\r\n\t\t//console.log(\"validate\", property, validators);\r\n\t\tvar errors, res, validator, _i, _len;\r\n\t\terrors = [];\r\n\t\tif (validators) {\r\n\t\t\tfor (_i = 0, _len = validators.length; _i < _len; _i++) {\r\n\t\t\t\tvalidator = validators[_i];\r\n\t\t\t\tres = validateProperty(property, validator);\r\n\t\t\t\tif (res !== null && res !== undefined) {\r\n\t\t\t\t\terrors.push(res);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tname: property.name,\r\n\t\t\tvalue: property.value,\r\n\t\t\tisValid: errors.length === 0,\r\n\t\t\terrors: errors\r\n\t\t};\r\n\t};\r\n\r\n\tvar validateProperty = function validateProperty(property, validator) {\r\n\t\tvar isValid;\r\n\t\tif (!validator) {\r\n\t\t\treturn void 0;\r\n\t\t}\r\n\t\tif (!property) {\r\n\t\t\treturn void 0;\r\n\t\t}\r\n\t\tisValid = (function() {\r\n\t\t\tswitch (validator.type) {\r\n\t\t\t\tcase \"required\":\r\n\t\t\t\t\tvar prevalidString = property.value === \"\" ? false : true;\r\n\t\t\t\t\tvar prevalidDate = true;\r\n\t\t\t\t\treturn validator.value === true ? (property.value !== null && property.value !== undefined && prevalidString && prevalidDate) : true;\r\n\t\t\t\tcase \"regex\":\r\n\t\t\t\t\tif (property.value === undefined || property.value === null) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn validator.value.test(property.value);\r\n\t\t\t\tcase \"email\":\r\n\t\t\t\t\tif (property.value === undefined || property.value === null) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn emailValidation(property.value, validator.options);\r\n\t\t\t\tcase \"number\":\r\n\t\t\t\t\treturn numberValidation(property.value, validator.options);\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tvar stringToValidate = property.value || \"\";\r\n\t\t\t\t\treturn stringLength(stringToValidate, validator.options);\r\n\t\t\t\tcase \"date\":\r\n\t\t\t\t\treturn dateValidation(property.value, validator.options);\r\n\t\t\t\tcase \"function\":\r\n\t\t\t\t\treturn validator.value(property.value, validator.options);\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn void 0;\r\n\t\t\t}\r\n\t\t})();\r\n\t\tif (isValid === undefined || isValid === null) {\r\n\t\t\tconsole.warn('The validator of type: ' + validator.type + ' is not defined'); //Todo: call the logger.\r\n\t\t} else if (isValid === false) {\r\n\r\n\t\t\t//Add the name of the property.\r\n\t\t\treturn getErrorLalel(validator.type, property.name, validator.options); //\"The property \" + property.name + \" is invalid.\";\r\n\t\t}\r\n\t};\r\n\r\n\tfunction getErrorLalel(type, fieldName, options) {\r\n\t\toptions = options || {};\r\n\t\tif (!i18n) {\r\n\t\t\tthrow new DependencyException(\"Dependency not resolved: i18n.js\");\r\n\t\t}\r\n\t\tvar translationKey = options.translationKey ? options.translationKey : \"domain.validation.\" + type;\r\n\t\treturn i18n.translate(translationKey, {\r\n\t\t\tfieldName: fieldName,\r\n\t\t\toptions: options\r\n\t\t});\r\n\t\t/*var message = (function() {\r\n\t\tswitch (type) {\r\n\t\t\tcase \"required\":\r\n\t\t\t\treturn i18n.translate();\r\n\t\t\tcase \"regex\":\r\n\t\t\t\treturn validator.value.test(property.value);\r\n\t\t\tcase \"email\":\r\n\t\t\t\treturn emailValidation(property.value, validator.options);\r\n\t\t\tcase \"number\":\r\n\t\t\t\treturn numberValidation(property.value, validator.options);\r\n\t\t\tcase \"string\":\r\n\t\t\t\treturn stringLength(property.value, validator.options);\r\n\t\t\tcase \"function\":\r\n\t\t\t\treturn validator.value(property.value, validator.options);\r\n\t\t\tdefault:\r\n\t\t\t\treturn void 0;\r\n\t\t}\r\n\t})();*/\r\n\t}\r\n\r\n\t// Validations functions.\r\n\tvar validators = {\r\n\t\temail: emailValidation,\r\n\t\tstringLength: stringLength,\r\n\t\tnumber: numberValidation,\r\n\t\tvalidate: validate\r\n\t};\r\n\r\n\t// Differenciating export for node or browser.\r\n\tif (isInBrowser) {\r\n\t\tNS.Helpers = NS.Helpers || {};\r\n\t\tNS.Helpers.validators = validators;\r\n\t} else {\r\n\t\tmodule.exports = validators;\r\n\t}\r\n\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","# Put your handlebars.js helpers here.\r\n# Globals variables.\r\n# Get the domains definition as globals.\r\nmetadaBuilder = Fmk.Helpers.metadataBuilder# require('./metadata_builder').metadataBuilder\r\ndomains_definition = Fmk.Helpers.metadataBuilder.getDomains()\r\n\r\nHandlebars.registerHelper 'pick', (val, options) ->\r\n  return options.hash[val]\r\n\r\n#use in order to use the translation system in the view.\r\nHandlebars.registerHelper \"t\", (i18n_key, options) ->\r\n  opt = options.hash or {}\r\n  suffix =  opt.suffix or \"\"\r\n  prefix = opt.prefix or \"\"\r\n  maxLength = opt.max\r\n  (i18n_key = this[i18n_key]) if opt.keyInContext is true\r\n\r\n  params = if opt.params? then opt.params.split(',') else undefined\r\n  console.log(opt.params, _.pick.apply(@, params));\r\n  params = if params? then _.pick.apply(@, params) else undefined\r\n  result = i18n.t(\"#{prefix}#{i18n_key}#{suffix}\", params)\r\n  if maxLength? and maxLength < result.length then result = \"#{result.slice(0,+maxLength)}...\"\r\n  new Handlebars.SafeString(result)\r\n\r\n#use in order to debug a template.\r\nHandlebars.registerHelper \"debug\", (optionalValue) ->\r\n  console.log \"Current Context\"\r\n  console.log \"====================\"\r\n  console.log this\r\n  if optionalValue\r\n    console.log \"Value\"\r\n    console.log \"====================\"\r\n    console.log optionalValue   \r\n\r\n###------------------------------------------- FORM FOR THE INPUTS -------------------------------------------###\r\nHandlebars.registerHelper \"display_for\", (property, options) ->\r\n  options = options or {}\r\n  opt = options.hash or {}\r\n  modelName = this.modelName or opt.modelName or undefined\r\n  container = _.extend(this, {modelName: modelName})\r\n  metadata = metadaBuilder.getMetadataForAttribute(container,property)\r\n  domain =  Fmk.Helpers.metadataBuilder.getDomains()[metadata.domain] or {}\r\n  translationRoot = opt.translationRoot or undefined\r\n  dataType = opt.dataType or domain.type or \"text\"\r\n  (dataType = \"checkbox\") if dataType is \"boolean\"\r\n  containerAttribs = opt.containerAttribs or \"\"\r\n  containerCss = opt.containerCss or \"\"\r\n  labelSizeValue = if opt.isNoLabel then 0 else if opt.labelSize then opt.labelSize else 4\r\n  labelSize = \"col-sm-#{labelSizeValue} col-md-#{labelSizeValue} col-lg-#{labelSizeValue}\"\r\n  col = if opt.col? then Handlebars.helpers.col.call(this, opt.col) else \"\"\r\n  noHtml = if opt.noHtml? then opt.noHtml else false\r\n  noGrid = if opt.noGrid? then opt.noGrid else false\r\n  htmlId = if opt.htmlId? then \"id='#{opt.htmlId}'\" else \"\"\r\n  linkTo = if opt.linkTo? then opt.linkTo else \"\"\r\n  #Generate link\r\n  linkOpen = () => \r\n    if linkTo then return \"<a href='#{linkTo}' data-bypass>\" else return \"\"\r\n  linkClose = () =>\r\n    if linkTo then return \"</a>\" else return \"\"\r\n  #Deal with the inputSize\r\n  inputSize = ()=>\r\n    #When it's a checkbox from BootstrapSwitch the input size is equal to zero.\r\n    if noGrid or opt.containerCss\r\n      inputSize = \"\"\r\n    else\r\n      inputSizeValue = 12 - labelSizeValue\r\n      inputSize = opt.inputSize or \"col-sm-#{inputSizeValue} col-md-#{inputSizeValue} col-lg-#{inputSizeValue}\"\r\n  \r\n  #Get the value of the transalated label.\r\n  translationKey =()=>\r\n    translation = opt.translationKey or metadata.label or (\"#{this['modelName']}.#{property}\" if this['modelName']?) or \"\"\r\n    if translationRoot?\r\n      translation = ((if (translationRoot?) and typeof translationRoot is \"string\" then translationRoot + \".\" else \"\")) + property\r\n    return if(translation is \"\") then \"\" else i18n.t(translation)\r\n  #compute the label\r\n  label = ()=>\r\n    if opt.isNoLabel?\r\n      return \"\"\r\n    else if noHtml\r\n      return \"#{translationKey()}\"\r\n    else\r\n      return \"<label class='control-label #{labelSize}' for='#{property}'>#{translationKey()}</label>\" \r\n  #Get the value of the property\r\n  propertyValue =  ()=>\r\n    metadataClass = if metadata.style? then metadata.style else \"\"\r\n    #console.log \"metadataClass\", metadataClass\r\n    if this[property]?\r\n      propValue = this[property]\r\n      if opt.listKey?\r\n        key = this[property]\r\n        value = _.findWhere(_this[opt.listKey], {code:_this[property]})\r\n        if not value?\r\n           value = _.findWhere(_this[opt.listKey], {id:_this[property]})\r\n        if value?\r\n          propValue = if opt.labelProperty then value[opt.labelProperty] else value.label\r\n        else\r\n          propValue = undefined\r\n      if noHtml\r\n        return \"#{_.escape(propValue)}\"\r\n      if metadata.format? and  metadata.format.value?\r\n        #console.log(\"format\", metadata.format(), \"value\", propValue)\r\n        propValue =  metadata.format.value(propValue, metadata.format.options)\r\n      if metadata.symbol?\r\n        propValue = propValue + \" \" + i18n.t(metadata.symbol)\r\n      if dataType is \"checkbox\"\r\n         propValue = if this[property] then i18n.t(\"search.labels.true\") else i18n.t(\"search.labels.false\")\r\n      if dataType is \"date\" and this[property] isnt \"\"\r\n        return \"<div #{htmlId} class='#{metadataClass}'>#{propValue}</div>\"\r\n      else return \"<div #{htmlId} class='#{metadataClass}'>#{linkOpen()}#{_.escape(propValue)}#{linkClose()}</div>\"\r\n    return \"\"\r\n  if noHtml then return new Handlebars.SafeString(\"#{label()} #{propertyValue()}\")\r\n  html = \"<div class='form-group #{col}'>\r\n            #{label()}\r\n            <div class='#{inputSize()} #{containerCss}' #{containerAttribs}>\r\n              <div class='form-control-static'>#{propertyValue()}</div>\r\n            </div>\r\n          </div> \"\r\n  return new Handlebars.SafeString(html)\r\n  \r\nHandlebars.registerHelper \"returns_if_contains\", (property, options) =>\r\n  opt = options.hash or {}\r\n  value=opt.value\r\n  if _.contains(property, value) \r\n    return opt.return\r\n  return ''\r\n\r\nHandlebars.registerHelper \"input_for\", (property, options) ->\r\n  options = options or {}\r\n  #Initialize the variables which are options\r\n  html = undefined\r\n  translationRoot = undefined\r\n  dataType = undefined\r\n  #Read all the options if they exists\r\n  opt = options.hash or {}\r\n  modelName = this.modelName or opt.modelName or undefined\r\n  container = _.extend(this, {modelName: modelName})\r\n  metadata = Fmk.Helpers.metadataBuilder.getMetadataForAttribute(container,property)\r\n  #console.log \"metadata\",metadata\r\n  domain = Fmk.Helpers.metadataBuilder.getDomains()[metadata.domain] or {}\r\n  #console.log \"domain\", domain\r\n  minimalHtml = if opt.minimalHtml? then opt.minimalHtml else false\r\n  noGrid = if opt.noGrid then opt.noGrid else false\r\n  dataFields = (context)->\r\n    subHTML = \"\"\r\n    if opt.dataFields\r\n      fieldNames = opt.dataFields.split(',')\r\n      fieldNames.forEach((fieldName)->\r\n        if context[fieldName]\r\n          subHTML = subHTML + \"data-#{fieldName}='#{context[fieldName]}'\"\r\n      )        \r\n    return subHTML\r\n  isDisplayRequired = false\r\n  isRequired = ()=>\r\n    isDisplayRequired = false\r\n    if opt.isRequired?\r\n      isDisplayRequired = opt.isRequired\r\n    else if metadata.required?\r\n      isDisplayRequired = metadata.required\r\n    return if isDisplayRequired then \"<span class='input-group-addon'>*</span>\" else \"\"\r\n  symbol = ()=>\r\n    isSymbol = false\r\n    #console.log(metadata, isSymbol)\r\n    if opt.symbol?\r\n      isSymbol = opt.symbol\r\n    else if metadata.symbol?\r\n      isSymbol = metadata.symbol\r\n\r\n    return if isSymbol then \"<span class='input-group-addon'>#{isSymbol}</span>\" else \"\"\r\n  #isRequired = if !opt.isRequired? or !opt.isRequired then \"\" else \"<span class='input-group-addon'>*</span>\"\r\n  translationRoot = opt.translationRoot or undefined\r\n  dataType = opt.dataType or domain.type or \"text\"\r\n  (dataType = \"checkbox\") if dataType is \"boolean\"\r\n  readonly = opt.readonly or false\r\n  readonly = if readonly then \"readonly\" else \"\"\r\n  disabled = opt.disabled or false\r\n  disabled = if disabled then \"disabled\" else \"\"\r\n  inputAttributes= this[opt.inputAttributes] or opt.inputAttributes or \"\"\r\n  cidAttr = if opt.cidSelection = true then \"cid='#{@cid}'\" else \"\"\r\n  #Add bootstrap-switch css to checkbox input.\r\n  containerAttribs = opt.containerAttribs or \"\"\r\n  containerCss = opt.containerCss or \"\"\r\n  labelSizeValue = if opt.isNoLabel then 0 else if opt.labelSize then opt.labelSize else 4\r\n  labelSize = \"col-sm-#{labelSizeValue} col-md-#{labelSizeValue} col-lg-#{labelSizeValue}\"\r\n  col = if opt.col? then Handlebars.helpers.col.call(this, opt.col) else \"\"\r\n  #Deal with the inputSize\r\n  inputSize = ()=>\r\n    #When it's a checkbox from BootstrapSwitch the input size is equal to zero.\r\n    if noGrid or opt.containerCss\r\n      inputSize = \"\"\r\n    else\r\n      inputSizeValue = 12 - labelSizeValue\r\n      inputSize = opt.inputSize or \"col-sm-#{inputSizeValue} col-md-#{inputSizeValue} col-lg-#{inputSizeValue}\"\r\n  # Define all the case where there is an input addon.\r\n  # todo:pbn maybe remove the isAddOnInput because there if ther is a mix of symbol and no symbol the input size is different.\r\n  isAddOnInput = true or opt.icon? or ((opt.isRequired || metadata.required)) is true or ((opt.symbol || metadata.symbol))?\r\n  #Get the value of the property\r\n  propertyValue =  ()=>\r\n    if this[property]?\r\n      propValue = this[property]\r\n      if metadata.format? and metadata.format.value?\r\n        #console.log(\"format\", metadata.format(), \"value\", propValue)\r\n        propValue =  metadata.format.value(propValue, metadata.format.options)\r\n      if dataType is \"checkbox\"\r\n        if propValue then return 'checked'\r\n      if dataType is \"date\" and propValue isnt \"\"\r\n        return \"value='\" + propValue + \"'\"\r\n      if dataType is \"number\"\r\n        return \"value='\" + numeral(propValue).value() + \"'\" \r\n      else return \"value='#{_.escape(propValue)}'\"\r\n    \"\"\r\n  #Get the value of the translated label.\r\n  translationKey =()=>\r\n    translation = opt.translationKey or metadata.label or (\"#{this['modelName']}.#{property}\" if this['modelName']?) or \"\"\r\n    if translationRoot?\r\n      translation = ((if (translationRoot?) and typeof translationRoot is \"string\" then translationRoot + \".\" else \"\")) + property\r\n    \r\n    return if(translation is \"\") then \"\" else i18n.t(translation)\r\n   \r\n  #Deal with the icon case\r\n  icon = ()=>  \r\n    #<span class='glyphicon glyphicon-#{opt.icon}'></span>\r\n    if opt.icon? then \"<span class='input-group-addon'><i class='fa fa-#{opt.icon}  fa-fw'></i> </span>\" else \"\"\r\n  #Deal with the label\r\n  label = ()=>\r\n    if opt.isNoLabel?\r\n      return \"\"\r\n    else\r\n      return \"<label class='control-label #{labelSize}' for='#{property}'>#{translationKey()}</label>\"\r\n    #if not opt.isNoLabel? then \"<label class='control-label #{labelSize}' for='#{property}'> #{translationKey} </label>\" else \"\"\r\n  #By default there is a placeholder or if the preperty is true.\r\n  placeholder = if (!opt.placeholder? and opt.isNoLabel) or opt.placeholder then \"placeholder='#{translationKey()}'\" else \"\"\r\n  #console.log \"placeholder\", placeholder, (!opt.isNoLabel? or !opt.isNolabel)\r\n  \r\n  decorator = ()=>\r\n    if metadata.decorator?\r\n      return \"data-decorator='#{metadata.decorator}'\"\r\n    else\r\n      return ''\r\n  \r\n  #Initialize the errors variables => Is there an error, if yes what is the message.\r\n  error = \"\"\r\n  error = \"has-error\" if @errors? and @errors[property]?\r\n  errorValue = if @errors? and @errors[property]? then i18n.t(@errors[property]) else \"\"\r\n  errorSize = ()=>\r\n    errorLength = 12 - labelSizeValue\r\n    offsetError = labelSizeValue\r\n    return \"col-sm-#{errorLength} col-md-#{errorLength} col-lg-#{errorLength} col-sm-offset-#{offsetError} col-md-offset-#{offsetError} col-lg-offset-#{offsetError}\"\r\n  #Deal with error\r\n  errors = ()=>\r\n    if error == \"has-error\" then \"<span class='#{error} #{errorSize()} help-inline pull-left' style='color:#b94a48'> #{errorValue } </span>\" else \"\"\r\n  #Build the html tag.\r\n  # <div class=\"form-group\">\r\n  #     <label for=\"exampleInputEmail\">Email address</label>\r\n  #     <input type=\"text\" class=\"form-control\" id=\"exampleInputEmail\" placeholder=\"Enter email\">\r\n  #   </div>\r\n  if minimalHtml \r\n      html = \" <input id='#{property}' #{dataFields(@)} #{decorator()} class=''\"\r\n      html += \"data-name='#{property}' type='#{dataType}' #{inputAttributes} #{cidAttr} #{placeholder} #{propertyValue()} #{readonly} #{disabled}/>\"\r\n  else\r\n      html = \"\r\n              <div class='form-group #{error} #{col}'>\r\n                #{label()}\r\n                <div class='#{inputSize()} #{containerCss}' #{containerAttribs}>\r\n                    <div class='#{if isAddOnInput then 'input-group' else \"\"}'>\r\n                   #{icon()}\r\n                  <input id='#{property}' #{decorator()} #{dataFields(@)} class='\"\r\n      if(dataType != \"checkbox\") then html +=\"form-control \"\r\n      html += \"input-sm' data-name='#{property}' type='#{dataType}' #{inputAttributes} #{placeholder} #{propertyValue()} #{readonly} #{disabled}/>\r\n                  #{symbol()}\"\r\n      if(dataType !=\"checkbox\") then html +=\"              #{isRequired()}\" else html+=\"              \"\r\n             \r\n      html+=\"               </div> \r\n                        </div>\r\n                #{errors()}\r\n              </div>\r\n            \"\r\n  new Handlebars.SafeString(html)\r\n  \r\n  \r\nHandlebars.registerHelper \"radio_for\", (property, options) ->\r\n  options = options or {}\r\n  #Initialize the variables which are options\r\n  html = undefined\r\n  translationRoot = undefined\r\n  dataType = undefined\r\n  #Read all the options if they exists\r\n  opt = options.hash or {}\r\n  metadata = Fmk.Helpers.metadataBuilder.getMetadataForAttribute(this,property)\r\n  #console.log \"metadata\",metadata\r\n  domain = Fmk.Helpers.metadataBuilder.getDomains()[metadata.domain] or {}\r\n  #possible values for the radio group\r\n  possibleValues = [] ;\r\n  isDisplayRequired = false\r\n  isRequired = ()=> \r\n    isDisplayRequired = false\r\n    if opt.isRequired?\r\n      isDisplayRequired = opt.isRequired\r\n    else if metadata.required?\r\n      isDisplayRequired = metadata.required\r\n    return if isDisplayRequired then \"\" else generateRadioButton(i18n.t('search.labels.all'), \"null\", defaultValue == \"\")\r\n\r\n  translationRoot = opt.translationRoot or undefined\r\n  dataType = opt.dataType or domain.type or \"text\"\r\n  #generate possible values or return classic input_for\r\n  switch dataType\r\n    when \"boolean\" then possibleValues = [true, false]\r\n    else return \"Type \" + dataType + \" not supported by helper radio_for\"\r\n  defaultValue = if opt.defaultValue != undefined then opt.defaultValue else \"\"\r\n  readonly = opt.readonly or false\r\n  readonly = if readonly then \"readonly\" else \"\"\r\n  disabled = opt.disabled or false\r\n  disabled = if disabled then \"disabled\" else \"\"\r\n  inputAttributes= opt.inputAttributes or \"\"\r\n  #Add bootstrap-switch css to checkbox input.\r\n  containerAttribs = opt.containerAttribs or \"\"\r\n  containerCss = opt.containerCss or \"\"\r\n  labelSizeValue = if opt.isNoLabel then 0 else if opt.labelSize then opt.labelSize else 3\r\n  labelSize = \"col-sm-#{labelSizeValue} col-md-#{labelSizeValue} col-lg-#{labelSizeValue}\"\r\n  col = if opt.col? then Handlebars.helpers.col.call(this, opt.col) else \"\"\r\n  radioSizeValue = opt.radioSize or 4\r\n  radioSize = \"col-sm-#{radioSizeValue} col-md-#{radioSizeValue} col-lg-#{radioSizeValue}\"\r\n  #Deal with the inputSize\r\n  inputSize = ()=>\r\n      inputSizeValue = 12 - labelSizeValue\r\n      inputSize = opt.inputSize or \"col-sm-#{inputSizeValue} col-md-#{inputSizeValue} col-lg-#{inputSizeValue}\"\r\n  #Deal with the label\r\n  label = ()=>\r\n    if opt.isNoLabel?\r\n      return \"\"\r\n    else\r\n      return \"<label class='control-label #{labelSize}' for='#{property}'>#{translationKey()}</label>\"\r\n  #Get the value of the transalated label.\r\n  translationKey =()=>\r\n    translation = opt.translationKey or   metadata.label or (\"#{this['modelName']}.#{property}\" if this['modelName']?) or \"\"\r\n    if translationRoot?\r\n      translation = ((if (translationRoot?) and typeof translationRoot is \"string\" then translationRoot + \".\" else \"\")) + property\r\n    \r\n    return if(translation is \"\") then \"\" else i18n.t(translation)\r\n   \r\n    #if not opt.isNoLabel? then \"<label class='control-label #{labelSize}' for='#{property}'> #{translationKey} </label>\" else \"\"\r\n  #By default there is a placeholder or if the preperty is true.\r\n  placeholder = if (!opt.placeholder? and opt.isNoLabel) or opt.placeholder then \"placeholder='#{translationKey()}'\" else \"\"\r\n  #console.log \"placeholder\", placeholder, (!opt.isNoLabel? or !opt.isNolabel)\r\n  \r\n  #Checked by default\r\n  checked = (value, isDefault) => \r\n    isChecked =  this[property] is value or ((not this[property]?) and isDefault) or false\r\n    return if isChecked then \"checked='checked'\" else \"\"\r\n  \r\n  #Basic layout for radio button\r\n  generateRadioButton = (label, value, isDefault) => \r\n    return \"\r\n    <div class='#{radioSize}'>\r\n         <div class='input-group'>\r\n             <span class='input-group-addon'>\r\n                <input id='#{property + value}' name='#{property}' data-name='#{property}' type=radio value='#{value}' #{checked(value,isDefault)} #{inputAttributes} #{placeholder} #{readonly} #{disabled}/>      \r\n             </span>\r\n             <label for='#{property + value}' class='form-control'>\r\n               #{label}\r\n             </label>\r\n          </div>\r\n      </div>\"\r\n  \r\n  #Deal with error\r\n  #Initialize the errors variables => Is there an error, if yes what is the message.\r\n  error = \"\"\r\n  error = \"has-error\" if @errors? and @errors[property]?\r\n  errorValue = if @errors? and @errors[property]? then i18n.t(@errors[property]) else \"\"\r\n  errorSize = ()=>\r\n    errorLength = 12 - labelSizeValue\r\n    offsetError = labelSizeValue\r\n    return \"col-sm-#{errorLength} col-md-#{errorLength} col-lg-#{errorLength} col-sm-offset-#{offsetError} col-md-offset-#{offsetError} col-lg-offset-#{offsetError}\"\r\n  #create the radios\r\n  radios = isRequired()\r\n  radios += generateRadioButton(i18n.t('search.labels.'+value), value, value == defaultValue) for value in possibleValues\r\n  \r\n  errors = ()=>\r\n    if error == \"has-error\" then \"<span class='#{error} #{errorSize()} help-inline pull-left' style='color:#b94a48'> #{errorValue } </span>\" else \"\"\r\n  html = \"\r\n          <div class='form-group #{error} #{col}'>\r\n            #{label()}\r\n            <div class='#{inputSize()} #{containerCss}' #{containerAttribs}>\r\n              #{radios}\r\n              </div>\r\n            #{errors()}\r\n          </div>\r\n        \"\r\n  new Handlebars.SafeString(html)\r\n\r\n#Generate a optionset selector. https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement\r\nHandlebars.registerHelper \"options_selected\", (property, options) ->\r\n  options = options or {}\r\n  opt = options.hash or {}\r\n  cssClass = if opt.cssClass? then opt.cssClass else \"\"\r\n  optName = if opt.optName? then \"data-name='#{opt.optName}'\" else \"\"\r\n  optToTriggerName = if opt.optToTriggerName? then \"data-opttotrigger-name='#{opt.optToTriggerName}'\" else \"\"\r\n  optToTriggerListKey = if opt.optToTriggerListKey? then \"data-opttotrigger-listkey='#{opt.optToTriggerListKey}'\" else \"\"\r\n  optMapping = if opt.optMapping? then this[opt.optMapping] else null\r\n  dataMapping = if optMapping? then \"data-mapping=#{optMapping}\" else \"\"\r\n  list = this[opt.listKey] or []\r\n  selected = this[property] or opt.selected or undefined\r\n  if(opt.addDefault)\r\n    list =[{id: undefined, label: ''}].concat(list)\r\n  metadata = Fmk.Helpers.metadataBuilder.getMetadataForAttribute(this,property)\r\n  domain = Fmk.Helpers.metadataBuilder.getDomains()[metadata.domain] or {}\r\n  #console.log \"domain\", domain\r\n  isRequired = ()=>\r\n    isDisplayRequired = false\r\n    if opt.isRequired?\r\n      isDisplayRequired = opt.isRequired\r\n    else if metadata.required?\r\n      isDisplayRequired = metadata.required\r\n    return if isDisplayRequired then \"<span class='input-group-addon'>*</span>\" else \"\"\r\n  translationRoot = opt.translationRoot or undefined\r\n  isAtLine = opt.isAtLine or false\r\n  readonly = opt.readonly or false\r\n  readonly = if readonly then \"disabled\" else \"\"\r\n  labelSizeValue = if opt.isNoLabel then 0 else if opt.labelSize then opt.labelSize else 4\r\n  labelSize = \"col-sm-#{labelSizeValue} col-md-#{labelSizeValue} col-lg-#{labelSizeValue}\"\r\n  col = if opt.col? then Handlebars.helpers.col.call(this, opt.col) else \"\"\r\n  \r\n  inputSize = ()=>\r\n    #When it's a checkbox from BootstrapSwitch the input size is equal to zero.\r\n    if opt.containerCss\r\n      inputSize = \"\"\r\n    else\r\n      inputSizeValue = 12 - labelSizeValue\r\n      inputSize = opt.inputSize or \"col-sm-#{inputSizeValue} col-md-#{inputSizeValue} col-lg-#{inputSizeValue}\"\r\n  #Get the value of the transalated label.\r\n  #Get the value of the transalated label.\r\n  translationKey =()=>\r\n    translation = opt.translationKey or metadata.label or (\"#{this['modelName']}.#{property}\" if this['modelName']?) or \"\"\r\n    if translationRoot?\r\n      translation = ((if (translationRoot?) and typeof translationRoot is \"string\" then translationRoot + \".\" else \"\")) + property\r\n    \r\n    return if(translation is \"\") then \"\" else i18n.t(translation)\r\n  icon = ()=>  \r\n  #<span class='glyphicon glyphicon-#{opt.icon}'></span>\r\n    if opt.icon? then \"<span class='input-group-addon'><i class='fa fa-#{opt.icon} fa-fw'></i> </span>\" else \"\"\r\n    #if opt.icon? then \"<span class='input-group-addon'> <span class='glyphicon glyphicon-#{opt.icon}'></span></span>\" else \"\"\r\n  isAddOnInput = true or opt.icon? or (opt.isRequired || metadata.required) is true\r\n   #Deal with the label\r\n  label = ()=>\r\n    if not opt.isNoLabel?\r\n      if isAtLine\r\n        \"<div class='row'><label class='control-label for='#{property}'> #{translationKey()} </label></div>\"\r\n      else\r\n        \"<label class='control-label #{labelSize}' for='#{property}'> #{translationKey()} </label>\" \r\n    else \"\"\r\n  #Initialize the errors variables => Is there an error, if yes what is the message.\r\n  error = \"\"\r\n  error = \"has-error\" if @errors? and @errors[property]?\r\n  errorValue = if @errors? and @errors[property]? then i18n.t(@errors[property]) else \"\"\r\n  #Deal with error\r\n  errors = ()=>\r\n    if error == \"has-error\" then \"<span class='#{error} help-inline pull-left' style='color:#b94a48'> #{errorValue } </span>\" else \"\"\r\n  jsonGiven = this\r\n  #We define a small addOption function in order to add an option to the select.\r\n  addOption = (elt) ->\r\n    id = elt.id or elt.code\r\n    prop = if opt.labelProperty then elt[opt.labelProperty] else elt.label\r\n    isSelected = if selected? and id? and ((!_.isArray(selected) and id.toString() is selected.toString()) or (_.isArray(selected) and selected.indexOf(id.toString()) > -1)) then \"selected\" else \"\"\r\n    html+= \"<option value= '#{id}'  #{isSelected}>#{prop}</option>\"\r\n    return undefined\r\n  multiple = if opt.isMultiple then \"multiple style='width:'resolve';'\" else \"\"\r\n  # Define \r\n  emptyOption = ->\r\n    #\r\n    isRequiredWithValue = selected? and ( isRequired() isnt \"\")\r\n    if((opt.isEmpty is true) or ((opt.isMultiple is true) or (isRequiredWithValue is true)) and (not opt.isNotEmpty))\r\n      return \"\"\r\n    return \"<option></option>\"\r\n    # Save the following information=> Edit mode with a value and display required => No empty option.\r\n    #return \"<option></option>\" if ((not isEditAndRequired) and (not opt.isNotEmpty)) and (not opt.isMultiple)\r\n  #Initialize the html  \r\n  html = \"<div class='form-group #{error} #{col}'>\r\n            #{label()}\r\n            <div class='controls #{inputSize()}'>\r\n              <div class='input-group '>\r\n                #{icon()}                \r\n                <select id='#{property}' data-name='#{property}' #{multiple} #{readonly} #{optName} #{optToTriggerName} #{optToTriggerListKey} #{dataMapping} class='form-control input-sm #{cssClass}'>#{emptyOption()}\"\r\n  #add options foreach options in the list\r\n  addOption(elt) for elt in list\r\n  html +=      \"</select>#{isRequired()} \r\n              </div>\r\n              #{errors()}\r\n            </div>\r\n          </div>\"  \r\n  new Handlebars.SafeString(html)\r\n\r\n# Format a date using moment.js.\r\nHandlebars.registerHelper \"dateFormat\",(_date, options) ->\r\n  formatedDate = ''\r\n  if _date\r\n    opt = options.hash or {}\r\n    format = opt.format or require('../config').dateFormat# Todo: reenable or require('./configuration').getConfiguration().format.date\r\n    formatedDate = moment(_date).format(format)\r\n  new Handlebars.SafeString(formatedDate)\r\n\r\n#S4  \r\nS4 = ->\r\n  (((1 + Math.random()) * 0x10000) | 0).toString(16).substring 1\r\n\r\n#Generate a pseudo-GUID by concatenating random hexadecimal.\r\nguid = ->\r\n  S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4()\r\n\r\n# Example => button \"transalationKey\", icon=\"heart\" id=\"12\" class=\"btn-danger\" type=\"submit\"\r\nHandlebars.registerHelper \"button\",(text_key, options) ->\r\n  #console.log \"button\", i18n.t(text_key)\r\n  opt = options.hash or {}\r\n  if opt.role  isnt undefined and !Fmk.Helpers.userHelper.hasRole(opt.role)\r\n    return \"\"\r\n  isLoading =  opt.isLoading\r\n  cssClass = opt.class or \"\"\r\n  cssId = opt.id or guid()\r\n  dataAttributes = opt.dataAttributes or \"\" \r\n  type = opt.type or \"button\"\r\n  action = if opt.action? then \"data-action=#{action}\" else \"\"\r\n  loading = ->\r\n    if isLoading or type is 'submit'\r\n      return \"data-loading data-loading-text='#{opt.loadingText or i18n.t('button.loading')}'\"\r\n    return \"\"\r\n  icon = ()->\r\n     if opt.icon? then \"<i class='fa fa-fw fa-#{opt.icon}'></i>\" else \"\"\r\n  button = \"<button type='#{type}' #{action}  #{dataAttributes} class='btn #{cssClass}' id='#{cssId}' #{loading()}>#{icon()} #{if text_key isnt '' then i18n.t(text_key) else ''}</button>\"\r\n  new Handlebars.SafeString(button)\r\n\r\n# display pagination on table \r\n# consume an object in the this which is : \r\n# `{currentPage: currentPage, firstPage: firstPage, totalPages: totalPages, perPage: perPage, totalRecords: totalRecords}`\r\nHandlebars.registerHelper \"paginate\", (property, options)->\r\n  options = options or {}\r\n  options = options.hash or {}\r\n  return \"\" if not @collection?\r\n  return \"\" if @collection? and @collection.length is 0\r\n  currentPage = this.currentPage\r\n  firstPage = this.firstPage or 1\r\n  endPage = this.totalPages or 0\r\n\r\n  nbPrint = 4;\r\n  firstPagePrint = Math.max(firstPage, currentPage - nbPrint)\r\n  lastPagePrint = Math.min(endPage, currentPage + nbPrint)\r\n  nbPagePrint = lastPagePrint - firstPagePrint\r\n  if nbPagePrint < nbPrint * 2\r\n    if endPage - lastPagePrint > nbPrint\r\n      lastPagePrint += nbPrint * 2 - nbPagePrint\r\n    else\r\n      firstPagePrint -= nbPrint * 2 - nbPagePrint\r\n  \r\n  firstPagePrint = Math.max(firstPagePrint, 1);\r\n   \r\n  perPage = this.perPage or 10\r\n  totalRecords = this.totalRecords\r\n  generateLeftArrow = ()->\r\n    className = if currentPage is firstPage then \"disabled\" else \"\"\r\n    return \"<li class='#{className}'><a href='#' data-bypass data-page='#{firstPage}'>&laquo;</a></li>\"\r\n  generatePageNumber= ()->\r\n    html = \"\"\r\n    (html+= \"<li class='#{if i is currentPage then 'active' else ''}'><a href='#' data-bypass data-page='#{i}'>#{i}</a></li>\") for i in [firstPagePrint..lastPagePrint]\r\n    return html\r\n  generateRigthArrow = ()->\r\n    className = if currentPage is endPage then \"disabled\" else \"\"\r\n    return \"<li class='#{className}'><a href='#' data-bypass  data-page='#{endPage}'>&raquo;</a></li>\"\r\n  generatePagination = ->\r\n    return \"\" if totalRecords <= perPage\r\n    return \"#{generateLeftArrow()}#{generatePageNumber()}#{generateRigthArrow()}\"\r\n  generatePageFilter = ()->\r\n    pageString = i18n.t(\"application.pages\")\r\n    generateOptions = ()->\r\n      html = \"\"\r\n      for i in [1..4]\r\n        html += \"<option value='#{5*i}' #{if 5*i is perPage then 'selected'}>#{5*i} #{pageString}</option>\"\r\n      return html\r\n      \r\n    return \"<select class='form-control pageFilter'>\r\n              #{generateOptions()} \r\n            </select>\"\r\n  generateTotal = ()->\r\n    resultString = i18n.t('search.result')\r\n    return if options.showResultNumber then \"<div class='badgeResult'>#{resultString} <span class='badge'>#{totalRecords}</span></div>\" else \"\"\r\n    \r\n  html = \"<div class='col-md-8'>\r\n            <ul class='pagination'>#{generatePagination()}</ul>\r\n          </div>\r\n          <div class='col-md-2 pagination'>\r\n            #{generateTotal()}\r\n          </div>\r\n          <div class='col-md-2 pagination'>\r\n            #{generatePageFilter()}\r\n          </div>\"\r\n  return new Handlebars.SafeString(html)\r\n\r\n# `{totalRecords: totalRecords}`\r\nHandlebars.registerHelper \"tableHeaderAction\", (options)->\r\n  options = options or {}\r\n  options = options.hash or {}\r\n  totalRecords = this.totalRecords or 0\r\n  resultString = i18n.t(options.resultLabel or 'search.result')\r\n  exportButton = ->\r\n    if options.exportUrl? && totalRecords > 0\r\n      return \"\r\n        <div class='pull-right export'>\r\n          <button   data-bypass class='btn btnExport'><i class='fa fa-table'></i>#{i18n.t('search.export')}</button>\r\n          <a href='#{options.exportUrl}' data-bypass class='btn hidden btnExport'><i class='fa fa-table'></i> #{i18n.t('search.export')}</a>\r\n        </div>\r\n        \"\r\n    return \"\"\r\n  generateTotal = ()->\r\n    return \"<span class='badge'>#{totalRecords}</span> #{resultString}\"\r\n  html = \"<div class='tableAction'>\r\n            <div class='pull-left'>\r\n                #{generateTotal()}\r\n            </div>\r\n            #{exportButton()}\r\n          </div>\"\r\n  return new Handlebars.SafeString(html)\r\n\r\n# display sort icon on table column\r\n# `{sortField: sortField, order: order, modelName: modelName}`\r\nHandlebars.registerHelper \"sortColumn\", (property, options)->\r\n  options = options.hash or {}\r\n  sortField = this.sortField\r\n  order = this.order || \"asc\"\r\n  translationKey = options.translationKey or undefined\r\n  generateSortPosition= ()->\r\n    icon = \"fa fa-sort\"\r\n    if property is sortField\r\n      icon+= \"-\" + order\r\n    return \"<i class='#{icon}' data-name='#{property}'></i>\"\r\n  if this.isEdit\r\n    return new Handlebars.SafeString(\"<span class='sortColumn'>#{i18n.t(translationKey)}</span>\")\r\n  new Handlebars.SafeString(\"<a class='sortColumn'  href='#' data-name='#{property}' data-bypass>#{i18n.t(translationKey)} #{if this.isEdit then '' else generateSortPosition()}</a>\")\r\n\r\nHandlebars.registerHelper \"statusIcon\", (property, options)->\r\n  if typeof(this[property] == \"boolean\")\r\n    if this[property] then icon = \"fa fa-check\" else icon = \"fa fa-exclamation\"\r\n  else switch this[property]\r\n    when 0 then icon = \"fa fa-ban\";\r\n    when 1 then icon = \"fa fa-exclamation\";\r\n    when 2 then icon = \"fa fa-clock-o\";\r\n    when 3 then icon = \"fa fa-check\";\r\n    else icon = \"\"\r\n  return new Handlebars.SafeString(\"<i class='#{icon}'><i>\");\r\n\r\n# Helper in order to display a progress bar.\r\nHandlebars.registerHelper \"progress\", (property, options)->\r\n  #Add each element of the property\r\n  addElements = (elements)->\r\n    html = \"\"\r\n    sum = 0\r\n    elements.forEach((elt)->\r\n      if(not _.isEmpty(elt))\r\n        sum+= elt.value \r\n    )\r\n    elements.forEach((elt)->\r\n      if(not _.isEmpty(elt))\r\n        html += \"<div class='progress-bar progress-bar-#{elt.type}' style='width: #{Math.floor(elt.value*100/sum)}%'>\r\n          #{elt.label}\r\n        </div>\"\r\n    )\r\n    #console.log \"progress\", html\r\n    return html\r\n  return new Handlebars.SafeString(\"<div class='progress'>#{addElements(@[property])}</div>\")\r\n\r\n# Check if the user has one role.\r\n### Example:\r\n  {{#hasOneRole \"ROLE1,ROLE2\"}}\r\n    <div>HTML code</div>\r\n  {{/hasOneRole}}\r\n###\r\nHandlebars.registerHelper \"hasOneRole\", (property, options)->\r\n  if _.isString(property)\r\n    roles = property.split(',')\r\n    if Fmk.Helpers.userHelper.hasOneRole(roles)\r\n      return options.fn(this)\r\n\r\n# Check if the user has a role.\r\n### Example:\r\n  {{#hasRole \"ROLE_NON_EXISTANT\"}}\r\n    <div>HTML code</div>\r\n  {{/hasRole}}\r\n###\r\nHandlebars.registerHelper \"hasRole\", (property, options)->\r\n  if _.isString(property) and Fmk.Helpers.userHelper.hasRole(property)\r\n    return options.fn(this)\r\n    \r\n# Generate the bootstrap css classes for the grid.\r\n### Example\r\n  {{col \"6\"}}\r\n###\r\nHandlebars.registerHelper \"col\", (property)->\r\n  return \"col-xs-#{property} col-sm-#{property} col-md-#{property} col-lg-#{property}\"\r\n\r\n\r\n# Redefinition of the each. Add an option in order to extend the context of the element inside the each loop.\r\n# parentKeys\r\n### Example\r\n    {{each collectionProperty}}\r\n    {{each collectionProperty parentKeys=\"prop1,prop2\"}}\r\n\r\n    {{each object}}\r\n        {{this.key}} : {{this.value}}\r\n    {{/each}}\r\n###\r\nHandlebars.registerHelper \"each\", (context, options)->\r\n  options = options or {}\r\n  opt = options.hash or {}\r\n  ret = \"\";\r\n  parentProperties = undefined\r\n  if opt.parentKeys?\r\n    parentProperties = _.pick(this, opt.parentKeys.split(','))\r\n    #console.log(opt.parentKeys, parentProperties)\r\n  context = context or []\r\n  if _.isArray(context)\r\n      for elem in (context or [])\r\n        ctx = _.extend(elem, parentProperties)\r\n        ret = ret + options.fn(ctx)\r\n  else if _.isObject(context)\r\n    for elem of (context or {})\r\n        ctx = {key: elem, value :_.extend(context[elem], parentProperties)}\r\n        ret = ret + options.fn(ctx)\r\n  return ret\r\n\r\nHandlebars.registerHelper \"introspect\", (property, options) ->\r\n  options = options or {}\r\n  opt = options.hash or {}\r\n  isDisplay = if opt.isDisplay? then opt.isDisplay else true\r\n  helperName = if isDisplay then \"display_for\" else \"input_for\"\r\n  modelName = this.modelName or property or opt.modelName or undefined\r\n  container = _.extend(this, {modelName: modelName})\r\n  metadatas = Fmk.Helpers.metadataBuilder.getMetadatas(container) or {}\r\n  html = \"\"\r\n  for prop of metadatas\r\n    #if container[prop]?\r\n    html =  html + Handlebars.helpers[helperName].call(container, prop, {hash: {col: 12}})\r\n  return new Handlebars.SafeString(html)\r\n\r\n\r\n# Currency helper in order to have a vizualization for the currency.\r\n## Todo: reenable when number format is needed..\r\n###Handlebars.registerHelper \"currency\",(property, options) ->  \r\n  currencySymbol = ''\r\n  value = ''\r\n  if (+this[property])? or +this[property] is 0\r\n    value = +this[property]\r\n  if typeof value is 'number'\r\n    value = numeral(value).format(require('./configuration').getConfiguration().format.currency) if value isnt ''#value.toFixed('2') \r\n    new Lawnchair({name: 'products'}, $.noop).get('currency', (curr)-> currencySymbol = curr.currencySymbol)\r\n  html = \"<div class='currency'><div class='right'>#{value} #{currencySymbol}</div></div>\"\r\n  new Handlebars.SafeString(html)###\r\n###\r\n  Helper pour uniformiser l'utilisation des formulaires.\r\n  Exemple: {{#form}} {{input_for \"firstName\"}} {{/form}}\r\n###\r\nHandlebars.registerHelper 'form', (options)->\r\n    return \"<form novalidate class='form-horizontal' role='form'>#{options.fn(@)}</form>\"\r\n###\r\n  Helper pour uniformiser l'utilisation des formulaires.\r\n  Exemple: {{#form}} {{input_for \"firstName\"}} {{/form}}\r\n###\r\nHandlebars.registerHelper 'display', (options)->\r\n    return \"<form novalidate class='form-horizontal' role='form'>#{options.fn(@)}</form>\"\r\n###\r\n  Helper pour uniformiser l'utilisation des formulaires.\r\n  Exemple: {{#button_toolbar}} {{{button_cancel}} {{button_save}} {{/button_toolbar}}\r\n###\r\nHandlebars.registerHelper 'btn_toolbar', (options)->\r\n    return \"<div class='btn-toolbar'><div class='btn-group'>#{options.fn(@)}</div></div>\"\r\n###\r\n  Helper pour uniformiser l'utilisation des panel.\r\n  Exemple: {{#panel}} {{{#form}} {{/form}} {{/panel}}\r\n  Exemple: {{#panel \"titlekey\"}} {{{#form}} {{/form}} {{/panel}}\r\n###\r\nHandlebars.registerHelper 'panel', (title, options)->\r\n    opt = (options or {}).hash or {}\r\n    if _.isObject(title)\r\n      options = title \r\n      title = undefined\r\n    editButton = ->\r\n      return if opt.edit then Handlebars.helpers.button_edit.call(@, {hash: {icon: \"pencil\"}}) else \"\"\r\n    saveButton = ->\r\n      return if opt.save then Handlebars.helpers.button_save.call(@, undefined, {hash: {icon: \"save\"}}) else \"\"\r\n    cancelButton = ->\r\n      return if opt.save then Handlebars.helpers.button_cancel.call(@, {hash: {icon: \"undo\"}}) else \"\"\r\n    title =  if not title? then \"\" else i18n.t(title)\r\n    html = \"<div class='panel panel-default'>\r\n          <div class='panel-heading'>#{title} #{editButton()} #{saveButton()} #{cancelButton()}</div>\r\n          <div class='panel-body'>#{options.fn(@)}</div>\r\n        </div>\"\r\n    return html\r\n###\r\n  Helper pour uniformiser l'utilisation des formulaires.\r\n  Exemple: {{#page \"page.title\" panelTitle=\"page.panel.title\"}} {{input_for \"firstName\"}} {{/page}}\r\n###\r\nHandlebars.registerHelper 'page', (title, options)->\r\n  options = options or {}\r\n  opt = options.hash or {}\r\n  console.error(\"noTitleInYourTemplate\")if not _.isString(title)    \r\n  html = \"\r\n      <h1>#{i18n.t(title)}</h1>\r\n      <div class='page-content'>\r\n        #{options.fn(@)}\r\n      </div>\r\n  \"\r\n  return html\r\n\r\n###\r\n  Helper pour uniformiser l'utilisation des formulaires.\r\n  Exemple: {{#criteria}}{{#form}} {{input_for \"firstName\"}} {{/form}}{{/criteria}}\r\n###\r\nHandlebars.registerHelper 'criteria', (title, options)->\r\n  options = options or {}\r\n  if _.isObject(title)\r\n      options = title \r\n      title = undefined\r\n    title =  if not title? then \"\" else i18n.t(title)\r\n  html = \"\r\n      <div class='criteria'>\r\n        <h2>#{title}</h2>\r\n        #{options.fn(@)}\r\n      </div>\r\n  \"\r\n  return html\r\n\r\n# Create the default _opening_ html for table result. Works as a tag.\r\n# Works with _close_result_table_ helper.\r\nHandlebars.registerHelper \"result\", (options)->\r\n  options = options or {}\r\n  opt = options.hash or {}\r\n  isTable = if opt.isTable? then opt.isTable else true\r\n  resultLabel = if opt.resultLabel then i18n.t(opt.resultLabel) else undefined\r\n  listTagName = if isTable then \"table\" else \"ul\"\r\n  elementTagName = if isTable then \"tr\" else \"li\"\r\n  striped = if opt.striped? then opt.stripped else true\r\n  cssClass = if isTable then defaults.cssClass.table else defaults.cssClass.list\r\n  if opt.cssClass? then cssClass= \"#{cssClass} opt.cssClass\"\r\n  if striped \r\n    cssClass = cssClass + \"  table-striped\"\r\n  # Generate the header actions.\r\n  tableHeaderActions = ()=>\r\n    showHeaderActions = if opt.showHeaderActions? then opt.showHeaderActions else true\r\n    return if showHeaderActions then \"#{Handlebars.helpers.tableHeaderAction.call(this, {hash:{resultLabel: '', exportUrl: this.exportUrl, resultLabel: resultLabel}})} <hr />\" else \"\"\r\n  # Render the pagination Pagination.\r\n  paginate = ()=>\r\n    isPaginate = if opt.isPaginate? then opt.isPaginate else true\r\n    if isPaginate\r\n      Handlebars.helpers.paginate.call(this, {hash:{showResultNumber:false}})\r\n    else \"\"\r\n  # Produce the html to render.\r\n  html = \" #{tableHeaderActions()}\r\n              <#{listTagName} class='#{cssClass}'>\r\n                #{options.fn(@)}\r\n              </#{listTagName}>\r\n            #{paginate()}\r\n          <div id='lineSelectionContainer'></div>\r\n  \"\r\n  return new Handlebars.SafeString(html)\r\n","/* name: spa-fmk , version: 0.1.3 description: Simple framework for backbone applications.*/ \n (function initialization(container) {var fmk = container.Fmk || {};fmk.name = 'spa-fmk';fmk.version = '0.1.3';container.Fmk = fmk;})(typeof module === 'undefined' && typeof window !== 'undefined' ? window : exports);","/*global window, _*/\r\n(function initialization(container) {\r\n  var fmk = container.Fmk || {};\r\n  _.extend(fmk, {\r\n    Models: {},\r\n    Views: {},\r\n    Services: {},\r\n    Helpers: {},\r\n    initialize: function initialize(options) {\r\n      this.Helpers.metadataBuilder.initialize(options);\r\n      this.Helpers.modelValidationPromise.initialize(options);\r\n      //this.Helpers.messageHelper.initialize();\r\n    }\r\n  });\r\n  container.Fmk = fmk;\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window : exports);","((NS) ->\r\n  \"use strict\"\r\n  # Filename: models/model.coffee\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  # Base class for all models. Define all transverses methods on the model.\r\n  class Collection extends Backbone.Collection\r\n    # The model name can be define.\r\n    modelName: undefined\r\n\r\n    \r\n    addModel: (model)->\r\n      if model.isNew()\r\n        @changes.creates[model.cid] = model.toSaveJSON()\r\n      else @updateModel(model)  \r\n    updateModel: (model)->\r\n      (delete @changes.deletes[model.cid]) if @changes.deletes[model.cid]?\r\n      @changes.updates[model.cid] = model.toSaveJSON()\r\n    deleteModel:(model) ->\r\n      if @changes.creates[model.cid]?\r\n        delete @changes.creates[model.cid]\r\n      if @changes.updates[model.cid]?\r\n        @changes.deletes[model.cid] = model.toSaveJSON()\r\n        delete @changes.updates[model.cid]\r\n    resetModels:(models) ->\r\n      #Reset the changes.\r\n      @changes = {\r\n        # The newly created models.\r\n        creates: {}\r\n        # The updated models.\r\n        updates: {}\r\n        # The deleted models.\r\n        deletes: {}\r\n      }\r\n      # Call add model foreach model.\r\n      models.forEach(@addModel, @)\r\n\r\n    initialize: (options)->\r\n      options = options or {}\r\n      # Changes inside the collection.\r\n      @changes = {\r\n        # The newly created models.\r\n        creates: {}\r\n        # The updated models.\r\n        updates: {}\r\n        # The deleted models.\r\n        deletes: {}\r\n      }\r\n      # Bind models events on order to track changes.\r\n      @on('add',(model)=> @addModel(model))\r\n      @on('remove', (model)=> @deleteModel(model))\r\n      @on('change', (model)=> @addModel(model))\r\n      @on('reset', (models)=> @resetModels(models))\r\n      # Add the collection elements if they are .\r\n      # @resetModels(options) if _.isArray(options)\r\n    # To json function.\r\n    toJSON: ->\r\n      jsonModel = super()\r\n      jsonModel.modelName =  @modelName or this.get('modelName')\r\n      return jsonModel\r\n      \r\n    # Return a json to Save constructed with the changes object.\r\n    toSaveJSON:(propertyPrefix) ->\r\n      propertyPrefix = propertyPrefix or \"coll\"\r\n      creates = \"#{propertyPrefix}Creates\"\r\n      updates = \"#{propertyPrefix}Updates\"\r\n      deletes = \"#{propertyPrefix}Deletes\"\r\n      labels = {};\r\n      labels[creates] = @changes.creates #_.map(@changes.creates, (value, key) -> return value);\r\n      labels[updates] = @changes.updates #_.map(@changes.updates, (value, key) -> return value);\r\n      labels[deletes] = @changes.deletes # _.map(@changes.deletes, (value, key) -> return value);\r\n      return labels\r\n    #Save the pervious collection values in order to restore it.\r\n    savePrevious: ->\r\n      @previousCollectionValues = @toJSON()\r\n    # Restore the previous attributes in the model.\r\n    restorePrevious: (options)->\r\n      options = options or {}\r\n      options.silent = options.isSilent or false\r\n      @reset(@previousCollectionValues, options)\r\n    # Tells if the previous model is different from the current.\r\n    isDifferent: ->\r\n      return not _.isEqual @previousCollectionValues, @toJSON()\r\n    ###\r\n      Set errors on a collection element.\r\n    ###\r\n    setErrors:(errors, options)->\r\n      if _.isArray(errors)\r\n        @setErrorsFromArray(errors, options) \r\n      else if _.isObject(errors)\r\n        @setErrorsFromObject(errors, options) \r\n    # Set the errors on the collection from an array of model.\r\n    setErrorsFromArray:(errors, options)->\r\n      for error in errors\r\n        console.warn('invalid error', error) if not error.index? and typeof error.index isnt \"number\" \r\n        console.warn('invalid error', error) if not error.errors? and typeof error.errors isnt \"object\"\r\n        \r\n        #For the model at the given position in the collection:\r\n        # Set the error depending on its index.\r\n        @at(error.index).set({\r\n            errors: error.errors\r\n        }, options)\r\n    setErrorsFromObject:(errors, options)->\r\n      for err of errors\r\n        console.warn('invalid error', err) if not _.isString(err)\r\n        @get(err).set({\r\n            errors: errors[err]\r\n        }, options)\r\n    # Unset errors.\r\n    unsetErrors: (options) ->\r\n      @forEach((mdl)-> mdl.unsetErrors(options))\r\n    jsonFromSaveJson:(saveJSON)->\r\n      changes = []\r\n      _.each(saveJSON.creates, (elt)->changes.push(elt))\r\n      _.each(saveJSON.updates, (elt)->changes.push(elt))\r\n      return changes;\r\n      \r\n  if isInBrowser\r\n    NS.Models = NS.Models or {}\r\n    NS.Models.Collection = Collection\r\n  else\r\n    module.exports = Collection\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)","/*global Backbone, window, module*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: models/headerItems.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\r\n  //Menu item model\r\n  var HeaderItem = Backbone.Model.extend({\r\n    defaults: {\r\n      cssId: \"\",\r\n      cssClass: \"\",\r\n      dataAttributes: \"\",\r\n      isActive: false,\r\n      name: undefined,\r\n      transalationKey: \"\",\r\n      url: \"#nav\"\r\n    },\r\n    initialize: function initializeMenuItem(options) {\r\n      options = options || {};\r\n      /*if(this.has('route')){\r\n        this.set({url: this.get('route')}, {silent: true});\r\n      }*/\r\n    },\r\n    //Change the active mode.\r\n    toggleActive: function toggleActive() {\r\n      this.set('isActive', !this.get('isActive'));\r\n    }\r\n  });\r\n\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Models = NS.Models || {};\r\n    NS.Models.HeaderItem = HeaderItem;\r\n  } else {\r\n    module.exports = HeaderItem;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global Backbone, window, module, _*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: models/menuItems.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var HeaderItem = isInBrowser ? NS.Models.HeaderItem : require('header-item');\r\n\r\n  //Notification model\r\n  var HeaderItems = Backbone.Collection.extend({\r\n    model: HeaderItem,\r\n    //Change the active mode.\r\n    changeActive: function changeActive(nodeName, options) {\r\n      if (nodeName === undefined || nodeName === this.currentActiveName) {\r\n        return;\r\n      }\r\n      //Get the current and the new active item.\r\n      var current = this.findWhere({\r\n        isActive: true\r\n      });\r\n      var newActive = this.findWhere({\r\n        name: nodeName\r\n      });\r\n\r\n      //Check if there is a change\r\n      if (current && newActive) {\r\n        current.set({\r\n          isActive: false\r\n        }, {silent: true});\r\n      }\r\n      if (newActive) {\r\n        newActive.set({\r\n          isActive: true\r\n        }, {silent: true});\r\n        this.currentActiveName = newActive.get('name');\r\n        this.parentName = this.processParentName();\r\n      }\r\n      this.trigger(\"change\");//Notify a change.\r\n    },\r\n    processParentName: function(){\r\n        if (this.currentActiveName === undefined) { return; }\r\n        var splitName = this.currentActiveName.split('.');\r\n        var res = '';\r\n        for(var i = 0, l = splitName.length -1 ; i < l ; i++ ){\r\n            res = res + splitName[i] + '.';\r\n        }if(res !== ''){\r\n            res = res.slice(0,-1);\r\n        }\r\n        return res;\r\n    },\r\n    //Define which part of the json is active.\r\n    toActiveJSON: function toActiveJSON(){\r\n      if(this.currentActiveName === undefined){return;}\r\n      var splitName = this.currentActiveName.split('.');\r\n      var res = '';\r\n      for(var i = 0, l = splitName.length -1 ; i < l ; i++ ){\r\n        res = res + splitName[i] + '.';\r\n      }if(res !== ''){\r\n        res = res.slice(0,-1);\r\n      }\r\n      return _.filter(this.toJSON(),function(element){return element.name.indexOf(res) === 0;});\r\n    }\r\n  });\r\n\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Models = NS.Models || {};\r\n    NS.Models.HeaderItems = HeaderItems;\r\n  } else {\r\n    module.exports = HeaderItems;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","((NS) ->\r\n  \"use strict\"\r\n  # Filename: models/model.coffee\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  # Base class for all models. Define all transverses methods on the model.\r\n  class Model extends Backbone.Model\r\n    defaultIfNew: undefined\r\n    # Initialize method of the model.\r\n    initialize: (options)->\r\n      options = options or {}\r\n      super options\r\n      @modelName = options.modelName if options.modelName?\r\n      if (this.has('id') and this.get('id') is 'new')\r\n        this.unset('id', {silent: true})\r\n        this.set('isNewModel', true, {silent: true})\r\n      else\r\n        this.set('isNewModel', false, {silent: true})\r\n      @savePrevious()\r\n      if(@isNew() and @defaultIfNew? )\r\n        this.set(@defaultIfNew, { silent: true })\r\n    #Define a method in order to be able to quickly remove errors form the model.\r\n    unsetErrors:(options) ->\r\n      options = options or {}\r\n      silent = options.silent or false\r\n      @unset('errors', {silent: silent})\r\n    #Define a setErrors method in order to quickly be able to set Errors.\r\n    setErrors:(errors) ->\r\n      @set({'errors': errors}) if errors?\r\n    # The model name can be define.\r\n    modelName: undefined\r\n    toJSON: ->\r\n      jsonModel = super()\r\n      jsonModel.cid = @cid\r\n      jsonModel.metadatas =  @metadatas\r\n      jsonModel.modelName =  @modelName or @get('modelName')\r\n      return jsonModel\r\n      \r\n    # Return a json to Save.\r\n    toSaveJSON: ->\r\n      Backbone.Model.prototype.toJSON.call(@)\r\n    # Return true if the model is inside a collection.\r\n    isInCollection: ->\r\n      return @collection?\r\n    # Save the previous attributes into the model.\r\n    savePrevious: ->\r\n      @perviousModelValues = @toSaveJSON()\r\n    # Restore the previous attributes in the model.\r\n    restorePrevious: (options)->\r\n      options = options or {}\r\n      options.silent = options.isSilent or false\r\n      @clear({silent: true})\r\n      @set(@perviousModelValues, options)\r\n    isDifferent: ->\r\n      return not _.isEqual @perviousModelValues, @toSaveJSON()\r\n  if isInBrowser\r\n    NS.Models = NS.Models or {}\r\n    NS.Models.Model = Model\r\n  else\r\n    module.exports = Model\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)\r\n","/*global Backbone, window, module*/\r\n\"use strict\";\r\n(function(NS) {\r\n  //Filename: models/notification.js\r\n  NS = NS || {};\r\n  //Dependency gestion depending on the fact that we are in the browser or in node.\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\r\n  //Notification model\r\n  /**\r\n   * [initialize description]\r\n   * @param  {[type]} )  {                 this.set({                   creationDate: new Date()                       } [description]\r\n   * @param  {[type]} {                                silent: true      });                      }  } [description]\r\n   * @return {[type]}    [description]\r\n   */\r\n  var Notification = Backbone.Model.extend({\r\n    defaults: {\r\n      /**\r\n       * [type description]\r\n       * @type {[type]}\r\n       */\r\n      type: undefined, //error/warning/success...\r\n      message: undefined, // The message which have to be display.\r\n      creationDate: undefined\r\n    },\r\n    /**\r\n     * Initialize the date of the notification.\r\n     * @return {undefined}\r\n     */\r\n    initialize: function initializeNotification() {\r\n      this.set({\r\n        creationDate: new Date()\r\n      }, {\r\n        silent: true\r\n      });\r\n    }\r\n  });\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Models = NS.Models || {};\r\n    NS.Models.Notification = Notification;\r\n  } else {\r\n    module.exports = Notification;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","\t/*global _, Backbone, window*/\r\n  \"use strict\";\r\n\t(function(NS) {\r\n\t\t// Filename: models/notifications.js\r\n\t\tNS = NS || {};\r\n\t\t//Dependency gestion depending on the fact that we are in the browser or in node.\r\n\t\tvar isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\t\tvar Notification = isInBrowser ? NS.Models.Notification : require('./notification');\r\n\r\n\t\t//This collection will contains all the message which will be display in the application.\r\n\t\tvar Notifications = Backbone.Collection.extend({\r\n\t\t\tmodel: Notification,\r\n\t\t\t// Return a constructed object filtered by error type.\r\n\t\t\tgetMessagesByType: function filterByTypeMessage() {\r\n\t\t\t\tvar jsonCollection = this.toJSON();\r\n\t\t\t\tvar messages = {};\r\n\t\t\t\tmessages.errorMessages = _.where(jsonCollection, {\r\n\t\t\t\t\t'type': 'error'\r\n\t\t\t\t});\r\n\t\t\t\tmessages.warningMessages = _.where(jsonCollection, {\r\n\t\t\t\t\t'type': 'warning'\r\n\t\t\t\t});\r\n\t\t\t\tmessages.infoMessages = _.where(jsonCollection, {\r\n\t\t\t\t\t'type': 'info'\r\n\t\t\t\t});\r\n\t\t\t\tmessages.successMessages = _.where(jsonCollection, {\r\n\t\t\t\t\t'type': 'success'\r\n\t\t\t\t});\r\n\t\t\t\treturn messages;\r\n\t\t\t},\r\n\t\t\t//Create a comparatot method in order to be able to sort them on their type\r\n\t\t\tcomparator: function comparator(notification) {\r\n\t\t\t\treturn notification.get(\"creationDate\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Differenciating export for node or browser.\r\n\t\tif (isInBrowser) {\r\n\t\t\tNS.Models = NS.Models || {};\r\n\t\t\tNS.Models.Notifications = Notifications;\r\n\t\t} else {\r\n\t\t\tmodule.exports = Notifications;\r\n\t\t}\r\n\t})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global window */\r\n(function(NS) {\r\n \"use strict\";\r\n  // Filename: models/paginatedCollection.js\r\n  NS = NS || {};\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"../helpers/custom_exception\").ArgumentInvalidException;\r\n  var Collection = isInBrowser ? NS.Models.Collection : require('./collection');\r\n\r\n // Paginated collection.\r\n  var PaginatedCollection = Collection.extend({\r\n      //first number of page\r\n      firstPage: 1,\r\n      //the page loaded\r\n      currentPage: 1,\r\n      // number of records par page\r\n      perPage: 10,\r\n      // total number og pages. default initialization\r\n      totalPages: 10,\r\n      //sort fields\r\n      sortField: {},\r\n      // export column labels\r\n      exportColumnLabels: {},\r\n      initialize: function initializePagiatedCollection(options) {\r\n          Collection.prototype.initialize.call(this, options);\r\n          if (this.sortField !== undefined && this.sortField.field !== undefined) {\r\n              this.setSortField(this.sortField.field, this.sortField.order);\r\n          }\r\n      },\r\n      setPageInfo: function setPageInfo(pageInfos){\r\n        this.totalRecords = pageInfos.totalRecords;\r\n        this.currentPage = pageInfos.currentPage;\r\n        this.firstPage = pageInfos.firstPage;\r\n        this.lastPage = pageInfos.lastPage;\r\n        this.perPage = pageInfos.perPage;\r\n        this.sortField = pageInfos.sortField;\r\n      },\r\n      pageInfo: function pageInfo() {\r\n          var info = {\r\n              // If parse() method is implemented and totalRecords is set to the length\r\n              // of the records returned, make it available. Else, default it to 0\r\n              totalRecords: this.totalRecords || 0,\r\n              currentPage: this.currentPage,\r\n              firstPage: this.firstPage,\r\n              totalPages: Math.ceil(this.totalRecords / this.perPage),\r\n              lastPage: this.totalPages, // should use totalPages in template\r\n              perPage: this.perPage,\r\n              previous: false,\r\n              next: false,\r\n              sortField: this.sortField\r\n          };\r\n\r\n          if (this.currentPage > 1) {\r\n              info.previous = this.currentPage - 1;\r\n          }\r\n\r\n          if (this.currentPage < info.totalPages) {\r\n              info.next = this.currentPage + 1;\r\n          }\r\n\r\n          // left around for backwards compatibility\r\n          info.hasNext = info.next;\r\n          info.hasPrevious = info.next;\r\n\r\n          this.information = info;\r\n          return info;\r\n      },\r\n\r\n      setPage: function setPage(page) {\r\n          page = page || 1;\r\n          this.currentPage = page;\r\n      },\r\n\r\n      setPerPage: function setPerPage(perPage) {\r\n          perPage = perPage || 10;\r\n          this.perPage = perPage;\r\n      },\r\n\r\n      setNextPage: function setNextPage() {\r\n          //TODO : controller si pas de page suivante\r\n          this.currentPage++;\r\n      },\r\n\r\n      setPreviousPage: function setPreviousPage() {\r\n          //TODO: controller si pas de page prcedente\r\n          this.currentPage--;\r\n      },\r\n\r\n      setSortField: function setSortField(field, order) {\r\n          order = order || \"asc\";\r\n          if (field === undefined || (order !== \"asc\" && order !== \"desc\")) {\r\n              throw new ArgumentInvalidException(\"sort arguments invalid\");\r\n          }\r\n          this.sortField = {\r\n              field: field,\r\n              order: order\r\n          };\r\n\r\n          this.currentPage = this.firstPage;\r\n      },\r\n\r\n      setTotalRecords: function setTotalRecords(totalRecords) {\r\n          this.totalRecords = totalRecords;\r\n      }\r\n  });\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Models = NS.Models || {};\r\n    NS.Models.PaginatedCollection = PaginatedCollection;\r\n  } else {\r\n    module.exports = PaginatedCollection;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","#global $, _\r\n\"use strict\"\r\n((NS) ->\r\n  # Filename: lib/templates/view_helper/template_helper.coffee */\r\n  NS = NS or {}\r\n  isInBrowser = typeof module is 'undefined' and typeof window isnt 'undefined'\r\n  \r\n  # Other module dependencies.\r\n  metadataBuilder = if isInBrowser then NS.Helpers.metadataBuilder else require('../../helpers/metadata_builder').metadataBuilder\r\n  \r\n  # Dependency on the configuration.\r\n  domains_definition = undefined\r\n  \r\n  # Default options\r\n  isDateHTML5 = true\r\n  gridSize = 12\r\n  defaultLabelSize = 3\r\n  defaultInputSize =  8\r\n\r\n  #initialize the template helper.\r\n  configure: (options)->\r\n    domains_definition = options.domains\r\n    isDateHTML5 = options.isDateHTML5 or isDateHTML5\r\n    gridSize = options.gridSize or gridSize\r\n    defaultLabelSize = options.labelSize\r\n    defaultInputSize = options.inputSize or defaultInputSize\r\n\r\n  #S4  \r\n  S4 = ->\r\n    (((1 + Math.random()) * 0x10000) | 0).toString(16).substring 1\r\n\r\n  #Generate a pseudo-GUID by concatenating random hexadecimal.  \r\n  guid = ->\r\n    S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4()\r\n  \r\n  #Container for all the fields helpers. display_for, input_for, option_selected\r\n  fieldHelpers = {}\r\n  fieldHelpers.process = (property,options, context)->\r\n    options = options or {}\r\n    result = {}\r\n    fieldHelpers.processMetadatas(property,options, result, context)\r\n    fieldHelpers.processDomain(property,options, result, context)\r\n    fieldHelpers.processOptions(property,options, result, context)\r\n\r\n\r\n    \r\n  # Process all options which are givent to the field helper.\r\n  fieldHelpers.processOption = (property,options, result, context)->\r\n    opt = options\r\n    metadata = result.metadata\r\n    result.options = optionsHelpers.process(opt, metadata)\r\n    return result.options\r\n  # Process all options which are givent to the field helper.\r\n  fieldHelpers.processMetadatas = (property,options, result, context)->\r\n    result.metadata = metadataBuilder.getMetadataForAttribute(context,property)\r\n    return result.metadata\r\n\r\n  # Process all options which are givent to the field helper.\r\n  fieldHelpers.processDomain = (property,options, result, context)->\r\n    result.domain = domains_definition[result.metadata.domain] or {}\r\n    return result.domain\r\n  fieldHelpers.processInputPropertyValue = (property,options, result, context)->\r\n     if context[property]?\r\n      propValue = context[property]\r\n      metadata = result.metadata\r\n      if metadata.format?\r\n        propValue =  metadata.format(propValue)\r\n      if dataType is \"checkbox\"\r\n        if propValue then return 'checked'\r\n      if dataType is \"date\" and propValue isnt \"\"\r\n        return \"value='\" + propValue + \"'\"\r\n      else return \"value='#{_.escape(propValue)}'\"\r\n    return \"\"\r\n  # Process the label translation.\r\n  fieldHelpers.processTranslation = (property, options, result, context)->\r\n    throw new Error('i18n is not defined') if not i18n? \r\n    metadata = result.metadata\r\n    translationRoot = result.options.translationRoot\r\n    translation = metadata.label or (\"#{context['modelName']}.#{property}\" if context['modelName']?) or \"\"\r\n    if translationRoot?\r\n      translation = ((if (translationRoot?) and typeof translationRoot is \"string\" then translationRoot + \".\" else \"\")) + property\r\n    result.translation =  if(translation is \"\") then \"\" else i18n.t(translation)\r\n    return result.translation\r\n  htmlHelpers = {}\r\n  #Deal with the icon case\r\n  htmlHelpers.processIcon =(property, options, result, context)->\r\n    #<span class='glyphicon glyphicon-#{opt.icon}'></span>\r\n    return if result.params.icon? then \"<span class='input-group-addon'><i class='fa fa-#{result.params.icon}  fa-fw'></i> </span>\" else \"\"\r\n\r\n  #Process the labels.\r\n  htmlHelpers.processLabel =(property, options, result, context)->\r\n    opt = result.params\r\n    if opt.isNoLabel?\r\n      return \"\"\r\n    else\r\n      return \"<label class='control-label #{opt.labelSize}' for='#{property}'>#{result.translation}</label>\"\r\n  \r\n  #Todo:\r\n  htmlHelpers.processErrors =(property, options, result, context)->\r\n    #tofdo: move into form size calculation.\r\n    error = \"\"\r\n    error = \"has-error\" if @errors? and @errors[property]?\r\n    errorValue = if @errors? and @errors[property]? then @errors[property] else \"\"\r\n    errorSize = ()=>\r\n      errorLength = gridSize - labelSizeValue\r\n      offsetError = labelSizeValue\r\n      return \"col-sm-#{errorLength} col-md-#{errorLength} col-lg-#{errorLength} col-sm-offset-#{offsetError} col-md-offset-#{offsetError} col-lg-offset-#{offsetError}\"\r\n    #Deal with error\r\n    errors = ()=>\r\n      if error == \"has-error\" then \"<span class='#{error} #{errorSize()} help-inline pull-left' style='color:#b94a48'> #{errorValue } </span>\" else \"\"\r\n    return errors()\r\n  \r\n  #Container for the options helper.\r\n  optionsHelpers = {}\r\n\r\n  #Process all options helpers.\r\n  optionsHelpers.process = (opt, metadata)->\r\n    options = {\r\n      required: optionsHelpers.required(opt, metadata),\r\n      symbol: optionsHelpers.symbol(opt, metadata),\r\n      dataType: optionsHelpers.dataType(opt, metadata),\r\n      readonly: optionsHelpers.readonly(opt, metadata),\r\n      formSize: optionsHelpers.formSize(opt, metadata),\r\n      isNoLabel: opt.isNoLabel,\r\n      isAddOnInput: optionsHelpers.isAddOnInput(opt, metadata)\r\n      translationRoot: opt.translationRoot or undefined\r\n      icon: opt.icon\r\n    }\r\n    return options\r\n\r\n  #If a field is required by its metadata or with the view helper definition, a * is return.\r\n  optionsHelpers.required = (opt, metadata)->\r\n    required = undefined\r\n    if opt.isRequired?\r\n      required = if opt.isRequired then \"*\" else undefined\r\n    else if metadata.required?\r\n      required = if opt.isRequired then \"*\" else undefined\r\n    return required\r\n  \r\n  # If a symbol is define in the metadata or in the view helper, it will be display.\r\n  optionsHelpers.symbol = (opt, metadata)->\r\n    symbol = undefined\r\n    if opt.symbol?\r\n      symbol = opt.symbol\r\n    else if metadata.symbol?\r\n      symbol = metadata.symbol\r\n    return symbol\r\n  \r\n  #Process the datatype, mainly use into html5 fields.\r\n  optionsHelpers.dataType = (opt, metadata)->\r\n    dataType = opt.dataType or domain.type or \"text\"\r\n    if dataType is \"boolean\"\r\n      dataType = \"checkbox\"\r\n    else if dataType is \"date\"  \r\n      (dataType = \"text\") if not isDateHTML5\r\n    return dataType\r\n\r\n  # Process the readonly attribute\r\n  optionsHelpers.readonly = (opt, metadata)->\r\n    readonly = opt.readonly or false\r\n    readonly = if readonly then \"readonly\" else \"\"\r\n  \r\n  # Check if a field is disable or not. \r\n  optionsHelpers.disabled = (opt, metadata)->\r\n    disabled = opt.disabled or false\r\n    disabled = if disabled then \"disabled\" else \"\"\r\n  \r\n  #Formsize processing: label, input.\r\n  optionsHelpers.formSize = (opt, metadata)->\r\n    size = {}\r\n    # Process the label size.\r\n    size.label = if opt.isNoLabel then 0 else if opt.labelSize then opt.labelSize else defaultLabelSize\r\n    # Process the input size.\r\n    if opt.containerCss\r\n      size.input = \"\"\r\n    else\r\n      size.input  = gridSize - size.label\r\n    return size\r\n  #Define if an input needs a addon.\r\n  optionsHelpers.isAddOnInput = (opt, metadata)->\r\n    return true or opt.icon? or ((opt.isRequired || metadata.required)) is true or ((opt.symbol || metadata.symbol))?\r\n\r\n\r\n    return size\r\n  \r\n  # All methods which has to be displayed to the module.\r\n  mod = {\r\n    guid: guid,\r\n    processField: process\r\n  }\r\n  if isInBrowser\r\n    NS.Helpers = NS.Helpers or {}\r\n    NS.Templates.helpers = mod\r\n  else\r\n    module.exports = mod\r\n)(if typeof module is 'undefined' and typeof window isnt 'undefined' then window.Fmk else module.exports)","#use in order to debug a template.\r\nHandlebars.registerHelper \"debug\", (optionalValue) ->\r\n  console.log \"Current Context\"\r\n  console.log \"====================\"\r\n  console.log this\r\n  if optionalValue\r\n    console.log \"Value\"\r\n    console.log \"====================\"\r\n    console.log optionalValue\r\n###\r\nExample call:\r\n\t- debug the current this\r\n\t```{{debug}}```\r\n\t- debug a value ant the this\r\n\t```{{debug option1=\"test\" option2=\"test2\"```\r\n###","# Filename: lib/templates/view_helper/pick.coffee\r\n# Pick a data.\r\nHandlebars.registerHelper 'pick', (val, options) ->\r\n  return options.hash[val]","# Filename: lib/templates/view_helper/translate.coffee\r\n#Use this helper in order to use the translation system in the view. It has a dependency on i18next.js.\r\nHandlebars.registerHelper \"t\", (i18n_key, options) ->\r\n  opt = options.hash or {}\r\n  maxLength = opt.max\r\n  result = i18n.t(i18n_key)\r\n  if maxLength? and maxLength < result.length then result = \"#{result.slice(0,+maxLength)}...\"\r\n  new Handlebars.SafeString(result)\r\n###\r\nExample call: (inside an hbs file)\r\n\t{{t \"contact.firstName\"}}\r\n###","(function() {\r\n  \"use strict\";\r\n  (function(NS) {\r\n    var S4, defaultInputSize, defaultLabelSize, domains_definition, fieldHelpers, gridSize, guid, htmlHelpers, isDateHTML5, isInBrowser, metadataBuilder, mod, optionsHelpers;\r\n    NS = NS || {};\r\n    isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    metadataBuilder = isInBrowser ? NS.Helpers.metadataBuilder : require('../../helpers/metadata_builder').metadataBuilder;\r\n    domains_definition = void 0;\r\n    isDateHTML5 = true;\r\n    gridSize = 12;\r\n    defaultLabelSize = 3;\r\n    defaultInputSize = 8;\r\n    ({\r\n      configure: function(options) {\r\n        domains_definition = options.domains;\r\n        isDateHTML5 = options.isDateHTML5 || isDateHTML5;\r\n        gridSize = options.gridSize || gridSize;\r\n        defaultLabelSize = options.labelSize;\r\n        return defaultInputSize = options.inputSize || defaultInputSize;\r\n      }\r\n    });\r\n    S4 = function() {\r\n      return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n    };\r\n    guid = function() {\r\n      return S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4();\r\n    };\r\n    fieldHelpers = {};\r\n    fieldHelpers.process = function(property, options, context) {\r\n      var result;\r\n      options = options || {};\r\n      result = {};\r\n      fieldHelpers.processMetadatas(property, options, result, context);\r\n      fieldHelpers.processDomain(property, options, result, context);\r\n      return fieldHelpers.processOptions(property, options, result, context);\r\n    };\r\n    fieldHelpers.processOption = function(property, options, result, context) {\r\n      var metadata, opt;\r\n      opt = options;\r\n      metadata = result.metadata;\r\n      result.options = optionsHelpers.process(opt, metadata);\r\n      return result.options;\r\n    };\r\n    fieldHelpers.processMetadatas = function(property, options, result, context) {\r\n      result.metadata = metadataBuilder.getMetadataForAttribute(context, property);\r\n      return result.metadata;\r\n    };\r\n    fieldHelpers.processDomain = function(property, options, result, context) {\r\n      result.domain = domains_definition[result.metadata.domain] || {};\r\n      return result.domain;\r\n    };\r\n    fieldHelpers.processInputPropertyValue = function(property, options, result, context) {\r\n      var metadata, propValue;\r\n      if (context[property] != null) {\r\n        propValue = context[property];\r\n        metadata = result.metadata;\r\n        if (metadata.format != null) {\r\n          propValue = metadata.format(propValue);\r\n        }\r\n        if (dataType === \"checkbox\") {\r\n          if (propValue) {\r\n            return 'checked';\r\n          }\r\n        }\r\n        if (dataType === \"date\" && propValue !== \"\") {\r\n          return \"value='\" + propValue + \"'\";\r\n        } else {\r\n          return \"value='\" + (_.escape(propValue)) + \"'\";\r\n        }\r\n      }\r\n    };\r\n    return \"\";\r\n    fieldHelpers.processTranslation = function(property, options, result, context) {\r\n      var metadata, translation, translationRoot;\r\n      if (typeof i18n === \"undefined\" || i18n === null) {\r\n        throw new Error('i18n is not defined');\r\n      }\r\n      metadata = result.metadata;\r\n      translationRoot = result.options.translationRoot;\r\n      translation = metadata.label || (context['modelName'] != null ? \"\" + context['modelName'] + \".\" + property : void 0) || \"\";\r\n      if (translationRoot != null) {\r\n        translation = ((translationRoot != null) && typeof translationRoot === \"string\" ? translationRoot + \".\" : \"\") + property;\r\n      }\r\n      result.translation = translation === \"\" ? \"\" : i18n.t(translation);\r\n      return result.translation;\r\n    };\r\n    htmlHelpers = {};\r\n    htmlHelpers.processIcon = function(property, options, result, context) {\r\n      if (result.params.icon != null) {\r\n        return \"<span class='input-group-addon'><i class='fa fa-\" + result.params.icon + \"  fa-fw'></i> </span>\";\r\n      } else {\r\n        return \"\";\r\n      }\r\n    };\r\n    htmlHelpers.processLabel = function(property, options, result, context) {\r\n      var opt;\r\n      opt = result.params;\r\n      if (opt.isNoLabel != null) {\r\n        return \"\";\r\n      } else {\r\n        return \"<label class='control-label \" + opt.labelSize + \"' for='\" + property + \"'>\" + result.translation + \"</label>\";\r\n      }\r\n    };\r\n    htmlHelpers.processErrors = function(property, options, result, context) {\r\n      var error, errorSize, errorValue, errors;\r\n      error = \"\";\r\n      if ((this.errors != null) && (this.errors[property] != null)) {\r\n        error = \"has-error\";\r\n      }\r\n      errorValue = (this.errors != null) && (this.errors[property] != null) ? this.errors[property] : \"\";\r\n      errorSize = (function(_this) {\r\n        return function() {\r\n          var errorLength, offsetError;\r\n          errorLength = gridSize - labelSizeValue;\r\n          offsetError = labelSizeValue;\r\n          return \"col-sm-\" + errorLength + \" col-md-\" + errorLength + \" col-lg-\" + errorLength + \" col-sm-offset-\" + offsetError + \" col-md-offset-\" + offsetError + \" col-lg-offset-\" + offsetError;\r\n        };\r\n      })(this);\r\n      errors = (function(_this) {\r\n        return function() {\r\n          if (error === \"has-error\") {\r\n            return \"<span class='\" + error + \" \" + (errorSize()) + \" help-inline pull-left' style='color:#b94a48'> \" + errorValue + \" </span>\";\r\n          } else {\r\n            return \"\";\r\n          }\r\n        };\r\n      })(this);\r\n      return errors();\r\n    };\r\n    optionsHelpers = {};\r\n    optionsHelpers.process = function(opt, metadata) {\r\n      var options;\r\n      options = {\r\n        required: optionsHelpers.required(opt, metadata),\r\n        symbol: optionsHelpers.symbol(opt, metadata),\r\n        dataType: optionsHelpers.dataType(opt, metadata),\r\n        readonly: optionsHelpers.readonly(opt, metadata),\r\n        formSize: optionsHelpers.formSize(opt, metadata),\r\n        isNoLabel: opt.isNoLabel,\r\n        isAddOnInput: optionsHelpers.isAddOnInput(opt, metadata),\r\n        translationRoot: opt.translationRoot || void 0,\r\n        icon: opt.icon\r\n      };\r\n      return options;\r\n    };\r\n    optionsHelpers.required = function(opt, metadata) {\r\n      var required;\r\n      required = void 0;\r\n      if (opt.isRequired != null) {\r\n        required = opt.isRequired ? \"*\" : void 0;\r\n      } else if (metadata.required != null) {\r\n        required = opt.isRequired ? \"*\" : void 0;\r\n      }\r\n      return required;\r\n    };\r\n    optionsHelpers.symbol = function(opt, metadata) {\r\n      var symbol;\r\n      symbol = void 0;\r\n      if (opt.symbol != null) {\r\n        symbol = opt.symbol;\r\n      } else if (metadata.symbol != null) {\r\n        symbol = metadata.symbol;\r\n      }\r\n      return symbol;\r\n    };\r\n    optionsHelpers.dataType = function(opt, metadata) {\r\n      var dataType;\r\n      dataType = opt.dataType || domain.type || \"text\";\r\n      if (dataType === \"boolean\") {\r\n        dataType = \"checkbox\";\r\n      } else if (dataType === \"date\") {\r\n        if (!isDateHTML5) {\r\n          dataType = \"text\";\r\n        }\r\n      }\r\n      return dataType;\r\n    };\r\n    optionsHelpers.readonly = function(opt, metadata) {\r\n      var readonly;\r\n      readonly = opt.readonly || false;\r\n      return readonly = readonly ? \"readonly\" : \"\";\r\n    };\r\n    optionsHelpers.disabled = function(opt, metadata) {\r\n      var disabled;\r\n      disabled = opt.disabled || false;\r\n      return disabled = disabled ? \"disabled\" : \"\";\r\n    };\r\n    optionsHelpers.formSize = function(opt, metadata) {\r\n      var size;\r\n      size = {};\r\n      size.label = opt.isNoLabel ? 0 : opt.labelSize ? opt.labelSize : defaultLabelSize;\r\n      if (opt.containerCss) {\r\n        size.input = \"\";\r\n      } else {\r\n        size.input = gridSize - size.label;\r\n      }\r\n      return size;\r\n    };\r\n    optionsHelpers.isAddOnInput = function(opt, metadata) {\r\n      return true || (opt.icon != null) || (opt.isRequired || metadata.required) === true || ((opt.symbol || metadata.symbol) != null);\r\n      return size;\r\n    };\r\n    mod = {\r\n      guid: guid,\r\n      processField: process\r\n    };\r\n    if (isInBrowser) {\r\n      NS.Helpers = NS.Helpers || {};\r\n      return NS.Templates.helpers = mod;\r\n    } else {\r\n      return module.exports = mod;\r\n    }\r\n  })(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);\r\n\r\n}).call(this);\r\n\r\n(function() {\r\n  Handlebars.registerHelper(\"debug\", function(optionalValue) {\r\n    console.log(\"Current Context\");\r\n    console.log(\"====================\");\r\n    console.log(this);\r\n    if (optionalValue) {\r\n      console.log(\"Value\");\r\n      console.log(\"====================\");\r\n      return console.log(optionalValue);\r\n    }\r\n  });\r\n\r\n\r\n  /*\r\n  Example call:\r\n  \t- debug the current this\r\n  \t```{{debug}}```\r\n  \t- debug a value ant the this\r\n  \t```{{debug option1=\"test\" option2=\"test2\"```\r\n   */\r\n\r\n}).call(this);\r\n\r\n(function() {\r\n  Handlebars.registerHelper('pick', function(val, options) {\r\n    return options.hash[val];\r\n  });\r\n\r\n}).call(this);\r\n\r\n(function() {\r\n  Handlebars.registerHelper(\"t\", function(i18n_key, options) {\r\n    var maxLength, opt, result;\r\n    opt = options.hash || {};\r\n    maxLength = opt.max;\r\n    result = i18n.t(i18n_key);\r\n    if ((maxLength != null) && maxLength < result.length) {\r\n      result = \"\" + (result.slice(0, +maxLength)) + \"...\";\r\n    }\r\n    return new Handlebars.SafeString(result);\r\n  });\r\n\r\n\r\n  /*\r\n  Example call: (inside an hbs file)\r\n  \t{{t \"contact.firstName\"}}\r\n   */\r\n\r\n}).call(this);\r\n","this[\"Fmk\"] = this[\"Fmk\"] || {};\nthis[\"Fmk\"][\"templates\"] = this[\"Fmk\"][\"templates\"] || {};\nthis[\"Fmk\"][\"templates\"][\"header\"] = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  return \"<div class=\\\"navbar-static-top header\\\">\\r\\n  \\r\\n</div>\\r\\n<div>\\r\\n  <i class=\\\"fa fa-spinner fa-spin hidden\\\" id='ajaxIndicator'></i>\\r\\n</div>\";\n  },\"useData\":true});;\nthis[\"Fmk\"] = this[\"Fmk\"] || {};\nthis[\"Fmk\"][\"templates\"] = this[\"Fmk\"][\"templates\"] || {};\nthis[\"Fmk\"][\"templates\"][\"headerItems\"] = Handlebars.template({\"1\":function(depth0,helpers,partials,data) {\n  var stack1, helper, functionType=\"function\", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = \"             <li id='\"\n    + escapeExpression(((helper = (helper = helpers.cssId || (depth0 != null ? depth0.cssId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"cssId\",\"hash\":{},\"data\":data}) : helper)))\n    + \"' class=\\\"\"\n    + escapeExpression(((helper = (helper = helpers.cssClass || (depth0 != null ? depth0.cssClass : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"cssClass\",\"hash\":{},\"data\":data}) : helper)))\n    + \" \";\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.isActive : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(2, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"\\\" \"\n    + escapeExpression(((helper = (helper = helpers.dataAttributes || (depth0 != null ? depth0.dataAttributes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"dataAttributes\",\"hash\":{},\"data\":data}) : helper)))\n    + \" >\\r\\n                <a href=\\\"\"\n    + escapeExpression(((helper = (helper = helpers.route || (depth0 != null ? depth0.route : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"route\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\">\"\n    + escapeExpression(((helpers.t || (depth0 && depth0.t) || helperMissing).call(depth0, (depth0 != null ? depth0.name : depth0), {\"name\":\"t\",\"hash\":{\n    'suffix': (\".title\"),\n    'prefix': (\"header.\")\n  },\"data\":data})))\n    + \"</a>\\r\\n             </li>\\r\\n\";\n},\"2\":function(depth0,helpers,partials,data) {\n  return \"active\";\n  },\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"<div class=\\\"navbar-default\\\">\\r\\n    <div class=\\\"container\\\">\\r\\n      <div class=\\\"navbar-header\\\">\\r\\n        <button type=\\\"button\\\" class=\\\"navbar-toggle\\\" data-toggle=\\\"collapse\\\" data-target=\\\".navbar-collapse\\\">\\r\\n          <span class=\\\"icon-bar\\\"></span>\\r\\n          <span class=\\\"icon-bar\\\"></span>\\r\\n          <span class=\\\"icon-bar\\\"></span>\\r\\n        </button>\\r\\n        <a class=\\\"navbar-brand\\\" href=\\\"#\\\"></a>\\r\\n      </div>\\r\\n      <div class=\\\"navbar-collapse collapse\\\" >\\r\\n        <ul class=\\\"nav navbar-nav\\\">\\r\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.headerItems : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"    </ul>\\r\\n  </div>\\r\\n</div>\";\n},\"useData\":true});;\nthis[\"Fmk\"] = this[\"Fmk\"] || {};\nthis[\"Fmk\"][\"templates\"] = this[\"Fmk\"][\"templates\"] || {};\nthis[\"Fmk\"][\"templates\"][\"modalSkeleton\"] = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n  return \"<!-- Modal -->\\r\\n<div class=\\\"modal fade\\\" data-modal  datatabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"myModalLabel\\\" aria-hidden=\\\"true\\\">\\r\\n  <div class=\\\"modal-dialog\\\">\\r\\n    <div class=\\\"modal-content\\\">\\r\\n      <div class=\\\"modal-header\\\">\\r\\n        <button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\">&times;</button>\\r\\n        <h4 class=\\\"modal-title\\\" id=\\\"myModalLabel\\\">\"\n    + escapeExpression(((helpers.t || (depth0 && depth0.t) || helperMissing).call(depth0, \"title\", {\"name\":\"t\",\"hash\":{\n    'keyInContext': (true)\n  },\"data\":data})))\n    + \"</h4>\\r\\n      </div>\\r\\n      <div class=\\\"modal-body\\\" data-modal-content>\\r\\n      </div>\\r\\n      <div class=\\\"modal-footer\\\">\\r\\n        <button type=\\\"button\\\" class=\\\"btn btn-default\\\" data-dismiss=\\\"modal\\\">\"\n    + escapeExpression(((helpers.t || (depth0 && depth0.t) || helperMissing).call(depth0, \"button.modalClose\", {\"name\":\"t\",\"hash\":{},\"data\":data})))\n    + \"</button>\\r\\n        <button type=\\\"button\\\" class=\\\"btn btn-primary\\\" data-close=\\\"modal\\\">\"\n    + escapeExpression(((helpers.t || (depth0 && depth0.t) || helperMissing).call(depth0, \"button.modalSave\", {\"name\":\"t\",\"hash\":{},\"data\":data})))\n    + \"</button>\\r\\n      </div>\\r\\n    </div>\\r\\n  </div>\\r\\n</div>\";\n},\"useData\":true});;\nthis[\"Fmk\"] = this[\"Fmk\"] || {};\nthis[\"Fmk\"][\"templates\"] = this[\"Fmk\"][\"templates\"] || {};\nthis[\"Fmk\"][\"templates\"][\"noResults\"] = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var helper, functionType=\"function\", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n  return \"<div class=\\\"noResults\\\">\"\n    + escapeExpression(((helper = (helper = helpers.message || (depth0 != null ? depth0.message : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"message\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</div>\";\n},\"useData\":true});;\nthis[\"Fmk\"] = this[\"Fmk\"] || {};\nthis[\"Fmk\"][\"templates\"] = this[\"Fmk\"][\"templates\"] || {};\nthis[\"Fmk\"][\"templates\"][\"notifications\"] = Handlebars.template({\"1\":function(depth0,helpers,partials,data) {\n  var helper, functionType=\"function\", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n  return \"    <strong>\"\n    + escapeExpression(((helper = (helper = helpers.message || (depth0 != null ? depth0.message : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"message\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</strong><br />\\r\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var stack1, helper, functionType=\"function\", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = \"<div class='alert alert-\"\n    + escapeExpression(((helper = (helper = helpers.cssMessageType || (depth0 != null ? depth0.cssMessageType : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"cssMessageType\",\"hash\":{},\"data\":data}) : helper)))\n    + \"'>\\r\\n  <button type='button' class='close' data-dismiss='alert'>&times;</button>\\r\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.messages : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</div>\";\n},\"useData\":true});;\nthis[\"Fmk\"] = this[\"Fmk\"] || {};\nthis[\"Fmk\"][\"templates\"] = this[\"Fmk\"][\"templates\"] || {};\nthis[\"Fmk\"][\"templates\"][\"spinner\"] = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n  return \"<div class='spinner-container'>\\r\\n       <div class='spinner'>\\r\\n          <div class=\\\"three-quarters\\\">\\r\\n            \"\n    + escapeExpression(((helpers.t || (depth0 && depth0.t) || helperMissing).call(depth0, \"application.loading\", {\"name\":\"t\",\"hash\":{},\"data\":data})))\n    + \"\\r\\n          </div>\\r\\n       </div>\\r\\n   </div>\";\n},\"useData\":true});;","/*global Backbone, window*/\r\n//var template = require(\"../template/collection-pagination\");\r\n(function(NS) {\r\n  //Filename: views/collection-pagination-view.js\r\n  \"use strict\";\r\n  NS = NS || {};\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var CollectionPaginationView = Backbone.View.extend({\r\n    Service: undefined,\r\n    initialize: function initializePagination() {\r\n\r\n    },\r\n    events: {},\r\n    goToPage: function goToPage(page) {\r\n      this.model.setPage(page);\r\n    },\r\n    nextPage: function nextPage() {\r\n      this.model.setNextPage();\r\n    },\r\n    previousPage: function PreviousPage() {\r\n      this.model.setPreviousPage();\r\n    },\r\n    render: function renderPagination() {\r\n      if (this.model.length === 0) {\r\n        this.$el.html(\"\");\r\n      } else {\r\n        this.$el.html(this.template(this.model.pageInfo()));\r\n      }\r\n    }\r\n  });\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Views = NS.Views || {};\r\n    NS.Views.CollectionPaginationView = CollectionPaginationView;\r\n  } else {\r\n    module.exports = CollectionPaginationView;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global  $, window, _, Promise*/\r\n(function (NS) {\r\n    \"use strict\";\r\n    // Filename: views/list-view.js\r\n    NS = NS || {};\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    //var NotImplementedException = isInBrowser ? NS.Helpers.Exceptions.NotImplementedException : require('../helpers/custom_exception').NotImplementedException;\r\n    var ConsultEditView = isInBrowser ? NS.Views.ConsultEditView : require('./consult-edit-view');\r\n    var errorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var formHelper = isInBrowser ? NS.Helpers.formHelper : require('../helpers/form_helper');\r\n    var utilHelper = isInBrowser ? NS.Helpers.utilHelper : require('../helpers/util_helper');\r\n    var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"../helpers/custom_exception\").ArgumentNullException;\r\n    var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"../helpers/custom_exception\").ArgumentInvalidException;\r\n    var ModelValidator = isInBrowser ? NS.Helpers.modelValidationPromise : require('../helpers/modelValidationPromise');\r\n\r\n\r\n    // Core view to design _composite view_. These wiews are composition of model and collection with associated views.\r\n    var CompositeView = ConsultEditView.extend({\r\n\r\n        //The default the surronding tag of the view .\r\n        tagName: 'div',\r\n\r\n        //The default the css class of the view.\r\n        className: 'compositeView',\r\n\r\n        //Default options of the composite view.\r\n        defaultOptions: _.extend({}, ConsultEditView.prototype.defaultOptions, {\r\n            isForceReload: true,\r\n            isNavigationOnSave: false,\r\n            isModelToLoad: false,\r\n            isListeningToModelChange: false\r\n        }),\r\n\r\n        //Service to save a model wether it is a model or a collection.\r\n        saveModelSvc: undefined,\r\n\r\n        //Container for all the views which are registered.\r\n        //viewsConfiguration: [],\r\n\r\n        //Initialize function of the composite view.\r\n        initialize: function initializeCompositeView(options) {\r\n            options = options || {};\r\n            ConsultEditView.prototype.initialize.call(this, options);\r\n            this.viewsConfiguration = [];\r\n            //Call efor each view you want to register the register view method.\r\n\r\n        },\r\n        //Method to call in order to register a new view inside the composite view.\r\n        //Be carefull, a view must be inside the composite view before being registered.\r\n        // Example: this.registerView({ selector: \"div#zone1\", name: \"contactView\", type: \"model\", modelProperty: \"property\"});\r\n        //The `modelProperty` is the name of the property of the object which will be constructed.\r\n        registerView: function registerView(viewConfiguration) {\r\n\r\n            //Check the configuration before adding the view.\r\n            if (viewConfiguration === undefined || viewConfiguration === null) {\r\n                throw new ArgumentNullException(\"viewConfiguration\");\r\n            }\r\n            if (typeof viewConfiguration.selector !== \"string\") {\r\n                throw new ArgumentInvalidException(\"viewconfiguration.selector must be a string.\", viewConfiguration);\r\n            }\r\n            //Should a test on the selector be addedin order to know if it's in the dom? \r\n\r\n            if (typeof viewConfiguration.name !== \"string\") {\r\n                throw new ArgumentInvalidException(\"viewconfiguration.name must be a string.\", viewConfiguration);\r\n            }\r\n            var registeredView = this[viewConfiguration.name];\r\n            if (registeredView === undefined || registeredView === null) {\r\n                throw new ArgumentNullException(\"The view you are trying to register: \" + viewConfiguration.name + \" does not exists inside the composite view.\");\r\n            }\r\n            if (!utilHelper.isBackboneView(registeredView)) {\r\n                throw new ArgumentInvalidException(\"The view you are trying to register: \" + viewConfiguration.name + \" is not a Backbone view.\", viewConfiguration);\r\n            }\r\n            var type = viewConfiguration.type;\r\n            if (typeof type !== \"string\") {\r\n                throw new ArgumentInvalidException(\"viewconfiguration.type must be a string.\", viewConfiguration);\r\n            }\r\n            if (type !== \"model\" && type !== \"collection\") {\r\n                throw new ArgumentInvalidException(\"viewconfiguration.type must be a model or a collection.\", viewConfiguration);\r\n            }\r\n            if (typeof viewConfiguration.modelProperty !== \"string\") {\r\n                throw new ArgumentInvalidException(\"viewconfiguration.modelProperty must be a string.\", viewConfiguration);\r\n            }\r\n            this.viewsConfiguration.push(viewConfiguration);\r\n            //this[\"render\"+viewConfiguration.name] = function(){ this[viewConfiguration.name].render();} //Maybe register a render method per view\r\n        },\r\n\r\n        //Register many views by calling each time the registerViews.\r\n        registerViews: function (viewsConfigurations) {\r\n            //If the view is not an array.\r\n            if (!_.isArray(viewsConfigurations)) {\r\n                throw new ArgumentInvalidException(\"viewconfigurations must be an array.\", viewsConfigurations);\r\n            }\r\n            for (var i = 0, l = viewsConfigurations.length; i < l; i++) {\r\n                this.registerView(viewsConfigurations[i]);\r\n            }\r\n        },\r\n\r\n        //Remove the view inside the viewsconfiguration by its name.\r\n        removeView: function removeView(viewName) {\r\n\r\n            if (viewName !== undefined && viewName !== null && utilHelper.isBackboneView(this[viewName])) {\r\n                //Remove the view from both the dom.\r\n                this[viewName].remove();\r\n\r\n                //Delete it from the view context.\r\n                delete this[viewName];\r\n\r\n                //Delete oit from the configuration.\r\n                this.viewsConfiguration = _.reject(this.viewsConfiguration, function (viewConf) {\r\n                    return viewConf.name === viewName;\r\n                });\r\n            }\r\n        },\r\n\r\n        //Events handle by the view.\r\n        events: {\r\n            \"click .panel-heading\": \"toogleCollapse\",\r\n            //Edition events\r\n            \"click button.btnEdit\": \"toggleEditMode\",\r\n            \"click button[type='submit']\": \"save\",\r\n            \"click button.btnCancel\": \"cancelEdition\",\r\n            \"click button[data-loading]\": \"loadLoadingButton\"\r\n        },\r\n        // Get the data to give to the template.\r\n        getRenderData: function getRenderDataCompositeView() {\r\n            return _.extend({}, { listUrl: this.opts.listUrl }, this.additionalData());\r\n        },\r\n\r\n        //Render function of the coposite view.\r\n        render: function renderCompositeView(options) {\r\n            options = options || {};\r\n            //Render the template which should contains all the subview selectors.\r\n            this.$el.html(this.template(this.getRenderData()));\r\n\r\n            //Render each view inside the configuration.\r\n            for (var i = 0, l = this.viewsConfiguration.length; i < l; i++) {\r\n                var vConf = this.viewsConfiguration[i];\r\n                //Render each view inside its selector.\r\n                $(vConf.selector, this.$el).html(this[vConf.name].render(options).el);\r\n                this[vConf.name].delegateEvents();\r\n            }\r\n\r\n            //this.delegateEvents();\r\n            return this;\r\n        },\r\n        toggleEditMode: function toggleEditModeCompositeView() {\r\n            ConsultEditView.prototype.toggleEditMode.apply(this);\r\n            //Render each view inside the configuration.\r\n            for (var i = 0, l = this.viewsConfiguration.length; i < l; i++) {\r\n                var vConf = this.viewsConfiguration[i];\r\n                //Render each view inside its selector.\r\n                this[vConf.name].toggleEditMode();\r\n            }\r\n        },\r\n        bindToModel: function(){\r\n            var compoView = this;\r\n            for (var i = 0, l = compoView.viewsConfiguration.length; i < l; i++) {\r\n                var viewConf = compoView.viewsConfiguration[i];\r\n                compoView[viewConf.name].bindToModel();\r\n            }\r\n            this.model.set(this.buildJSONToSave());\r\n        },\r\n        //Submit the compoosite view.\r\n        save: function saveCompositeView(event) {\r\n            event.preventDefault();\r\n            var compoView = this;\r\n\r\n            var promisesValidationContainer = [];\r\n            //Function  to build promises from view configuration.\r\n            function buildPromisesFromViewConfiguration(vConf) {\r\n                if (vConf.type === \"model\") {\r\n                    //Bind the model.\r\n                    compoView[vConf.name].bindToModel();\r\n                    promisesValidationContainer.push(\r\n                        //A promise is created in order to be resolve by the promise.all.\r\n                        //Otherwise, the promise returned by the validation is already resolve when the promise.all is treated.\r\n                        new Promise(function (resolve, failure) {\r\n                            ModelValidator.validate(compoView[vConf.name].model).then(\r\n                                function (success) {\r\n                                    resolve(success);\r\n                                },\r\n                                function (errors) {\r\n                                    errorHelper.setModelErrors(compoView[vConf.name].model, { fieldErrors: errors });\r\n                                    failure(errors);\r\n                                }\r\n                            );\r\n                        })\r\n                    );\r\n\r\n                } else {\r\n                    //The view of the collection must have a collectionSelectot to be able to work.\r\n                    //Bind the collection.\r\n                    compoView[vConf.name].bindToModel();\r\n\r\n                    //Push promises inside the container.\r\n                    promisesValidationContainer.push(\r\n                        //Same reason as for the model.\r\n                        new Promise(function (resolve, failure) {\r\n                            ModelValidator.validateAll(compoView[vConf.name].model).then(\r\n                                function (success) {\r\n                                    resolve(success);\r\n                                },\r\n                                function (errors) {\r\n                                    errorHelper.setCollectionErrors(compoView[vConf.name].model, errors);\r\n                                    failure(errors);\r\n                                }\r\n                            );\r\n                        })\r\n                    );\r\n                }\r\n            }\r\n            //Go through the whole conf.\r\n            for (var i = 0, l = compoView.viewsConfiguration.length; i < l; i++) {\r\n                var viewConf = compoView.viewsConfiguration[i];\r\n                buildPromisesFromViewConfiguration(viewConf);\r\n            }\r\n            var promisesContainer = _.union(promisesValidationContainer, compoView.businessValidationPromises())\r\n            //Resolve all validation promise inside the page.\r\n            Promise.all(promisesContainer).then(function (success) {\r\n                compoView.saveAction();\r\n            }, function (error) {\r\n                //console.error(error);\r\n                compoView.resetSaveButton();\r\n            });\r\n        },\r\n        //Method called when the validation is done and ok.\r\n        saveAction: function saveActionCompositeView() {\r\n            var currentView = this;\r\n            this.saveModelSvc(this.buildJSONToSave()).then(\r\n            function successSaveCompostiteView(success) {\r\n                currentView.saveSuccess(success);\r\n            },\r\n            function errorSaveCompositeView(responseError) {\r\n                currentView.saveError(responseError);\r\n            }).then(this.resetSaveButton.bind(this));\r\n        },\r\n        //Cancel the edition.\r\n        cancelEdition: function cancelEditionCompositeView() {\r\n            // cancelEdit on composite = ToggleEdit on compositeView only + cancelEdit on each child view.\r\n\r\n            if (this.isCreateMode()) {\r\n                ConsultEditView.prototype.cancelEdition.call(this);\r\n            }\r\n            else {\r\n                ConsultEditView.prototype.toggleEditMode.apply(this);\r\n\r\n                //Render each view inside the configuration.\r\n                for (var i = 0, l = this.viewsConfiguration.length; i < l; i++) {\r\n                    var vConf = this.viewsConfiguration[i];\r\n                    //Render each view inside its selector.\r\n                    this[vConf.name].cancelEdition();\r\n                }\r\n            }\r\n            \r\n        },\r\n        //After the loadin of the global model datas, dispatch it into the model and collections of each view.\r\n        //todo: Test.\r\n        setViewsModels: function setViewsModels(successResponse) {\r\n            for (var i = 0, l = this.viewsConfiguration.length; i < l; i++) {\r\n                var vConf = this.viewsConfiguration[i];\r\n                if (successResponse[vConf.modelProperty]) {\r\n                    var method = vConf.type === \"model\" ? 'set' : 'reset';\r\n                    this[vConf.name].model[method](successResponse[vConf.modelProperty]);\r\n                }\r\n\r\n            }\r\n        },\r\n        //Build the json from differents models.\r\n        buildJSONToSave: function () {\r\n            var json = {};\r\n            for (var i = 0, l = this.viewsConfiguration.length; i < l; i++) {\r\n                var vConf = this.viewsConfiguration[i];\r\n                json[vConf.modelProperty] = this[vConf.name].model.toSaveJSON();\r\n            }\r\n            return json;\r\n        },\r\n        //Call after render specifically to the composite view.\r\n        afterRender: function postRenderListView() {\r\n            ConsultEditView.prototype.afterRender.call(this);\r\n            $('.collapse', this.$el).collapse('show');\r\n        }\r\n    });\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.CompositeView = CompositeView;\r\n    } else {\r\n        module.exports = CompositeView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global window, Backbone, $, i18n, _*/\r\n(function (NS) {\r\n    \"use strict\";\r\n    //Filename: views/consult-edit-view.js\r\n    NS = NS || {};\r\n\r\n    //Dependencies.\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    var ErrorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var CoreView = isInBrowser ? NS.Views.CoreView : require('./core-view');\r\n    var form_helper = isInBrowser ? NS.Helpers.formHelper : require('../helpers/form_helper');\r\n    var urlHelper = isInBrowser ? NS.Helpers.urlHelper : require('../helpers/url_helper');\r\n    var utilHelper = isInBrowser ? NS.Helpers.utilHelper : require('../helpers/utilHelper');\r\n    var ModelValidator = isInBrowser ? NS.Helpers.modelValidationPromise : require('../helpers/modelValidationPromise');\r\n    var errorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var backboneNotification = isInBrowser ? NS.Helpers.backboneNotification : require(\"../helpers/backbone_notification\");\r\n    var NotImplementedException = isInBrowser ? NS.Helpers.Exceptions.NotImplementedException : require(\"../helpers/custom_exception\").NotImplementedException;\r\n    var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"../helpers/custom_exception\").ArgumentNullException;\r\n\r\n    //Backbone view which can be use in order to create consultation view and edition view.\r\n    var ConsultEditView = CoreView.extend({\r\n\r\n        //The default tag for this view is a div.\r\n        tagName: 'div',\r\n\r\n        //The default class for this view.\r\n        className: 'consultEditView',\r\n\r\n        // Service to initialize the model\r\n        getNewModelSvc: undefined,\r\n\r\n        //Service to get the model.\r\n        getModelSvc: undefined,\r\n\r\n        //Service to delete the model.\r\n        deleteModelSvc: undefined,\r\n\r\n        //Service to save a model wether it is a model or a collection.\r\n        saveModelSvc: undefined,\r\n\r\n        //Template for the edit mode.\r\n        templateEdit: undefined,\r\n\r\n        //Template for the consultation mode.\r\n        templateConsult: undefined,\r\n\r\n        //Additional data to pass to the template.\r\n        additionalData: function () {\r\n            return undefined;\r\n        },\r\n\r\n        //Default options for the view.\r\n        defaultOptions: _.extend({}, CoreView.prototype.defaultOptions, {\r\n            isModelToLoad: true, //By default the model is loaded.\r\n            isEditMode: true,\r\n            isNavigationOnSave: true,\r\n            isNavigationOnDelete: true,\r\n            isSaveOnServer: true,\r\n            collectionSelector: \"tbody tr\",\r\n            isForceReload: false,\r\n            isReadyModelData: true,\r\n            listUrl: undefined,\r\n            isListeningToModelChange: true,\r\n            formSelector: undefined, //In whitch selector you have to search the form datas (inputs, select,...).,\r\n            modelType: \"model\"\r\n        }),\r\n\r\n        //Initialize function\r\n        initialize: function initializeConsultEdit(options) {\r\n            options = options || {};\r\n            CoreView.prototype.initialize.call(this, options);\r\n            //By default the view is in consultationmode and if edit mode is active and isEdit has been activated in th options. \r\n            this.isEdit = (this.opts.isEditMode && this.opts.isEdit) || false;\r\n\r\n            //Transform the listUrl\r\n            if (this.opts.listUrl) {\r\n                var currentView = this;\r\n                this.opts.listUrl = this.opts.listUrl.replace(/\\:(\\w+)/g, function (match) {\r\n                    return currentView.opts[match.replace(\":\", \"\")];\r\n                });\r\n            }\r\n\r\n            if (this.model) {\r\n                if (this.isCreateMode(options)) {\r\n                    this.isEdit = true;\r\n                    this.opts.isModelToLoad = false;\r\n                    this.loadGetNewModelData();\r\n                }\r\n\r\n                /*\r\n            else if (!isBackboneModel && this.model.isCreate) {\r\n               this.opts.isModelToLoad = false;\r\n            }\r\n            */\r\n\r\n                //render view when the model is loaded\r\n                if (this.opts.isListeningToModelChange) {\r\n                    this.model.on('change', this.render, this);\r\n                }\r\n\r\n                // In order to be loaded a model has to have an id and the options must be activated.\r\n                if (this.opts.isModelToLoad && utilHelper.isBackboneModel(this.model)) {\r\n                    this.opts.isReadyModelData = false;\r\n                    //Try to load the model from a service which have to return a promise.\r\n                    this.loadModelData();\r\n                }\r\n            }\r\n        },\r\n        // returns true if the view should be rendered in creation mode.\r\n        isCreateMode: function isCreateModeConsultEdit(options) {\r\n            var isBackboneModel = utilHelper.isBackboneModel(this.model);\r\n            return this.opts.isCreateMode || (isBackboneModel && this.opts.isModelToLoad && this.model.get('isNewModel'));\r\n        },\r\n        //This function is use in order to retrieve the data from the api using a service.\r\n        loadModelData: function loadModelData(id) {\r\n            var view = this;\r\n            var idValue = id || this.model.get('id');\r\n            this.getModelSvc(idValue)\r\n                .then(function success(jsonModel) {\r\n                    view.opts.isReadyModelData = true;\r\n                    view.model.set(jsonModel);\r\n                    //view.model.savePrevious();\r\n                }).then(null, function error(errorResponse) {\r\n                    ErrorHelper.manageResponseErrors(errorResponse, {\r\n                        model: view.model\r\n                    });\r\n                });\r\n        },\r\n\r\n        //This function is use in order to retrieve the data from the api using a service.\r\n        loadGetNewModelData: function loadGetNewModelData() {\r\n            if (this.getNewModelSvc != undefined) {\r\n                var view = this;\r\n                this.getNewModelSvc()\r\n                    .then(function success(jsonModel) {\r\n                        view.opts.isReadyModelData = true;\r\n                        view.model.set(jsonModel);\r\n                        //view.model.savePrevious();\r\n                    }).then(null, function error(errorResponse) {\r\n                        ErrorHelper.manageResponseErrors(errorResponse, {\r\n                            model: view.model\r\n                        });\r\n                    });\r\n            }\r\n        },\r\n\r\n        //Events handle by the view with user interaction\r\n        events: {\r\n            \"click button.btnEdit\": \"edit\",\r\n            \"click button.btnDelete\": \"deleteItem\",\r\n            \"click .panel-heading\": \"toogleCollapse\",\r\n            \"click button[type='submit']\": \"save\",\r\n            \"click button.btnCancel\": \"cancelEdition\",\r\n            \"click button.btnBack\": \"back\",\r\n            \"click button[data-loading]\": \"loadLoadingButton\"\r\n        },\r\n\r\n        //JSON data to attach to the template.\r\n        getRenderData: function getRenderDataConsultEdit() {\r\n            if (this.opts.listUrl === undefined) {\r\n                return this.model.toJSON();\r\n            }\r\n            return _.extend({}, this.model.toJSON(), { listUrl: this.opts.listUrl });\r\n        },\r\n\r\n        //genarate navigation url usefull if the edit mode is not on the same page.\r\n        generateEditUrl: function generateEditUrl() {\r\n            return this.model.modelName + \"/edit/\" + this.model.get('id');\r\n        },\r\n\r\n        //Change the edit mode.\r\n        toggleEditMode: function toogleEditMode(event) {\r\n            if (event) {\r\n                event.preventDefault();\r\n            }\r\n            \r\n            this.isEdit = !this.isEdit;\r\n            if(this.isEdit){\r\n                backboneNotification.clearNotifications();\r\n                this.model.savePrevious();\r\n            }\r\n            this.render();\r\n        },\r\n\r\n        //Deal with the edit button click wether there is an edit mode or not.\r\n        edit: function editConsultEditView(event) {\r\n            event.preventDefault();\r\n            if (this.opts.isEditMode) {\r\n                this.toggleEditMode();\r\n            } else {\r\n                Backbone.history.navigate(this.generateEditUrl(), true);\r\n            }\r\n        },\r\n        //Get the json data to be save by the view.\r\n        getDataToSave: function getDataToSaveDetailEdit() {\r\n            if (utilHelper.isBackboneModel(this.model)) {\r\n                return this.model.toJSON();\r\n            } else {\r\n                return this.model.toSaveJSON();\r\n            }\r\n        },\r\n        //Deal with the save event on the page.\r\n        save: function saveConsultEdit(event) {\r\n            event.preventDefault();\r\n            //Call a different method depending on the fact that the model is a collection or a model.\r\n            if (utilHelper.isBackboneModel(this.model)) {\r\n                this.saveModel();\r\n            } else if (utilHelper.isBackboneCollection(this.model)) {\r\n                this.saveCollection();\r\n            }\r\n\r\n        },\r\n        //Save a backbone collection.\r\n        saveCollection: function saveBackboneCollection() {\r\n            //Call the form helper in order to rebuild the collection from the form.\r\n            this.bindToModel();\r\n            //Bind the this to the current view for the\r\n            var currentView = this;\r\n            ModelValidator.validateAll(currentView.model)\r\n                .then(function successValidation() {\r\n                    //When the model is valid, unset errors.\r\n                    currentView.model.forEach(function (mdl) {\r\n                        mdl.unsetErrors();\r\n                    }, currentView);\r\n                    if (currentView.opts.isSaveOnServer) {\r\n                        currentView.saveAction();\r\n                    } else {\r\n                        currentView.saveSuccess(currentView.model.toJSON());\r\n                    }\r\n\r\n                }, function errorValidation(errors) {\r\n                    //todo: see how to set errors.\r\n                    errorHelper.setCollectionErrors(currentView.model, errors);\r\n                    currentView.resetSaveButton();\r\n                });\r\n        },\r\n        resetSaveButton: function resetSaveButton() {\r\n            $('button[type=\"submit\"]', this.$el).button('reset');\r\n        },\r\n        resetLoadingButton: function resetLoadingButton(){\r\n            $('button[data-loading]', this.$el).button('reset');\r\n        },\r\n        loadLoadingButton: function loadLoadingButton(event){\r\n          $(event.target).closest('button[data-loading]').button('loading');\r\n        },\r\n        bindToModel: function bindToModelConsultEdit() {\r\n            var formSelector = this.opts.formSelector || \"\";\r\n            if (utilHelper.isBackboneModel(this.model)) {\r\n                this.model.unsetErrors({ silent: true });\r\n                var inputSelector = formSelector + \" \" + \"input, \" + formSelector + \" \" + \"textarea\";\r\n                var selectSelector = formSelector + \" \" + \"select\";\r\n                form_helper.formModelBinder({\r\n                    inputs: $(inputSelector, this.$el),\r\n                    options: $(selectSelector, this.$el)\r\n                }, this.model);\r\n            } else if (utilHelper.isBackboneCollection(this.model)) {\r\n                this.model.unsetErrors({silent: true});\r\n                var collectionSelector = formSelector + \" \" + this.opts.collectionSelector;\r\n                form_helper.formCollectionBinder(\r\n                    $(collectionSelector, this.$el),\r\n                    this.model, {\r\n                        isSilent: false\r\n                    }\r\n                );\r\n            }\r\n        },\r\n        //Save method in case of a model.\r\n        saveModel: function saveBackboneModel() {\r\n            this.bindToModel();\r\n\r\n            //Bind the this to the current view for the\r\n            var currentView = this;\r\n            //Todo: Add a method in util in order to know if an object is a collectio or a model.\r\n            //Add it into the initialize too.\r\n            ModelValidator.validate(currentView.model)\r\n                .then(function successValidation() {\r\n                    //When the model is valid, unset errors.\r\n                    currentView.model.unsetErrors();\r\n                    if (currentView.opts.isSaveOnServer) {\r\n                        currentView.saveAction();\r\n                    } else {\r\n                        currentView.saveSuccess(currentView.model.toJSON());\r\n                    }\r\n\r\n                }, function errorValidation(errors) {\r\n                    currentView.model.setErrors(errors);\r\n                    currentView.resetSaveButton();\r\n                });\r\n        },\r\n        //Save action call the save Svc.\r\n        saveAction: function () {\r\n            var currentView = this;\r\n            //Add a control on the property saveModelSvc.\r\n            if(!currentView.saveModelSvc){\r\n                throw new ArgumentNullException(\"The service use in order to save the model is not define in the wiew, try to define it: saveModelSvc\");\r\n            }\r\n            //Call the service in order to save the model.                   \r\n            return currentView.saveModelSvc(currentView.getDataToSave())\r\n                .then(function success(jsonModel) {\r\n                    currentView.saveSuccess(jsonModel);\r\n                }, function error(responseError) {\r\n                    currentView.saveError(responseError);\r\n                })\r\n                .then(currentView.resetSaveButton.bind(currentView));\r\n        },\r\n        //Actions on save error\r\n        saveError: function saveErrorConsultEdit(errors) {\r\n\r\n            ErrorHelper.manageResponseErrors(errors, {\r\n                model: this.model\r\n            });\r\n        },\r\n        //Actions on save success.\r\n        saveSuccess: function saveSuccessConsultEdit(jsonModel) {\r\n            this.opts.isNewModel = false;\r\n            //Add a notification which will be displayed wether by the router or by the same view.\r\n            backboneNotification.addNotification({\r\n                type: 'success',\r\n                message: i18n.t('save.' + (jsonModel && jsonModel.id ? 'create' : 'update') + 'success')\r\n            });\r\n            // If the navigation on save is activated, navigate to the page.\r\n            if (this.opts.isNavigationOnSave) {\r\n                Backbone.history.navigate(this.generateNavigationUrl(), true);\r\n            } else {\r\n                // If there is no navigation on save, trigger a change event.\r\n                if (this.opts.isForceReload === true) {\r\n                    var thisUrl = this.generateReloadUrl(jsonModel);\r\n                    if (!Backbone.history.navigate(thisUrl, true)) {\r\n                        Backbone.history.loadUrl(thisUrl);\r\n                    }\r\n                } else if (jsonModel instanceof Object) {\r\n                    //Render the success notification.\r\n                    backboneNotification.renderNotifications();\r\n                    //Reset the model or the collection.\r\n                    this.model[utilHelper.isBackboneModel(this.model) ? 'set' : 'reset'](jsonModel, {\r\n                        silent: false\r\n                    });\r\n                    this.toggleEditMode();\r\n                } else if (utilHelper.isBackboneModel(this.model) && this.model.isNew()) {\r\n                    Backbone.history.navigate(Backbone.history.fragment.replace('new', jsonModel), true);\r\n                } else {\r\n                    backboneNotification.renderNotifications();\r\n                    //Reload the model from the service.\r\n                    this.loadModelData();\r\n                    this.toggleEditMode();\r\n                }\r\n\r\n            }\r\n        },\r\n        //Contains all the business validation promises.\r\n        businessValidationPromises: function () {\r\n            //Return an array of  promises\r\n            return [];\r\n        },\r\n        //Cancel the edition.\r\n        cancelEdition: function cancelEditionConsultEditView() {\r\n            backboneNotification.clearNotifications();\r\n            if (this.model.isNew()) {\r\n                Backbone.history.navigate(this.opts.listUrl, true);\r\n            } else {\r\n                this.model.restorePrevious();\r\n                this.toggleEditMode();\r\n            }\r\n        },\r\n        //Url to generate when you want to reload the page, if the option isForceReload is activated.\r\n        generateReloadUrl: function generateReloadUrl(param) {\r\n            throw new NotImplementedException('generateReloadUrl', this);\r\n        },\r\n        //Url for the newt page after success if the option isNavigateOnSave is activated.\r\n        generateNavigationUrl: function generateNavigationUrl() {\r\n            if (this.model.get('id') === null || this.model.get('id') === undefined) {\r\n                return \"/\";\r\n            }\r\n            return urlHelper.generateUrl([this.model.modelName, this.model.get(\"id\")], {});\r\n        },\r\n\r\n        //Code to delete an item.\r\n        deleteItem: function deleteConsult(event) {\r\n            event.preventDefault();\r\n            var view = this;\r\n            //call delete service\r\n            this.deleteModelSvc(this.model)\r\n                .then(function success(successResponse) {\r\n                    view.deleteSuccess(successResponse);\r\n                }, function error(errorResponse) {\r\n                    view.deleteError(errorResponse);\r\n                });\r\n        },\r\n\r\n        //Generate delete navigation url.\r\n        generateDeleteUrl: function generateDeleteUrl() {\r\n            return this.opts.listUrl;\r\n        },\r\n\r\n        // Actions after a delete success.\r\n        deleteSuccess: function deleteConsultEditSuccess(response) {\r\n            //remove the view from the DOM\r\n            if (this.model.isInCollection()) {\r\n                this.model.collection.remove(this.model);\r\n            } else {\r\n                delete this.model;\r\n            }\r\n            this.remove();\r\n            this.resetLoadingButton();\r\n            if (this.opts.isNavigationOnDelete) {\r\n                //navigate to next page\r\n                Backbone.history.navigate(this.generateDeleteUrl(), true);\r\n            }\r\n\r\n        },\r\n\r\n        // Actions after a delete error. \r\n        deleteError: function deleteConsultEditError(errorResponse) {\r\n            ErrorHelper.manageResponseErrors(errorResponse, {\r\n                isDisplay: true\r\n            });\r\n            this.resetLoadingButton();\r\n        },\r\n        //Render function.\r\n        render: function renderConsultEditView() {\r\n            //todo: see if a getRenderData different from each mode is necessary or it coul be deal inside the getRenderDatatFunction if needed.\r\n            var templateName = this.isEdit ? 'templateEdit' : 'templateConsult';\r\n            if (this.opts.isElementRedefinition) {\r\n                this.setElement(this[templateName](this.getRenderData()));\r\n            } else {\r\n                this.$el.html(this[templateName](this.getRenderData()));\r\n            }\r\n\r\n            //if (this.isEdit) {\r\n            //    this.$el.html(this.templateEdit(this.getRenderData()));\r\n            //} else {\r\n            //    this.$el.html(this.templateConsult(this.getRenderData()));\r\n            //}\r\n\r\n            return this;\r\n        },\r\n        //Inform if the view is ready to be displayed.\r\n        isReady: function isReadyConsultEditView() {\r\n            return this.opts.isReadyModelData === true && CoreView.prototype.isReady.call(this) === true;\r\n        },\r\n        //Function which is called after the render, usally necessary for jQuery plugins.\r\n        afterRender: function postRenderDetailView() {\r\n            CoreView.prototype.afterRender.call(this);\r\n            $('.collapse', this.$el).collapse('show');\r\n            //Button loading:\r\n            $('button[data-loading]').button();\r\n\r\n            var errorField = $('input', 'div.form-group.has-error', this.$el)[0];\r\n            if (errorField === undefined) {\r\n                errorField = $('select', 'div.form-group.has-error', this.$el)[0];\r\n            }\r\n            if (errorField !== undefined) {\r\n                errorField.focus();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.ConsultEditView = ConsultEditView;\r\n    } else {\r\n        module.exports = ConsultEditView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global Backbone, _, window, Promise, $ */\r\n\"use strict\";\r\n(function(NS) {\r\n    //Filename: views/core-view.js\r\n    NS = NS || {};\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    var postRenderingBuilder = isInBrowser ? NS.Helpers.postRenderingBuilder : require('../helpers/post_rendering_builder');\r\n    var ErrorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var RefHelper = isInBrowser ? NS.Helpers.referenceHelper : require('../helpers/reference_helper');\r\n    var ArgumentNullException = isInBrowser ? NS.Helpers.Exceptions.ArgumentNullException : require(\"../helpers/custom_exception\").ArgumentNullException;\r\n    var Model = isInBrowser ? NS.Models.Model : require(\"../models/model\");\r\n    var PaginatedCollection = isInBrowser ? NS.Models.PaginatedCollection : require(\"../models/paginatedCollection\");\r\n    var UtilHelper = isInBrowser ? NS.Helpers.utilHelper : require('../helpers/util_helper');\r\n    var sessionHelper = isInBrowser ? NS.Helpers.sessionHelper : require('../helpers/session_helper');\r\n    var templateSpinner = isInBrowser ? NS.templates.spinner : function() {\r\n        return \"Template spinner to define...\";\r\n    };\r\n    //View which is the default view for each view.\r\n    //This view is able to deal with errors and to render the default json moodel.\r\n    var CoreView = Backbone.View.extend({\r\n        toogleIsHidden: function(options) {\r\n            this.isHidden = !this.isHidden;\r\n            this.render(options);\r\n        },\r\n        //Reference lists names. \r\n        //These _names_, must have been registered inside the the application to be used.\r\n        referenceNames: undefined,\r\n\r\n        //Options define by default for the view.\r\n        defaultOptions: {\r\n            isElementRedefinition: false, //This options is use in order to not have a tag container generated by Backbone arround the view.\r\n            isReadyReferences: true\r\n        },\r\n        //Options overriden By the instanciate view.\r\n        customOptions: {},\r\n\r\n        //This property is use in order to create a new Model if no model are define in the view.\r\n        modelName: undefined,\r\n\r\n        //Initialization of the coreview.\r\n        initialize: function initializeCoreView(options) {\r\n            options = options || {};\r\n            //Define default options foreach _core_ view, and override these options for each _project view_.\r\n            //Then each view will have access to options in any methods.\r\n            this.opts = _.extend({}, this.defaultOptions, this.customOptions, options);\r\n\r\n            this.on('toogleIsHidden', this.toogleIsHidden);\r\n            this.initializeModel();\r\n\r\n            /*Register after renger.*/\r\n            _.bindAll(this, 'render', 'afterRender');\r\n            var _this = this;\r\n            this.render = _.wrap(this.render, function(render, options) {\r\n                //If the view is ready perform the standard render.\r\n                if (_this.isReady()) {\r\n                    render(options);\r\n                    _this.afterRender();\r\n                } else {\r\n                    //Else render the spinner.\r\n                    this.renderSpinner();\r\n                }\r\n                return _this;\r\n            });\r\n\r\n            //Listen to the reference list loading.\r\n            this.listenTo(this.model, \"references:loaded\", this.render, this);\r\n\r\n            //Load all the references lists which are defined in referenceNames.\r\n            var currentView = this;\r\n            if (_.isArray(this.referenceNames) && this.referenceNames.length > 0) {\r\n                this.opts.isReadyReferences = false;\r\n                Promise.all(RefHelper.loadMany(this.referenceNames)).then(function(results) {\r\n                    currentView.opts.isReadyReferences = true;\r\n                    //console.log('resultsreferenceNames', results);\r\n                    var res = {}; //Container for all the results.\r\n                    for (var i = 0, l = results.length; i < l; i++) {\r\n                        res[currentView.referenceNames[i]] = results[i];\r\n                        //The results are save into an object with a name for each reference list.\r\n                    }\r\n                    if (UtilHelper.isBackboneCollection(currentView.model)) {\r\n                        _.extend(currentView.model, res); // Add the references as properties of the object without using set which erases the collection.\r\n                        // Reset the collection to trigger a render.\r\n                    } else {\r\n                        currentView.model.set(res, {\r\n                            silent: true\r\n                        }); //This trigger a render due to model change.\r\n                    }\r\n                    currentView.model.trigger('references:loaded');\r\n                    //Inform the view that we are ready to render well.\r\n                }).then(null, function(error) {\r\n                    currentView.opts.isReadyReferences = true;\r\n                    currentView.render();\r\n                    ErrorHelper.manageResponseErrors(error, {\r\n                        isDisplay: true\r\n                    });\r\n                });\r\n            }\r\n\r\n        },\r\n\r\n        //Initialize the model of the view.\r\n        //In order to be able to be initialize, a view must have a _model_ or a _modelName_.\r\n        initializeModel: function initializeModelCoreView() {\r\n            if (this.model) {\r\n                return;\r\n            } else if (this.opts.modelName) {\r\n                //Cration d'une collection et d'un model\r\n                var ModelCreated = Model.extend({\r\n                    modelName: this.opts.modelName\r\n                });\r\n                //Case of a collection.\r\n                if (this.opts.modelType !== undefined && this.opts.modelType === \"collection\") {\r\n                    var CollectionCreated = PaginatedCollection.extend({\r\n                        modelName: this.opts.modelName,\r\n                        model: ModelCreated\r\n                    });\r\n                    this.model = new CollectionCreated();\r\n                } else {\r\n                    //Case of a model.\r\n                    this.model = new ModelCreated();\r\n\r\n                }\r\n            } else {\r\n                throw new ArgumentNullException(\"The view must have a model or a model name.\", this);\r\n            }\r\n        },\r\n        //The handlebars template has to be defined here.\r\n        template: function emptyTemplate(json) {\r\n            console.log(\"templateData\", json);\r\n            return \"<p>Your template has to be implemented.</p>\";\r\n        }, // Example: require('./templates/coreView'),\r\n        templateSpinner: templateSpinner,\r\n        //Defaults events.\r\n        events: {\r\n            \"focus input\": \"inputFocus\", //Deal with the focus in the field.\r\n            \"blur input\": \"inputBlur\", //Deal with the focus out of the field.\r\n            \"click .panel-collapse.in\": \"hideCollapse\",\r\n            \"click .panel-collapse:not('.in')\": \"showCollapse\",\r\n            \"click button[data-loading]\": \"loadingButton\"\r\n        },\r\n        //Input focus event.\r\n        inputFocus: function coreViewInputFocus(event) {\r\n            if (!this.model.has('errors')) {\r\n                return;\r\n            }\r\n            //Remove the input hidden attribute.\r\n            return event.target.parentElement.parentElement.childNodes[5].removeAttribute('hidden');\r\n        },\r\n        //Input blur event gestion\r\n        inputBlur: function coreViewInputBlur(event) {\r\n            if (!this.model.has('errors')) {\r\n                return;\r\n            }\r\n            //If there is an error add the hidden attribute into it in odere to hide the errors.\r\n            return event.target.parentElement.parentElement.childNodes[5].setAttribute(\"hidden\", \"hidden\");\r\n        },\r\n        //This method is use in order to inject json data to the template. By default, the this.model.toJSON() is called.\r\n        getRenderData: function getCoreViewRenderData() {\r\n            return this.model.toJSON();\r\n        },\r\n        showCollapse: function showCollapseCoreView() {\r\n            $('.collapse', this.$el).collapse('show');\r\n        },\r\n        hideCollapse: function hideCollapseCoreView() {\r\n            $('.collapse', this.$el).collapse('hide');\r\n        },\r\n        toogleCollapse: function toogleCollapseCoreView(event) {\r\n            $(\".panel-collapse.in\", event.target.parentNode.parentNode).collapse('hide'); //todo: change the selector\r\n            $(\".panel-collapse:not('.in')\", event.target.parentNode.parentNode).collapse('show');\r\n        },\r\n        //Render function  by default call the getRenderData and inject it into the view dom element.\r\n        render: function renderCoreView() {\r\n            //If the view is not ready.\r\n            this.$el.html(this.template(this.getRenderData()));\r\n\r\n            //_.defer(this.afterRender, this);\r\n            return this;\r\n        },\r\n        afterRender: function afterRenderCoreView() {\r\n            //Eventually pass the currentview as argument for this binding.\r\n            postRenderingBuilder({\r\n                model: this.model,\r\n                viewSelector: this.$el\r\n            });\r\n            $('.collapse', this.$el).collapse({\r\n                toogle: true\r\n            });\r\n        },\r\n        //Get the criteria from the session storage if exists.\r\n        getSessionCriteria: function getCriteria() {\r\n            return sessionHelper.getItem(this.getCriteriaId());\r\n        },\r\n        //Save the criteria in the session storage.\r\n        saveSessionCriteria: function saveSessionCriteria(criteria) {\r\n            return sessionHelper.saveItem(this.getCriteriaId(), criteria);\r\n        },\r\n        // Get the id of the criteria.\r\n        getCriteriaId: function getCriteriaId() {\r\n            var hash = window.location.hash;\r\n            if (this.model.modelName != undefined) {\r\n                hash += this.model.modelName;\r\n            }\r\n            if (this.opts.criteriaId != undefined) {\r\n                hash += this.opts.criteriaId;\r\n            }\r\n            return hash;\r\n        },\r\n        //Call the history back.\r\n        back: function back() {\r\n            Backbone.history.history.back();\r\n        },\r\n        //Function which tells if the view is ready to be display.\r\n        isReady: function isReady() {\r\n            return this.opts.isReadyReferences === true;\r\n        },\r\n        //renderSpinner\r\n        renderSpinner: function renderSpinner() {\r\n            this.$el.html(this.templateSpinner(this.getRenderData()));\r\n            return this;\r\n        }\r\n    });\r\n\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.CoreView = CoreView;\r\n    } else {\r\n        module.exports = CoreView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);\r\n// ## Example calll:\r\n// ```javascript\r\n// var CoreView = require('./views/core-view');\r\n// new CoreView({model: new Model({firstName: \"first name\", lastName: \"last name\"}).render().el //Get the dom element of the view.\r\n//```","/* global Backbone, window*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: views/header-items-view.js\r\n  NS = NS || {};\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  \r\n  //Template for the header items.\r\n  var template = isInBrowser ? NS.templates.headerItems : function(){};\r\n  \r\n  //View for the header items.\r\n  var headerItemsView = Backbone.View.extend({\r\n    \r\n    //Default template.\r\n      template: template,\r\n    //Options for the param.\r\n    paramOptions: {\r\n        selector: \"div#titleContainer\",\r\n        template: function(){console.warn('no template define for your param....')}\r\n    },\r\n    //Initialize the header view.\r\n    initialize: function initializeHeaderItemsView(options) {\r\n      options = options || {};\r\n      //Define the level params.\r\n      if (options.levelParams !== undefined) {\r\n          this.levelParams = options.levelParams;\r\n      }\r\n      this.listenTo(this.model, 'change', this.render);\r\n    },\r\n    ////Define the param for the Level.\r\n    //defineParam: function defineHeaderItemsViewParam(param) {\r\n    //    if (param === undefined || param === null) {\r\n    //        this.param = undefined;\r\n    //    }\r\n    //    this.param = param;\r\n    //},\r\n    //Render all the headers items.\r\n    render: function renderHeaderItems(){\r\n        var parentName = this.model.processParentName();\r\n        this.$el.html(this.template({ headerItems: this.model.toActiveJSON(), parentName: parentName }));\r\n\r\n        if (this.levelParams !== undefined && parentName!== undefined && this.levelParams[parentName] !== undefined) {\r\n            $(this.paramOptions.selector, this.$el).html(this.paramOptions.template(this.levelParams[parentName]));\r\n        }\r\n        return this;\r\n    },\r\n\r\n    //Hide the view.\r\n    hide: function hide(){\r\n      this.model.currentActiveName = undefined;\r\n      this.$el.html(null);\r\n    }\r\n  });\r\n\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Views = NS.Views || {};\r\n    NS.Views.HeaderItemsView = headerItemsView;\r\n  } else {\r\n    module.exports = headerItemsView;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/* global Backbone, window, _, $*/\r\n(function(NS) {\r\n  \"use strict\";\r\n  //Filename: views/header-view.js\r\n  NS = NS || {};\r\n  var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n  var util = isInBrowser ? NS.Helpers.utilHelper : require('../helpers/util_helper');\r\n  var HeaderItems = isInBrowser ? NS.Models.HeaderItems : require('../models/header-items');\r\n  var HeaderItemsView = isInBrowser ? NS.Views.HeaderItemsView : require('./header-items-view');\r\n  var siteDescriptionHelper =  isInBrowser ? NS.Helpers.siteDescriptionHelper : require('../helpers/site_description_helper');\r\n  var template = isInBrowser ? NS.templates.header : function(){};\r\n  var headerView = Backbone.View.extend({\r\n\r\n    //Name of the level layer.\r\n    levelName: \"level_\",\r\n    template: template,\r\n    //Default name of the container for the header.\r\n    defaultContainerName: \".header\",\r\n    //Example of definition of a different view for a header level:\r\n    // Inside the ViewForLevel => Add a property with levelName_[index] and a reference to the view you want.\r\n    //Warning, this is insife the prototype, only one headerview per application.  \r\n    ViewForLevel:{\r\n      \"level_0\": undefined,\r\n      \"level_1\": undefined,\r\n      \"level_2\": undefined,\r\n      \"level_3\": undefined\r\n    },\r\n    HeaderItemsView: HeaderItemsView,\r\n    //Initialize the header view.\r\n    initialize: function initializeHeaderView(options) {\r\n      options = options || {};\r\n      this.opts = _.extend({containerName: this.defaultContainerName},options);\r\n      if (options.site) {\r\n        this.processSite(options.site);\r\n      }\r\n      if (options.active) {\r\n        this.processActive(options.active);\r\n      }\r\n      //Contains all the params for the levels.\r\n      this.levelParams = {};\r\n\r\n    },\r\n\r\n    //Process the active menu item.\r\n    processActive: function processActive(activeNode) {\r\n      if (this.active === activeNode) {\r\n        return;\r\n      }\r\n      var split = activeNode.split('.');\r\n      this.level = split.length; //+1?\r\n\r\n      for (var i = 0; i < this.maxLevel; i++) {\r\n        //If the view is in the level.\r\n        if (i < this.level) {\r\n          //Test the depth.\r\n          this[this.levelName + i].model.changeActive(util.splitLevel(activeNode, {depth: i+1}));\r\n        } else {\r\n          this[this.levelName + i].hide();\r\n        }\r\n      }\r\n    },\r\n\r\n    //Process the site map.\r\n    processSite: function processSiteHeaderView(site) {\r\n      var grouped = util.groupBySplitChar(site);\r\n      //Erase previous view.\r\n      for (var i = 0; i < this.maxLevel; i++) {\r\n        this[this.levelName + i].remove();\r\n        //Remove the level.\r\n        delete this[this.levelName + i];//See if it is necessary.\r\n        //Remove the param inside the object.\r\n        delete this.levelParams[levelName];\r\n      }\r\n      var allParams = siteDescriptionHelper.getParams();\r\n      //Create new views\r\n      var index = 0;\r\n      for (var prop in grouped) {\r\n         var levelName = this.levelName + index;\r\n         var menuItms = _.values(grouped[prop]);\r\n        this.processLevelParams(menuItms, index, allParams);\r\n         //this.levelParams = this.processLevelParams(menuItms, index, allParams);\r\n        //Wich view for the view level.\r\n        var HeaderItemsViewOfLevel = this.ViewForLevel[levelName] || this.HeaderItemsView;\r\n        this[levelName] = new HeaderItemsViewOfLevel({\r\n            model: new HeaderItems(menuItms),\r\n            levelParams: this.levelParams[levelName]\r\n        });\r\n        index++;\r\n      }\r\n      //define the max profoundness level.\r\n      this.maxLevel = index;\r\n      this.render();\r\n    },\r\n    //Process the level params for the next level.\r\n    processLevelParams: function (menuItemsArray, indexLevel, params) {\r\n        var itemsWithParams = _.filter(menuItemsArray, function (element) { return element.requiredParams !== undefined; });\r\n        //If there is no element \r\n        if (!_.isArray(itemsWithParams)) { return undefined; }\r\n\r\n        var processParams = {};\r\n        for (var i = 0, l = itemsWithParams.length; i < l; i++) {\r\n            var itemWithParams = itemsWithParams[i];\r\n            if (itemWithParams !== undefined && itemWithParams.name !== undefined && itemWithParams.requiredParams !== undefined && _.isArray(itemWithParams.requiredParams)) {\r\n                var paramsOfItem = {};\r\n                //Build a param object for each param\r\n                for (var j = 0, ln = itemWithParams.requiredParams.length; j < ln; j++) {\r\n                    var paramName = itemWithParams.requiredParams[j];\r\n                    paramsOfItem[paramName] = params[paramName];\r\n                }\r\n                processParams[itemWithParams.name] = paramsOfItem;\r\n            }\r\n        }\r\n        //Register a nexlevel params only if necessary.\r\n        if (!_.isEmpty(processParams)) {\r\n            var nextLevelName = this.levelName + (indexLevel + 1);\r\n            this.levelParams[nextLevelName] = processParams;\r\n        }\r\n\r\n    },\r\n\r\n    //Render all the headers items.\r\n    render: function renderHeaders() {\r\n      this.$el.html(this.template());\r\n      for (var i = 0; i < this.maxLevel; i++) {\r\n        $(this.opts.containerName,this.$el).append( this[this.levelName + i].render().el);\r\n      }\r\n      return this;\r\n    }\r\n\r\n  });\r\n\r\n\r\n  // Differenciating export for node or browser.\r\n  if (isInBrowser) {\r\n    NS.Views = NS.Views || {};\r\n    NS.Views.HeaderView = headerView;\r\n  } else {\r\n    module.exports = headerView;\r\n  }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global Backbone, i18n, $, window, _*/\r\n(function (NS) {\r\n    \"use strict\";\r\n    // Filename: views/list-view.js\r\n    NS = NS || {};\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    //var NotImplementedException = isInBrowser ? NS.Helpers.Exceptions.NotImplementedException : require('../helpers/custom_exception').NotImplementedException;\r\n    var _url = isInBrowser ? NS.Helpers.urlHelper : require('../helpers/url_helper');\r\n    var templatePagination = function () { }; //Todo: call a handlebar herlper.//require('../templates/collection-pagination');\r\n    var ConsultEditView = isInBrowser ? NS.Views.ConsultEditView : require('./consult-edit-view');\r\n    var errorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var utilHelper = isInBrowser ? NS.Helpers.utilHelper : require('../helpers/utilHelper');\r\n    var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"../helpers/custom_exception\").ArgumentInvalidException;\r\n    var ListView = ConsultEditView.extend({\r\n        tagName: 'div',\r\n        className: 'resultView',\r\n        resultsPagination: 'div#pagination',\r\n        templatePagination: templatePagination,\r\n        search: undefined,\r\n        //By default the search criteria is empty.\r\n        searchCriteria: {},\r\n        //Get the \r\n        getCriteria: function getCriteria() {\r\n            return _.extend({}, this.searchCriteria, this.opts.searchCriteria);\r\n        },\r\n        //Default options of the list view.\r\n        defaultOptions: _.extend({}, ConsultEditView.prototype.defaultOptions, {\r\n            exportUrl: './Export/Index', //Change it if necessary.,\r\n            isReadyModelData: true,\r\n            isListeningToModelChange: false,\r\n            modelType: \"collection\"\r\n        }),\r\n        //Dervice to define in order to launch the export.\r\n        exportSvc: undefined,\r\n        //Url for the export.\r\n        export: function exportCollection(event) {\r\n            if (typeof this.opts.exportUrl === 'string' && typeof this.exportSvc === 'function') {\r\n                var currentView = this;\r\n                this.exportSvc(this.getCriteria(), _.extend(this.model.pageInfo(), {\r\n                    exportId: this.exportId,\r\n                    exportColumnLabels: this.model.exportColumnLabels\r\n                })).then(function (success) {\r\n                    window.open($('a.btnExport', currentView.$el).attr('href'), '_blank');\r\n                    //$('a.btnExport', this.$el).trigger('click');\r\n                }).then(null, function error(errorResponse) {\r\n                    event.preventDefault();\r\n                    errorHelper.manageResponseErrors(errorResponse, {\r\n                        isDisplay: true\r\n                    });\r\n                });\r\n            } else {\r\n                throw new ArgumentInvalidException('The export conf must be set in order to have an export button, see Fmk.Views.listView, exportSvc to override.', this.exportConf);\r\n            }\r\n\r\n        },\r\n        //Parameters for rendering the detail inside.\r\n        isShowDetailInside: false,\r\n        ResultSelectionView: undefined,\r\n        ResultSelectionModel: undefined,\r\n        resultsContainer: 'div#lineSelectionContainer',\r\n        //List of the model in memory in case of cancel.\r\n        storedModels: [],\r\n        //View foreach line in the collection view.\r\n        viewForEachLineConfiguration: {\r\n            isActive: false, //True or false will make the rendering different.\r\n            LineView: undefined, //View to create for each line.\r\n            //ModelLineView: undefined, //Model for the view initialize with collection data. It is not use but could be if we would want to initialize another model.\r\n            parentContainer: \"table tbody\" //selector into which the view .\r\n        },\r\n\r\n        initialize: function initializeListView(options) {\r\n            options = options || {};\r\n            //Container for the views of each line in case it is usefull.\r\n            this.lineViewsContainer = {};\r\n            ConsultEditView.prototype.initialize.call(this, options);\r\n            this.isSearchTriggered = options.isSearchTriggered || false;\r\n            this.listenTo(this.model, \"reset\", this.render, this);\r\n            // Listen to the model add event.\r\n            this.listenTo(this.model, \"add\", this.addOne, this);\r\n            var currentView = this;\r\n            if (this.opts.isModelToLoad) {\r\n                this.opts.isReadyModelData = false;\r\n                this.getSessionCriteria().then(function (crit) {\r\n                    //Restore the criteria if save into the session.\r\n                    if (crit !== undefined && crit !== null && crit.pageInfo !== undefined && crit.pageInfo !== null) {\r\n                        currentView.model.setPageInfo(crit.pageInfo);\r\n                    }\r\n                    currentView.loadModelData(options);\r\n                }, function (error) {\r\n                    errorHelper.manageResponseErrors(error);\r\n                });\r\n\r\n            }\r\n            //Set an exportId\r\n            if (this.exportSvc !== undefined && this.opts.exportUrl !== undefined) {\r\n                this.exportId = utilHelper.guid();\r\n            }\r\n        },\r\n        loadModelData: function loadModelData(options) {\r\n            options = options || {};\r\n            if (this.search !== undefined) {\r\n                // Fusion des critres venant du rooter (options.searchCriteria) et de la vue (this.getCriteria()).\r\n                var criteria = {};\r\n                _.extend(criteria, this.getCriteria(), options.searchCriteria);\r\n                this.opts.isReadyModelData = false;\r\n                var currentView = this;\r\n                //Call the service and inject the result into the model.\r\n                this.search(criteria, this.model.pageInfo()).then(function success(jsonResponse) {\r\n                    currentView.opts.isReadyModelData = true;\r\n                    currentView.model.setTotalRecords(jsonResponse.totalRecords);\r\n                    currentView.model.reset(jsonResponse.values);\r\n                    //Save the criteria and the pagInfo info the session.\r\n                    currentView.saveCriteria.call(currentView, criteria, currentView.model.pageInfo());\r\n                }).then(null, function error(errorResponse) {\r\n                    currentView.opts.isReadyModelData = true;\r\n                    currentView.render();\r\n                    errorHelper.manageResponseErrors(errorResponse, {\r\n                        isDisplay: true\r\n                    });\r\n                });\r\n            }\r\n        },\r\n        events: {\r\n            'click tbody td[data-selection]': 'lineSelection',\r\n            'click ul li [data-selection]': 'lineSelection',\r\n            'click .pagination li': 'goToPage',\r\n            'click a.sortColumn': 'sortCollection',\r\n            \"click .panel-heading\": \"toogleCollapse\",\r\n            'click #btnBack': 'navigateBack',\r\n            \"change .pageFilter\": \"changePageFilter\",\r\n            //Edition events\r\n            \"click button.btnEdit\": \"edit\",\r\n            \"click button.btnCreate\": \"create\",\r\n            \"click button[type='submit']\": \"save\",\r\n            \"click button.btnCancel\": \"cancelEdition\",\r\n            \"click button.btnExport\": 'export',\r\n            \"click button.btnBack\": \"back\",\r\n            \"click button[data-loading]\": \"loadLoadingButton\"\r\n        },\r\n        changePageFilter: function changePageFilterListView(event) {\r\n            this.model.perPage = +event.target.value;\r\n            this.model.currentPage = this.model.firstPage;\r\n            this.fetchDemand();\r\n        },\r\n        create: function createNavigate() {\r\n            var createUrl = this.generateNavigationUrl(\"new\");\r\n            Backbone.history.navigate(createUrl, true);\r\n        },\r\n        sortCollection: function sortCollection(event) {\r\n            event.preventDefault();\r\n            if (this.isEdit) {\r\n                return;\r\n            }\r\n            var collectionInfos = this.model.pageInfo();\r\n            var sortField = event.target.getAttribute(\"data-name\");\r\n            var currentSort = collectionInfos.sortField;\r\n            var order = \"asc\";\r\n            if (currentSort !== undefined && sortField === currentSort.field && currentSort.order === \"asc\") {\r\n                order = \"desc\";\r\n            }\r\n            this.model.setSortField(sortField, order);\r\n            this.fetchDemand();\r\n        },\r\n\r\n        goToPage: function goToPage(event) {\r\n            event.preventDefault();\r\n            var page = +event.target.getAttribute(\"data-page\");\r\n            this.model.setPage(page);\r\n            this.fetchDemand();\r\n        },\r\n\r\n        nextPage: function nextPage(event) {\r\n            event.preventDefault();\r\n            this.model.setNextPage();\r\n            this.fetchDemand();\r\n        },\r\n\r\n        previousPage: function PreviousPage(event) {\r\n            event.preventDefault();\r\n            this.model.setPreviousPage();\r\n            this.fetchDemand();\r\n        },\r\n\r\n        fetchDemand: function fetchDemandListView() {\r\n            this.loadModelData();\r\n        },\r\n\r\n        generateNavigationUrl: function generateNavigationUrl(id) {\r\n            return _url.generateUrl([this.model.model.prototype.modelName.replace('.', '/'), 'show', id]);\r\n        },\r\n        renderDetail: function renderDetail() {\r\n            $(this.resultsContainer, this.$el).html(new this.ResultSelectionView({\r\n                model: new this.ResultSelectionModel({\r\n                    id: this.detailId\r\n                })\r\n            }).render().el);\r\n        },\r\n        lineSelection: function lineSelectionSearchResults(event) {\r\n            //todo: should the be unactivated if there is aview per line and delegate to the line. , this.viewForEachLineConfiguration.isActive\r\n            event.preventDefault();\r\n            var id = $(event.target).closest(\"[data-selection]\").attr('data-selection');\r\n            if (this.isShowDetailInside) {\r\n                this.detailId = id;\r\n                $('.collapse', this.$el).collapse('hide');\r\n                this.trigger('listview:lineSelected', id);\r\n                this.renderDetail();\r\n                // Trigger\r\n\r\n            } else {\r\n                // Navigate\r\n                var url = this.generateNavigationUrl(id);\r\n                Backbone.history.navigate(url, true);\r\n            }\r\n        },\r\n        navigateBack: function navigateBack() {\r\n            Backbone.history.history.back();\r\n        },\r\n        cancelEdition: function cancelListEdition() {\r\n            // reset the collection with the previous models.\r\n            //this.model.reset(this.storedModels);\r\n            this.model.restorePrevious();\r\n            this.toggleEditMode();\r\n        },\r\n        //Add one line view from the model.\r\n        addOne: function addOneLineView(model) {\r\n            //console.log(\"modelNameAddone\", model, model.modelName, this);\r\n            var opt = _.extend({ isEdit: false }, this.additionalData());\r\n            if (this.isEdit) {\r\n                opt.isEdit = this.isEdit;\r\n            }\r\n            //Copy the references to the child.\r\n            model.set(_.pick(this.model, this.referenceNames), { silent: true });\r\n            //\r\n            var lineView = new this.viewForEachLineConfiguration.LineView(_.extend({\r\n                model: model\r\n            }, opt));\r\n            this.lineViewsContainer[model.cid] = lineView;\r\n            $(this.viewForEachLineConfiguration.parentContainer, this.$el).append(\r\n                lineView.render().el\r\n            );\r\n        },\r\n        render: function renderListView(options) {\r\n            options = options || {};\r\n        \r\n            //If there is no result.\r\n            if (this.model.length === 0 && !this.isEdit) {\r\n                this.renderEmptyList();\r\n            } else {\r\n                this.renderList();\r\n            }\r\n\r\n            this.delegateEvents();\r\n            return this;\r\n        },\r\n        afterRender: function postRenderListView() {\r\n            ConsultEditView.prototype.afterRender.call(this);\r\n            $('.collapse', this.$el).collapse('show');\r\n        },\r\n        renderEmptyList: function renderEmptyList() {\r\n            this.renderList();\r\n        },\r\n        renderList: function renderList() {\r\n            //the template must have named property to iterate over it\r\n            var infos = this.model.pageInfo();\r\n            this.$el.html(this.template(_.extend({\r\n                //Get the model datas only if view foreach line is active.\r\n                collection: this.viewForEachLineConfiguration.isActive ? undefined : this.getRenderData(),\r\n                sortField: infos.sortField.field,\r\n                order: infos.sortField.order,\r\n                currentPage: infos.currentPage,\r\n                perPage: infos.perPage,\r\n                firstPage: infos.firstPage,\r\n                totalPages: infos.totalPages,\r\n                totalRecords: this.model.totalRecords,\r\n                isViewForLine: this.viewForEachLineConfiguration.isActive\r\n            }, {\r\n                exportUrl: this.opts.exportUrl + '/' + this.exportId\r\n            }, _.pick(this.model, this.referenceNames, \"modelName\", \"metadatas\"), { isEdit: this.isEdit }, this.additionalData())));\r\n\r\n            //Conditionnal code for rendering a View  foreach line\r\n            if (this.viewForEachLineConfiguration.isActive) {\r\n                this.model.forEach(this.addOne, this);\r\n            }\r\n\r\n            //render pagination\r\n            $(this.resultsPagination, this.$el).html(this.templatePagination(this.model.pageInfo())); //TODO : this.model.pageInfo() {currentPage: 0, firstPage: 0, totalPages: 10}\r\n\r\n            //If there is a detail id set in the view, render it inside.\r\n            if (this.detailId) {\r\n                this.renderDetail();\r\n            }\r\n        },\r\n        saveCriteria: function (criteria, pageInfo) {\r\n            this.saveSessionCriteria({\r\n                criteria: criteria,\r\n                pageInfo: pageInfo\r\n            });\r\n        }\r\n        //,\r\n        //triggerSaveModels: function triggerSaveModels() {\r\n        //    this.model.forEach(function(model){\r\n        //        model.trigger(\"model:end-edit\");\r\n        //    }, this);\r\n        //}\r\n\r\n    });\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.ListView = ListView;\r\n    } else {\r\n        module.exports = ListView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);\r\n","/*global   $, window,_*/\r\n(function (NS) {\r\n    \"use strict\";\r\n    // Filename: views/modal-view.js\r\n    NS = NS || {};\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    var ConsultEditView = isInBrowser ? NS.Views.ConsultEditView : require('./consult-edit-view');\r\n    var templateModal = isInBrowser ? NS.templates.modalSkeleton : function () { };\r\n    var utilHelper = isInBrowser ? NS.Helpers.utilHelper : require('../helpers/utilHelper');\r\n    //var ArgumentInvalidException = isInBrowser ? NS.Helpers.Exceptions.ArgumentInvalidException : require(\"../helpers/custom_exception\").ArgumentInvalidException;\r\n    var ModalView = ConsultEditView.extend({\r\n        tagName: 'div',\r\n        className: 'modalView',\r\n        //Fefault options of the modal view.\r\n        defaultOptions: _.extend({}, ConsultEditView.prototype.defaultOptions, {\r\n            isModelToLoad: false, //By default the model is loaded.\r\n            isEditMode: true,\r\n            isEdit: true,\r\n            isNavigationOnSave: false,\r\n            isNavigationOnDelete: true,\r\n            isSaveOnServer: false,\r\n            isReadyModelData: true,\r\n        }),\r\n        modalTitle: \"Modal title i18n key.\",\r\n        //Configuration of the modal.\r\n        configuration: {\r\n            templateModal: templateModal,\r\n            container: \"div[data-modal]\",\r\n            selector: \"div[data-modal-content]\",\r\n            //Override the default modal options.\r\n            modalOptions: {\r\n                backdrop: 'static',\r\n                keyboard: true,\r\n                show: false,\r\n                remote: false\r\n            }\r\n        },\r\n        //Initialization of the modal.\r\n        initialize: function initializeModalView(options) {\r\n            options = options || {};\r\n            ConsultEditView.prototype.initialize.call(this, options);\r\n            //Modal title.\r\n            this.opts.modalTitle = options.modalTitle || this.modalTitle;\r\n            this.model.off('change');\r\n            this.model.on('change', this.renderModalContent, this);\r\n        },\r\n        //Events listen by default on the modal.\r\n        events: {\r\n            \"click button[data-dismiss]\": \"cancelModal\",\r\n            \"click button[data-close]\": \"closeModal\"\r\n        },\r\n        //Action call on cancel on the modal.\r\n        cancelModal: function cancelModal() {\r\n            //console.log('the modal is cancel');\r\n            this.trigger('modal:cancel', { cancel: true });\r\n        },\r\n        saveSuccess: function saveSuccessModalClose(jsonModel) {\r\n            var currentModal = this;\r\n            $(this.configuration.container, this.$el).on('hidden.bs.modal', function () {\r\n                currentModal.trigger('modal:close', jsonModel);\r\n                $(currentModal.configuration.container, currentModal.$el).off('hidden.bs.modal');\r\n            });\r\n            this.hideModal();\r\n            //console.log('the modal is close is successfull...');\r\n        },\r\n        //Action called on close the modale.\r\n        closeModal: function closeModal(event) {\r\n            event.preventDefault();\r\n            //console.log('the modal is close is called...');\r\n            if (utilHelper.isBackboneModel(this.model)) {\r\n                this.saveModel();\r\n            } else if (utilHelper.isBackboneCollection(this.model)) {\r\n                this.saveCollection();\r\n            }\r\n        },\r\n        //Render the modal container.\r\n        renderModalContainer: function renderModalContainer() {\r\n            this.$el.html(this.configuration.templateModal(this.getModalData()));\r\n        },\r\n        //Render the modal content.\r\n        renderModalContent: function renderModalContent() {\r\n            var templateName = this.isEdit ? 'templateEdit' : 'templateConsult';\r\n            $(this.configuration.selector, this.$el).html(this[templateName](this.getRenderData()));\r\n            $(this.configuration.selector, this.$el).modal(this.configuration.modalOptions);\r\n            this.afterRender();\r\n            this.delegateEvents();\r\n        },\r\n        getModalData: function () {\r\n            return _.extend({\r\n                title: this.opts.modalTitle,\r\n            }, this.configuration.modalOptions, this.opts);\r\n        },\r\n        showModal: function showModal() {\r\n            \r\n            //this.delegateEvents();\r\n            this.model.unsetErrors();\r\n            $(this.configuration.container, this.$el).modal('show');\r\n        },\r\n        hideModal: function hideModal() {\r\n            $(this.configuration.container, this.$el).modal('hide');\r\n        },\r\n        //Render the modal view.\r\n        render: function renderModalView(options) {\r\n            options = options || {};\r\n            this.renderModalContainer();\r\n            this.renderModalContent();\r\n            //this.delegateEvents();\r\n        }\r\n    });\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.ModalView = ModalView;\r\n    } else {\r\n        module.exports = ModalView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global Backbone, window*/\r\n\"use strict\";\r\n(function(NS) {\r\n\t//Filename: views/notifications-view.js\r\n\tNS = NS || {};\r\n\tvar isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\tvar template = isInBrowser ? NS.templates.notifications : function(){}; //require('./templates/notifications'); //Todo: call a handlebars function.\r\n\tvar NotificationsView = Backbone.View.extend({\r\n\t\ttagName: 'div',\r\n\t\tclassName: 'notifications',\r\n\t\ttemplate: template,\r\n\t\t//Render each type of notification.\r\n\t\trender: function() {\r\n\t\t\tvar messages = this.model.getMessagesByType();\r\n\t\t\t/*We have to add css property to the message in order  to use the same template.*/\r\n\t\t\tvar messageToPrint = {};\r\n\t\t\tmessageToPrint.errorMessages = {\r\n\t\t\t\tmessages: messages.errorMessages,\r\n\t\t\t\tcssMessageType: 'danger'\r\n\t\t\t};\r\n\t\t\tmessageToPrint.warningMessages = {\r\n\t\t\t\tmessages: messages.warningMessages,\r\n\t\t\t\tcssMessageType: 'warning'\r\n\t\t\t};\r\n\t\t\tmessageToPrint.successMessages = {\r\n\t\t\t\tmessages: messages.successMessages,\r\n\t\t\t\tcssMessageType: 'success'\r\n\t\t\t};\r\n\t\t\tmessageToPrint.infoMessages = {\r\n\t\t\t\tmessages: messages.infoMessages,\r\n\t\t\t\tcssMessageType: 'info'\r\n\t\t\t};\r\n\t\t\tthis.$el.html('');\r\n\t\t\t//In order to call the templat only if needed.\r\n\t\t\tfunction printMessageIfExists(messageContainerName, context) {\r\n\t\t\t\tif (messages[messageContainerName].length > 0) {\r\n\t\t\t\t\tcontext.$el.append(template(messageToPrint[messageContainerName]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprintMessageIfExists('errorMessages', this); //The this is put into a closure in order to not lose it.\r\n\t\t\tprintMessageIfExists('warningMessages', this);\r\n\t\t\tprintMessageIfExists('infoMessages', this);\r\n\t\t\tprintMessageIfExists('successMessages', this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tinitialize: function initialize() {\r\n\t\t\t//We bind the model changes to a render.\r\n\t\t\tthis.model.on('change', function() {\r\n\t\t\t\tthis.render();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tif (isInBrowser) {\r\n\t\tNS.Views = NS.Views || {};\r\n\t\tNS.Views.NotificationsView = NotificationsView;\r\n\t} else {\r\n\t\tmodule.exports = NotificationsView;\r\n\t}\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global  i18n, _, window*/\r\n(function (NS) {\r\n    \"use strict\";\r\n    // Filename: views/search-results-view.js\r\n    NS = NS || {};\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n\r\n    //Dependencies.\r\n    var ListView = isInBrowser ? NS.Views.ListView : require('./list-view');\r\n    var templateNoResults = isInBrowser ? NS.templates.noResults : function () { };\r\n\r\n    //View to use in order to display search results.\r\n    var SearchResultsView = ListView.extend({\r\n\r\n        //Defaults options of the searchresults view.\r\n        defaultOptions: _.extend({}, ListView.prototype.defaultOptions, {\r\n            isModelToLoad: false,\r\n            isReadyResultsData: true\r\n        }),\r\n\r\n        // Get the criteria used to get the results.\r\n        getCriteria : function getCriteriaResultsView(){\r\n            var criteria = this.opts.searchView.getCriteria();\r\n            return _.extend({}, ListView.prototype.getCriteria.call(this), criteria);\r\n        },\r\n\r\n        //Template use in order to display the fact that there is no results.\r\n        templateNoResults: templateNoResults,\r\n\r\n        //Trigger a fetch for the consultation \r\n        fetchDemand: function fetchDemandResultView() {\r\n            this.trigger('results:fetchDemand');\r\n        },\r\n        render: function renderSearchResultView(options) {\r\n            options = options || {};\r\n            //If the research was not launch triggered.\r\n            return ListView.prototype.render.call(this, options);\r\n        },\r\n        //Function call when there is no result.\r\n        renderEmptyList: function renderEmptySearchResults() {\r\n            //Is recherche launched.\r\n            if (this.isSearchTriggered) {\r\n                this.$el.html(this.templateNoResults({\r\n                    message: i18n.t('search.noResult')\r\n                }));\r\n            } else {\r\n                this.$el.html(this.templateNoResults({\r\n                    message: i18n.t('search.ready')\r\n                }));\r\n            }\r\n        },\r\n        toggleEditMode: function toogleEditModeSRV(event) {\r\n            if (event) {\r\n                event.preventDefault();\r\n            }\r\n            this.isEdit = !this.isEdit;\r\n            this.render({\r\n                isSearchTriggered: true\r\n            }); //todo: fix this to have no options.\r\n        },\r\n        //Indicate if the function is ready to be displayed. If not the spinner is display.\r\n        isReady: function readySearchResults() {\r\n            return this.opts.isReadyResultsData === true && ListView.prototype.isReady.call(this);\r\n        },\r\n\r\n        saveCriteria: function saveSearchCriteria(criteria, pageInfo) {\r\n            this.saveSessionCriteria({ criteria: criteria, pageInfo: pageInfo }).then(function (s) {\r\n                console.log('criteria save in session', s);\r\n            });\r\n        }\r\n    });\r\n\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.SearchResultsView = SearchResultsView;\r\n    } else {\r\n        module.exports = SearchResultsView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);","/*global Backbone, _, $, Promise, window*/\r\n\"use strict\";\r\n(function (NS) {\r\n    // Filename: views/search-view.js\r\n    NS = NS || {};\r\n    var isInBrowser = typeof module === 'undefined' && typeof window !== 'undefined';\r\n    var NotImplementedException = isInBrowser ? NS.Helpers.Exceptions.NotImplementedException : require('../helpers/custom_exception').NotImplementedException;\r\n    var ErrorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var form_helper = isInBrowser ? NS.Helpers.formHelper : require('../helpers/form_helper');\r\n    var ModelValidator = isInBrowser ? NS.Helpers.modelValidationPromise : require('../helpers/modelValidationPromise');\r\n    var CoreView = isInBrowser ? NS.Views.CoreView : require('./core-view');\r\n    var errorHelper = isInBrowser ? NS.Helpers.errorHelper : require('../helpers/error_helper');\r\n    var backboneNotification = isInBrowser ? NS.Helpers.backboneNotification : require(\"../helpers/backbone_notification\");\r\n\r\n    var SearchView = CoreView.extend({\r\n        tagName: 'div',\r\n        className: 'searchView',\r\n        ResultsView: undefined,\r\n        Results: undefined,\r\n        search: undefined,\r\n        resultsSelector: 'div#results',\r\n        isMoreCriteria: false,\r\n\r\n        //Default options of the search view.\r\n        defaultOptions: _.extend({}, Fmk.Views.CoreView.prototype.defaultOptions, {\r\n            isRefreshSearchOnInputChange: true\r\n        }),\r\n\r\n        initialize: function initializeSearch(options) {\r\n            options = options || {};\r\n            // Call the initialize function of the core view.\r\n            CoreView.prototype.initialize.call(this, options);\r\n            this.isSearchTriggered = options.isSearchTriggered || false;\r\n            this.stopListening(this.model, \"reset\");\r\n            this.isReadOnly = options.isReadOnly || false;\r\n            this.model.set({\r\n                isCriteriaReadonly: false\r\n            }, {\r\n                silent: true\r\n            });\r\n\r\n            //init results collection\r\n            this.searchResults = new this.Results();\r\n            //initialization of the result view \r\n            this.searchResultsView = new this.ResultsView({\r\n                model: this.searchResults,\r\n                criteria: this.model,\r\n                searchView: this,\r\n                isSearchTriggered : false\r\n            });\r\n            //handle the clear criteria action\r\n            this.listenTo(this.model, 'change', this.render);\r\n            this.listenTo(this.searchResultsView, 'results:fetchDemand', function () {\r\n                this.runSearch(null, {\r\n                    isFormBinded: false\r\n                });\r\n            });\r\n            this.listenTo(this.searchResultsView, 'listview:lineSelected', function () {\r\n                $('.collapse', this.$el).collapse('hide');\r\n            });\r\n            var currentView = this;\r\n            this.getSessionCriteria().then(function (crit) {\r\n                //Restore the criteria if save into the session.\r\n                if (crit !== undefined && crit !== null && crit.pageInfo !== undefined && crit.pageInfo !== null) {\r\n                    currentView.model.set(crit.criteria, { silent: false });\r\n                    currentView.searchResults.setPageInfo(crit.pageInfo);\r\n                    currentView.isSearchTriggered = true;\r\n                }\r\n                //If the serach has to be triggered, trigger it.\r\n                if (currentView.isSearchTriggered) {\r\n                    currentView.runSearch(null, {\r\n                        isFormBinded: false\r\n                    });\r\n                }\r\n            }, function (error) {\r\n                errorHelper.manageResponseErrors(error);\r\n            });\r\n\r\n            if (this.opts.isRefreshSearchOnInputChange) {\r\n                this.events = _.extend({}, this.events, this.defaultEvents, this.refreshSearchOnInputChangeEvents);\r\n            }\r\n            this.delegateEvents();\r\n        },\r\n\r\n        defaultEvents: {\r\n            \"submit form\": 'runSearch', // Launch the search.\r\n            \"click button.btnReset\": 'clearSearchCriteria', // Reset all the criteria.\r\n            \"click button.btnEditCriteria\": 'editCriteria', //Deal with the edit mode.\r\n            \"click button.toogleCriteria\": 'toogleMoreCriteria', // Deal with the more / less criteria.\r\n            \"click .panel-heading\": \"toogleCollapse\",\r\n            \"click button.btnCreate\": \"create\",\r\n        },\r\n        events: this.defaultEvents,\r\n\r\n        refreshSearchOnInputChangeEvents: {\r\n            \"change [data-refresh]  input:not([noRefresh])\": \"runSearch\",\r\n            \"change [data-refresh] select:not([noRefresh]) \": \"runSearch\"\r\n        },\r\n\r\n        //Change the fact that the view is in the mode mode or less criteria.\r\n        toogleMoreCriteria: function toogleMoreCriteria() {\r\n            this.isMoreCriteria = !this.isMoreCriteria;\r\n            form_helper.formModelBinder({\r\n                inputs: $('input', this.$el)\r\n            }, this.model);\r\n            this.render();\r\n        },\r\n        //get the JSON to attach to the template\r\n        getRenderData: function getRenderDataSearch() {\r\n            return this.model.toJSON();\r\n        },\r\n\r\n        editCriteria: function editCriteria() {\r\n            this.model.set({\r\n                isCriteriaReadonly: false\r\n            });\r\n        },\r\n        create: function createNavigate() {\r\n            this.searchResultsView.create();\r\n        },\r\n\r\n        searchSuccess: function searchSuccess(jsonResponse) {\r\n            this.searchResults.setTotalRecords(jsonResponse.totalRecords);\r\n            this.searchResults.reset(jsonResponse.values);\r\n        },\r\n        searchError: function searchError(response) {\r\n            this.searchResults.reset([]);\r\n            ErrorHelper.manageResponseErrors(response, {\r\n                isDisplay: true,\r\n                model: this.model\r\n            });\r\n        },\r\n\r\n        getCriteria: function () {\r\n            return _.clone(_.omit(this.model.toJSON(), this.referenceNames));\r\n        },\r\n\r\n        runSearch: function runSearchSearchView(event, options) {\r\n            var searchButton;\r\n            var isEvent = event !== undefined && event !== null;\r\n            if (isEvent) {\r\n                event.preventDefault();\r\n                searchButton = $(\"button[type=submit]\", event.target); // retrieving the button that triggered the search\r\n            }\r\n            options = options || {};\r\n            var isFormBinded = options.isFormBinded === undefined ? true : options.isFormBinded;\r\n            //bind form fields on model\r\n            if (isFormBinded) {\r\n                form_helper.formModelBinder({\r\n                    inputs: $('input', this.$el),\r\n                    options: $('select', this.$el)\r\n                }, this.model);\r\n            }\r\n            //Render loading inside the search results:\r\n            this.searchResultsView.opts.isReadyResultsData = false;\r\n            this.searchResultsView.render();\r\n            var currentView = this;\r\n            ModelValidator\r\n\t\t\t\t.validate(this.model)\r\n\t\t\t\t.then(function (model) {\r\n\t\t\t\t    currentView.model.unsetErrors({\r\n\t\t\t\t        silent: false\r\n\t\t\t\t    });\r\n\t\t\t\t    var criteria = currentView.getCriteria();\r\n\t\t\t\t    var pageInfo = currentView.searchResults.pageInfo();\r\n\r\n\t\t\t\t    if (isEvent) {\r\n\t\t\t\t        pageInfo.currentPage = 1;\r\n\t\t\t\t    }\r\n\r\n\t\t\t\t    currentView.search(criteria, pageInfo)\r\n\t\t\t\t\t\t.then(function success(jsonResponse) {\r\n\t\t\t\t\t\t    //Save the criteria in session.\r\n\t\t\t\t\t\t    currentView.searchResultsView.opts.isReadyResultsData = true;\r\n\t\t\t\t\t\t    currentView.searchResultsView.isSearchTriggered = true;\r\n\t\t\t\t\t\t    currentView.searchResults.setPageInfo(pageInfo);\r\n\t\t\t\t\t\t    currentView.saveSessionCriteria({\r\n\t\t\t\t\t\t        criteria: criteria,\r\n\t\t\t\t\t\t        pageInfo: pageInfo\r\n\t\t\t\t\t\t    }).then(function (s) {\r\n\t\t\t\t\t\t        //console.log('criteria save in session', s);\r\n\t\t\t\t\t\t        backboneNotification.clearNotifications();\r\n\t\t\t\t\t\t        return currentView.searchSuccess(jsonResponse);\r\n\t\t\t\t\t\t    });\r\n\t\t\t\t\t\t}).then(null, function error(errorResponse) {\r\n\t\t\t\t\t\t    currentView.searchResultsView.opts.isReadyResultsData = true;\r\n\t\t\t\t\t\t    currentView.searchError(errorResponse);\r\n\t\t\t\t\t\t}).then(function resetButton() {\r\n\t\t\t\t\t\t    if (searchButton) {\r\n\t\t\t\t\t\t        searchButton.button('reset');\r\n\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}).then(null, function error(errors) {\r\n\t\t\t\t    currentView.model.setErrors(errors);\r\n\t\t\t\t    if (searchButton) {\r\n\t\t\t\t        searchButton.button('reset');\r\n\t\t\t\t    }\r\n\t\t\t\t});\r\n\r\n            if (this.isReadOnly) {\r\n                this.model.set({\r\n                    isCriteriaReadonly: true\r\n                });\r\n            }\r\n        },\r\n\r\n        clearSearchCriteria: function clearSearchCriteria(event) {\r\n            event.preventDefault();\r\n            //Backbone.Notification.clearNotifications();\r\n            var unchanged = {};\r\n            var vals = this.getUnchangedFields();\r\n            for (var i in vals) {\r\n                unchanged[vals[i]] = this.model.get(vals[i]);\r\n            }\r\n            this.model.clear();\r\n            for (field in unchanged) {\r\n                this.model.set(field, unchanged[field], { silent: true });\r\n            }\r\n            this.saveSessionCriteria({}); // clear session criteria.\r\n            this.initialize(); //Call initialize again in order to refresh the view with criteria lists.\r\n        },\r\n\r\n        getUnchangedFields: function getUnchangedFields() { return [] },\r\n\r\n        render: function renderSearch(options) {\r\n            options = options || {};\r\n            CoreView.prototype.render.call(this, options);\r\n            this.$el.html(this.template(_.extend({\r\n                isMoreCriteria: this.isMoreCriteria\r\n            }, this.getRenderData())));\r\n            $(this.resultsSelector, this.$el).html(this.searchResultsView.render().el);\r\n            return this;\r\n        },\r\n        afterRender: function postRenderSearchView() {\r\n            CoreView.prototype.afterRender.call(this);\r\n            $('.collapse', this.$el).collapse('show');\r\n        }\r\n    });\r\n\r\n    /*ModelValidator.validate(this.model)\r\n\t\t\t.catch (currentView.model.setErrors)\r\n\t\t\t.then(function(model) {\r\n\t\t\t\tcurrentView.model.unsetErrors();\r\n\t\t\t\tcurrentView.search(currentView.model.toJSON())\r\n\t\t\t\t\t//.then(currentView.searchSuccess.bind(currentView))\r\n\t\t\t\t\t.then(currentView.searchResults.reset.bind(currentView.searchResults))\r\n\t\t\t\t\t.catch (currentView.searchError.bind(currentView))\r\n\t\t\t});*/\r\n\r\n    // Differenciating export for node or browser.\r\n    if (isInBrowser) {\r\n        NS.Views = NS.Views || {};\r\n        NS.Views.SearchView = SearchView;\r\n    } else {\r\n        module.exports = SearchView;\r\n    }\r\n})(typeof module === 'undefined' && typeof window !== 'undefined' ? window.Fmk : module.exports);"]}